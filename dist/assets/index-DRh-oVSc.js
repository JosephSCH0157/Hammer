(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=r(a);fetch(a.href,l)}})();function Tp(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Du={exports:{}},Ja={},Ou={exports:{}},_e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ym;function my(){if(ym)return _e;ym=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.iterator;function w(N){return N===null||typeof N!="object"?null:(N=y&&N[y]||N["@@iterator"],typeof N=="function"?N:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,v={};function x(N,V,ge){this.props=N,this.context=V,this.refs=v,this.updater=ge||T}x.prototype.isReactComponent={},x.prototype.setState=function(N,V){if(typeof N!="object"&&typeof N!="function"&&N!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,N,V,"setState")},x.prototype.forceUpdate=function(N){this.updater.enqueueForceUpdate(this,N,"forceUpdate")};function _(){}_.prototype=x.prototype;function A(N,V,ge){this.props=N,this.context=V,this.refs=v,this.updater=ge||T}var O=A.prototype=new _;O.constructor=A,S(O,x.prototype),O.isPureReactComponent=!0;var B=Array.isArray,j=Object.prototype.hasOwnProperty,L={current:null},q={key:!0,ref:!0,__self:!0,__source:!0};function G(N,V,ge){var Pe,be={},Ee=null,Oe=null;if(V!=null)for(Pe in V.ref!==void 0&&(Oe=V.ref),V.key!==void 0&&(Ee=""+V.key),V)j.call(V,Pe)&&!q.hasOwnProperty(Pe)&&(be[Pe]=V[Pe]);var Ae=arguments.length-2;if(Ae===1)be.children=ge;else if(1<Ae){for(var Ue=Array(Ae),ut=0;ut<Ae;ut++)Ue[ut]=arguments[ut+2];be.children=Ue}if(N&&N.defaultProps)for(Pe in Ae=N.defaultProps,Ae)be[Pe]===void 0&&(be[Pe]=Ae[Pe]);return{$$typeof:n,type:N,key:Ee,ref:Oe,props:be,_owner:L.current}}function se(N,V){return{$$typeof:n,type:N.type,key:V,ref:N.ref,props:N.props,_owner:N._owner}}function oe(N){return typeof N=="object"&&N!==null&&N.$$typeof===n}function re(N){var V={"=":"=0",":":"=2"};return"$"+N.replace(/[=:]/g,function(ge){return V[ge]})}var ne=/\/+/g;function he(N,V){return typeof N=="object"&&N!==null&&N.key!=null?re(""+N.key):V.toString(36)}function ze(N,V,ge,Pe,be){var Ee=typeof N;(Ee==="undefined"||Ee==="boolean")&&(N=null);var Oe=!1;if(N===null)Oe=!0;else switch(Ee){case"string":case"number":Oe=!0;break;case"object":switch(N.$$typeof){case n:case e:Oe=!0}}if(Oe)return Oe=N,be=be(Oe),N=Pe===""?"."+he(Oe,0):Pe,B(be)?(ge="",N!=null&&(ge=N.replace(ne,"$&/")+"/"),ze(be,V,ge,"",function(ut){return ut})):be!=null&&(oe(be)&&(be=se(be,ge+(!be.key||Oe&&Oe.key===be.key?"":(""+be.key).replace(ne,"$&/")+"/")+N)),V.push(be)),1;if(Oe=0,Pe=Pe===""?".":Pe+":",B(N))for(var Ae=0;Ae<N.length;Ae++){Ee=N[Ae];var Ue=Pe+he(Ee,Ae);Oe+=ze(Ee,V,ge,Ue,be)}else if(Ue=w(N),typeof Ue=="function")for(N=Ue.call(N),Ae=0;!(Ee=N.next()).done;)Ee=Ee.value,Ue=Pe+he(Ee,Ae++),Oe+=ze(Ee,V,ge,Ue,be);else if(Ee==="object")throw V=String(N),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(N).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.");return Oe}function Ze(N,V,ge){if(N==null)return N;var Pe=[],be=0;return ze(N,Pe,"","",function(Ee){return V.call(ge,Ee,be++)}),Pe}function Ne(N){if(N._status===-1){var V=N._result;V=V(),V.then(function(ge){(N._status===0||N._status===-1)&&(N._status=1,N._result=ge)},function(ge){(N._status===0||N._status===-1)&&(N._status=2,N._result=ge)}),N._status===-1&&(N._status=0,N._result=V)}if(N._status===1)return N._result.default;throw N._result}var Ce={current:null},Q={transition:null},fe={ReactCurrentDispatcher:Ce,ReactCurrentBatchConfig:Q,ReactCurrentOwner:L};function X(){throw Error("act(...) is not supported in production builds of React.")}return _e.Children={map:Ze,forEach:function(N,V,ge){Ze(N,function(){V.apply(this,arguments)},ge)},count:function(N){var V=0;return Ze(N,function(){V++}),V},toArray:function(N){return Ze(N,function(V){return V})||[]},only:function(N){if(!oe(N))throw Error("React.Children.only expected to receive a single React element child.");return N}},_e.Component=x,_e.Fragment=r,_e.Profiler=a,_e.PureComponent=A,_e.StrictMode=s,_e.Suspense=f,_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fe,_e.act=X,_e.cloneElement=function(N,V,ge){if(N==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+N+".");var Pe=S({},N.props),be=N.key,Ee=N.ref,Oe=N._owner;if(V!=null){if(V.ref!==void 0&&(Ee=V.ref,Oe=L.current),V.key!==void 0&&(be=""+V.key),N.type&&N.type.defaultProps)var Ae=N.type.defaultProps;for(Ue in V)j.call(V,Ue)&&!q.hasOwnProperty(Ue)&&(Pe[Ue]=V[Ue]===void 0&&Ae!==void 0?Ae[Ue]:V[Ue])}var Ue=arguments.length-2;if(Ue===1)Pe.children=ge;else if(1<Ue){Ae=Array(Ue);for(var ut=0;ut<Ue;ut++)Ae[ut]=arguments[ut+2];Pe.children=Ae}return{$$typeof:n,type:N.type,key:be,ref:Ee,props:Pe,_owner:Oe}},_e.createContext=function(N){return N={$$typeof:c,_currentValue:N,_currentValue2:N,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},N.Provider={$$typeof:l,_context:N},N.Consumer=N},_e.createElement=G,_e.createFactory=function(N){var V=G.bind(null,N);return V.type=N,V},_e.createRef=function(){return{current:null}},_e.forwardRef=function(N){return{$$typeof:u,render:N}},_e.isValidElement=oe,_e.lazy=function(N){return{$$typeof:g,_payload:{_status:-1,_result:N},_init:Ne}},_e.memo=function(N,V){return{$$typeof:m,type:N,compare:V===void 0?null:V}},_e.startTransition=function(N){var V=Q.transition;Q.transition={};try{N()}finally{Q.transition=V}},_e.unstable_act=X,_e.useCallback=function(N,V){return Ce.current.useCallback(N,V)},_e.useContext=function(N){return Ce.current.useContext(N)},_e.useDebugValue=function(){},_e.useDeferredValue=function(N){return Ce.current.useDeferredValue(N)},_e.useEffect=function(N,V){return Ce.current.useEffect(N,V)},_e.useId=function(){return Ce.current.useId()},_e.useImperativeHandle=function(N,V,ge){return Ce.current.useImperativeHandle(N,V,ge)},_e.useInsertionEffect=function(N,V){return Ce.current.useInsertionEffect(N,V)},_e.useLayoutEffect=function(N,V){return Ce.current.useLayoutEffect(N,V)},_e.useMemo=function(N,V){return Ce.current.useMemo(N,V)},_e.useReducer=function(N,V,ge){return Ce.current.useReducer(N,V,ge)},_e.useRef=function(N){return Ce.current.useRef(N)},_e.useState=function(N){return Ce.current.useState(N)},_e.useSyncExternalStore=function(N,V,ge){return Ce.current.useSyncExternalStore(N,V,ge)},_e.useTransition=function(){return Ce.current.useTransition()},_e.version="18.3.1",_e}var wm;function Bd(){return wm||(wm=1,Ou.exports=my()),Ou.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var km;function py(){if(km)return Ja;km=1;var n=Bd(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(u,f,m){var g,y={},w=null,T=null;m!==void 0&&(w=""+m),f.key!==void 0&&(w=""+f.key),f.ref!==void 0&&(T=f.ref);for(g in f)s.call(f,g)&&!l.hasOwnProperty(g)&&(y[g]=f[g]);if(u&&u.defaultProps)for(g in f=u.defaultProps,f)y[g]===void 0&&(y[g]=f[g]);return{$$typeof:e,type:u,key:w,ref:T,props:y,_owner:a.current}}return Ja.Fragment=r,Ja.jsx=c,Ja.jsxs=c,Ja}var Tm;function gy(){return Tm||(Tm=1,Du.exports=py()),Du.exports}var C=gy(),Y=Bd();const yy=Tp(Y);var Fl={},Uu={exports:{}},jt={},Lu={exports:{}},ju={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sm;function wy(){return Sm||(Sm=1,(function(n){function e(Q,fe){var X=Q.length;Q.push(fe);e:for(;0<X;){var N=X-1>>>1,V=Q[N];if(0<a(V,fe))Q[N]=fe,Q[X]=V,X=N;else break e}}function r(Q){return Q.length===0?null:Q[0]}function s(Q){if(Q.length===0)return null;var fe=Q[0],X=Q.pop();if(X!==fe){Q[0]=X;e:for(var N=0,V=Q.length,ge=V>>>1;N<ge;){var Pe=2*(N+1)-1,be=Q[Pe],Ee=Pe+1,Oe=Q[Ee];if(0>a(be,X))Ee<V&&0>a(Oe,be)?(Q[N]=Oe,Q[Ee]=X,N=Ee):(Q[N]=be,Q[Pe]=X,N=Pe);else if(Ee<V&&0>a(Oe,X))Q[N]=Oe,Q[Ee]=X,N=Ee;else break e}}return fe}function a(Q,fe){var X=Q.sortIndex-fe.sortIndex;return X!==0?X:Q.id-fe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;n.unstable_now=function(){return l.now()}}else{var c=Date,u=c.now();n.unstable_now=function(){return c.now()-u}}var f=[],m=[],g=1,y=null,w=3,T=!1,S=!1,v=!1,x=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function O(Q){for(var fe=r(m);fe!==null;){if(fe.callback===null)s(m);else if(fe.startTime<=Q)s(m),fe.sortIndex=fe.expirationTime,e(f,fe);else break;fe=r(m)}}function B(Q){if(v=!1,O(Q),!S)if(r(f)!==null)S=!0,Ne(j);else{var fe=r(m);fe!==null&&Ce(B,fe.startTime-Q)}}function j(Q,fe){S=!1,v&&(v=!1,_(G),G=-1),T=!0;var X=w;try{for(O(fe),y=r(f);y!==null&&(!(y.expirationTime>fe)||Q&&!re());){var N=y.callback;if(typeof N=="function"){y.callback=null,w=y.priorityLevel;var V=N(y.expirationTime<=fe);fe=n.unstable_now(),typeof V=="function"?y.callback=V:y===r(f)&&s(f),O(fe)}else s(f);y=r(f)}if(y!==null)var ge=!0;else{var Pe=r(m);Pe!==null&&Ce(B,Pe.startTime-fe),ge=!1}return ge}finally{y=null,w=X,T=!1}}var L=!1,q=null,G=-1,se=5,oe=-1;function re(){return!(n.unstable_now()-oe<se)}function ne(){if(q!==null){var Q=n.unstable_now();oe=Q;var fe=!0;try{fe=q(!0,Q)}finally{fe?he():(L=!1,q=null)}}else L=!1}var he;if(typeof A=="function")he=function(){A(ne)};else if(typeof MessageChannel<"u"){var ze=new MessageChannel,Ze=ze.port2;ze.port1.onmessage=ne,he=function(){Ze.postMessage(null)}}else he=function(){x(ne,0)};function Ne(Q){q=Q,L||(L=!0,he())}function Ce(Q,fe){G=x(function(){Q(n.unstable_now())},fe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Q){Q.callback=null},n.unstable_continueExecution=function(){S||T||(S=!0,Ne(j))},n.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):se=0<Q?Math.floor(1e3/Q):5},n.unstable_getCurrentPriorityLevel=function(){return w},n.unstable_getFirstCallbackNode=function(){return r(f)},n.unstable_next=function(Q){switch(w){case 1:case 2:case 3:var fe=3;break;default:fe=w}var X=w;w=fe;try{return Q()}finally{w=X}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Q,fe){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var X=w;w=Q;try{return fe()}finally{w=X}},n.unstable_scheduleCallback=function(Q,fe,X){var N=n.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?N+X:N):X=N,Q){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=X+V,Q={id:g++,callback:fe,priorityLevel:Q,startTime:X,expirationTime:V,sortIndex:-1},X>N?(Q.sortIndex=X,e(m,Q),r(f)===null&&Q===r(m)&&(v?(_(G),G=-1):v=!0,Ce(B,X-N))):(Q.sortIndex=V,e(f,Q),S||T||(S=!0,Ne(j))),Q},n.unstable_shouldYield=re,n.unstable_wrapCallback=function(Q){var fe=w;return function(){var X=w;w=fe;try{return Q.apply(this,arguments)}finally{w=X}}}})(ju)),ju}var vm;function ky(){return vm||(vm=1,Lu.exports=wy()),Lu.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bm;function Ty(){if(bm)return jt;bm=1;var n=Bd(),e=ky();function r(t){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+t,o=1;o<arguments.length;o++)i+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function l(t,i){c(t,i),c(t+"Capture",i)}function c(t,i){for(a[t]=i,t=0;t<i.length;t++)s.add(i[t])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),f=Object.prototype.hasOwnProperty,m=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},y={};function w(t){return f.call(y,t)?!0:f.call(g,t)?!1:m.test(t)?y[t]=!0:(g[t]=!0,!1)}function T(t,i,o,d){if(o!==null&&o.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return d?!1:o!==null?!o.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function S(t,i,o,d){if(i===null||typeof i>"u"||T(t,i,o,d))return!0;if(d)return!1;if(o!==null)switch(o.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function v(t,i,o,d,h,p,k){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=d,this.attributeNamespace=h,this.mustUseProperty=o,this.propertyName=t,this.type=i,this.sanitizeURL=p,this.removeEmptyString=k}var x={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){x[t]=new v(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var i=t[0];x[i]=new v(i,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){x[t]=new v(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){x[t]=new v(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){x[t]=new v(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){x[t]=new v(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){x[t]=new v(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){x[t]=new v(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){x[t]=new v(t,5,!1,t.toLowerCase(),null,!1,!1)});var _=/[\-:]([a-z])/g;function A(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var i=t.replace(_,A);x[i]=new v(i,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var i=t.replace(_,A);x[i]=new v(i,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var i=t.replace(_,A);x[i]=new v(i,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){x[t]=new v(t,1,!1,t.toLowerCase(),null,!1,!1)}),x.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){x[t]=new v(t,1,!1,t.toLowerCase(),null,!0,!0)});function O(t,i,o,d){var h=x.hasOwnProperty(i)?x[i]:null;(h!==null?h.type!==0:d||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(S(i,o,h,d)&&(o=null),d||h===null?w(i)&&(o===null?t.removeAttribute(i):t.setAttribute(i,""+o)):h.mustUseProperty?t[h.propertyName]=o===null?h.type===3?!1:"":o:(i=h.attributeName,d=h.attributeNamespace,o===null?t.removeAttribute(i):(h=h.type,o=h===3||h===4&&o===!0?"":""+o,d?t.setAttributeNS(d,i,o):t.setAttribute(i,o))))}var B=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j=Symbol.for("react.element"),L=Symbol.for("react.portal"),q=Symbol.for("react.fragment"),G=Symbol.for("react.strict_mode"),se=Symbol.for("react.profiler"),oe=Symbol.for("react.provider"),re=Symbol.for("react.context"),ne=Symbol.for("react.forward_ref"),he=Symbol.for("react.suspense"),ze=Symbol.for("react.suspense_list"),Ze=Symbol.for("react.memo"),Ne=Symbol.for("react.lazy"),Ce=Symbol.for("react.offscreen"),Q=Symbol.iterator;function fe(t){return t===null||typeof t!="object"?null:(t=Q&&t[Q]||t["@@iterator"],typeof t=="function"?t:null)}var X=Object.assign,N;function V(t){if(N===void 0)try{throw Error()}catch(o){var i=o.stack.trim().match(/\n( *(at )?)/);N=i&&i[1]||""}return`
`+N+t}var ge=!1;function Pe(t,i){if(!t||ge)return"";ge=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(U){var d=U}Reflect.construct(t,[],i)}else{try{i.call()}catch(U){d=U}t.call(i.prototype)}else{try{throw Error()}catch(U){d=U}t()}}catch(U){if(U&&d&&typeof U.stack=="string"){for(var h=U.stack.split(`
`),p=d.stack.split(`
`),k=h.length-1,P=p.length-1;1<=k&&0<=P&&h[k]!==p[P];)P--;for(;1<=k&&0<=P;k--,P--)if(h[k]!==p[P]){if(k!==1||P!==1)do if(k--,P--,0>P||h[k]!==p[P]){var M=`
`+h[k].replace(" at new "," at ");return t.displayName&&M.includes("<anonymous>")&&(M=M.replace("<anonymous>",t.displayName)),M}while(1<=k&&0<=P);break}}}finally{ge=!1,Error.prepareStackTrace=o}return(t=t?t.displayName||t.name:"")?V(t):""}function be(t){switch(t.tag){case 5:return V(t.type);case 16:return V("Lazy");case 13:return V("Suspense");case 19:return V("SuspenseList");case 0:case 2:case 15:return t=Pe(t.type,!1),t;case 11:return t=Pe(t.type.render,!1),t;case 1:return t=Pe(t.type,!0),t;default:return""}}function Ee(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case q:return"Fragment";case L:return"Portal";case se:return"Profiler";case G:return"StrictMode";case he:return"Suspense";case ze:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case re:return(t.displayName||"Context")+".Consumer";case oe:return(t._context.displayName||"Context")+".Provider";case ne:var i=t.render;return t=t.displayName,t||(t=i.displayName||i.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Ze:return i=t.displayName||null,i!==null?i:Ee(t.type)||"Memo";case Ne:i=t._payload,t=t._init;try{return Ee(t(i))}catch{}}return null}function Oe(t){var i=t.type;switch(t.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=i.render,t=t.displayName||t.name||"",i.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ee(i);case 8:return i===G?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Ae(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Ue(t){var i=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function ut(t){var i=Ue(t)?"checked":"value",o=Object.getOwnPropertyDescriptor(t.constructor.prototype,i),d=""+t[i];if(!t.hasOwnProperty(i)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var h=o.get,p=o.set;return Object.defineProperty(t,i,{configurable:!0,get:function(){return h.call(this)},set:function(k){d=""+k,p.call(this,k)}}),Object.defineProperty(t,i,{enumerable:o.enumerable}),{getValue:function(){return d},setValue:function(k){d=""+k},stopTracking:function(){t._valueTracker=null,delete t[i]}}}}function Rn(t){t._valueTracker||(t._valueTracker=ut(t))}function aa(t){if(!t)return!1;var i=t._valueTracker;if(!i)return!0;var o=i.getValue(),d="";return t&&(d=Ue(t)?t.checked?"true":"false":t.value),t=d,t!==o?(i.setValue(t),!0):!1}function en(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Gn(t,i){var o=i.checked;return X({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??t._wrapperState.initialChecked})}function ci(t,i){var o=i.defaultValue==null?"":i.defaultValue,d=i.checked!=null?i.checked:i.defaultChecked;o=Ae(i.value!=null?i.value:o),t._wrapperState={initialChecked:d,initialValue:o,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function Gi(t,i){i=i.checked,i!=null&&O(t,"checked",i,!1)}function oa(t,i){Gi(t,i);var o=Ae(i.value),d=i.type;if(o!=null)d==="number"?(o===0&&t.value===""||t.value!=o)&&(t.value=""+o):t.value!==""+o&&(t.value=""+o);else if(d==="submit"||d==="reset"){t.removeAttribute("value");return}i.hasOwnProperty("value")?la(t,i.type,o):i.hasOwnProperty("defaultValue")&&la(t,i.type,Ae(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(t.defaultChecked=!!i.defaultChecked)}function Sr(t,i,o){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var d=i.type;if(!(d!=="submit"&&d!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+t._wrapperState.initialValue,o||i===t.value||(t.value=i),t.defaultValue=i}o=t.name,o!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,o!==""&&(t.name=o)}function la(t,i,o){(i!=="number"||en(t.ownerDocument)!==t)&&(o==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+o&&(t.defaultValue=""+o))}var ui=Array.isArray;function Xn(t,i,o,d){if(t=t.options,i){i={};for(var h=0;h<o.length;h++)i["$"+o[h]]=!0;for(o=0;o<t.length;o++)h=i.hasOwnProperty("$"+t[o].value),t[o].selected!==h&&(t[o].selected=h),h&&d&&(t[o].defaultSelected=!0)}else{for(o=""+Ae(o),i=null,h=0;h<t.length;h++){if(t[h].value===o){t[h].selected=!0,d&&(t[h].defaultSelected=!0);return}i!==null||t[h].disabled||(i=t[h])}i!==null&&(i.selected=!0)}}function Xi(t,i){if(i.dangerouslySetInnerHTML!=null)throw Error(r(91));return X({},i,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function So(t,i){var o=i.value;if(o==null){if(o=i.children,i=i.defaultValue,o!=null){if(i!=null)throw Error(r(92));if(ui(o)){if(1<o.length)throw Error(r(93));o=o[0]}i=o}i==null&&(i=""),o=i}t._wrapperState={initialValue:Ae(o)}}function ca(t,i){var o=Ae(i.value),d=Ae(i.defaultValue);o!=null&&(o=""+o,o!==t.value&&(t.value=o),i.defaultValue==null&&t.defaultValue!==o&&(t.defaultValue=o)),d!=null&&(t.defaultValue=""+d)}function vo(t){var i=t.textContent;i===t._wrapperState.initialValue&&i!==""&&i!==null&&(t.value=i)}function nt(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function vr(t,i){return t==null||t==="http://www.w3.org/1999/xhtml"?nt(i):t==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Yn,ua=(function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,o,d,h){MSApp.execUnsafeLocalFunction(function(){return t(i,o,d,h)})}:t})(function(t,i){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=i;else{for(Yn=Yn||document.createElement("div"),Yn.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Yn.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;i.firstChild;)t.appendChild(i.firstChild)}});function st(t,i){if(i){var o=t.firstChild;if(o&&o===t.lastChild&&o.nodeType===3){o.nodeValue=i;return}}t.textContent=i}var br={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ec=["Webkit","ms","Moz","O"];Object.keys(br).forEach(function(t){ec.forEach(function(i){i=i+t.charAt(0).toUpperCase()+t.substring(1),br[i]=br[t]})});function bo(t,i,o){return i==null||typeof i=="boolean"||i===""?"":o||typeof i!="number"||i===0||br.hasOwnProperty(t)&&br[t]?(""+i).trim():i+"px"}function xo(t,i){t=t.style;for(var o in i)if(i.hasOwnProperty(o)){var d=o.indexOf("--")===0,h=bo(o,i[o],d);o==="float"&&(o="cssFloat"),d?t.setProperty(o,h):t[o]=h}}var tc=X({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Yi(t,i){if(i){if(tc[t]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(r(137,t));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(r(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(r(61))}if(i.style!=null&&typeof i.style!="object")throw Error(r(62))}}function di(t,i){if(t.indexOf("-")===-1)return typeof i.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xr=null;function da(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Cr=null,Pr=null,$t=null;function Co(t){if(t=Oa(t)){if(typeof Cr!="function")throw Error(r(280));var i=t.stateNode;i&&(i=qo(i),Cr(t.stateNode,t.type,i))}}function Zn(t){Pr?$t?$t.push(t):$t=[t]:Pr=t}function Zi(){if(Pr){var t=Pr,i=$t;if($t=Pr=null,Co(t),i)for(t=0;t<i.length;t++)Co(i[t])}}function fa(t,i){return t(i)}function Po(){}var Ji=!1;function Eo(t,i,o){if(Ji)return t(i,o);Ji=!0;try{return fa(t,i,o)}finally{Ji=!1,(Pr!==null||$t!==null)&&(Po(),Zi())}}function tn(t,i){var o=t.stateNode;if(o===null)return null;var d=qo(o);if(d===null)return null;o=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(t=t.type,d=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!d;break e;default:t=!1}if(t)return null;if(o&&typeof o!="function")throw Error(r(231,i,typeof o));return o}var Er=!1;if(u)try{var Jn={};Object.defineProperty(Jn,"passive",{get:function(){Er=!0}}),window.addEventListener("test",Jn,Jn),window.removeEventListener("test",Jn,Jn)}catch{Er=!1}function es(t,i,o,d,h,p,k,P,M){var U=Array.prototype.slice.call(arguments,3);try{i.apply(o,U)}catch($){this.onError($)}}var _r=!1,er=null,fi=!1,ts=null,_o={onError:function(t){_r=!0,er=t}};function nn(t,i,o,d,h,p,k,P,M){_r=!1,er=null,es.apply(_o,arguments)}function Io(t,i,o,d,h,p,k,P,M){if(nn.apply(this,arguments),_r){if(_r){var U=er;_r=!1,er=null}else throw Error(r(198));fi||(fi=!0,ts=U)}}function zn(t){var i=t,o=t;if(t.alternate)for(;i.return;)i=i.return;else{t=i;do i=t,(i.flags&4098)!==0&&(o=i.return),t=i.return;while(t)}return i.tag===3?o:null}function hi(t){if(t.tag===13){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function Ir(t){if(zn(t)!==t)throw Error(r(188))}function mi(t){var i=t.alternate;if(!i){if(i=zn(t),i===null)throw Error(r(188));return i!==t?null:t}for(var o=t,d=i;;){var h=o.return;if(h===null)break;var p=h.alternate;if(p===null){if(d=h.return,d!==null){o=d;continue}break}if(h.child===p.child){for(p=h.child;p;){if(p===o)return Ir(h),t;if(p===d)return Ir(h),i;p=p.sibling}throw Error(r(188))}if(o.return!==d.return)o=h,d=p;else{for(var k=!1,P=h.child;P;){if(P===o){k=!0,o=h,d=p;break}if(P===d){k=!0,d=h,o=p;break}P=P.sibling}if(!k){for(P=p.child;P;){if(P===o){k=!0,o=p,d=h;break}if(P===d){k=!0,d=p,o=h;break}P=P.sibling}if(!k)throw Error(r(189))}}if(o.alternate!==d)throw Error(r(190))}if(o.tag!==3)throw Error(r(188));return o.stateNode.current===o?t:i}function yn(t){return t=mi(t),t!==null?Ar(t):null}function Ar(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var i=Ar(t);if(i!==null)return i;t=t.sibling}return null}var Mr=e.unstable_scheduleCallback,St=e.unstable_cancelCallback,rn=e.unstable_shouldYield,ha=e.unstable_requestPaint,je=e.unstable_now,nc=e.unstable_getCurrentPriorityLevel,ma=e.unstable_ImmediatePriority,pa=e.unstable_UserBlockingPriority,ns=e.unstable_NormalPriority,rc=e.unstable_LowPriority,Ao=e.unstable_IdlePriority,pi=null,Rt=null;function gi(t){if(Rt&&typeof Rt.onCommitFiberRoot=="function")try{Rt.onCommitFiberRoot(pi,t,void 0,(t.current.flags&128)===128)}catch{}}var Qt=Math.clz32?Math.clz32:ga,sn=Math.log,ic=Math.LN2;function ga(t){return t>>>=0,t===0?32:31-(sn(t)/ic|0)|0}var yi=64,wn=4194304;function Fr(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function wi(t,i){var o=t.pendingLanes;if(o===0)return 0;var d=0,h=t.suspendedLanes,p=t.pingedLanes,k=o&268435455;if(k!==0){var P=k&~h;P!==0?d=Fr(P):(p&=k,p!==0&&(d=Fr(p)))}else k=o&~h,k!==0?d=Fr(k):p!==0&&(d=Fr(p));if(d===0)return 0;if(i!==0&&i!==d&&(i&h)===0&&(h=d&-d,p=i&-i,h>=p||h===16&&(p&4194240)!==0))return i;if((d&4)!==0&&(d|=o&16),i=t.entangledLanes,i!==0)for(t=t.entanglements,i&=d;0<i;)o=31-Qt(i),h=1<<o,d|=t[o],i&=~h;return d}function sc(t,i){switch(t){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Mo(t,i){for(var o=t.suspendedLanes,d=t.pingedLanes,h=t.expirationTimes,p=t.pendingLanes;0<p;){var k=31-Qt(p),P=1<<k,M=h[k];M===-1?((P&o)===0||(P&d)!==0)&&(h[k]=sc(P,i)):M<=i&&(t.expiredLanes|=P),p&=~P}}function ya(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function rt(){var t=yi;return yi<<=1,(yi&4194240)===0&&(yi=64),t}function qt(t){for(var i=[],o=0;31>o;o++)i.push(t);return i}function an(t,i,o){t.pendingLanes|=i,i!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,i=31-Qt(i),t[i]=o}function Fo(t,i){var o=t.pendingLanes&~i;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=i,t.mutableReadLanes&=i,t.entangledLanes&=i,i=t.entanglements;var d=t.eventTimes;for(t=t.expirationTimes;0<o;){var h=31-Qt(o),p=1<<h;i[h]=0,d[h]=-1,t[h]=-1,o&=~p}}function wa(t,i){var o=t.entangledLanes|=i;for(t=t.entanglements;o;){var d=31-Qt(o),h=1<<d;h&i|t[d]&i&&(t[d]|=i),o&=~h}}var Me=0;function ka(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var Ta,rs,is,ss,No,as=!1,ki=[],zt=null,kn=null,Bn=null,Dn=new Map,Ti=new Map,On=[],Nr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ro(t,i){switch(t){case"focusin":case"focusout":zt=null;break;case"dragenter":case"dragleave":kn=null;break;case"mouseover":case"mouseout":Bn=null;break;case"pointerover":case"pointerout":Dn.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ti.delete(i.pointerId)}}function Si(t,i,o,d,h,p){return t===null||t.nativeEvent!==p?(t={blockedOn:i,domEventName:o,eventSystemFlags:d,nativeEvent:p,targetContainers:[h]},i!==null&&(i=Oa(i),i!==null&&rs(i)),t):(t.eventSystemFlags|=d,i=t.targetContainers,h!==null&&i.indexOf(h)===-1&&i.push(h),t)}function ac(t,i,o,d,h){switch(i){case"focusin":return zt=Si(zt,t,i,o,d,h),!0;case"dragenter":return kn=Si(kn,t,i,o,d,h),!0;case"mouseover":return Bn=Si(Bn,t,i,o,d,h),!0;case"pointerover":var p=h.pointerId;return Dn.set(p,Si(Dn.get(p)||null,t,i,o,d,h)),!0;case"gotpointercapture":return p=h.pointerId,Ti.set(p,Si(Ti.get(p)||null,t,i,o,d,h)),!0}return!1}function zo(t){var i=Pi(t.target);if(i!==null){var o=zn(i);if(o!==null){if(i=o.tag,i===13){if(i=hi(o),i!==null){t.blockedOn=i,No(t.priority,function(){is(o)});return}}else if(i===3&&o.stateNode.current.memoizedState.isDehydrated){t.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}t.blockedOn=null}function os(t){if(t.blockedOn!==null)return!1;for(var i=t.targetContainers;0<i.length;){var o=va(t.domEventName,t.eventSystemFlags,i[0],t.nativeEvent);if(o===null){o=t.nativeEvent;var d=new o.constructor(o.type,o);xr=d,o.target.dispatchEvent(d),xr=null}else return i=Oa(o),i!==null&&rs(i),t.blockedOn=o,!1;i.shift()}return!0}function Bo(t,i,o){os(t)&&o.delete(i)}function oc(){as=!1,zt!==null&&os(zt)&&(zt=null),kn!==null&&os(kn)&&(kn=null),Bn!==null&&os(Bn)&&(Bn=null),Dn.forEach(Bo),Ti.forEach(Bo)}function vi(t,i){t.blockedOn===i&&(t.blockedOn=null,as||(as=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,oc)))}function tr(t){function i(h){return vi(h,t)}if(0<ki.length){vi(ki[0],t);for(var o=1;o<ki.length;o++){var d=ki[o];d.blockedOn===t&&(d.blockedOn=null)}}for(zt!==null&&vi(zt,t),kn!==null&&vi(kn,t),Bn!==null&&vi(Bn,t),Dn.forEach(i),Ti.forEach(i),o=0;o<On.length;o++)d=On[o],d.blockedOn===t&&(d.blockedOn=null);for(;0<On.length&&(o=On[0],o.blockedOn===null);)zo(o),o.blockedOn===null&&On.shift()}var Rr=B.ReactCurrentBatchConfig,ls=!0;function lc(t,i,o,d){var h=Me,p=Rr.transition;Rr.transition=null;try{Me=1,Sa(t,i,o,d)}finally{Me=h,Rr.transition=p}}function cc(t,i,o,d){var h=Me,p=Rr.transition;Rr.transition=null;try{Me=4,Sa(t,i,o,d)}finally{Me=h,Rr.transition=p}}function Sa(t,i,o,d){if(ls){var h=va(t,i,o,d);if(h===null)Ec(t,i,d,cs,o),Ro(t,d);else if(ac(h,t,i,o,d))d.stopPropagation();else if(Ro(t,d),i&4&&-1<Nr.indexOf(t)){for(;h!==null;){var p=Oa(h);if(p!==null&&Ta(p),p=va(t,i,o,d),p===null&&Ec(t,i,d,cs,o),p===h)break;h=p}h!==null&&d.stopPropagation()}else Ec(t,i,d,null,o)}}var cs=null;function va(t,i,o,d){if(cs=null,t=da(d),t=Pi(t),t!==null)if(i=zn(t),i===null)t=null;else if(o=i.tag,o===13){if(t=hi(i),t!==null)return t;t=null}else if(o===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;t=null}else i!==t&&(t=null);return cs=t,null}function Do(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(nc()){case ma:return 1;case pa:return 4;case ns:case rc:return 16;case Ao:return 536870912;default:return 16}default:return 16}}var Un=null,ba=null,us=null;function xa(){if(us)return us;var t,i=ba,o=i.length,d,h="value"in Un?Un.value:Un.textContent,p=h.length;for(t=0;t<o&&i[t]===h[t];t++);var k=o-t;for(d=1;d<=k&&i[o-d]===h[p-d];d++);return us=h.slice(t,1<d?1-d:void 0)}function ds(t){var i=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&i===13&&(t=13)):t=i,t===10&&(t=13),32<=t||t===13?t:0}function fs(){return!0}function zr(){return!1}function At(t){function i(o,d,h,p,k){this._reactName=o,this._targetInst=h,this.type=d,this.nativeEvent=p,this.target=k,this.currentTarget=null;for(var P in t)t.hasOwnProperty(P)&&(o=t[P],this[P]=o?o(p):p[P]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?fs:zr,this.isPropagationStopped=zr,this}return X(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=fs)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=fs)},persist:function(){},isPersistent:fs}),i}var Br={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ca=At(Br),bi=X({},Br,{view:0,detail:0}),uc=At(bi),Pa,Ea,xi,hs=X({},bi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xe,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==xi&&(xi&&t.type==="mousemove"?(Pa=t.screenX-xi.screenX,Ea=t.screenY-xi.screenY):Ea=Pa=0,xi=t),Pa)},movementY:function(t){return"movementY"in t?t.movementY:Ea}}),Oo=At(hs),Uo=X({},hs,{dataTransfer:0}),dc=At(Uo),fc=X({},bi,{relatedTarget:0}),Ci=At(fc),hc=X({},Br,{animationName:0,elapsedTime:0,pseudoElement:0}),mc=At(hc),pc=X({},Br,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),gc=At(pc),E=X({},Br,{data:0}),D=At(E),W={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ee={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Te={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Le(t){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(t):(t=Te[t])?!!i[t]:!1}function xe(){return Le}var We=X({},bi,{key:function(t){if(t.key){var i=W[t.key]||t.key;if(i!=="Unidentified")return i}return t.type==="keypress"?(t=ds(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?ee[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xe,charCode:function(t){return t.type==="keypress"?ds(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ds(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Mt=At(We),Kt=X({},hs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_a=At(Kt),r0=X({},bi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xe}),i0=At(r0),s0=X({},Br,{propertyName:0,elapsedTime:0,pseudoElement:0}),a0=At(s0),o0=X({},hs,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),l0=At(o0),c0=[9,13,27,32],yc=u&&"CompositionEvent"in window,Ia=null;u&&"documentMode"in document&&(Ia=document.documentMode);var u0=u&&"TextEvent"in window&&!Ia,cf=u&&(!yc||Ia&&8<Ia&&11>=Ia),uf=" ",df=!1;function ff(t,i){switch(t){case"keyup":return c0.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hf(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ms=!1;function d0(t,i){switch(t){case"compositionend":return hf(i);case"keypress":return i.which!==32?null:(df=!0,uf);case"textInput":return t=i.data,t===uf&&df?null:t;default:return null}}function f0(t,i){if(ms)return t==="compositionend"||!yc&&ff(t,i)?(t=xa(),us=ba=Un=null,ms=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return cf&&i.locale!=="ko"?null:i.data;default:return null}}var h0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mf(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i==="input"?!!h0[t.type]:i==="textarea"}function pf(t,i,o,d){Zn(d),i=Ho(i,"onChange"),0<i.length&&(o=new Ca("onChange","change",null,o,d),t.push({event:o,listeners:i}))}var Aa=null,Ma=null;function m0(t){Nf(t,0)}function Lo(t){var i=ks(t);if(aa(i))return t}function p0(t,i){if(t==="change")return i}var gf=!1;if(u){var wc;if(u){var kc="oninput"in document;if(!kc){var yf=document.createElement("div");yf.setAttribute("oninput","return;"),kc=typeof yf.oninput=="function"}wc=kc}else wc=!1;gf=wc&&(!document.documentMode||9<document.documentMode)}function wf(){Aa&&(Aa.detachEvent("onpropertychange",kf),Ma=Aa=null)}function kf(t){if(t.propertyName==="value"&&Lo(Ma)){var i=[];pf(i,Ma,t,da(t)),Eo(m0,i)}}function g0(t,i,o){t==="focusin"?(wf(),Aa=i,Ma=o,Aa.attachEvent("onpropertychange",kf)):t==="focusout"&&wf()}function y0(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Lo(Ma)}function w0(t,i){if(t==="click")return Lo(i)}function k0(t,i){if(t==="input"||t==="change")return Lo(i)}function T0(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var Tn=typeof Object.is=="function"?Object.is:T0;function Fa(t,i){if(Tn(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;var o=Object.keys(t),d=Object.keys(i);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var h=o[d];if(!f.call(i,h)||!Tn(t[h],i[h]))return!1}return!0}function Tf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Sf(t,i){var o=Tf(t);t=0;for(var d;o;){if(o.nodeType===3){if(d=t+o.textContent.length,t<=i&&d>=i)return{node:o,offset:i-t};t=d}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Tf(o)}}function vf(t,i){return t&&i?t===i?!0:t&&t.nodeType===3?!1:i&&i.nodeType===3?vf(t,i.parentNode):"contains"in t?t.contains(i):t.compareDocumentPosition?!!(t.compareDocumentPosition(i)&16):!1:!1}function bf(){for(var t=window,i=en();i instanceof t.HTMLIFrameElement;){try{var o=typeof i.contentWindow.location.href=="string"}catch{o=!1}if(o)t=i.contentWindow;else break;i=en(t.document)}return i}function Tc(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i&&(i==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||i==="textarea"||t.contentEditable==="true")}function S0(t){var i=bf(),o=t.focusedElem,d=t.selectionRange;if(i!==o&&o&&o.ownerDocument&&vf(o.ownerDocument.documentElement,o)){if(d!==null&&Tc(o)){if(i=d.start,t=d.end,t===void 0&&(t=i),"selectionStart"in o)o.selectionStart=i,o.selectionEnd=Math.min(t,o.value.length);else if(t=(i=o.ownerDocument||document)&&i.defaultView||window,t.getSelection){t=t.getSelection();var h=o.textContent.length,p=Math.min(d.start,h);d=d.end===void 0?p:Math.min(d.end,h),!t.extend&&p>d&&(h=d,d=p,p=h),h=Sf(o,p);var k=Sf(o,d);h&&k&&(t.rangeCount!==1||t.anchorNode!==h.node||t.anchorOffset!==h.offset||t.focusNode!==k.node||t.focusOffset!==k.offset)&&(i=i.createRange(),i.setStart(h.node,h.offset),t.removeAllRanges(),p>d?(t.addRange(i),t.extend(k.node,k.offset)):(i.setEnd(k.node,k.offset),t.addRange(i)))}}for(i=[],t=o;t=t.parentNode;)t.nodeType===1&&i.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<i.length;o++)t=i[o],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var v0=u&&"documentMode"in document&&11>=document.documentMode,ps=null,Sc=null,Na=null,vc=!1;function xf(t,i,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;vc||ps==null||ps!==en(d)||(d=ps,"selectionStart"in d&&Tc(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Na&&Fa(Na,d)||(Na=d,d=Ho(Sc,"onSelect"),0<d.length&&(i=new Ca("onSelect","select",null,i,o),t.push({event:i,listeners:d}),i.target=ps)))}function jo(t,i){var o={};return o[t.toLowerCase()]=i.toLowerCase(),o["Webkit"+t]="webkit"+i,o["Moz"+t]="moz"+i,o}var gs={animationend:jo("Animation","AnimationEnd"),animationiteration:jo("Animation","AnimationIteration"),animationstart:jo("Animation","AnimationStart"),transitionend:jo("Transition","TransitionEnd")},bc={},Cf={};u&&(Cf=document.createElement("div").style,"AnimationEvent"in window||(delete gs.animationend.animation,delete gs.animationiteration.animation,delete gs.animationstart.animation),"TransitionEvent"in window||delete gs.transitionend.transition);function Vo(t){if(bc[t])return bc[t];if(!gs[t])return t;var i=gs[t],o;for(o in i)if(i.hasOwnProperty(o)&&o in Cf)return bc[t]=i[o];return t}var Pf=Vo("animationend"),Ef=Vo("animationiteration"),_f=Vo("animationstart"),If=Vo("transitionend"),Af=new Map,Mf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dr(t,i){Af.set(t,i),l(i,[t])}for(var xc=0;xc<Mf.length;xc++){var Cc=Mf[xc],b0=Cc.toLowerCase(),x0=Cc[0].toUpperCase()+Cc.slice(1);Dr(b0,"on"+x0)}Dr(Pf,"onAnimationEnd"),Dr(Ef,"onAnimationIteration"),Dr(_f,"onAnimationStart"),Dr("dblclick","onDoubleClick"),Dr("focusin","onFocus"),Dr("focusout","onBlur"),Dr(If,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ra="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),C0=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ra));function Ff(t,i,o){var d=t.type||"unknown-event";t.currentTarget=o,Io(d,i,void 0,t),t.currentTarget=null}function Nf(t,i){i=(i&4)!==0;for(var o=0;o<t.length;o++){var d=t[o],h=d.event;d=d.listeners;e:{var p=void 0;if(i)for(var k=d.length-1;0<=k;k--){var P=d[k],M=P.instance,U=P.currentTarget;if(P=P.listener,M!==p&&h.isPropagationStopped())break e;Ff(h,P,U),p=M}else for(k=0;k<d.length;k++){if(P=d[k],M=P.instance,U=P.currentTarget,P=P.listener,M!==p&&h.isPropagationStopped())break e;Ff(h,P,U),p=M}}}if(fi)throw t=ts,fi=!1,ts=null,t}function $e(t,i){var o=i[Nc];o===void 0&&(o=i[Nc]=new Set);var d=t+"__bubble";o.has(d)||(Rf(i,t,2,!1),o.add(d))}function Pc(t,i,o){var d=0;i&&(d|=4),Rf(o,t,d,i)}var Wo="_reactListening"+Math.random().toString(36).slice(2);function za(t){if(!t[Wo]){t[Wo]=!0,s.forEach(function(o){o!=="selectionchange"&&(C0.has(o)||Pc(o,!1,t),Pc(o,!0,t))});var i=t.nodeType===9?t:t.ownerDocument;i===null||i[Wo]||(i[Wo]=!0,Pc("selectionchange",!1,i))}}function Rf(t,i,o,d){switch(Do(i)){case 1:var h=lc;break;case 4:h=cc;break;default:h=Sa}o=h.bind(null,i,o,t),h=void 0,!Er||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(h=!0),d?h!==void 0?t.addEventListener(i,o,{capture:!0,passive:h}):t.addEventListener(i,o,!0):h!==void 0?t.addEventListener(i,o,{passive:h}):t.addEventListener(i,o,!1)}function Ec(t,i,o,d,h){var p=d;if((i&1)===0&&(i&2)===0&&d!==null)e:for(;;){if(d===null)return;var k=d.tag;if(k===3||k===4){var P=d.stateNode.containerInfo;if(P===h||P.nodeType===8&&P.parentNode===h)break;if(k===4)for(k=d.return;k!==null;){var M=k.tag;if((M===3||M===4)&&(M=k.stateNode.containerInfo,M===h||M.nodeType===8&&M.parentNode===h))return;k=k.return}for(;P!==null;){if(k=Pi(P),k===null)return;if(M=k.tag,M===5||M===6){d=p=k;continue e}P=P.parentNode}}d=d.return}Eo(function(){var U=p,$=da(o),K=[];e:{var H=Af.get(t);if(H!==void 0){var ie=Ca,ce=t;switch(t){case"keypress":if(ds(o)===0)break e;case"keydown":case"keyup":ie=Mt;break;case"focusin":ce="focus",ie=Ci;break;case"focusout":ce="blur",ie=Ci;break;case"beforeblur":case"afterblur":ie=Ci;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ie=Oo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ie=dc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ie=i0;break;case Pf:case Ef:case _f:ie=mc;break;case If:ie=a0;break;case"scroll":ie=uc;break;case"wheel":ie=l0;break;case"copy":case"cut":case"paste":ie=gc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ie=_a}var ue=(i&4)!==0,it=!ue&&t==="scroll",R=ue?H!==null?H+"Capture":null:H;ue=[];for(var F=U,z;F!==null;){z=F;var Z=z.stateNode;if(z.tag===5&&Z!==null&&(z=Z,R!==null&&(Z=tn(F,R),Z!=null&&ue.push(Ba(F,Z,z)))),it)break;F=F.return}0<ue.length&&(H=new ie(H,ce,null,o,$),K.push({event:H,listeners:ue}))}}if((i&7)===0){e:{if(H=t==="mouseover"||t==="pointerover",ie=t==="mouseout"||t==="pointerout",H&&o!==xr&&(ce=o.relatedTarget||o.fromElement)&&(Pi(ce)||ce[nr]))break e;if((ie||H)&&(H=$.window===$?$:(H=$.ownerDocument)?H.defaultView||H.parentWindow:window,ie?(ce=o.relatedTarget||o.toElement,ie=U,ce=ce?Pi(ce):null,ce!==null&&(it=zn(ce),ce!==it||ce.tag!==5&&ce.tag!==6)&&(ce=null)):(ie=null,ce=U),ie!==ce)){if(ue=Oo,Z="onMouseLeave",R="onMouseEnter",F="mouse",(t==="pointerout"||t==="pointerover")&&(ue=_a,Z="onPointerLeave",R="onPointerEnter",F="pointer"),it=ie==null?H:ks(ie),z=ce==null?H:ks(ce),H=new ue(Z,F+"leave",ie,o,$),H.target=it,H.relatedTarget=z,Z=null,Pi($)===U&&(ue=new ue(R,F+"enter",ce,o,$),ue.target=z,ue.relatedTarget=it,Z=ue),it=Z,ie&&ce)t:{for(ue=ie,R=ce,F=0,z=ue;z;z=ys(z))F++;for(z=0,Z=R;Z;Z=ys(Z))z++;for(;0<F-z;)ue=ys(ue),F--;for(;0<z-F;)R=ys(R),z--;for(;F--;){if(ue===R||R!==null&&ue===R.alternate)break t;ue=ys(ue),R=ys(R)}ue=null}else ue=null;ie!==null&&zf(K,H,ie,ue,!1),ce!==null&&it!==null&&zf(K,it,ce,ue,!0)}}e:{if(H=U?ks(U):window,ie=H.nodeName&&H.nodeName.toLowerCase(),ie==="select"||ie==="input"&&H.type==="file")var de=p0;else if(mf(H))if(gf)de=k0;else{de=y0;var ye=g0}else(ie=H.nodeName)&&ie.toLowerCase()==="input"&&(H.type==="checkbox"||H.type==="radio")&&(de=w0);if(de&&(de=de(t,U))){pf(K,de,o,$);break e}ye&&ye(t,H,U),t==="focusout"&&(ye=H._wrapperState)&&ye.controlled&&H.type==="number"&&la(H,"number",H.value)}switch(ye=U?ks(U):window,t){case"focusin":(mf(ye)||ye.contentEditable==="true")&&(ps=ye,Sc=U,Na=null);break;case"focusout":Na=Sc=ps=null;break;case"mousedown":vc=!0;break;case"contextmenu":case"mouseup":case"dragend":vc=!1,xf(K,o,$);break;case"selectionchange":if(v0)break;case"keydown":case"keyup":xf(K,o,$)}var we;if(yc)e:{switch(t){case"compositionstart":var Se="onCompositionStart";break e;case"compositionend":Se="onCompositionEnd";break e;case"compositionupdate":Se="onCompositionUpdate";break e}Se=void 0}else ms?ff(t,o)&&(Se="onCompositionEnd"):t==="keydown"&&o.keyCode===229&&(Se="onCompositionStart");Se&&(cf&&o.locale!=="ko"&&(ms||Se!=="onCompositionStart"?Se==="onCompositionEnd"&&ms&&(we=xa()):(Un=$,ba="value"in Un?Un.value:Un.textContent,ms=!0)),ye=Ho(U,Se),0<ye.length&&(Se=new D(Se,t,null,o,$),K.push({event:Se,listeners:ye}),we?Se.data=we:(we=hf(o),we!==null&&(Se.data=we)))),(we=u0?d0(t,o):f0(t,o))&&(U=Ho(U,"onBeforeInput"),0<U.length&&($=new D("onBeforeInput","beforeinput",null,o,$),K.push({event:$,listeners:U}),$.data=we))}Nf(K,i)})}function Ba(t,i,o){return{instance:t,listener:i,currentTarget:o}}function Ho(t,i){for(var o=i+"Capture",d=[];t!==null;){var h=t,p=h.stateNode;h.tag===5&&p!==null&&(h=p,p=tn(t,o),p!=null&&d.unshift(Ba(t,p,h)),p=tn(t,i),p!=null&&d.push(Ba(t,p,h))),t=t.return}return d}function ys(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function zf(t,i,o,d,h){for(var p=i._reactName,k=[];o!==null&&o!==d;){var P=o,M=P.alternate,U=P.stateNode;if(M!==null&&M===d)break;P.tag===5&&U!==null&&(P=U,h?(M=tn(o,p),M!=null&&k.unshift(Ba(o,M,P))):h||(M=tn(o,p),M!=null&&k.push(Ba(o,M,P)))),o=o.return}k.length!==0&&t.push({event:i,listeners:k})}var P0=/\r\n?/g,E0=/\u0000|\uFFFD/g;function Bf(t){return(typeof t=="string"?t:""+t).replace(P0,`
`).replace(E0,"")}function $o(t,i,o){if(i=Bf(i),Bf(t)!==i&&o)throw Error(r(425))}function Qo(){}var _c=null,Ic=null;function Ac(t,i){return t==="textarea"||t==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Mc=typeof setTimeout=="function"?setTimeout:void 0,_0=typeof clearTimeout=="function"?clearTimeout:void 0,Df=typeof Promise=="function"?Promise:void 0,I0=typeof queueMicrotask=="function"?queueMicrotask:typeof Df<"u"?function(t){return Df.resolve(null).then(t).catch(A0)}:Mc;function A0(t){setTimeout(function(){throw t})}function Fc(t,i){var o=i,d=0;do{var h=o.nextSibling;if(t.removeChild(o),h&&h.nodeType===8)if(o=h.data,o==="/$"){if(d===0){t.removeChild(h),tr(i);return}d--}else o!=="$"&&o!=="$?"&&o!=="$!"||d++;o=h}while(o);tr(i)}function Or(t){for(;t!=null;t=t.nextSibling){var i=t.nodeType;if(i===1||i===3)break;if(i===8){if(i=t.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return t}function Of(t){t=t.previousSibling;for(var i=0;t;){if(t.nodeType===8){var o=t.data;if(o==="$"||o==="$!"||o==="$?"){if(i===0)return t;i--}else o==="/$"&&i++}t=t.previousSibling}return null}var ws=Math.random().toString(36).slice(2),Ln="__reactFiber$"+ws,Da="__reactProps$"+ws,nr="__reactContainer$"+ws,Nc="__reactEvents$"+ws,M0="__reactListeners$"+ws,F0="__reactHandles$"+ws;function Pi(t){var i=t[Ln];if(i)return i;for(var o=t.parentNode;o;){if(i=o[nr]||o[Ln]){if(o=i.alternate,i.child!==null||o!==null&&o.child!==null)for(t=Of(t);t!==null;){if(o=t[Ln])return o;t=Of(t)}return i}t=o,o=t.parentNode}return null}function Oa(t){return t=t[Ln]||t[nr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ks(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(r(33))}function qo(t){return t[Da]||null}var Rc=[],Ts=-1;function Ur(t){return{current:t}}function Qe(t){0>Ts||(t.current=Rc[Ts],Rc[Ts]=null,Ts--)}function He(t,i){Ts++,Rc[Ts]=t.current,t.current=i}var Lr={},vt=Ur(Lr),Bt=Ur(!1),Ei=Lr;function Ss(t,i){var o=t.type.contextTypes;if(!o)return Lr;var d=t.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===i)return d.__reactInternalMemoizedMaskedChildContext;var h={},p;for(p in o)h[p]=i[p];return d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=h),h}function Dt(t){return t=t.childContextTypes,t!=null}function Ko(){Qe(Bt),Qe(vt)}function Uf(t,i,o){if(vt.current!==Lr)throw Error(r(168));He(vt,i),He(Bt,o)}function Lf(t,i,o){var d=t.stateNode;if(i=i.childContextTypes,typeof d.getChildContext!="function")return o;d=d.getChildContext();for(var h in d)if(!(h in i))throw Error(r(108,Oe(t)||"Unknown",h));return X({},o,d)}function Go(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Lr,Ei=vt.current,He(vt,t),He(Bt,Bt.current),!0}function jf(t,i,o){var d=t.stateNode;if(!d)throw Error(r(169));o?(t=Lf(t,i,Ei),d.__reactInternalMemoizedMergedChildContext=t,Qe(Bt),Qe(vt),He(vt,t)):Qe(Bt),He(Bt,o)}var rr=null,Xo=!1,zc=!1;function Vf(t){rr===null?rr=[t]:rr.push(t)}function N0(t){Xo=!0,Vf(t)}function jr(){if(!zc&&rr!==null){zc=!0;var t=0,i=Me;try{var o=rr;for(Me=1;t<o.length;t++){var d=o[t];do d=d(!0);while(d!==null)}rr=null,Xo=!1}catch(h){throw rr!==null&&(rr=rr.slice(t+1)),Mr(ma,jr),h}finally{Me=i,zc=!1}}return null}var vs=[],bs=0,Yo=null,Zo=0,on=[],ln=0,_i=null,ir=1,sr="";function Ii(t,i){vs[bs++]=Zo,vs[bs++]=Yo,Yo=t,Zo=i}function Wf(t,i,o){on[ln++]=ir,on[ln++]=sr,on[ln++]=_i,_i=t;var d=ir;t=sr;var h=32-Qt(d)-1;d&=~(1<<h),o+=1;var p=32-Qt(i)+h;if(30<p){var k=h-h%5;p=(d&(1<<k)-1).toString(32),d>>=k,h-=k,ir=1<<32-Qt(i)+h|o<<h|d,sr=p+t}else ir=1<<p|o<<h|d,sr=t}function Bc(t){t.return!==null&&(Ii(t,1),Wf(t,1,0))}function Dc(t){for(;t===Yo;)Yo=vs[--bs],vs[bs]=null,Zo=vs[--bs],vs[bs]=null;for(;t===_i;)_i=on[--ln],on[ln]=null,sr=on[--ln],on[ln]=null,ir=on[--ln],on[ln]=null}var Gt=null,Xt=null,Ke=!1,Sn=null;function Hf(t,i){var o=fn(5,null,null,0);o.elementType="DELETED",o.stateNode=i,o.return=t,i=t.deletions,i===null?(t.deletions=[o],t.flags|=16):i.push(o)}function $f(t,i){switch(t.tag){case 5:var o=t.type;return i=i.nodeType!==1||o.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(t.stateNode=i,Gt=t,Xt=Or(i.firstChild),!0):!1;case 6:return i=t.pendingProps===""||i.nodeType!==3?null:i,i!==null?(t.stateNode=i,Gt=t,Xt=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(o=_i!==null?{id:ir,overflow:sr}:null,t.memoizedState={dehydrated:i,treeContext:o,retryLane:1073741824},o=fn(18,null,null,0),o.stateNode=i,o.return=t,t.child=o,Gt=t,Xt=null,!0):!1;default:return!1}}function Oc(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Uc(t){if(Ke){var i=Xt;if(i){var o=i;if(!$f(t,i)){if(Oc(t))throw Error(r(418));i=Or(o.nextSibling);var d=Gt;i&&$f(t,i)?Hf(d,o):(t.flags=t.flags&-4097|2,Ke=!1,Gt=t)}}else{if(Oc(t))throw Error(r(418));t.flags=t.flags&-4097|2,Ke=!1,Gt=t}}}function Qf(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Gt=t}function Jo(t){if(t!==Gt)return!1;if(!Ke)return Qf(t),Ke=!0,!1;var i;if((i=t.tag!==3)&&!(i=t.tag!==5)&&(i=t.type,i=i!=="head"&&i!=="body"&&!Ac(t.type,t.memoizedProps)),i&&(i=Xt)){if(Oc(t))throw qf(),Error(r(418));for(;i;)Hf(t,i),i=Or(i.nextSibling)}if(Qf(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(r(317));e:{for(t=t.nextSibling,i=0;t;){if(t.nodeType===8){var o=t.data;if(o==="/$"){if(i===0){Xt=Or(t.nextSibling);break e}i--}else o!=="$"&&o!=="$!"&&o!=="$?"||i++}t=t.nextSibling}Xt=null}}else Xt=Gt?Or(t.stateNode.nextSibling):null;return!0}function qf(){for(var t=Xt;t;)t=Or(t.nextSibling)}function xs(){Xt=Gt=null,Ke=!1}function Lc(t){Sn===null?Sn=[t]:Sn.push(t)}var R0=B.ReactCurrentBatchConfig;function Ua(t,i,o){if(t=o.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(r(309));var d=o.stateNode}if(!d)throw Error(r(147,t));var h=d,p=""+t;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===p?i.ref:(i=function(k){var P=h.refs;k===null?delete P[p]:P[p]=k},i._stringRef=p,i)}if(typeof t!="string")throw Error(r(284));if(!o._owner)throw Error(r(290,t))}return t}function el(t,i){throw t=Object.prototype.toString.call(i),Error(r(31,t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t))}function Kf(t){var i=t._init;return i(t._payload)}function Gf(t){function i(R,F){if(t){var z=R.deletions;z===null?(R.deletions=[F],R.flags|=16):z.push(F)}}function o(R,F){if(!t)return null;for(;F!==null;)i(R,F),F=F.sibling;return null}function d(R,F){for(R=new Map;F!==null;)F.key!==null?R.set(F.key,F):R.set(F.index,F),F=F.sibling;return R}function h(R,F){return R=Gr(R,F),R.index=0,R.sibling=null,R}function p(R,F,z){return R.index=z,t?(z=R.alternate,z!==null?(z=z.index,z<F?(R.flags|=2,F):z):(R.flags|=2,F)):(R.flags|=1048576,F)}function k(R){return t&&R.alternate===null&&(R.flags|=2),R}function P(R,F,z,Z){return F===null||F.tag!==6?(F=Mu(z,R.mode,Z),F.return=R,F):(F=h(F,z),F.return=R,F)}function M(R,F,z,Z){var de=z.type;return de===q?$(R,F,z.props.children,Z,z.key):F!==null&&(F.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===Ne&&Kf(de)===F.type)?(Z=h(F,z.props),Z.ref=Ua(R,F,z),Z.return=R,Z):(Z=xl(z.type,z.key,z.props,null,R.mode,Z),Z.ref=Ua(R,F,z),Z.return=R,Z)}function U(R,F,z,Z){return F===null||F.tag!==4||F.stateNode.containerInfo!==z.containerInfo||F.stateNode.implementation!==z.implementation?(F=Fu(z,R.mode,Z),F.return=R,F):(F=h(F,z.children||[]),F.return=R,F)}function $(R,F,z,Z,de){return F===null||F.tag!==7?(F=Di(z,R.mode,Z,de),F.return=R,F):(F=h(F,z),F.return=R,F)}function K(R,F,z){if(typeof F=="string"&&F!==""||typeof F=="number")return F=Mu(""+F,R.mode,z),F.return=R,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case j:return z=xl(F.type,F.key,F.props,null,R.mode,z),z.ref=Ua(R,null,F),z.return=R,z;case L:return F=Fu(F,R.mode,z),F.return=R,F;case Ne:var Z=F._init;return K(R,Z(F._payload),z)}if(ui(F)||fe(F))return F=Di(F,R.mode,z,null),F.return=R,F;el(R,F)}return null}function H(R,F,z,Z){var de=F!==null?F.key:null;if(typeof z=="string"&&z!==""||typeof z=="number")return de!==null?null:P(R,F,""+z,Z);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case j:return z.key===de?M(R,F,z,Z):null;case L:return z.key===de?U(R,F,z,Z):null;case Ne:return de=z._init,H(R,F,de(z._payload),Z)}if(ui(z)||fe(z))return de!==null?null:$(R,F,z,Z,null);el(R,z)}return null}function ie(R,F,z,Z,de){if(typeof Z=="string"&&Z!==""||typeof Z=="number")return R=R.get(z)||null,P(F,R,""+Z,de);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case j:return R=R.get(Z.key===null?z:Z.key)||null,M(F,R,Z,de);case L:return R=R.get(Z.key===null?z:Z.key)||null,U(F,R,Z,de);case Ne:var ye=Z._init;return ie(R,F,z,ye(Z._payload),de)}if(ui(Z)||fe(Z))return R=R.get(z)||null,$(F,R,Z,de,null);el(F,Z)}return null}function ce(R,F,z,Z){for(var de=null,ye=null,we=F,Se=F=0,ht=null;we!==null&&Se<z.length;Se++){we.index>Se?(ht=we,we=null):ht=we.sibling;var Be=H(R,we,z[Se],Z);if(Be===null){we===null&&(we=ht);break}t&&we&&Be.alternate===null&&i(R,we),F=p(Be,F,Se),ye===null?de=Be:ye.sibling=Be,ye=Be,we=ht}if(Se===z.length)return o(R,we),Ke&&Ii(R,Se),de;if(we===null){for(;Se<z.length;Se++)we=K(R,z[Se],Z),we!==null&&(F=p(we,F,Se),ye===null?de=we:ye.sibling=we,ye=we);return Ke&&Ii(R,Se),de}for(we=d(R,we);Se<z.length;Se++)ht=ie(we,R,Se,z[Se],Z),ht!==null&&(t&&ht.alternate!==null&&we.delete(ht.key===null?Se:ht.key),F=p(ht,F,Se),ye===null?de=ht:ye.sibling=ht,ye=ht);return t&&we.forEach(function(Xr){return i(R,Xr)}),Ke&&Ii(R,Se),de}function ue(R,F,z,Z){var de=fe(z);if(typeof de!="function")throw Error(r(150));if(z=de.call(z),z==null)throw Error(r(151));for(var ye=de=null,we=F,Se=F=0,ht=null,Be=z.next();we!==null&&!Be.done;Se++,Be=z.next()){we.index>Se?(ht=we,we=null):ht=we.sibling;var Xr=H(R,we,Be.value,Z);if(Xr===null){we===null&&(we=ht);break}t&&we&&Xr.alternate===null&&i(R,we),F=p(Xr,F,Se),ye===null?de=Xr:ye.sibling=Xr,ye=Xr,we=ht}if(Be.done)return o(R,we),Ke&&Ii(R,Se),de;if(we===null){for(;!Be.done;Se++,Be=z.next())Be=K(R,Be.value,Z),Be!==null&&(F=p(Be,F,Se),ye===null?de=Be:ye.sibling=Be,ye=Be);return Ke&&Ii(R,Se),de}for(we=d(R,we);!Be.done;Se++,Be=z.next())Be=ie(we,R,Se,Be.value,Z),Be!==null&&(t&&Be.alternate!==null&&we.delete(Be.key===null?Se:Be.key),F=p(Be,F,Se),ye===null?de=Be:ye.sibling=Be,ye=Be);return t&&we.forEach(function(hy){return i(R,hy)}),Ke&&Ii(R,Se),de}function it(R,F,z,Z){if(typeof z=="object"&&z!==null&&z.type===q&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case j:e:{for(var de=z.key,ye=F;ye!==null;){if(ye.key===de){if(de=z.type,de===q){if(ye.tag===7){o(R,ye.sibling),F=h(ye,z.props.children),F.return=R,R=F;break e}}else if(ye.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===Ne&&Kf(de)===ye.type){o(R,ye.sibling),F=h(ye,z.props),F.ref=Ua(R,ye,z),F.return=R,R=F;break e}o(R,ye);break}else i(R,ye);ye=ye.sibling}z.type===q?(F=Di(z.props.children,R.mode,Z,z.key),F.return=R,R=F):(Z=xl(z.type,z.key,z.props,null,R.mode,Z),Z.ref=Ua(R,F,z),Z.return=R,R=Z)}return k(R);case L:e:{for(ye=z.key;F!==null;){if(F.key===ye)if(F.tag===4&&F.stateNode.containerInfo===z.containerInfo&&F.stateNode.implementation===z.implementation){o(R,F.sibling),F=h(F,z.children||[]),F.return=R,R=F;break e}else{o(R,F);break}else i(R,F);F=F.sibling}F=Fu(z,R.mode,Z),F.return=R,R=F}return k(R);case Ne:return ye=z._init,it(R,F,ye(z._payload),Z)}if(ui(z))return ce(R,F,z,Z);if(fe(z))return ue(R,F,z,Z);el(R,z)}return typeof z=="string"&&z!==""||typeof z=="number"?(z=""+z,F!==null&&F.tag===6?(o(R,F.sibling),F=h(F,z),F.return=R,R=F):(o(R,F),F=Mu(z,R.mode,Z),F.return=R,R=F),k(R)):o(R,F)}return it}var Cs=Gf(!0),Xf=Gf(!1),tl=Ur(null),nl=null,Ps=null,jc=null;function Vc(){jc=Ps=nl=null}function Wc(t){var i=tl.current;Qe(tl),t._currentValue=i}function Hc(t,i,o){for(;t!==null;){var d=t.alternate;if((t.childLanes&i)!==i?(t.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),t===o)break;t=t.return}}function Es(t,i){nl=t,jc=Ps=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&i)!==0&&(Ot=!0),t.firstContext=null)}function cn(t){var i=t._currentValue;if(jc!==t)if(t={context:t,memoizedValue:i,next:null},Ps===null){if(nl===null)throw Error(r(308));Ps=t,nl.dependencies={lanes:0,firstContext:t}}else Ps=Ps.next=t;return i}var Ai=null;function $c(t){Ai===null?Ai=[t]:Ai.push(t)}function Yf(t,i,o,d){var h=i.interleaved;return h===null?(o.next=o,$c(i)):(o.next=h.next,h.next=o),i.interleaved=o,ar(t,d)}function ar(t,i){t.lanes|=i;var o=t.alternate;for(o!==null&&(o.lanes|=i),o=t,t=t.return;t!==null;)t.childLanes|=i,o=t.alternate,o!==null&&(o.childLanes|=i),o=t,t=t.return;return o.tag===3?o.stateNode:null}var Vr=!1;function Qc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Zf(t,i){t=t.updateQueue,i.updateQueue===t&&(i.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function or(t,i){return{eventTime:t,lane:i,tag:0,payload:null,callback:null,next:null}}function Wr(t,i,o){var d=t.updateQueue;if(d===null)return null;if(d=d.shared,(Re&2)!==0){var h=d.pending;return h===null?i.next=i:(i.next=h.next,h.next=i),d.pending=i,ar(t,o)}return h=d.interleaved,h===null?(i.next=i,$c(d)):(i.next=h.next,h.next=i),d.interleaved=i,ar(t,o)}function rl(t,i,o){if(i=i.updateQueue,i!==null&&(i=i.shared,(o&4194240)!==0)){var d=i.lanes;d&=t.pendingLanes,o|=d,i.lanes=o,wa(t,o)}}function Jf(t,i){var o=t.updateQueue,d=t.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var h=null,p=null;if(o=o.firstBaseUpdate,o!==null){do{var k={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};p===null?h=p=k:p=p.next=k,o=o.next}while(o!==null);p===null?h=p=i:p=p.next=i}else h=p=i;o={baseState:d.baseState,firstBaseUpdate:h,lastBaseUpdate:p,shared:d.shared,effects:d.effects},t.updateQueue=o;return}t=o.lastBaseUpdate,t===null?o.firstBaseUpdate=i:t.next=i,o.lastBaseUpdate=i}function il(t,i,o,d){var h=t.updateQueue;Vr=!1;var p=h.firstBaseUpdate,k=h.lastBaseUpdate,P=h.shared.pending;if(P!==null){h.shared.pending=null;var M=P,U=M.next;M.next=null,k===null?p=U:k.next=U,k=M;var $=t.alternate;$!==null&&($=$.updateQueue,P=$.lastBaseUpdate,P!==k&&(P===null?$.firstBaseUpdate=U:P.next=U,$.lastBaseUpdate=M))}if(p!==null){var K=h.baseState;k=0,$=U=M=null,P=p;do{var H=P.lane,ie=P.eventTime;if((d&H)===H){$!==null&&($=$.next={eventTime:ie,lane:0,tag:P.tag,payload:P.payload,callback:P.callback,next:null});e:{var ce=t,ue=P;switch(H=i,ie=o,ue.tag){case 1:if(ce=ue.payload,typeof ce=="function"){K=ce.call(ie,K,H);break e}K=ce;break e;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=ue.payload,H=typeof ce=="function"?ce.call(ie,K,H):ce,H==null)break e;K=X({},K,H);break e;case 2:Vr=!0}}P.callback!==null&&P.lane!==0&&(t.flags|=64,H=h.effects,H===null?h.effects=[P]:H.push(P))}else ie={eventTime:ie,lane:H,tag:P.tag,payload:P.payload,callback:P.callback,next:null},$===null?(U=$=ie,M=K):$=$.next=ie,k|=H;if(P=P.next,P===null){if(P=h.shared.pending,P===null)break;H=P,P=H.next,H.next=null,h.lastBaseUpdate=H,h.shared.pending=null}}while(!0);if($===null&&(M=K),h.baseState=M,h.firstBaseUpdate=U,h.lastBaseUpdate=$,i=h.shared.interleaved,i!==null){h=i;do k|=h.lane,h=h.next;while(h!==i)}else p===null&&(h.shared.lanes=0);Ni|=k,t.lanes=k,t.memoizedState=K}}function eh(t,i,o){if(t=i.effects,i.effects=null,t!==null)for(i=0;i<t.length;i++){var d=t[i],h=d.callback;if(h!==null){if(d.callback=null,d=o,typeof h!="function")throw Error(r(191,h));h.call(d)}}}var La={},jn=Ur(La),ja=Ur(La),Va=Ur(La);function Mi(t){if(t===La)throw Error(r(174));return t}function qc(t,i){switch(He(Va,i),He(ja,t),He(jn,La),t=i.nodeType,t){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:vr(null,"");break;default:t=t===8?i.parentNode:i,i=t.namespaceURI||null,t=t.tagName,i=vr(i,t)}Qe(jn),He(jn,i)}function _s(){Qe(jn),Qe(ja),Qe(Va)}function th(t){Mi(Va.current);var i=Mi(jn.current),o=vr(i,t.type);i!==o&&(He(ja,t),He(jn,o))}function Kc(t){ja.current===t&&(Qe(jn),Qe(ja))}var Ge=Ur(0);function sl(t){for(var i=t;i!==null;){if(i.tag===13){var o=i.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Gc=[];function Xc(){for(var t=0;t<Gc.length;t++)Gc[t]._workInProgressVersionPrimary=null;Gc.length=0}var al=B.ReactCurrentDispatcher,Yc=B.ReactCurrentBatchConfig,Fi=0,Xe=null,lt=null,dt=null,ol=!1,Wa=!1,Ha=0,z0=0;function bt(){throw Error(r(321))}function Zc(t,i){if(i===null)return!1;for(var o=0;o<i.length&&o<t.length;o++)if(!Tn(t[o],i[o]))return!1;return!0}function Jc(t,i,o,d,h,p){if(Fi=p,Xe=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,al.current=t===null||t.memoizedState===null?U0:L0,t=o(d,h),Wa){p=0;do{if(Wa=!1,Ha=0,25<=p)throw Error(r(301));p+=1,dt=lt=null,i.updateQueue=null,al.current=j0,t=o(d,h)}while(Wa)}if(al.current=ul,i=lt!==null&&lt.next!==null,Fi=0,dt=lt=Xe=null,ol=!1,i)throw Error(r(300));return t}function eu(){var t=Ha!==0;return Ha=0,t}function Vn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dt===null?Xe.memoizedState=dt=t:dt=dt.next=t,dt}function un(){if(lt===null){var t=Xe.alternate;t=t!==null?t.memoizedState:null}else t=lt.next;var i=dt===null?Xe.memoizedState:dt.next;if(i!==null)dt=i,lt=t;else{if(t===null)throw Error(r(310));lt=t,t={memoizedState:lt.memoizedState,baseState:lt.baseState,baseQueue:lt.baseQueue,queue:lt.queue,next:null},dt===null?Xe.memoizedState=dt=t:dt=dt.next=t}return dt}function $a(t,i){return typeof i=="function"?i(t):i}function tu(t){var i=un(),o=i.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=t;var d=lt,h=d.baseQueue,p=o.pending;if(p!==null){if(h!==null){var k=h.next;h.next=p.next,p.next=k}d.baseQueue=h=p,o.pending=null}if(h!==null){p=h.next,d=d.baseState;var P=k=null,M=null,U=p;do{var $=U.lane;if((Fi&$)===$)M!==null&&(M=M.next={lane:0,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null}),d=U.hasEagerState?U.eagerState:t(d,U.action);else{var K={lane:$,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null};M===null?(P=M=K,k=d):M=M.next=K,Xe.lanes|=$,Ni|=$}U=U.next}while(U!==null&&U!==p);M===null?k=d:M.next=P,Tn(d,i.memoizedState)||(Ot=!0),i.memoizedState=d,i.baseState=k,i.baseQueue=M,o.lastRenderedState=d}if(t=o.interleaved,t!==null){h=t;do p=h.lane,Xe.lanes|=p,Ni|=p,h=h.next;while(h!==t)}else h===null&&(o.lanes=0);return[i.memoizedState,o.dispatch]}function nu(t){var i=un(),o=i.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=t;var d=o.dispatch,h=o.pending,p=i.memoizedState;if(h!==null){o.pending=null;var k=h=h.next;do p=t(p,k.action),k=k.next;while(k!==h);Tn(p,i.memoizedState)||(Ot=!0),i.memoizedState=p,i.baseQueue===null&&(i.baseState=p),o.lastRenderedState=p}return[p,d]}function nh(){}function rh(t,i){var o=Xe,d=un(),h=i(),p=!Tn(d.memoizedState,h);if(p&&(d.memoizedState=h,Ot=!0),d=d.queue,ru(ah.bind(null,o,d,t),[t]),d.getSnapshot!==i||p||dt!==null&&dt.memoizedState.tag&1){if(o.flags|=2048,Qa(9,sh.bind(null,o,d,h,i),void 0,null),ft===null)throw Error(r(349));(Fi&30)!==0||ih(o,i,h)}return h}function ih(t,i,o){t.flags|=16384,t={getSnapshot:i,value:o},i=Xe.updateQueue,i===null?(i={lastEffect:null,stores:null},Xe.updateQueue=i,i.stores=[t]):(o=i.stores,o===null?i.stores=[t]:o.push(t))}function sh(t,i,o,d){i.value=o,i.getSnapshot=d,oh(i)&&lh(t)}function ah(t,i,o){return o(function(){oh(i)&&lh(t)})}function oh(t){var i=t.getSnapshot;t=t.value;try{var o=i();return!Tn(t,o)}catch{return!0}}function lh(t){var i=ar(t,1);i!==null&&Cn(i,t,1,-1)}function ch(t){var i=Vn();return typeof t=="function"&&(t=t()),i.memoizedState=i.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$a,lastRenderedState:t},i.queue=t,t=t.dispatch=O0.bind(null,Xe,t),[i.memoizedState,t]}function Qa(t,i,o,d){return t={tag:t,create:i,destroy:o,deps:d,next:null},i=Xe.updateQueue,i===null?(i={lastEffect:null,stores:null},Xe.updateQueue=i,i.lastEffect=t.next=t):(o=i.lastEffect,o===null?i.lastEffect=t.next=t:(d=o.next,o.next=t,t.next=d,i.lastEffect=t)),t}function uh(){return un().memoizedState}function ll(t,i,o,d){var h=Vn();Xe.flags|=t,h.memoizedState=Qa(1|i,o,void 0,d===void 0?null:d)}function cl(t,i,o,d){var h=un();d=d===void 0?null:d;var p=void 0;if(lt!==null){var k=lt.memoizedState;if(p=k.destroy,d!==null&&Zc(d,k.deps)){h.memoizedState=Qa(i,o,p,d);return}}Xe.flags|=t,h.memoizedState=Qa(1|i,o,p,d)}function dh(t,i){return ll(8390656,8,t,i)}function ru(t,i){return cl(2048,8,t,i)}function fh(t,i){return cl(4,2,t,i)}function hh(t,i){return cl(4,4,t,i)}function mh(t,i){if(typeof i=="function")return t=t(),i(t),function(){i(null)};if(i!=null)return t=t(),i.current=t,function(){i.current=null}}function ph(t,i,o){return o=o!=null?o.concat([t]):null,cl(4,4,mh.bind(null,i,t),o)}function iu(){}function gh(t,i){var o=un();i=i===void 0?null:i;var d=o.memoizedState;return d!==null&&i!==null&&Zc(i,d[1])?d[0]:(o.memoizedState=[t,i],t)}function yh(t,i){var o=un();i=i===void 0?null:i;var d=o.memoizedState;return d!==null&&i!==null&&Zc(i,d[1])?d[0]:(t=t(),o.memoizedState=[t,i],t)}function wh(t,i,o){return(Fi&21)===0?(t.baseState&&(t.baseState=!1,Ot=!0),t.memoizedState=o):(Tn(o,i)||(o=rt(),Xe.lanes|=o,Ni|=o,t.baseState=!0),i)}function B0(t,i){var o=Me;Me=o!==0&&4>o?o:4,t(!0);var d=Yc.transition;Yc.transition={};try{t(!1),i()}finally{Me=o,Yc.transition=d}}function kh(){return un().memoizedState}function D0(t,i,o){var d=qr(t);if(o={lane:d,action:o,hasEagerState:!1,eagerState:null,next:null},Th(t))Sh(i,o);else if(o=Yf(t,i,o,d),o!==null){var h=Nt();Cn(o,t,d,h),vh(o,i,d)}}function O0(t,i,o){var d=qr(t),h={lane:d,action:o,hasEagerState:!1,eagerState:null,next:null};if(Th(t))Sh(i,h);else{var p=t.alternate;if(t.lanes===0&&(p===null||p.lanes===0)&&(p=i.lastRenderedReducer,p!==null))try{var k=i.lastRenderedState,P=p(k,o);if(h.hasEagerState=!0,h.eagerState=P,Tn(P,k)){var M=i.interleaved;M===null?(h.next=h,$c(i)):(h.next=M.next,M.next=h),i.interleaved=h;return}}catch{}finally{}o=Yf(t,i,h,d),o!==null&&(h=Nt(),Cn(o,t,d,h),vh(o,i,d))}}function Th(t){var i=t.alternate;return t===Xe||i!==null&&i===Xe}function Sh(t,i){Wa=ol=!0;var o=t.pending;o===null?i.next=i:(i.next=o.next,o.next=i),t.pending=i}function vh(t,i,o){if((o&4194240)!==0){var d=i.lanes;d&=t.pendingLanes,o|=d,i.lanes=o,wa(t,o)}}var ul={readContext:cn,useCallback:bt,useContext:bt,useEffect:bt,useImperativeHandle:bt,useInsertionEffect:bt,useLayoutEffect:bt,useMemo:bt,useReducer:bt,useRef:bt,useState:bt,useDebugValue:bt,useDeferredValue:bt,useTransition:bt,useMutableSource:bt,useSyncExternalStore:bt,useId:bt,unstable_isNewReconciler:!1},U0={readContext:cn,useCallback:function(t,i){return Vn().memoizedState=[t,i===void 0?null:i],t},useContext:cn,useEffect:dh,useImperativeHandle:function(t,i,o){return o=o!=null?o.concat([t]):null,ll(4194308,4,mh.bind(null,i,t),o)},useLayoutEffect:function(t,i){return ll(4194308,4,t,i)},useInsertionEffect:function(t,i){return ll(4,2,t,i)},useMemo:function(t,i){var o=Vn();return i=i===void 0?null:i,t=t(),o.memoizedState=[t,i],t},useReducer:function(t,i,o){var d=Vn();return i=o!==void 0?o(i):i,d.memoizedState=d.baseState=i,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},d.queue=t,t=t.dispatch=D0.bind(null,Xe,t),[d.memoizedState,t]},useRef:function(t){var i=Vn();return t={current:t},i.memoizedState=t},useState:ch,useDebugValue:iu,useDeferredValue:function(t){return Vn().memoizedState=t},useTransition:function(){var t=ch(!1),i=t[0];return t=B0.bind(null,t[1]),Vn().memoizedState=t,[i,t]},useMutableSource:function(){},useSyncExternalStore:function(t,i,o){var d=Xe,h=Vn();if(Ke){if(o===void 0)throw Error(r(407));o=o()}else{if(o=i(),ft===null)throw Error(r(349));(Fi&30)!==0||ih(d,i,o)}h.memoizedState=o;var p={value:o,getSnapshot:i};return h.queue=p,dh(ah.bind(null,d,p,t),[t]),d.flags|=2048,Qa(9,sh.bind(null,d,p,o,i),void 0,null),o},useId:function(){var t=Vn(),i=ft.identifierPrefix;if(Ke){var o=sr,d=ir;o=(d&~(1<<32-Qt(d)-1)).toString(32)+o,i=":"+i+"R"+o,o=Ha++,0<o&&(i+="H"+o.toString(32)),i+=":"}else o=z0++,i=":"+i+"r"+o.toString(32)+":";return t.memoizedState=i},unstable_isNewReconciler:!1},L0={readContext:cn,useCallback:gh,useContext:cn,useEffect:ru,useImperativeHandle:ph,useInsertionEffect:fh,useLayoutEffect:hh,useMemo:yh,useReducer:tu,useRef:uh,useState:function(){return tu($a)},useDebugValue:iu,useDeferredValue:function(t){var i=un();return wh(i,lt.memoizedState,t)},useTransition:function(){var t=tu($a)[0],i=un().memoizedState;return[t,i]},useMutableSource:nh,useSyncExternalStore:rh,useId:kh,unstable_isNewReconciler:!1},j0={readContext:cn,useCallback:gh,useContext:cn,useEffect:ru,useImperativeHandle:ph,useInsertionEffect:fh,useLayoutEffect:hh,useMemo:yh,useReducer:nu,useRef:uh,useState:function(){return nu($a)},useDebugValue:iu,useDeferredValue:function(t){var i=un();return lt===null?i.memoizedState=t:wh(i,lt.memoizedState,t)},useTransition:function(){var t=nu($a)[0],i=un().memoizedState;return[t,i]},useMutableSource:nh,useSyncExternalStore:rh,useId:kh,unstable_isNewReconciler:!1};function vn(t,i){if(t&&t.defaultProps){i=X({},i),t=t.defaultProps;for(var o in t)i[o]===void 0&&(i[o]=t[o]);return i}return i}function su(t,i,o,d){i=t.memoizedState,o=o(d,i),o=o==null?i:X({},i,o),t.memoizedState=o,t.lanes===0&&(t.updateQueue.baseState=o)}var dl={isMounted:function(t){return(t=t._reactInternals)?zn(t)===t:!1},enqueueSetState:function(t,i,o){t=t._reactInternals;var d=Nt(),h=qr(t),p=or(d,h);p.payload=i,o!=null&&(p.callback=o),i=Wr(t,p,h),i!==null&&(Cn(i,t,h,d),rl(i,t,h))},enqueueReplaceState:function(t,i,o){t=t._reactInternals;var d=Nt(),h=qr(t),p=or(d,h);p.tag=1,p.payload=i,o!=null&&(p.callback=o),i=Wr(t,p,h),i!==null&&(Cn(i,t,h,d),rl(i,t,h))},enqueueForceUpdate:function(t,i){t=t._reactInternals;var o=Nt(),d=qr(t),h=or(o,d);h.tag=2,i!=null&&(h.callback=i),i=Wr(t,h,d),i!==null&&(Cn(i,t,d,o),rl(i,t,d))}};function bh(t,i,o,d,h,p,k){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(d,p,k):i.prototype&&i.prototype.isPureReactComponent?!Fa(o,d)||!Fa(h,p):!0}function xh(t,i,o){var d=!1,h=Lr,p=i.contextType;return typeof p=="object"&&p!==null?p=cn(p):(h=Dt(i)?Ei:vt.current,d=i.contextTypes,p=(d=d!=null)?Ss(t,h):Lr),i=new i(o,p),t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=dl,t.stateNode=i,i._reactInternals=t,d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=h,t.__reactInternalMemoizedMaskedChildContext=p),i}function Ch(t,i,o,d){t=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(o,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(o,d),i.state!==t&&dl.enqueueReplaceState(i,i.state,null)}function au(t,i,o,d){var h=t.stateNode;h.props=o,h.state=t.memoizedState,h.refs={},Qc(t);var p=i.contextType;typeof p=="object"&&p!==null?h.context=cn(p):(p=Dt(i)?Ei:vt.current,h.context=Ss(t,p)),h.state=t.memoizedState,p=i.getDerivedStateFromProps,typeof p=="function"&&(su(t,i,p,o),h.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(i=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),i!==h.state&&dl.enqueueReplaceState(h,h.state,null),il(t,o,h,d),h.state=t.memoizedState),typeof h.componentDidMount=="function"&&(t.flags|=4194308)}function Is(t,i){try{var o="",d=i;do o+=be(d),d=d.return;while(d);var h=o}catch(p){h=`
Error generating stack: `+p.message+`
`+p.stack}return{value:t,source:i,stack:h,digest:null}}function ou(t,i,o){return{value:t,source:null,stack:o??null,digest:i??null}}function lu(t,i){try{console.error(i.value)}catch(o){setTimeout(function(){throw o})}}var V0=typeof WeakMap=="function"?WeakMap:Map;function Ph(t,i,o){o=or(-1,o),o.tag=3,o.payload={element:null};var d=i.value;return o.callback=function(){wl||(wl=!0,bu=d),lu(t,i)},o}function Eh(t,i,o){o=or(-1,o),o.tag=3;var d=t.type.getDerivedStateFromError;if(typeof d=="function"){var h=i.value;o.payload=function(){return d(h)},o.callback=function(){lu(t,i)}}var p=t.stateNode;return p!==null&&typeof p.componentDidCatch=="function"&&(o.callback=function(){lu(t,i),typeof d!="function"&&($r===null?$r=new Set([this]):$r.add(this));var k=i.stack;this.componentDidCatch(i.value,{componentStack:k!==null?k:""})}),o}function _h(t,i,o){var d=t.pingCache;if(d===null){d=t.pingCache=new V0;var h=new Set;d.set(i,h)}else h=d.get(i),h===void 0&&(h=new Set,d.set(i,h));h.has(o)||(h.add(o),t=ny.bind(null,t,i,o),i.then(t,t))}function Ih(t){do{var i;if((i=t.tag===13)&&(i=t.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return t;t=t.return}while(t!==null);return null}function Ah(t,i,o,d,h){return(t.mode&1)===0?(t===i?t.flags|=65536:(t.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(i=or(-1,1),i.tag=2,Wr(o,i,1))),o.lanes|=1),t):(t.flags|=65536,t.lanes=h,t)}var W0=B.ReactCurrentOwner,Ot=!1;function Ft(t,i,o,d){i.child=t===null?Xf(i,null,o,d):Cs(i,t.child,o,d)}function Mh(t,i,o,d,h){o=o.render;var p=i.ref;return Es(i,h),d=Jc(t,i,o,d,p,h),o=eu(),t!==null&&!Ot?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~h,lr(t,i,h)):(Ke&&o&&Bc(i),i.flags|=1,Ft(t,i,d,h),i.child)}function Fh(t,i,o,d,h){if(t===null){var p=o.type;return typeof p=="function"&&!Au(p)&&p.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(i.tag=15,i.type=p,Nh(t,i,p,d,h)):(t=xl(o.type,null,d,i,i.mode,h),t.ref=i.ref,t.return=i,i.child=t)}if(p=t.child,(t.lanes&h)===0){var k=p.memoizedProps;if(o=o.compare,o=o!==null?o:Fa,o(k,d)&&t.ref===i.ref)return lr(t,i,h)}return i.flags|=1,t=Gr(p,d),t.ref=i.ref,t.return=i,i.child=t}function Nh(t,i,o,d,h){if(t!==null){var p=t.memoizedProps;if(Fa(p,d)&&t.ref===i.ref)if(Ot=!1,i.pendingProps=d=p,(t.lanes&h)!==0)(t.flags&131072)!==0&&(Ot=!0);else return i.lanes=t.lanes,lr(t,i,h)}return cu(t,i,o,d,h)}function Rh(t,i,o){var d=i.pendingProps,h=d.children,p=t!==null?t.memoizedState:null;if(d.mode==="hidden")if((i.mode&1)===0)i.memoizedState={baseLanes:0,cachePool:null,transitions:null},He(Ms,Yt),Yt|=o;else{if((o&1073741824)===0)return t=p!==null?p.baseLanes|o:o,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:t,cachePool:null,transitions:null},i.updateQueue=null,He(Ms,Yt),Yt|=t,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=p!==null?p.baseLanes:o,He(Ms,Yt),Yt|=d}else p!==null?(d=p.baseLanes|o,i.memoizedState=null):d=o,He(Ms,Yt),Yt|=d;return Ft(t,i,h,o),i.child}function zh(t,i){var o=i.ref;(t===null&&o!==null||t!==null&&t.ref!==o)&&(i.flags|=512,i.flags|=2097152)}function cu(t,i,o,d,h){var p=Dt(o)?Ei:vt.current;return p=Ss(i,p),Es(i,h),o=Jc(t,i,o,d,p,h),d=eu(),t!==null&&!Ot?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~h,lr(t,i,h)):(Ke&&d&&Bc(i),i.flags|=1,Ft(t,i,o,h),i.child)}function Bh(t,i,o,d,h){if(Dt(o)){var p=!0;Go(i)}else p=!1;if(Es(i,h),i.stateNode===null)hl(t,i),xh(i,o,d),au(i,o,d,h),d=!0;else if(t===null){var k=i.stateNode,P=i.memoizedProps;k.props=P;var M=k.context,U=o.contextType;typeof U=="object"&&U!==null?U=cn(U):(U=Dt(o)?Ei:vt.current,U=Ss(i,U));var $=o.getDerivedStateFromProps,K=typeof $=="function"||typeof k.getSnapshotBeforeUpdate=="function";K||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(P!==d||M!==U)&&Ch(i,k,d,U),Vr=!1;var H=i.memoizedState;k.state=H,il(i,d,k,h),M=i.memoizedState,P!==d||H!==M||Bt.current||Vr?(typeof $=="function"&&(su(i,o,$,d),M=i.memoizedState),(P=Vr||bh(i,o,P,d,H,M,U))?(K||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount()),typeof k.componentDidMount=="function"&&(i.flags|=4194308)):(typeof k.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=M),k.props=d,k.state=M,k.context=U,d=P):(typeof k.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{k=i.stateNode,Zf(t,i),P=i.memoizedProps,U=i.type===i.elementType?P:vn(i.type,P),k.props=U,K=i.pendingProps,H=k.context,M=o.contextType,typeof M=="object"&&M!==null?M=cn(M):(M=Dt(o)?Ei:vt.current,M=Ss(i,M));var ie=o.getDerivedStateFromProps;($=typeof ie=="function"||typeof k.getSnapshotBeforeUpdate=="function")||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(P!==K||H!==M)&&Ch(i,k,d,M),Vr=!1,H=i.memoizedState,k.state=H,il(i,d,k,h);var ce=i.memoizedState;P!==K||H!==ce||Bt.current||Vr?(typeof ie=="function"&&(su(i,o,ie,d),ce=i.memoizedState),(U=Vr||bh(i,o,U,d,H,ce,M)||!1)?($||typeof k.UNSAFE_componentWillUpdate!="function"&&typeof k.componentWillUpdate!="function"||(typeof k.componentWillUpdate=="function"&&k.componentWillUpdate(d,ce,M),typeof k.UNSAFE_componentWillUpdate=="function"&&k.UNSAFE_componentWillUpdate(d,ce,M)),typeof k.componentDidUpdate=="function"&&(i.flags|=4),typeof k.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof k.componentDidUpdate!="function"||P===t.memoizedProps&&H===t.memoizedState||(i.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||P===t.memoizedProps&&H===t.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=ce),k.props=d,k.state=ce,k.context=M,d=U):(typeof k.componentDidUpdate!="function"||P===t.memoizedProps&&H===t.memoizedState||(i.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||P===t.memoizedProps&&H===t.memoizedState||(i.flags|=1024),d=!1)}return uu(t,i,o,d,p,h)}function uu(t,i,o,d,h,p){zh(t,i);var k=(i.flags&128)!==0;if(!d&&!k)return h&&jf(i,o,!1),lr(t,i,p);d=i.stateNode,W0.current=i;var P=k&&typeof o.getDerivedStateFromError!="function"?null:d.render();return i.flags|=1,t!==null&&k?(i.child=Cs(i,t.child,null,p),i.child=Cs(i,null,P,p)):Ft(t,i,P,p),i.memoizedState=d.state,h&&jf(i,o,!0),i.child}function Dh(t){var i=t.stateNode;i.pendingContext?Uf(t,i.pendingContext,i.pendingContext!==i.context):i.context&&Uf(t,i.context,!1),qc(t,i.containerInfo)}function Oh(t,i,o,d,h){return xs(),Lc(h),i.flags|=256,Ft(t,i,o,d),i.child}var du={dehydrated:null,treeContext:null,retryLane:0};function fu(t){return{baseLanes:t,cachePool:null,transitions:null}}function Uh(t,i,o){var d=i.pendingProps,h=Ge.current,p=!1,k=(i.flags&128)!==0,P;if((P=k)||(P=t!==null&&t.memoizedState===null?!1:(h&2)!==0),P?(p=!0,i.flags&=-129):(t===null||t.memoizedState!==null)&&(h|=1),He(Ge,h&1),t===null)return Uc(i),t=i.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((i.mode&1)===0?i.lanes=1:t.data==="$!"?i.lanes=8:i.lanes=1073741824,null):(k=d.children,t=d.fallback,p?(d=i.mode,p=i.child,k={mode:"hidden",children:k},(d&1)===0&&p!==null?(p.childLanes=0,p.pendingProps=k):p=Cl(k,d,0,null),t=Di(t,d,o,null),p.return=i,t.return=i,p.sibling=t,i.child=p,i.child.memoizedState=fu(o),i.memoizedState=du,t):hu(i,k));if(h=t.memoizedState,h!==null&&(P=h.dehydrated,P!==null))return H0(t,i,k,d,P,h,o);if(p){p=d.fallback,k=i.mode,h=t.child,P=h.sibling;var M={mode:"hidden",children:d.children};return(k&1)===0&&i.child!==h?(d=i.child,d.childLanes=0,d.pendingProps=M,i.deletions=null):(d=Gr(h,M),d.subtreeFlags=h.subtreeFlags&14680064),P!==null?p=Gr(P,p):(p=Di(p,k,o,null),p.flags|=2),p.return=i,d.return=i,d.sibling=p,i.child=d,d=p,p=i.child,k=t.child.memoizedState,k=k===null?fu(o):{baseLanes:k.baseLanes|o,cachePool:null,transitions:k.transitions},p.memoizedState=k,p.childLanes=t.childLanes&~o,i.memoizedState=du,d}return p=t.child,t=p.sibling,d=Gr(p,{mode:"visible",children:d.children}),(i.mode&1)===0&&(d.lanes=o),d.return=i,d.sibling=null,t!==null&&(o=i.deletions,o===null?(i.deletions=[t],i.flags|=16):o.push(t)),i.child=d,i.memoizedState=null,d}function hu(t,i){return i=Cl({mode:"visible",children:i},t.mode,0,null),i.return=t,t.child=i}function fl(t,i,o,d){return d!==null&&Lc(d),Cs(i,t.child,null,o),t=hu(i,i.pendingProps.children),t.flags|=2,i.memoizedState=null,t}function H0(t,i,o,d,h,p,k){if(o)return i.flags&256?(i.flags&=-257,d=ou(Error(r(422))),fl(t,i,k,d)):i.memoizedState!==null?(i.child=t.child,i.flags|=128,null):(p=d.fallback,h=i.mode,d=Cl({mode:"visible",children:d.children},h,0,null),p=Di(p,h,k,null),p.flags|=2,d.return=i,p.return=i,d.sibling=p,i.child=d,(i.mode&1)!==0&&Cs(i,t.child,null,k),i.child.memoizedState=fu(k),i.memoizedState=du,p);if((i.mode&1)===0)return fl(t,i,k,null);if(h.data==="$!"){if(d=h.nextSibling&&h.nextSibling.dataset,d)var P=d.dgst;return d=P,p=Error(r(419)),d=ou(p,d,void 0),fl(t,i,k,d)}if(P=(k&t.childLanes)!==0,Ot||P){if(d=ft,d!==null){switch(k&-k){case 4:h=2;break;case 16:h=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:h=32;break;case 536870912:h=268435456;break;default:h=0}h=(h&(d.suspendedLanes|k))!==0?0:h,h!==0&&h!==p.retryLane&&(p.retryLane=h,ar(t,h),Cn(d,t,h,-1))}return Iu(),d=ou(Error(r(421))),fl(t,i,k,d)}return h.data==="$?"?(i.flags|=128,i.child=t.child,i=ry.bind(null,t),h._reactRetry=i,null):(t=p.treeContext,Xt=Or(h.nextSibling),Gt=i,Ke=!0,Sn=null,t!==null&&(on[ln++]=ir,on[ln++]=sr,on[ln++]=_i,ir=t.id,sr=t.overflow,_i=i),i=hu(i,d.children),i.flags|=4096,i)}function Lh(t,i,o){t.lanes|=i;var d=t.alternate;d!==null&&(d.lanes|=i),Hc(t.return,i,o)}function mu(t,i,o,d,h){var p=t.memoizedState;p===null?t.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:h}:(p.isBackwards=i,p.rendering=null,p.renderingStartTime=0,p.last=d,p.tail=o,p.tailMode=h)}function jh(t,i,o){var d=i.pendingProps,h=d.revealOrder,p=d.tail;if(Ft(t,i,d.children,o),d=Ge.current,(d&2)!==0)d=d&1|2,i.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=i.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Lh(t,o,i);else if(t.tag===19)Lh(t,o,i);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break e;for(;t.sibling===null;){if(t.return===null||t.return===i)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}d&=1}if(He(Ge,d),(i.mode&1)===0)i.memoizedState=null;else switch(h){case"forwards":for(o=i.child,h=null;o!==null;)t=o.alternate,t!==null&&sl(t)===null&&(h=o),o=o.sibling;o=h,o===null?(h=i.child,i.child=null):(h=o.sibling,o.sibling=null),mu(i,!1,h,o,p);break;case"backwards":for(o=null,h=i.child,i.child=null;h!==null;){if(t=h.alternate,t!==null&&sl(t)===null){i.child=h;break}t=h.sibling,h.sibling=o,o=h,h=t}mu(i,!0,o,null,p);break;case"together":mu(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function hl(t,i){(i.mode&1)===0&&t!==null&&(t.alternate=null,i.alternate=null,i.flags|=2)}function lr(t,i,o){if(t!==null&&(i.dependencies=t.dependencies),Ni|=i.lanes,(o&i.childLanes)===0)return null;if(t!==null&&i.child!==t.child)throw Error(r(153));if(i.child!==null){for(t=i.child,o=Gr(t,t.pendingProps),i.child=o,o.return=i;t.sibling!==null;)t=t.sibling,o=o.sibling=Gr(t,t.pendingProps),o.return=i;o.sibling=null}return i.child}function $0(t,i,o){switch(i.tag){case 3:Dh(i),xs();break;case 5:th(i);break;case 1:Dt(i.type)&&Go(i);break;case 4:qc(i,i.stateNode.containerInfo);break;case 10:var d=i.type._context,h=i.memoizedProps.value;He(tl,d._currentValue),d._currentValue=h;break;case 13:if(d=i.memoizedState,d!==null)return d.dehydrated!==null?(He(Ge,Ge.current&1),i.flags|=128,null):(o&i.child.childLanes)!==0?Uh(t,i,o):(He(Ge,Ge.current&1),t=lr(t,i,o),t!==null?t.sibling:null);He(Ge,Ge.current&1);break;case 19:if(d=(o&i.childLanes)!==0,(t.flags&128)!==0){if(d)return jh(t,i,o);i.flags|=128}if(h=i.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),He(Ge,Ge.current),d)break;return null;case 22:case 23:return i.lanes=0,Rh(t,i,o)}return lr(t,i,o)}var Vh,pu,Wh,Hh;Vh=function(t,i){for(var o=i.child;o!==null;){if(o.tag===5||o.tag===6)t.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return;o=o.return}o.sibling.return=o.return,o=o.sibling}},pu=function(){},Wh=function(t,i,o,d){var h=t.memoizedProps;if(h!==d){t=i.stateNode,Mi(jn.current);var p=null;switch(o){case"input":h=Gn(t,h),d=Gn(t,d),p=[];break;case"select":h=X({},h,{value:void 0}),d=X({},d,{value:void 0}),p=[];break;case"textarea":h=Xi(t,h),d=Xi(t,d),p=[];break;default:typeof h.onClick!="function"&&typeof d.onClick=="function"&&(t.onclick=Qo)}Yi(o,d);var k;o=null;for(U in h)if(!d.hasOwnProperty(U)&&h.hasOwnProperty(U)&&h[U]!=null)if(U==="style"){var P=h[U];for(k in P)P.hasOwnProperty(k)&&(o||(o={}),o[k]="")}else U!=="dangerouslySetInnerHTML"&&U!=="children"&&U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&U!=="autoFocus"&&(a.hasOwnProperty(U)?p||(p=[]):(p=p||[]).push(U,null));for(U in d){var M=d[U];if(P=h?.[U],d.hasOwnProperty(U)&&M!==P&&(M!=null||P!=null))if(U==="style")if(P){for(k in P)!P.hasOwnProperty(k)||M&&M.hasOwnProperty(k)||(o||(o={}),o[k]="");for(k in M)M.hasOwnProperty(k)&&P[k]!==M[k]&&(o||(o={}),o[k]=M[k])}else o||(p||(p=[]),p.push(U,o)),o=M;else U==="dangerouslySetInnerHTML"?(M=M?M.__html:void 0,P=P?P.__html:void 0,M!=null&&P!==M&&(p=p||[]).push(U,M)):U==="children"?typeof M!="string"&&typeof M!="number"||(p=p||[]).push(U,""+M):U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&(a.hasOwnProperty(U)?(M!=null&&U==="onScroll"&&$e("scroll",t),p||P===M||(p=[])):(p=p||[]).push(U,M))}o&&(p=p||[]).push("style",o);var U=p;(i.updateQueue=U)&&(i.flags|=4)}},Hh=function(t,i,o,d){o!==d&&(i.flags|=4)};function qa(t,i){if(!Ke)switch(t.tailMode){case"hidden":i=t.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?t.tail=null:o.sibling=null;break;case"collapsed":o=t.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?i||t.tail===null?t.tail=null:t.tail.sibling=null:d.sibling=null}}function xt(t){var i=t.alternate!==null&&t.alternate.child===t.child,o=0,d=0;if(i)for(var h=t.child;h!==null;)o|=h.lanes|h.childLanes,d|=h.subtreeFlags&14680064,d|=h.flags&14680064,h.return=t,h=h.sibling;else for(h=t.child;h!==null;)o|=h.lanes|h.childLanes,d|=h.subtreeFlags,d|=h.flags,h.return=t,h=h.sibling;return t.subtreeFlags|=d,t.childLanes=o,i}function Q0(t,i,o){var d=i.pendingProps;switch(Dc(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xt(i),null;case 1:return Dt(i.type)&&Ko(),xt(i),null;case 3:return d=i.stateNode,_s(),Qe(Bt),Qe(vt),Xc(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(t===null||t.child===null)&&(Jo(i)?i.flags|=4:t===null||t.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,Sn!==null&&(Pu(Sn),Sn=null))),pu(t,i),xt(i),null;case 5:Kc(i);var h=Mi(Va.current);if(o=i.type,t!==null&&i.stateNode!=null)Wh(t,i,o,d,h),t.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!d){if(i.stateNode===null)throw Error(r(166));return xt(i),null}if(t=Mi(jn.current),Jo(i)){d=i.stateNode,o=i.type;var p=i.memoizedProps;switch(d[Ln]=i,d[Da]=p,t=(i.mode&1)!==0,o){case"dialog":$e("cancel",d),$e("close",d);break;case"iframe":case"object":case"embed":$e("load",d);break;case"video":case"audio":for(h=0;h<Ra.length;h++)$e(Ra[h],d);break;case"source":$e("error",d);break;case"img":case"image":case"link":$e("error",d),$e("load",d);break;case"details":$e("toggle",d);break;case"input":ci(d,p),$e("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!p.multiple},$e("invalid",d);break;case"textarea":So(d,p),$e("invalid",d)}Yi(o,p),h=null;for(var k in p)if(p.hasOwnProperty(k)){var P=p[k];k==="children"?typeof P=="string"?d.textContent!==P&&(p.suppressHydrationWarning!==!0&&$o(d.textContent,P,t),h=["children",P]):typeof P=="number"&&d.textContent!==""+P&&(p.suppressHydrationWarning!==!0&&$o(d.textContent,P,t),h=["children",""+P]):a.hasOwnProperty(k)&&P!=null&&k==="onScroll"&&$e("scroll",d)}switch(o){case"input":Rn(d),Sr(d,p,!0);break;case"textarea":Rn(d),vo(d);break;case"select":case"option":break;default:typeof p.onClick=="function"&&(d.onclick=Qo)}d=h,i.updateQueue=d,d!==null&&(i.flags|=4)}else{k=h.nodeType===9?h:h.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=nt(o)),t==="http://www.w3.org/1999/xhtml"?o==="script"?(t=k.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof d.is=="string"?t=k.createElement(o,{is:d.is}):(t=k.createElement(o),o==="select"&&(k=t,d.multiple?k.multiple=!0:d.size&&(k.size=d.size))):t=k.createElementNS(t,o),t[Ln]=i,t[Da]=d,Vh(t,i,!1,!1),i.stateNode=t;e:{switch(k=di(o,d),o){case"dialog":$e("cancel",t),$e("close",t),h=d;break;case"iframe":case"object":case"embed":$e("load",t),h=d;break;case"video":case"audio":for(h=0;h<Ra.length;h++)$e(Ra[h],t);h=d;break;case"source":$e("error",t),h=d;break;case"img":case"image":case"link":$e("error",t),$e("load",t),h=d;break;case"details":$e("toggle",t),h=d;break;case"input":ci(t,d),h=Gn(t,d),$e("invalid",t);break;case"option":h=d;break;case"select":t._wrapperState={wasMultiple:!!d.multiple},h=X({},d,{value:void 0}),$e("invalid",t);break;case"textarea":So(t,d),h=Xi(t,d),$e("invalid",t);break;default:h=d}Yi(o,h),P=h;for(p in P)if(P.hasOwnProperty(p)){var M=P[p];p==="style"?xo(t,M):p==="dangerouslySetInnerHTML"?(M=M?M.__html:void 0,M!=null&&ua(t,M)):p==="children"?typeof M=="string"?(o!=="textarea"||M!=="")&&st(t,M):typeof M=="number"&&st(t,""+M):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(a.hasOwnProperty(p)?M!=null&&p==="onScroll"&&$e("scroll",t):M!=null&&O(t,p,M,k))}switch(o){case"input":Rn(t),Sr(t,d,!1);break;case"textarea":Rn(t),vo(t);break;case"option":d.value!=null&&t.setAttribute("value",""+Ae(d.value));break;case"select":t.multiple=!!d.multiple,p=d.value,p!=null?Xn(t,!!d.multiple,p,!1):d.defaultValue!=null&&Xn(t,!!d.multiple,d.defaultValue,!0);break;default:typeof h.onClick=="function"&&(t.onclick=Qo)}switch(o){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return xt(i),null;case 6:if(t&&i.stateNode!=null)Hh(t,i,t.memoizedProps,d);else{if(typeof d!="string"&&i.stateNode===null)throw Error(r(166));if(o=Mi(Va.current),Mi(jn.current),Jo(i)){if(d=i.stateNode,o=i.memoizedProps,d[Ln]=i,(p=d.nodeValue!==o)&&(t=Gt,t!==null))switch(t.tag){case 3:$o(d.nodeValue,o,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&$o(d.nodeValue,o,(t.mode&1)!==0)}p&&(i.flags|=4)}else d=(o.nodeType===9?o:o.ownerDocument).createTextNode(d),d[Ln]=i,i.stateNode=d}return xt(i),null;case 13:if(Qe(Ge),d=i.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ke&&Xt!==null&&(i.mode&1)!==0&&(i.flags&128)===0)qf(),xs(),i.flags|=98560,p=!1;else if(p=Jo(i),d!==null&&d.dehydrated!==null){if(t===null){if(!p)throw Error(r(318));if(p=i.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(r(317));p[Ln]=i}else xs(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;xt(i),p=!1}else Sn!==null&&(Pu(Sn),Sn=null),p=!0;if(!p)return i.flags&65536?i:null}return(i.flags&128)!==0?(i.lanes=o,i):(d=d!==null,d!==(t!==null&&t.memoizedState!==null)&&d&&(i.child.flags|=8192,(i.mode&1)!==0&&(t===null||(Ge.current&1)!==0?ct===0&&(ct=3):Iu())),i.updateQueue!==null&&(i.flags|=4),xt(i),null);case 4:return _s(),pu(t,i),t===null&&za(i.stateNode.containerInfo),xt(i),null;case 10:return Wc(i.type._context),xt(i),null;case 17:return Dt(i.type)&&Ko(),xt(i),null;case 19:if(Qe(Ge),p=i.memoizedState,p===null)return xt(i),null;if(d=(i.flags&128)!==0,k=p.rendering,k===null)if(d)qa(p,!1);else{if(ct!==0||t!==null&&(t.flags&128)!==0)for(t=i.child;t!==null;){if(k=sl(t),k!==null){for(i.flags|=128,qa(p,!1),d=k.updateQueue,d!==null&&(i.updateQueue=d,i.flags|=4),i.subtreeFlags=0,d=o,o=i.child;o!==null;)p=o,t=d,p.flags&=14680066,k=p.alternate,k===null?(p.childLanes=0,p.lanes=t,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=k.childLanes,p.lanes=k.lanes,p.child=k.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=k.memoizedProps,p.memoizedState=k.memoizedState,p.updateQueue=k.updateQueue,p.type=k.type,t=k.dependencies,p.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),o=o.sibling;return He(Ge,Ge.current&1|2),i.child}t=t.sibling}p.tail!==null&&je()>Fs&&(i.flags|=128,d=!0,qa(p,!1),i.lanes=4194304)}else{if(!d)if(t=sl(k),t!==null){if(i.flags|=128,d=!0,o=t.updateQueue,o!==null&&(i.updateQueue=o,i.flags|=4),qa(p,!0),p.tail===null&&p.tailMode==="hidden"&&!k.alternate&&!Ke)return xt(i),null}else 2*je()-p.renderingStartTime>Fs&&o!==1073741824&&(i.flags|=128,d=!0,qa(p,!1),i.lanes=4194304);p.isBackwards?(k.sibling=i.child,i.child=k):(o=p.last,o!==null?o.sibling=k:i.child=k,p.last=k)}return p.tail!==null?(i=p.tail,p.rendering=i,p.tail=i.sibling,p.renderingStartTime=je(),i.sibling=null,o=Ge.current,He(Ge,d?o&1|2:o&1),i):(xt(i),null);case 22:case 23:return _u(),d=i.memoizedState!==null,t!==null&&t.memoizedState!==null!==d&&(i.flags|=8192),d&&(i.mode&1)!==0?(Yt&1073741824)!==0&&(xt(i),i.subtreeFlags&6&&(i.flags|=8192)):xt(i),null;case 24:return null;case 25:return null}throw Error(r(156,i.tag))}function q0(t,i){switch(Dc(i),i.tag){case 1:return Dt(i.type)&&Ko(),t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 3:return _s(),Qe(Bt),Qe(vt),Xc(),t=i.flags,(t&65536)!==0&&(t&128)===0?(i.flags=t&-65537|128,i):null;case 5:return Kc(i),null;case 13:if(Qe(Ge),t=i.memoizedState,t!==null&&t.dehydrated!==null){if(i.alternate===null)throw Error(r(340));xs()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 19:return Qe(Ge),null;case 4:return _s(),null;case 10:return Wc(i.type._context),null;case 22:case 23:return _u(),null;case 24:return null;default:return null}}var ml=!1,Ct=!1,K0=typeof WeakSet=="function"?WeakSet:Set,le=null;function As(t,i){var o=t.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(d){Je(t,i,d)}else o.current=null}function gu(t,i,o){try{o()}catch(d){Je(t,i,d)}}var $h=!1;function G0(t,i){if(_c=ls,t=bf(),Tc(t)){if("selectionStart"in t)var o={start:t.selectionStart,end:t.selectionEnd};else e:{o=(o=t.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var h=d.anchorOffset,p=d.focusNode;d=d.focusOffset;try{o.nodeType,p.nodeType}catch{o=null;break e}var k=0,P=-1,M=-1,U=0,$=0,K=t,H=null;t:for(;;){for(var ie;K!==o||h!==0&&K.nodeType!==3||(P=k+h),K!==p||d!==0&&K.nodeType!==3||(M=k+d),K.nodeType===3&&(k+=K.nodeValue.length),(ie=K.firstChild)!==null;)H=K,K=ie;for(;;){if(K===t)break t;if(H===o&&++U===h&&(P=k),H===p&&++$===d&&(M=k),(ie=K.nextSibling)!==null)break;K=H,H=K.parentNode}K=ie}o=P===-1||M===-1?null:{start:P,end:M}}else o=null}o=o||{start:0,end:0}}else o=null;for(Ic={focusedElem:t,selectionRange:o},ls=!1,le=i;le!==null;)if(i=le,t=i.child,(i.subtreeFlags&1028)!==0&&t!==null)t.return=i,le=t;else for(;le!==null;){i=le;try{var ce=i.alternate;if((i.flags&1024)!==0)switch(i.tag){case 0:case 11:case 15:break;case 1:if(ce!==null){var ue=ce.memoizedProps,it=ce.memoizedState,R=i.stateNode,F=R.getSnapshotBeforeUpdate(i.elementType===i.type?ue:vn(i.type,ue),it);R.__reactInternalSnapshotBeforeUpdate=F}break;case 3:var z=i.stateNode.containerInfo;z.nodeType===1?z.textContent="":z.nodeType===9&&z.documentElement&&z.removeChild(z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(Z){Je(i,i.return,Z)}if(t=i.sibling,t!==null){t.return=i.return,le=t;break}le=i.return}return ce=$h,$h=!1,ce}function Ka(t,i,o){var d=i.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var h=d=d.next;do{if((h.tag&t)===t){var p=h.destroy;h.destroy=void 0,p!==void 0&&gu(i,o,p)}h=h.next}while(h!==d)}}function pl(t,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var o=i=i.next;do{if((o.tag&t)===t){var d=o.create;o.destroy=d()}o=o.next}while(o!==i)}}function yu(t){var i=t.ref;if(i!==null){var o=t.stateNode;switch(t.tag){case 5:t=o;break;default:t=o}typeof i=="function"?i(t):i.current=t}}function Qh(t){var i=t.alternate;i!==null&&(t.alternate=null,Qh(i)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(i=t.stateNode,i!==null&&(delete i[Ln],delete i[Da],delete i[Nc],delete i[M0],delete i[F0])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function qh(t){return t.tag===5||t.tag===3||t.tag===4}function Kh(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||qh(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function wu(t,i,o){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?o.nodeType===8?o.parentNode.insertBefore(t,i):o.insertBefore(t,i):(o.nodeType===8?(i=o.parentNode,i.insertBefore(t,o)):(i=o,i.appendChild(t)),o=o._reactRootContainer,o!=null||i.onclick!==null||(i.onclick=Qo));else if(d!==4&&(t=t.child,t!==null))for(wu(t,i,o),t=t.sibling;t!==null;)wu(t,i,o),t=t.sibling}function ku(t,i,o){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?o.insertBefore(t,i):o.appendChild(t);else if(d!==4&&(t=t.child,t!==null))for(ku(t,i,o),t=t.sibling;t!==null;)ku(t,i,o),t=t.sibling}var pt=null,bn=!1;function Hr(t,i,o){for(o=o.child;o!==null;)Gh(t,i,o),o=o.sibling}function Gh(t,i,o){if(Rt&&typeof Rt.onCommitFiberUnmount=="function")try{Rt.onCommitFiberUnmount(pi,o)}catch{}switch(o.tag){case 5:Ct||As(o,i);case 6:var d=pt,h=bn;pt=null,Hr(t,i,o),pt=d,bn=h,pt!==null&&(bn?(t=pt,o=o.stateNode,t.nodeType===8?t.parentNode.removeChild(o):t.removeChild(o)):pt.removeChild(o.stateNode));break;case 18:pt!==null&&(bn?(t=pt,o=o.stateNode,t.nodeType===8?Fc(t.parentNode,o):t.nodeType===1&&Fc(t,o),tr(t)):Fc(pt,o.stateNode));break;case 4:d=pt,h=bn,pt=o.stateNode.containerInfo,bn=!0,Hr(t,i,o),pt=d,bn=h;break;case 0:case 11:case 14:case 15:if(!Ct&&(d=o.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){h=d=d.next;do{var p=h,k=p.destroy;p=p.tag,k!==void 0&&((p&2)!==0||(p&4)!==0)&&gu(o,i,k),h=h.next}while(h!==d)}Hr(t,i,o);break;case 1:if(!Ct&&(As(o,i),d=o.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=o.memoizedProps,d.state=o.memoizedState,d.componentWillUnmount()}catch(P){Je(o,i,P)}Hr(t,i,o);break;case 21:Hr(t,i,o);break;case 22:o.mode&1?(Ct=(d=Ct)||o.memoizedState!==null,Hr(t,i,o),Ct=d):Hr(t,i,o);break;default:Hr(t,i,o)}}function Xh(t){var i=t.updateQueue;if(i!==null){t.updateQueue=null;var o=t.stateNode;o===null&&(o=t.stateNode=new K0),i.forEach(function(d){var h=iy.bind(null,t,d);o.has(d)||(o.add(d),d.then(h,h))})}}function xn(t,i){var o=i.deletions;if(o!==null)for(var d=0;d<o.length;d++){var h=o[d];try{var p=t,k=i,P=k;e:for(;P!==null;){switch(P.tag){case 5:pt=P.stateNode,bn=!1;break e;case 3:pt=P.stateNode.containerInfo,bn=!0;break e;case 4:pt=P.stateNode.containerInfo,bn=!0;break e}P=P.return}if(pt===null)throw Error(r(160));Gh(p,k,h),pt=null,bn=!1;var M=h.alternate;M!==null&&(M.return=null),h.return=null}catch(U){Je(h,i,U)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)Yh(i,t),i=i.sibling}function Yh(t,i){var o=t.alternate,d=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(xn(i,t),Wn(t),d&4){try{Ka(3,t,t.return),pl(3,t)}catch(ue){Je(t,t.return,ue)}try{Ka(5,t,t.return)}catch(ue){Je(t,t.return,ue)}}break;case 1:xn(i,t),Wn(t),d&512&&o!==null&&As(o,o.return);break;case 5:if(xn(i,t),Wn(t),d&512&&o!==null&&As(o,o.return),t.flags&32){var h=t.stateNode;try{st(h,"")}catch(ue){Je(t,t.return,ue)}}if(d&4&&(h=t.stateNode,h!=null)){var p=t.memoizedProps,k=o!==null?o.memoizedProps:p,P=t.type,M=t.updateQueue;if(t.updateQueue=null,M!==null)try{P==="input"&&p.type==="radio"&&p.name!=null&&Gi(h,p),di(P,k);var U=di(P,p);for(k=0;k<M.length;k+=2){var $=M[k],K=M[k+1];$==="style"?xo(h,K):$==="dangerouslySetInnerHTML"?ua(h,K):$==="children"?st(h,K):O(h,$,K,U)}switch(P){case"input":oa(h,p);break;case"textarea":ca(h,p);break;case"select":var H=h._wrapperState.wasMultiple;h._wrapperState.wasMultiple=!!p.multiple;var ie=p.value;ie!=null?Xn(h,!!p.multiple,ie,!1):H!==!!p.multiple&&(p.defaultValue!=null?Xn(h,!!p.multiple,p.defaultValue,!0):Xn(h,!!p.multiple,p.multiple?[]:"",!1))}h[Da]=p}catch(ue){Je(t,t.return,ue)}}break;case 6:if(xn(i,t),Wn(t),d&4){if(t.stateNode===null)throw Error(r(162));h=t.stateNode,p=t.memoizedProps;try{h.nodeValue=p}catch(ue){Je(t,t.return,ue)}}break;case 3:if(xn(i,t),Wn(t),d&4&&o!==null&&o.memoizedState.isDehydrated)try{tr(i.containerInfo)}catch(ue){Je(t,t.return,ue)}break;case 4:xn(i,t),Wn(t);break;case 13:xn(i,t),Wn(t),h=t.child,h.flags&8192&&(p=h.memoizedState!==null,h.stateNode.isHidden=p,!p||h.alternate!==null&&h.alternate.memoizedState!==null||(vu=je())),d&4&&Xh(t);break;case 22:if($=o!==null&&o.memoizedState!==null,t.mode&1?(Ct=(U=Ct)||$,xn(i,t),Ct=U):xn(i,t),Wn(t),d&8192){if(U=t.memoizedState!==null,(t.stateNode.isHidden=U)&&!$&&(t.mode&1)!==0)for(le=t,$=t.child;$!==null;){for(K=le=$;le!==null;){switch(H=le,ie=H.child,H.tag){case 0:case 11:case 14:case 15:Ka(4,H,H.return);break;case 1:As(H,H.return);var ce=H.stateNode;if(typeof ce.componentWillUnmount=="function"){d=H,o=H.return;try{i=d,ce.props=i.memoizedProps,ce.state=i.memoizedState,ce.componentWillUnmount()}catch(ue){Je(d,o,ue)}}break;case 5:As(H,H.return);break;case 22:if(H.memoizedState!==null){em(K);continue}}ie!==null?(ie.return=H,le=ie):em(K)}$=$.sibling}e:for($=null,K=t;;){if(K.tag===5){if($===null){$=K;try{h=K.stateNode,U?(p=h.style,typeof p.setProperty=="function"?p.setProperty("display","none","important"):p.display="none"):(P=K.stateNode,M=K.memoizedProps.style,k=M!=null&&M.hasOwnProperty("display")?M.display:null,P.style.display=bo("display",k))}catch(ue){Je(t,t.return,ue)}}}else if(K.tag===6){if($===null)try{K.stateNode.nodeValue=U?"":K.memoizedProps}catch(ue){Je(t,t.return,ue)}}else if((K.tag!==22&&K.tag!==23||K.memoizedState===null||K===t)&&K.child!==null){K.child.return=K,K=K.child;continue}if(K===t)break e;for(;K.sibling===null;){if(K.return===null||K.return===t)break e;$===K&&($=null),K=K.return}$===K&&($=null),K.sibling.return=K.return,K=K.sibling}}break;case 19:xn(i,t),Wn(t),d&4&&Xh(t);break;case 21:break;default:xn(i,t),Wn(t)}}function Wn(t){var i=t.flags;if(i&2){try{e:{for(var o=t.return;o!==null;){if(qh(o)){var d=o;break e}o=o.return}throw Error(r(160))}switch(d.tag){case 5:var h=d.stateNode;d.flags&32&&(st(h,""),d.flags&=-33);var p=Kh(t);ku(t,p,h);break;case 3:case 4:var k=d.stateNode.containerInfo,P=Kh(t);wu(t,P,k);break;default:throw Error(r(161))}}catch(M){Je(t,t.return,M)}t.flags&=-3}i&4096&&(t.flags&=-4097)}function X0(t,i,o){le=t,Zh(t)}function Zh(t,i,o){for(var d=(t.mode&1)!==0;le!==null;){var h=le,p=h.child;if(h.tag===22&&d){var k=h.memoizedState!==null||ml;if(!k){var P=h.alternate,M=P!==null&&P.memoizedState!==null||Ct;P=ml;var U=Ct;if(ml=k,(Ct=M)&&!U)for(le=h;le!==null;)k=le,M=k.child,k.tag===22&&k.memoizedState!==null?tm(h):M!==null?(M.return=k,le=M):tm(h);for(;p!==null;)le=p,Zh(p),p=p.sibling;le=h,ml=P,Ct=U}Jh(t)}else(h.subtreeFlags&8772)!==0&&p!==null?(p.return=h,le=p):Jh(t)}}function Jh(t){for(;le!==null;){var i=le;if((i.flags&8772)!==0){var o=i.alternate;try{if((i.flags&8772)!==0)switch(i.tag){case 0:case 11:case 15:Ct||pl(5,i);break;case 1:var d=i.stateNode;if(i.flags&4&&!Ct)if(o===null)d.componentDidMount();else{var h=i.elementType===i.type?o.memoizedProps:vn(i.type,o.memoizedProps);d.componentDidUpdate(h,o.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var p=i.updateQueue;p!==null&&eh(i,p,d);break;case 3:var k=i.updateQueue;if(k!==null){if(o=null,i.child!==null)switch(i.child.tag){case 5:o=i.child.stateNode;break;case 1:o=i.child.stateNode}eh(i,k,o)}break;case 5:var P=i.stateNode;if(o===null&&i.flags&4){o=P;var M=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":M.autoFocus&&o.focus();break;case"img":M.src&&(o.src=M.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var U=i.alternate;if(U!==null){var $=U.memoizedState;if($!==null){var K=$.dehydrated;K!==null&&tr(K)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}Ct||i.flags&512&&yu(i)}catch(H){Je(i,i.return,H)}}if(i===t){le=null;break}if(o=i.sibling,o!==null){o.return=i.return,le=o;break}le=i.return}}function em(t){for(;le!==null;){var i=le;if(i===t){le=null;break}var o=i.sibling;if(o!==null){o.return=i.return,le=o;break}le=i.return}}function tm(t){for(;le!==null;){var i=le;try{switch(i.tag){case 0:case 11:case 15:var o=i.return;try{pl(4,i)}catch(M){Je(i,o,M)}break;case 1:var d=i.stateNode;if(typeof d.componentDidMount=="function"){var h=i.return;try{d.componentDidMount()}catch(M){Je(i,h,M)}}var p=i.return;try{yu(i)}catch(M){Je(i,p,M)}break;case 5:var k=i.return;try{yu(i)}catch(M){Je(i,k,M)}}}catch(M){Je(i,i.return,M)}if(i===t){le=null;break}var P=i.sibling;if(P!==null){P.return=i.return,le=P;break}le=i.return}}var Y0=Math.ceil,gl=B.ReactCurrentDispatcher,Tu=B.ReactCurrentOwner,dn=B.ReactCurrentBatchConfig,Re=0,ft=null,at=null,gt=0,Yt=0,Ms=Ur(0),ct=0,Ga=null,Ni=0,yl=0,Su=0,Xa=null,Ut=null,vu=0,Fs=1/0,cr=null,wl=!1,bu=null,$r=null,kl=!1,Qr=null,Tl=0,Ya=0,xu=null,Sl=-1,vl=0;function Nt(){return(Re&6)!==0?je():Sl!==-1?Sl:Sl=je()}function qr(t){return(t.mode&1)===0?1:(Re&2)!==0&&gt!==0?gt&-gt:R0.transition!==null?(vl===0&&(vl=rt()),vl):(t=Me,t!==0||(t=window.event,t=t===void 0?16:Do(t.type)),t)}function Cn(t,i,o,d){if(50<Ya)throw Ya=0,xu=null,Error(r(185));an(t,o,d),((Re&2)===0||t!==ft)&&(t===ft&&((Re&2)===0&&(yl|=o),ct===4&&Kr(t,gt)),Lt(t,d),o===1&&Re===0&&(i.mode&1)===0&&(Fs=je()+500,Xo&&jr()))}function Lt(t,i){var o=t.callbackNode;Mo(t,i);var d=wi(t,t===ft?gt:0);if(d===0)o!==null&&St(o),t.callbackNode=null,t.callbackPriority=0;else if(i=d&-d,t.callbackPriority!==i){if(o!=null&&St(o),i===1)t.tag===0?N0(rm.bind(null,t)):Vf(rm.bind(null,t)),I0(function(){(Re&6)===0&&jr()}),o=null;else{switch(ka(d)){case 1:o=ma;break;case 4:o=pa;break;case 16:o=ns;break;case 536870912:o=Ao;break;default:o=ns}o=dm(o,nm.bind(null,t))}t.callbackPriority=i,t.callbackNode=o}}function nm(t,i){if(Sl=-1,vl=0,(Re&6)!==0)throw Error(r(327));var o=t.callbackNode;if(Ns()&&t.callbackNode!==o)return null;var d=wi(t,t===ft?gt:0);if(d===0)return null;if((d&30)!==0||(d&t.expiredLanes)!==0||i)i=bl(t,d);else{i=d;var h=Re;Re|=2;var p=sm();(ft!==t||gt!==i)&&(cr=null,Fs=je()+500,zi(t,i));do try{ey();break}catch(P){im(t,P)}while(!0);Vc(),gl.current=p,Re=h,at!==null?i=0:(ft=null,gt=0,i=ct)}if(i!==0){if(i===2&&(h=ya(t),h!==0&&(d=h,i=Cu(t,h))),i===1)throw o=Ga,zi(t,0),Kr(t,d),Lt(t,je()),o;if(i===6)Kr(t,d);else{if(h=t.current.alternate,(d&30)===0&&!Z0(h)&&(i=bl(t,d),i===2&&(p=ya(t),p!==0&&(d=p,i=Cu(t,p))),i===1))throw o=Ga,zi(t,0),Kr(t,d),Lt(t,je()),o;switch(t.finishedWork=h,t.finishedLanes=d,i){case 0:case 1:throw Error(r(345));case 2:Bi(t,Ut,cr);break;case 3:if(Kr(t,d),(d&130023424)===d&&(i=vu+500-je(),10<i)){if(wi(t,0)!==0)break;if(h=t.suspendedLanes,(h&d)!==d){Nt(),t.pingedLanes|=t.suspendedLanes&h;break}t.timeoutHandle=Mc(Bi.bind(null,t,Ut,cr),i);break}Bi(t,Ut,cr);break;case 4:if(Kr(t,d),(d&4194240)===d)break;for(i=t.eventTimes,h=-1;0<d;){var k=31-Qt(d);p=1<<k,k=i[k],k>h&&(h=k),d&=~p}if(d=h,d=je()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*Y0(d/1960))-d,10<d){t.timeoutHandle=Mc(Bi.bind(null,t,Ut,cr),d);break}Bi(t,Ut,cr);break;case 5:Bi(t,Ut,cr);break;default:throw Error(r(329))}}}return Lt(t,je()),t.callbackNode===o?nm.bind(null,t):null}function Cu(t,i){var o=Xa;return t.current.memoizedState.isDehydrated&&(zi(t,i).flags|=256),t=bl(t,i),t!==2&&(i=Ut,Ut=o,i!==null&&Pu(i)),t}function Pu(t){Ut===null?Ut=t:Ut.push.apply(Ut,t)}function Z0(t){for(var i=t;;){if(i.flags&16384){var o=i.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var d=0;d<o.length;d++){var h=o[d],p=h.getSnapshot;h=h.value;try{if(!Tn(p(),h))return!1}catch{return!1}}}if(o=i.child,i.subtreeFlags&16384&&o!==null)o.return=i,i=o;else{if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Kr(t,i){for(i&=~Su,i&=~yl,t.suspendedLanes|=i,t.pingedLanes&=~i,t=t.expirationTimes;0<i;){var o=31-Qt(i),d=1<<o;t[o]=-1,i&=~d}}function rm(t){if((Re&6)!==0)throw Error(r(327));Ns();var i=wi(t,0);if((i&1)===0)return Lt(t,je()),null;var o=bl(t,i);if(t.tag!==0&&o===2){var d=ya(t);d!==0&&(i=d,o=Cu(t,d))}if(o===1)throw o=Ga,zi(t,0),Kr(t,i),Lt(t,je()),o;if(o===6)throw Error(r(345));return t.finishedWork=t.current.alternate,t.finishedLanes=i,Bi(t,Ut,cr),Lt(t,je()),null}function Eu(t,i){var o=Re;Re|=1;try{return t(i)}finally{Re=o,Re===0&&(Fs=je()+500,Xo&&jr())}}function Ri(t){Qr!==null&&Qr.tag===0&&(Re&6)===0&&Ns();var i=Re;Re|=1;var o=dn.transition,d=Me;try{if(dn.transition=null,Me=1,t)return t()}finally{Me=d,dn.transition=o,Re=i,(Re&6)===0&&jr()}}function _u(){Yt=Ms.current,Qe(Ms)}function zi(t,i){t.finishedWork=null,t.finishedLanes=0;var o=t.timeoutHandle;if(o!==-1&&(t.timeoutHandle=-1,_0(o)),at!==null)for(o=at.return;o!==null;){var d=o;switch(Dc(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&Ko();break;case 3:_s(),Qe(Bt),Qe(vt),Xc();break;case 5:Kc(d);break;case 4:_s();break;case 13:Qe(Ge);break;case 19:Qe(Ge);break;case 10:Wc(d.type._context);break;case 22:case 23:_u()}o=o.return}if(ft=t,at=t=Gr(t.current,null),gt=Yt=i,ct=0,Ga=null,Su=yl=Ni=0,Ut=Xa=null,Ai!==null){for(i=0;i<Ai.length;i++)if(o=Ai[i],d=o.interleaved,d!==null){o.interleaved=null;var h=d.next,p=o.pending;if(p!==null){var k=p.next;p.next=h,d.next=k}o.pending=d}Ai=null}return t}function im(t,i){do{var o=at;try{if(Vc(),al.current=ul,ol){for(var d=Xe.memoizedState;d!==null;){var h=d.queue;h!==null&&(h.pending=null),d=d.next}ol=!1}if(Fi=0,dt=lt=Xe=null,Wa=!1,Ha=0,Tu.current=null,o===null||o.return===null){ct=1,Ga=i,at=null;break}e:{var p=t,k=o.return,P=o,M=i;if(i=gt,P.flags|=32768,M!==null&&typeof M=="object"&&typeof M.then=="function"){var U=M,$=P,K=$.tag;if(($.mode&1)===0&&(K===0||K===11||K===15)){var H=$.alternate;H?($.updateQueue=H.updateQueue,$.memoizedState=H.memoizedState,$.lanes=H.lanes):($.updateQueue=null,$.memoizedState=null)}var ie=Ih(k);if(ie!==null){ie.flags&=-257,Ah(ie,k,P,p,i),ie.mode&1&&_h(p,U,i),i=ie,M=U;var ce=i.updateQueue;if(ce===null){var ue=new Set;ue.add(M),i.updateQueue=ue}else ce.add(M);break e}else{if((i&1)===0){_h(p,U,i),Iu();break e}M=Error(r(426))}}else if(Ke&&P.mode&1){var it=Ih(k);if(it!==null){(it.flags&65536)===0&&(it.flags|=256),Ah(it,k,P,p,i),Lc(Is(M,P));break e}}p=M=Is(M,P),ct!==4&&(ct=2),Xa===null?Xa=[p]:Xa.push(p),p=k;do{switch(p.tag){case 3:p.flags|=65536,i&=-i,p.lanes|=i;var R=Ph(p,M,i);Jf(p,R);break e;case 1:P=M;var F=p.type,z=p.stateNode;if((p.flags&128)===0&&(typeof F.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&($r===null||!$r.has(z)))){p.flags|=65536,i&=-i,p.lanes|=i;var Z=Eh(p,P,i);Jf(p,Z);break e}}p=p.return}while(p!==null)}om(o)}catch(de){i=de,at===o&&o!==null&&(at=o=o.return);continue}break}while(!0)}function sm(){var t=gl.current;return gl.current=ul,t===null?ul:t}function Iu(){(ct===0||ct===3||ct===2)&&(ct=4),ft===null||(Ni&268435455)===0&&(yl&268435455)===0||Kr(ft,gt)}function bl(t,i){var o=Re;Re|=2;var d=sm();(ft!==t||gt!==i)&&(cr=null,zi(t,i));do try{J0();break}catch(h){im(t,h)}while(!0);if(Vc(),Re=o,gl.current=d,at!==null)throw Error(r(261));return ft=null,gt=0,ct}function J0(){for(;at!==null;)am(at)}function ey(){for(;at!==null&&!rn();)am(at)}function am(t){var i=um(t.alternate,t,Yt);t.memoizedProps=t.pendingProps,i===null?om(t):at=i,Tu.current=null}function om(t){var i=t;do{var o=i.alternate;if(t=i.return,(i.flags&32768)===0){if(o=Q0(o,i,Yt),o!==null){at=o;return}}else{if(o=q0(o,i),o!==null){o.flags&=32767,at=o;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ct=6,at=null;return}}if(i=i.sibling,i!==null){at=i;return}at=i=t}while(i!==null);ct===0&&(ct=5)}function Bi(t,i,o){var d=Me,h=dn.transition;try{dn.transition=null,Me=1,ty(t,i,o,d)}finally{dn.transition=h,Me=d}return null}function ty(t,i,o,d){do Ns();while(Qr!==null);if((Re&6)!==0)throw Error(r(327));o=t.finishedWork;var h=t.finishedLanes;if(o===null)return null;if(t.finishedWork=null,t.finishedLanes=0,o===t.current)throw Error(r(177));t.callbackNode=null,t.callbackPriority=0;var p=o.lanes|o.childLanes;if(Fo(t,p),t===ft&&(at=ft=null,gt=0),(o.subtreeFlags&2064)===0&&(o.flags&2064)===0||kl||(kl=!0,dm(ns,function(){return Ns(),null})),p=(o.flags&15990)!==0,(o.subtreeFlags&15990)!==0||p){p=dn.transition,dn.transition=null;var k=Me;Me=1;var P=Re;Re|=4,Tu.current=null,G0(t,o),Yh(o,t),S0(Ic),ls=!!_c,Ic=_c=null,t.current=o,X0(o),ha(),Re=P,Me=k,dn.transition=p}else t.current=o;if(kl&&(kl=!1,Qr=t,Tl=h),p=t.pendingLanes,p===0&&($r=null),gi(o.stateNode),Lt(t,je()),i!==null)for(d=t.onRecoverableError,o=0;o<i.length;o++)h=i[o],d(h.value,{componentStack:h.stack,digest:h.digest});if(wl)throw wl=!1,t=bu,bu=null,t;return(Tl&1)!==0&&t.tag!==0&&Ns(),p=t.pendingLanes,(p&1)!==0?t===xu?Ya++:(Ya=0,xu=t):Ya=0,jr(),null}function Ns(){if(Qr!==null){var t=ka(Tl),i=dn.transition,o=Me;try{if(dn.transition=null,Me=16>t?16:t,Qr===null)var d=!1;else{if(t=Qr,Qr=null,Tl=0,(Re&6)!==0)throw Error(r(331));var h=Re;for(Re|=4,le=t.current;le!==null;){var p=le,k=p.child;if((le.flags&16)!==0){var P=p.deletions;if(P!==null){for(var M=0;M<P.length;M++){var U=P[M];for(le=U;le!==null;){var $=le;switch($.tag){case 0:case 11:case 15:Ka(8,$,p)}var K=$.child;if(K!==null)K.return=$,le=K;else for(;le!==null;){$=le;var H=$.sibling,ie=$.return;if(Qh($),$===U){le=null;break}if(H!==null){H.return=ie,le=H;break}le=ie}}}var ce=p.alternate;if(ce!==null){var ue=ce.child;if(ue!==null){ce.child=null;do{var it=ue.sibling;ue.sibling=null,ue=it}while(ue!==null)}}le=p}}if((p.subtreeFlags&2064)!==0&&k!==null)k.return=p,le=k;else e:for(;le!==null;){if(p=le,(p.flags&2048)!==0)switch(p.tag){case 0:case 11:case 15:Ka(9,p,p.return)}var R=p.sibling;if(R!==null){R.return=p.return,le=R;break e}le=p.return}}var F=t.current;for(le=F;le!==null;){k=le;var z=k.child;if((k.subtreeFlags&2064)!==0&&z!==null)z.return=k,le=z;else e:for(k=F;le!==null;){if(P=le,(P.flags&2048)!==0)try{switch(P.tag){case 0:case 11:case 15:pl(9,P)}}catch(de){Je(P,P.return,de)}if(P===k){le=null;break e}var Z=P.sibling;if(Z!==null){Z.return=P.return,le=Z;break e}le=P.return}}if(Re=h,jr(),Rt&&typeof Rt.onPostCommitFiberRoot=="function")try{Rt.onPostCommitFiberRoot(pi,t)}catch{}d=!0}return d}finally{Me=o,dn.transition=i}}return!1}function lm(t,i,o){i=Is(o,i),i=Ph(t,i,1),t=Wr(t,i,1),i=Nt(),t!==null&&(an(t,1,i),Lt(t,i))}function Je(t,i,o){if(t.tag===3)lm(t,t,o);else for(;i!==null;){if(i.tag===3){lm(i,t,o);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&($r===null||!$r.has(d))){t=Is(o,t),t=Eh(i,t,1),i=Wr(i,t,1),t=Nt(),i!==null&&(an(i,1,t),Lt(i,t));break}}i=i.return}}function ny(t,i,o){var d=t.pingCache;d!==null&&d.delete(i),i=Nt(),t.pingedLanes|=t.suspendedLanes&o,ft===t&&(gt&o)===o&&(ct===4||ct===3&&(gt&130023424)===gt&&500>je()-vu?zi(t,0):Su|=o),Lt(t,i)}function cm(t,i){i===0&&((t.mode&1)===0?i=1:(i=wn,wn<<=1,(wn&130023424)===0&&(wn=4194304)));var o=Nt();t=ar(t,i),t!==null&&(an(t,i,o),Lt(t,o))}function ry(t){var i=t.memoizedState,o=0;i!==null&&(o=i.retryLane),cm(t,o)}function iy(t,i){var o=0;switch(t.tag){case 13:var d=t.stateNode,h=t.memoizedState;h!==null&&(o=h.retryLane);break;case 19:d=t.stateNode;break;default:throw Error(r(314))}d!==null&&d.delete(i),cm(t,o)}var um;um=function(t,i,o){if(t!==null)if(t.memoizedProps!==i.pendingProps||Bt.current)Ot=!0;else{if((t.lanes&o)===0&&(i.flags&128)===0)return Ot=!1,$0(t,i,o);Ot=(t.flags&131072)!==0}else Ot=!1,Ke&&(i.flags&1048576)!==0&&Wf(i,Zo,i.index);switch(i.lanes=0,i.tag){case 2:var d=i.type;hl(t,i),t=i.pendingProps;var h=Ss(i,vt.current);Es(i,o),h=Jc(null,i,d,t,h,o);var p=eu();return i.flags|=1,typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Dt(d)?(p=!0,Go(i)):p=!1,i.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,Qc(i),h.updater=dl,i.stateNode=h,h._reactInternals=i,au(i,d,t,o),i=uu(null,i,d,!0,p,o)):(i.tag=0,Ke&&p&&Bc(i),Ft(null,i,h,o),i=i.child),i;case 16:d=i.elementType;e:{switch(hl(t,i),t=i.pendingProps,h=d._init,d=h(d._payload),i.type=d,h=i.tag=ay(d),t=vn(d,t),h){case 0:i=cu(null,i,d,t,o);break e;case 1:i=Bh(null,i,d,t,o);break e;case 11:i=Mh(null,i,d,t,o);break e;case 14:i=Fh(null,i,d,vn(d.type,t),o);break e}throw Error(r(306,d,""))}return i;case 0:return d=i.type,h=i.pendingProps,h=i.elementType===d?h:vn(d,h),cu(t,i,d,h,o);case 1:return d=i.type,h=i.pendingProps,h=i.elementType===d?h:vn(d,h),Bh(t,i,d,h,o);case 3:e:{if(Dh(i),t===null)throw Error(r(387));d=i.pendingProps,p=i.memoizedState,h=p.element,Zf(t,i),il(i,d,null,o);var k=i.memoizedState;if(d=k.element,p.isDehydrated)if(p={element:d,isDehydrated:!1,cache:k.cache,pendingSuspenseBoundaries:k.pendingSuspenseBoundaries,transitions:k.transitions},i.updateQueue.baseState=p,i.memoizedState=p,i.flags&256){h=Is(Error(r(423)),i),i=Oh(t,i,d,o,h);break e}else if(d!==h){h=Is(Error(r(424)),i),i=Oh(t,i,d,o,h);break e}else for(Xt=Or(i.stateNode.containerInfo.firstChild),Gt=i,Ke=!0,Sn=null,o=Xf(i,null,d,o),i.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(xs(),d===h){i=lr(t,i,o);break e}Ft(t,i,d,o)}i=i.child}return i;case 5:return th(i),t===null&&Uc(i),d=i.type,h=i.pendingProps,p=t!==null?t.memoizedProps:null,k=h.children,Ac(d,h)?k=null:p!==null&&Ac(d,p)&&(i.flags|=32),zh(t,i),Ft(t,i,k,o),i.child;case 6:return t===null&&Uc(i),null;case 13:return Uh(t,i,o);case 4:return qc(i,i.stateNode.containerInfo),d=i.pendingProps,t===null?i.child=Cs(i,null,d,o):Ft(t,i,d,o),i.child;case 11:return d=i.type,h=i.pendingProps,h=i.elementType===d?h:vn(d,h),Mh(t,i,d,h,o);case 7:return Ft(t,i,i.pendingProps,o),i.child;case 8:return Ft(t,i,i.pendingProps.children,o),i.child;case 12:return Ft(t,i,i.pendingProps.children,o),i.child;case 10:e:{if(d=i.type._context,h=i.pendingProps,p=i.memoizedProps,k=h.value,He(tl,d._currentValue),d._currentValue=k,p!==null)if(Tn(p.value,k)){if(p.children===h.children&&!Bt.current){i=lr(t,i,o);break e}}else for(p=i.child,p!==null&&(p.return=i);p!==null;){var P=p.dependencies;if(P!==null){k=p.child;for(var M=P.firstContext;M!==null;){if(M.context===d){if(p.tag===1){M=or(-1,o&-o),M.tag=2;var U=p.updateQueue;if(U!==null){U=U.shared;var $=U.pending;$===null?M.next=M:(M.next=$.next,$.next=M),U.pending=M}}p.lanes|=o,M=p.alternate,M!==null&&(M.lanes|=o),Hc(p.return,o,i),P.lanes|=o;break}M=M.next}}else if(p.tag===10)k=p.type===i.type?null:p.child;else if(p.tag===18){if(k=p.return,k===null)throw Error(r(341));k.lanes|=o,P=k.alternate,P!==null&&(P.lanes|=o),Hc(k,o,i),k=p.sibling}else k=p.child;if(k!==null)k.return=p;else for(k=p;k!==null;){if(k===i){k=null;break}if(p=k.sibling,p!==null){p.return=k.return,k=p;break}k=k.return}p=k}Ft(t,i,h.children,o),i=i.child}return i;case 9:return h=i.type,d=i.pendingProps.children,Es(i,o),h=cn(h),d=d(h),i.flags|=1,Ft(t,i,d,o),i.child;case 14:return d=i.type,h=vn(d,i.pendingProps),h=vn(d.type,h),Fh(t,i,d,h,o);case 15:return Nh(t,i,i.type,i.pendingProps,o);case 17:return d=i.type,h=i.pendingProps,h=i.elementType===d?h:vn(d,h),hl(t,i),i.tag=1,Dt(d)?(t=!0,Go(i)):t=!1,Es(i,o),xh(i,d,h),au(i,d,h,o),uu(null,i,d,!0,t,o);case 19:return jh(t,i,o);case 22:return Rh(t,i,o)}throw Error(r(156,i.tag))};function dm(t,i){return Mr(t,i)}function sy(t,i,o,d){this.tag=t,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fn(t,i,o,d){return new sy(t,i,o,d)}function Au(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ay(t){if(typeof t=="function")return Au(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ne)return 11;if(t===Ze)return 14}return 2}function Gr(t,i){var o=t.alternate;return o===null?(o=fn(t.tag,i,t.key,t.mode),o.elementType=t.elementType,o.type=t.type,o.stateNode=t.stateNode,o.alternate=t,t.alternate=o):(o.pendingProps=i,o.type=t.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=t.flags&14680064,o.childLanes=t.childLanes,o.lanes=t.lanes,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,i=t.dependencies,o.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},o.sibling=t.sibling,o.index=t.index,o.ref=t.ref,o}function xl(t,i,o,d,h,p){var k=2;if(d=t,typeof t=="function")Au(t)&&(k=1);else if(typeof t=="string")k=5;else e:switch(t){case q:return Di(o.children,h,p,i);case G:k=8,h|=8;break;case se:return t=fn(12,o,i,h|2),t.elementType=se,t.lanes=p,t;case he:return t=fn(13,o,i,h),t.elementType=he,t.lanes=p,t;case ze:return t=fn(19,o,i,h),t.elementType=ze,t.lanes=p,t;case Ce:return Cl(o,h,p,i);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case oe:k=10;break e;case re:k=9;break e;case ne:k=11;break e;case Ze:k=14;break e;case Ne:k=16,d=null;break e}throw Error(r(130,t==null?t:typeof t,""))}return i=fn(k,o,i,h),i.elementType=t,i.type=d,i.lanes=p,i}function Di(t,i,o,d){return t=fn(7,t,d,i),t.lanes=o,t}function Cl(t,i,o,d){return t=fn(22,t,d,i),t.elementType=Ce,t.lanes=o,t.stateNode={isHidden:!1},t}function Mu(t,i,o){return t=fn(6,t,null,i),t.lanes=o,t}function Fu(t,i,o){return i=fn(4,t.children!==null?t.children:[],t.key,i),i.lanes=o,i.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},i}function oy(t,i,o,d,h){this.tag=i,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=qt(0),this.expirationTimes=qt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qt(0),this.identifierPrefix=d,this.onRecoverableError=h,this.mutableSourceEagerHydrationData=null}function Nu(t,i,o,d,h,p,k,P,M){return t=new oy(t,i,o,P,M),i===1?(i=1,p===!0&&(i|=8)):i=0,p=fn(3,null,null,i),t.current=p,p.stateNode=t,p.memoizedState={element:d,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},Qc(p),t}function ly(t,i,o){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:L,key:d==null?null:""+d,children:t,containerInfo:i,implementation:o}}function fm(t){if(!t)return Lr;t=t._reactInternals;e:{if(zn(t)!==t||t.tag!==1)throw Error(r(170));var i=t;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Dt(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(r(171))}if(t.tag===1){var o=t.type;if(Dt(o))return Lf(t,o,i)}return i}function hm(t,i,o,d,h,p,k,P,M){return t=Nu(o,d,!0,t,h,p,k,P,M),t.context=fm(null),o=t.current,d=Nt(),h=qr(o),p=or(d,h),p.callback=i??null,Wr(o,p,h),t.current.lanes=h,an(t,h,d),Lt(t,d),t}function Pl(t,i,o,d){var h=i.current,p=Nt(),k=qr(h);return o=fm(o),i.context===null?i.context=o:i.pendingContext=o,i=or(p,k),i.payload={element:t},d=d===void 0?null:d,d!==null&&(i.callback=d),t=Wr(h,i,k),t!==null&&(Cn(t,h,k,p),rl(t,h,k)),k}function El(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function mm(t,i){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var o=t.retryLane;t.retryLane=o!==0&&o<i?o:i}}function Ru(t,i){mm(t,i),(t=t.alternate)&&mm(t,i)}function cy(){return null}var pm=typeof reportError=="function"?reportError:function(t){console.error(t)};function zu(t){this._internalRoot=t}_l.prototype.render=zu.prototype.render=function(t){var i=this._internalRoot;if(i===null)throw Error(r(409));Pl(t,i,null,null)},_l.prototype.unmount=zu.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var i=t.containerInfo;Ri(function(){Pl(null,t,null,null)}),i[nr]=null}};function _l(t){this._internalRoot=t}_l.prototype.unstable_scheduleHydration=function(t){if(t){var i=ss();t={blockedOn:null,target:t,priority:i};for(var o=0;o<On.length&&i!==0&&i<On[o].priority;o++);On.splice(o,0,t),o===0&&zo(t)}};function Bu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Il(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function gm(){}function uy(t,i,o,d,h){if(h){if(typeof d=="function"){var p=d;d=function(){var U=El(k);p.call(U)}}var k=hm(i,d,t,0,null,!1,!1,"",gm);return t._reactRootContainer=k,t[nr]=k.current,za(t.nodeType===8?t.parentNode:t),Ri(),k}for(;h=t.lastChild;)t.removeChild(h);if(typeof d=="function"){var P=d;d=function(){var U=El(M);P.call(U)}}var M=Nu(t,0,!1,null,null,!1,!1,"",gm);return t._reactRootContainer=M,t[nr]=M.current,za(t.nodeType===8?t.parentNode:t),Ri(function(){Pl(i,M,o,d)}),M}function Al(t,i,o,d,h){var p=o._reactRootContainer;if(p){var k=p;if(typeof h=="function"){var P=h;h=function(){var M=El(k);P.call(M)}}Pl(i,k,t,h)}else k=uy(o,i,t,h,d);return El(k)}Ta=function(t){switch(t.tag){case 3:var i=t.stateNode;if(i.current.memoizedState.isDehydrated){var o=Fr(i.pendingLanes);o!==0&&(wa(i,o|1),Lt(i,je()),(Re&6)===0&&(Fs=je()+500,jr()))}break;case 13:Ri(function(){var d=ar(t,1);if(d!==null){var h=Nt();Cn(d,t,1,h)}}),Ru(t,1)}},rs=function(t){if(t.tag===13){var i=ar(t,134217728);if(i!==null){var o=Nt();Cn(i,t,134217728,o)}Ru(t,134217728)}},is=function(t){if(t.tag===13){var i=qr(t),o=ar(t,i);if(o!==null){var d=Nt();Cn(o,t,i,d)}Ru(t,i)}},ss=function(){return Me},No=function(t,i){var o=Me;try{return Me=t,i()}finally{Me=o}},Cr=function(t,i,o){switch(i){case"input":if(oa(t,o),i=o.name,o.type==="radio"&&i!=null){for(o=t;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<o.length;i++){var d=o[i];if(d!==t&&d.form===t.form){var h=qo(d);if(!h)throw Error(r(90));aa(d),oa(d,h)}}}break;case"textarea":ca(t,o);break;case"select":i=o.value,i!=null&&Xn(t,!!o.multiple,i,!1)}},fa=Eu,Po=Ri;var dy={usingClientEntryPoint:!1,Events:[Oa,ks,qo,Zn,Zi,Eu]},Za={findFiberByHostInstance:Pi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},fy={bundleType:Za.bundleType,version:Za.version,rendererPackageName:Za.rendererPackageName,rendererConfig:Za.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:B.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=yn(t),t===null?null:t.stateNode},findFiberByHostInstance:Za.findFiberByHostInstance||cy,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ml=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ml.isDisabled&&Ml.supportsFiber)try{pi=Ml.inject(fy),Rt=Ml}catch{}}return jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dy,jt.createPortal=function(t,i){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bu(i))throw Error(r(200));return ly(t,i,null,o)},jt.createRoot=function(t,i){if(!Bu(t))throw Error(r(299));var o=!1,d="",h=pm;return i!=null&&(i.unstable_strictMode===!0&&(o=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onRecoverableError!==void 0&&(h=i.onRecoverableError)),i=Nu(t,1,!1,null,null,o,!1,d,h),t[nr]=i.current,za(t.nodeType===8?t.parentNode:t),new zu(i)},jt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var i=t._reactInternals;if(i===void 0)throw typeof t.render=="function"?Error(r(188)):(t=Object.keys(t).join(","),Error(r(268,t)));return t=yn(i),t=t===null?null:t.stateNode,t},jt.flushSync=function(t){return Ri(t)},jt.hydrate=function(t,i,o){if(!Il(i))throw Error(r(200));return Al(null,t,i,!0,o)},jt.hydrateRoot=function(t,i,o){if(!Bu(t))throw Error(r(405));var d=o!=null&&o.hydratedSources||null,h=!1,p="",k=pm;if(o!=null&&(o.unstable_strictMode===!0&&(h=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onRecoverableError!==void 0&&(k=o.onRecoverableError)),i=hm(i,null,t,1,o??null,h,!1,p,k),t[nr]=i.current,za(t),d)for(t=0;t<d.length;t++)o=d[t],h=o._getVersion,h=h(o._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[o,h]:i.mutableSourceEagerHydrationData.push(o,h);return new _l(i)},jt.render=function(t,i,o){if(!Il(i))throw Error(r(200));return Al(null,t,i,!1,o)},jt.unmountComponentAtNode=function(t){if(!Il(t))throw Error(r(40));return t._reactRootContainer?(Ri(function(){Al(null,null,t,!1,function(){t._reactRootContainer=null,t[nr]=null})}),!0):!1},jt.unstable_batchedUpdates=Eu,jt.unstable_renderSubtreeIntoContainer=function(t,i,o,d){if(!Il(o))throw Error(r(200));if(t==null||t._reactInternals===void 0)throw Error(r(38));return Al(t,i,o,!1,d)},jt.version="18.3.1-next-f1338f8080-20240426",jt}var xm;function Sy(){if(xm)return Uu.exports;xm=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Uu.exports=Ty(),Uu.exports}var Cm;function vy(){if(Cm)return Fl;Cm=1;var n=Sy();return Fl.createRoot=n.createRoot,Fl.hydrateRoot=n.hydrateRoot,Fl}var by=vy();const xy=Tp(by),Cy="hammer-db",Ys="assets",Py=1;let Rs=null;const Sp=()=>Rs||(typeof indexedDB>"u"?Promise.reject(new Error("IndexedDB not available")):(Rs=new Promise((n,e)=>{const r=indexedDB.open(Cy,Py);r.onupgradeneeded=()=>{const s=r.result;s.objectStoreNames.contains(Ys)||s.createObjectStore(Ys,{keyPath:"assetId"})},r.onerror=()=>{const s=r.error?.name??"UnknownError";Rs=null,e(new Error(`IndexedDB open failed (${s})`))},r.onblocked=()=>{Rs=null,e(new Error("IndexedDB open blocked (another tab may be using an old connection). Close other tabs and retry."))},r.onsuccess=()=>{n(r.result)}}),Rs)),vp=n=>new Promise((e,r)=>{n.onsuccess=()=>e(n.result),n.onerror=()=>r(n.error??new Error("IndexedDB request failed"))}),bp=n=>new Promise((e,r)=>{n.oncomplete=()=>e(),n.onerror=()=>r(n.error??new Error("IndexedDB transaction failed")),n.onabort=()=>r(n.error??new Error("IndexedDB transaction aborted"))}),Ey=async n=>{const r=(await Sp()).transaction(Ys,"readwrite"),s=r.objectStore(Ys);await vp(s.put(n)),await bp(r)},_y=async n=>{const r=(await Sp()).transaction(Ys,"readonly"),s=r.objectStore(Ys),a=await vp(s.get(n));return await bp(r),a??null},Iy=n=>new Promise((e,r)=>{const s=()=>{l(),e()},a=()=>{l(),r(new Error("Unable to load video metadata."))},l=()=>{n.removeEventListener("loadedmetadata",s),n.removeEventListener("error",a)};n.addEventListener("loadedmetadata",s),n.addEventListener("error",a)}),xp=async n=>{const e=URL.createObjectURL(n),r=document.createElement("video");r.preload="metadata",r.src=e,r.load();try{await Iy(r);const s=Math.round(r.duration*1e3);if(!Number.isFinite(s)||s<=0)throw new Error("Invalid duration metadata.");if(r.videoWidth<=0||r.videoHeight<=0)throw new Error("Invalid dimension metadata.");return{durationMs:s,width:r.videoWidth,height:r.videoHeight}}finally{URL.revokeObjectURL(e)}},Dd="hammer.projects.index",Od="hammer.projects.docs",Cp="hammer.projects",Pm="hammer.projects.migratedAt",Dl="local",eo=new Map;let Pp={},Ep={};const yo=()=>{try{return typeof localStorage<"u"}catch{return!1}},Li=n=>{const e={projectId:n.projectId,updatedAt:n.updatedAt,filename:n.source.filename,durationMs:n.source.durationMs,width:n.source.width,height:n.source.height,hasTranscript:(n.transcript?.segments?.length??0)>0,transcriptSegmentsCount:n.transcript?.segments?.length??0,cutsCount:n.edl?.cuts?.length??0,splitsCount:n.splits?.length??0,assetsCount:n.assets?.length??0};return n.title&&(e.title=n.title),n.thumbnailAssetId&&(e.thumbnailAssetId=n.thumbnailAssetId),e},_p=n=>{const e={};return Object.values(n).forEach(r=>{e[r.projectId]=Li(r)}),e},Ay=(n,e)=>{if(!n||typeof n!="object")return null;const r={filename:n.filename,durationMs:n.durationMs,width:n.width,height:n.height};if(typeof n.fps=="number"&&(r.fps=n.fps),"asset"in n&&n.asset&&typeof n.asset=="object"){const s=n.asset;if(typeof s.assetId!="string")return null;const a=fd(s.assetId).providerId,l=a??s.providerId??e,c=a?s.assetId:Ol(l,s.assetId),u=l!==s.providerId||c!==s.assetId;return{source:{...r,asset:{providerId:l,assetId:c}},migrated:u}}if("assetId"in n&&typeof n.assetId=="string"){const s=fd(n.assetId).providerId,a=s??e,l=s?n.assetId:Ol(a,n.assetId);return{source:{...r,asset:{providerId:a,assetId:l}},migrated:!0}}return null},My=n=>{if(!n||!Array.isArray(n.cuts))return{edl:{cuts:[]},migrated:!!n};if(n.cuts.length===0)return{edl:{cuts:[]},migrated:!1};const e=n.cuts[0];if("inMs"in e&&"outMs"in e)return{edl:{cuts:[...n.cuts].sort((s,a)=>s.inMs-a.inMs)},migrated:!1};if("startMs"in e&&"endMs"in e){const s=n.cuts.reduce((a,l,c)=>{if(typeof l.startMs!="number"||typeof l.endMs!="number"||l.endMs<=l.startMs)return a;const u=typeof l.reason=="string"&&l.reason.trim().length?l.reason.trim():void 0,f={id:`legacy_${c}_${l.startMs}_${l.endMs}`,inMs:l.startMs,outMs:l.endMs};return u&&(f.label=u),a.push(f),a},[]);return s.sort((a,l)=>a.inMs-l.inMs),{edl:{cuts:s},migrated:!0}}return{edl:{cuts:[]},migrated:!0}},Fy=n=>{if(!n)return{splits:[],migrated:!1};if(!Array.isArray(n))return{splits:[],migrated:!0};const e=n.reduce((r,s)=>{if(!s||typeof s!="object"||typeof s.id!="string"||typeof s.tMs!="number")return r;const a={id:s.id,tMs:s.tMs};return typeof s.label=="string"&&s.label.trim().length>0&&(a.label=s.label.trim()),(s.kind==="manual"||s.kind==="auto")&&(a.kind=s.kind),r.push(a),r},[]);return e.sort((r,s)=>r.tMs-s.tMs),{splits:e,migrated:e.length!==n.length}},Ny=n=>{if(!n)return{migrated:!1};const r=(Array.isArray(n.segments)?n.segments:[]).reduce((a,l,c)=>{if(!l||typeof l!="object")return a;const u=typeof l.startMs=="number"?l.startMs:0,f=typeof l.endMs=="number"?l.endMs:u,m=Number.isFinite(u)?Math.max(0,u):0,g=Number.isFinite(f)?Math.max(m,f):m,y=typeof l.text=="string"?l.text.trim():"";if(!y)return a;const T={id:typeof l.id=="string"&&l.id.trim().length>0?l.id.trim():`seg_${c}_${m}`,startMs:m,endMs:g,text:y};return typeof l.speaker=="string"&&l.speaker.trim().length>0&&(T.speaker=l.speaker.trim()),typeof l.confidence=="number"&&(T.confidence=l.confidence),a.push(T),a},[]);r.sort((a,l)=>a.startMs-l.startMs);const s={id:typeof n.id=="string"&&n.id.trim().length>0?n.id.trim():Ip(),createdAt:typeof n.createdAt=="number"&&Number.isFinite(n.createdAt)?n.createdAt:Date.now(),segments:r};return typeof n.sourceAssetId=="string"&&n.sourceAssetId.trim().length>0&&(s.sourceAssetId=n.sourceAssetId.trim()),typeof n.language=="string"&&n.language.trim().length>0&&(s.language=n.language.trim()),{transcript:s,migrated:!0}},Ry=n=>{if(!n)return{assets:[],migrated:!1};if(!Array.isArray(n))return{assets:[],migrated:!0};const e=n.reduce((r,s)=>{if(!s||typeof s!="object"||typeof s.id!="string"||typeof s.name!="string"||typeof s.size!="number"||s.kind!=="image"&&s.kind!=="video"&&s.kind!=="audio")return r;const a={id:s.id,kind:s.kind,name:s.name,size:s.size,mime:typeof s.mime=="string"?s.mime:"",createdAt:typeof s.createdAt=="string"?s.createdAt:new Date().toISOString()};return typeof s.displayName=="string"&&s.displayName.trim().length>0&&(a.displayName=s.displayName.trim()),typeof s.durationMs=="number"&&(a.durationMs=s.durationMs),r.push(a),r},[]);return{assets:e,migrated:e.length!==n.length}},zy=(n,e)=>{const r={};let s=!1;return Object.entries(n).forEach(([a,l])=>{const c=Ay(l.source,e),u=My(l.edl),f=Fy(l.splits),m=Ry(l.assets),g=Ny(l.transcript);if(!c){const w={...l,edl:u.edl,splits:f.splits,assets:m.assets};g.transcript&&(w.transcript=g.transcript),r[a]=w,s=s||u.migrated||f.migrated||m.migrated||g.migrated;return}const y={...l,source:c.source,edl:u.edl,splits:f.splits,assets:m.assets};g.transcript&&(y.transcript=g.transcript),r[a]=y,s=s||c.migrated||u.migrated||f.migrated||m.migrated||g.migrated}),{docs:r,migrated:s}},dd=(n,e)=>{if(!n)return null;try{const r=JSON.parse(n);return!r||typeof r!="object"?null:zy(r,e)}catch{return null}},By=()=>{if(!yo()||localStorage.getItem(Pm)||localStorage.getItem(Od)||localStorage.getItem(Dd))return null;const n=dd(localStorage.getItem(Cp),Dl);if(!n)return null;qn(n.docs);const e=_p(n.docs);return dr(e),localStorage.setItem(Pm,new Date().toISOString()),n.docs},ur=()=>{if(!yo())return{...Pp};const n=dd(localStorage.getItem(Od),Dl);if(n)return n.migrated&&qn(n.docs),n.docs;const e=By();if(e)return e;const r=dd(localStorage.getItem(Cp),Dl);return r?(r.migrated&&qn(r.docs),r.docs):{}},qn=n=>{if(!yo()){Pp={...n};return}localStorage.setItem(Od,JSON.stringify(n))},Yr=()=>{if(!yo())return{...Ep};const n=localStorage.getItem(Dd);if(n)try{const s=JSON.parse(n);if(!Object.values(s).some(l=>typeof l.cutsCount!="number"||typeof l.splitsCount!="number"||typeof l.assetsCount!="number"||typeof l.transcriptSegmentsCount!="number"))return s}catch{}const e=ur(),r=_p(e);return dr(r),r},dr=n=>{if(!yo()){Ep={...n};return}localStorage.setItem(Dd,JSON.stringify(n))},Ip=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`id_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,10)}`,Ol=(n,e)=>`${n}:${e}`,fd=n=>{const e=n.indexOf(":");return e<=0?{providerId:null,rawId:n}:{providerId:n.slice(0,e),rawId:n.slice(e+1)}},Dy=(n,e)=>{const r=fd(n);if(r.providerId){if(r.providerId!==e)throw new Error(`Asset provider mismatch: expected "${e}", got "${r.providerId}"`);return[n,r.rawId]}return[n,Ol(e,n)]};class Oy{providerId=Dl;async putAsset(e){const r=Ol(this.providerId,Ip());eo.set(r,e);try{await Ey({assetId:r,blob:e,filename:e.name,contentType:e.type,size:e.size,createdAt:new Date().toISOString()})}catch{}return{assetId:r,meta:{filename:e.name,size:e.size,type:e.type}}}async getAsset(e){const r=Dy(e,this.providerId);for(const s of r){const a=eo.get(s);if(a)return s!==e&&eo.set(e,a),a}try{for(const s of r){const a=await _y(s);if(a)return eo.set(s,a.blob),s!==e&&eo.set(e,a.blob),a.blob}throw new Error(`Asset not found: ${e}`)}catch(s){throw s instanceof Error&&s.message.startsWith("Asset not found")?s:new Error(`Asset lookup failed for ${e}: ${s instanceof Error?s.message:"Unknown error"}`)}}async relinkSource(e,r){const s=ur(),a=Yr(),l=s[e];if(!l)throw new Error(`Project not found: ${e}`);const c=await xp(r),u=await this.putAsset(r),f={...l.source,asset:{providerId:this.providerId,assetId:u.assetId},filename:r.name,durationMs:c.durationMs,width:c.width,height:c.height};typeof c.fps=="number"?f.fps=c.fps:delete f.fps;const m={...l,source:f,updatedAt:new Date().toISOString()};return s[e]=m,a[e]=Li(m),qn(s),dr(a),m}async setTranscript(e,r){const s=ur(),a=Yr(),l=s[e];if(!l)throw new Error(`Project not found: ${e}`);const c={...l,updatedAt:new Date().toISOString()};r?c.transcript=r:delete c.transcript,s[e]=c,a[e]=Li(c),qn(s),dr(a)}async setCuts(e,r){const s=ur(),a=Yr(),l=s[e];if(!l)throw new Error(`Project not found: ${e}`);const c=[...r].sort((f,m)=>f.inMs-m.inMs),u={...l,edl:{...l.edl,cuts:c},updatedAt:new Date().toISOString()};return s[e]=u,a[e]=Li(u),qn(s),dr(a),u}async setSplits(e,r){const s=ur(),a=Yr(),l=s[e];if(!l)throw new Error(`Project not found: ${e}`);const c=[...r].sort((f,m)=>f.tMs-m.tMs),u={...l,splits:c,updatedAt:new Date().toISOString()};return s[e]=u,a[e]=Li(u),qn(s),dr(a),u}async setAssets(e,r){const s=ur(),a=Yr(),l=s[e];if(!l)throw new Error(`Project not found: ${e}`);const c=[...r].sort((f,m)=>f.createdAt.localeCompare(m.createdAt)),u={...l,assets:c,updatedAt:new Date().toISOString()};return s[e]=u,a[e]=Li(u),qn(s),dr(a),u}async saveProject(e){const r=ur(),s=Yr(),a={...e,updatedAt:new Date().toISOString()};r[e.projectId]=a,s[e.projectId]=Li(a),qn(r),dr(s)}async loadProject(e){const s=ur()[e];if(!s)throw new Error(`Project not found: ${e}`);return s}async listProjects(){const e=Yr();return Object.values(e)}async deleteProject(e){const r=ur(),s=Yr(),a=!!r[e],l=!!s[e];!a&&!l||(a&&delete r[e],l&&delete s[e],a&&qn(r),l&&dr(s))}}const Ap=(n,e)=>{const r=Number.isFinite(e)&&e>0?e:0,s=n.map(l=>{const c=Math.max(0,Math.min(l.inMs,r)),u=Math.max(0,Math.min(l.outMs,r));return{inMs:c,outMs:u}}).filter(l=>Number.isFinite(l.inMs)&&Number.isFinite(l.outMs)&&l.outMs>l.inMs).sort((l,c)=>l.inMs===c.inMs?l.outMs-c.outMs:l.inMs-c.inMs),a=[];for(const l of s){const c=a[a.length-1];if(!c){a.push({...l});continue}if(l.inMs<=c.outMs){c.outMs=Math.max(c.outMs,l.outMs);continue}a.push({...l})}return a},Mp=(n,e)=>{const r=Number.isFinite(n)&&n>0?n:0;if(r===0)return[];if(e.length===0)return[{inMs:0,outMs:r}];const s=[];let a=0;for(const l of e)l.inMs>a&&s.push({inMs:a,outMs:l.inMs}),a=Math.max(a,l.outMs);return a<r&&s.push({inMs:a,outMs:r}),s},Ud=n=>{if(n.mode==="clip"){const e=n.clipRangeMs;if(!e)return[];const r=Number.isFinite(n.sourceDurationMs)&&n.sourceDurationMs>0?n.sourceDurationMs:0;if(r===0)return[];const s=Math.max(0,Math.min(e.inMs,r)),a=Math.max(0,Math.min(e.outMs,r));return a<=s?[]:[{inMs:s,outMs:a}]}return Mp(n.sourceDurationMs,n.cuts)},Uy=n=>n.reduce((e,r)=>e+Math.max(0,r.outMs-r.inMs),0),Ly=n=>{if(n.numberOfChannels===1)return n.getChannelData(0).slice();const e=n.length,r=new Float32Array(e);for(let a=0;a<n.numberOfChannels;a+=1){const l=n.getChannelData(a);for(let c=0;c<e;c+=1){const u=r[c]??0;r[c]=u+(l[c]??0)}}const s=1/n.numberOfChannels;for(let a=0;a<e;a+=1)r[a]=(r[a]??0)*s;return r},jy=(n,e,r)=>{if(e===r)return n.slice();const s=e/r,a=Math.max(1,Math.round(n.length/s)),l=new Float32Array(a);for(let c=0;c<a;c+=1){const u=c*s,f=Math.floor(u),m=Math.min(f+1,n.length-1),g=u-f,y=n[f]??0,w=n[m]??0;l[c]=y+(w-y)*g}return l},Vy=async(n,e=16e3)=>{const r=await n.arrayBuffer(),s=new AudioContext;let a;try{a=await s.decodeAudioData(r)}finally{s.state!=="closed"&&await s.close()}const l=Ly(a),c=typeof e=="number"&&e>0?e:a.sampleRate;return{samples:a.sampleRate===c?l:jy(l,a.sampleRate,c),sampleRate:c,durationMs:Math.round(a.duration*1e3)}},Em=()=>new Worker(new URL("/assets/offlineWhisper.worker-C4n2dRhh.js",import.meta.url),{type:"module"}),Wy=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`req_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,Hy=()=>{let n=Em(),e=null;return{transcribe:(a,l,c,u)=>{if(e)return Promise.reject(new Error("Transcription already running."));n||(n=Em());const f=Wy();return e=f,new Promise((m,g)=>{if(!n){e=null,g(new Error("Offline transcription worker unavailable."));return}const y=S=>{const v=S.data;if(!(!v||v.requestId!==f)){if(v.type==="status"){const x={phase:v.phase};typeof v.progress=="number"&&(x.progress=v.progress),typeof v.message=="string"&&(x.message=v.message),typeof v.cached=="boolean"&&(x.cached=v.cached),v.device&&(x.device=v.device),u?.(x),v.phase==="error"&&(T(),g(new Error(v.message??"Offline transcription failed.")));return}if(v.type==="result"){const x=v.cached??!1,_=v.device??"wasm";T(),m({segments:v.segments,cached:x,device:_})}}},w=S=>{T(),g(new Error(S.message||"Offline transcription failed."))},T=()=>{if(!n){e=null;return}n.removeEventListener("message",y),n.removeEventListener("error",w),e=null};n.addEventListener("message",y),n.addEventListener("error",w),n.postMessage({type:"transcribe",requestId:f,audio:a.buffer,sampleRate:l,model:c.model},[a.buffer])})},terminate:()=>{n&&n.terminate(),n=null,e=null}}},$y=n=>{if(typeof MediaRecorder>"u")throw new Error("MediaRecorder not supported");const e=n==="mp4"?["video/mp4;codecs=avc1.42E01E,mp4a.40.2","video/mp4"]:["video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm"];for(const r of e)if(MediaRecorder.isTypeSupported(r))return r;throw new Error(`No supported MediaRecorder mime type for ${n}`)},Fp=(n,e,r)=>new Promise((s,a)=>{const l=()=>{u(),s()},c=()=>{u(),a(new Error(r))},u=()=>{n.removeEventListener(e,l),n.removeEventListener("error",c)};n.addEventListener(e,l),n.addEventListener("error",c)}),Qy=async(n,e)=>{const r=Math.max(0,e/1e3);if(Math.abs(n.currentTime-r)<.01)return;const s=Fp(n,"seeked","Video seek failed");n.currentTime=r,await s},qy=async n=>{try{await n.play()}catch(e){if(e instanceof DOMException&&e.name==="NotAllowedError"&&!n.muted){n.muted=!0,await n.play();return}throw e}},Ky=(n,e)=>new Promise((r,s)=>{const a=e/1e3;let l=!1;const c=()=>{n.removeEventListener("timeupdate",f),n.removeEventListener("ended",m),n.removeEventListener("error",g)},u=()=>{l||(l=!0,c(),n.pause(),r())},f=()=>{n.currentTime>=a&&u()},m=()=>{u()},g=()=>{l||(l=!0,c(),s(new Error("Video playback failed")))};n.addEventListener("timeupdate",f),n.addEventListener("ended",m),n.addEventListener("error",g),qy(n).catch(y=>{l||(l=!0,c(),s(y instanceof Error?y:new Error("Video playback failed")))})}),Gy=async(n,e,r)=>{if(typeof document>"u")throw new Error("Encoding requires a browser environment");const s=Ud(n);if(s.length===0)throw new Error("No kept ranges to export");const a=await e.getAsset(n.sourceAssetId),l=URL.createObjectURL(a),c=document.createElement("video");c.preload="auto",c.src=l,c.playsInline=!0;const u=c,f=u.captureStream??u.mozCaptureStream;if(!f)throw URL.revokeObjectURL(l),new Error("captureStream not supported");try{await Fp(c,"loadedmetadata","Video metadata failed to load");const m=f.call(c),g=$y(r.container),y=new MediaRecorder(m,{mimeType:g}),w=[],T=m.getAudioTracks().length>0,S=new Promise((v,x)=>{y.onstop=()=>v(),y.onerror=()=>x(new Error("MediaRecorder failed"))});y.ondataavailable=v=>{v.data&&v.data.size>0&&w.push(v.data)},r.includeAudio||m.getAudioTracks().forEach(v=>{m.removeTrack(v),v.stop()}),y.start();for(const v of s)await Qy(c,v.inMs),await Ky(c,v.outMs);return y.stop(),await S,{blob:new Blob(w,{type:g}),mime:g,engine:"mediaRecorder",audioIncluded:r.includeAudio&&T}}finally{c.pause(),c.removeAttribute("src"),c.load(),URL.revokeObjectURL(l)}},Xy=(n,e,r)=>{const s=["HAMMER_EXPORT_PLACEHOLDER",`source=${n.sourceAssetId}`,`cuts=${n.cuts.length}`,`durationMs=${e}`].join(`
`),a=r==="webm"?"video/webm":"video/mp4";return{blob:new Blob([s],{type:a}),mime:a,engine:"placeholder",audioIncluded:!1}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */function b(n){if(!n)throw new Error("Assertion failed.")}const Gl=n=>{const e=(n%360+360)%360;if(e===0||e===90||e===180||e===270)return e;throw new Error(`Invalid rotation ${n}.`)},ot=n=>n&&n[n.length-1],Zs=n=>n>=0&&n<2**32;class Ye{constructor(e){this.bytes=e,this.pos=0}seekToByte(e){this.pos=8*e}readBit(){const e=Math.floor(this.pos/8),r=this.bytes[e]??0,s=7-(this.pos&7),a=(r&1<<s)>>s;return this.pos++,a}readBits(e){if(e===1)return this.readBit();let r=0;for(let s=0;s<e;s++)r<<=1,r|=this.readBit();return r}writeBits(e,r){const s=this.pos+e;for(let a=this.pos;a<s;a++){const l=Math.floor(a/8);let c=this.bytes[l];const u=7-(a&7);c&=~(1<<u),c|=(r&1<<s-a-1)>>s-a-1<<u,this.bytes[l]=c}this.pos=s}readAlignedByte(){if(this.pos%8!==0)throw new Error("Bitstream is not byte-aligned.");const e=this.pos/8,r=this.bytes[e]??0;return this.pos+=8,r}skipBits(e){this.pos+=e}getBitsLeft(){return this.bytes.length*8-this.pos}clone(){const e=new Ye(this.bytes);return e.pos=this.pos,e}}const ae=n=>{let e=0;for(;n.readBits(1)===0&&e<32;)e++;if(e>=32)throw new Error("Invalid exponential-Golomb code.");return(1<<e)-1+n.readBits(e)},wr=n=>{const e=ae(n);return(e&1)===0?-(e>>1):e+1>>1},Yy=(n,e,r,s)=>{for(let a=e;a<r;a++){const l=Math.floor(a/8);let c=n[l];const u=7-(a&7);c&=~(1<<u),c|=(s&1<<r-a-1)>>r-a-1<<u,n[l]=c}},It=n=>n.constructor===Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n),tt=n=>n.constructor===DataView?n:ArrayBuffer.isView(n)?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(n),mn=new TextDecoder,Wt=new TextEncoder,Ld=n=>Object.fromEntries(Object.entries(n).map(([e,r])=>[r,e])),na={bt709:1,bt470bg:5,smpte170m:6,bt2020:9,smpte432:12},Np=Ld(na),ra={bt709:1,smpte170m:6,linear:8,"iec61966-2-1":13,pq:16,hlg:18},Rp=Ld(ra),ia={rgb:0,bt709:1,bt470bg:5,smpte170m:6,"bt2020-ncl":9},zp=Ld(ia),Bp=n=>!!n&&!!n.primaries&&!!n.transfer&&!!n.matrix&&n.fullRange!==void 0,Xl=n=>n instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer||ArrayBuffer.isView(n);class sa{constructor(){this.currentPromise=Promise.resolve()}async acquire(){let e;const r=new Promise(a=>{e=a}),s=this.currentPromise;return this.currentPromise=r,await s,e}}const _m=n=>[...n].map(e=>e.toString(16).padStart(2,"0")).join(""),Im=n=>(n=n>>1&1431655765|(n&1431655765)<<1,n=n>>2&858993459|(n&858993459)<<2,n=n>>4&252645135|(n&252645135)<<4,n=n>>8&16711935|(n&16711935)<<8,n=n>>16&65535|(n&65535)<<16,n>>>0),Yl=(n,e,r)=>{let s=0,a=n.length-1,l=-1;for(;s<=a;){const c=s+a>>1,u=r(n[c]);u===e?(l=c,a=c-1):u<e?s=c+1:a=c-1}return l},Ve=(n,e,r)=>{let s=0,a=n.length-1,l=-1;for(;s<=a;){const c=s+(a-s+1)/2|0;r(n[c])<=e?(l=c,s=c+1):a=c-1}return l},Am=(n,e,r)=>{const s=Ve(n,r(e),r);n.splice(s+1,0,e)},wt=()=>{let n,e;return{promise:new Promise((s,a)=>{n=s,e=a}),resolve:n,reject:e}},Dp=(n,e)=>{for(let r=n.length-1;r>=0;r--)if(e(n[r]))return n[r]},Op=(n,e)=>{for(let r=n.length-1;r>=0;r--)if(e(n[r]))return r;return-1},Zy=async function*(n){Symbol.iterator in n?yield*n[Symbol.iterator]():yield*n[Symbol.asyncIterator]()},Jy=n=>{if(!(Symbol.iterator in n)&&!(Symbol.asyncIterator in n))throw new TypeError("Argument must be an iterable or async iterable.")},Mn=n=>{throw new Error(`Unexpected value: ${n}`)},Zl=(n,e,r)=>{const s=n.getUint8(e),a=n.getUint8(e+1),l=n.getUint8(e+2);return r?s|a<<8|l<<16:s<<16|a<<8|l},ew=(n,e,r)=>Zl(n,e,r)<<8>>8,jd=(n,e,r,s)=>{r=r>>>0,r=r&16777215,s?(n.setUint8(e,r&255),n.setUint8(e+1,r>>>8&255),n.setUint8(e+2,r>>>16&255)):(n.setUint8(e,r>>>16&255),n.setUint8(e+1,r>>>8&255),n.setUint8(e+2,r&255))},tw=(n,e,r,s)=>{r=yt(r,-8388608,8388607),r<0&&(r=r+16777216&16777215),jd(n,e,r,s)},Mm=(n,e)=>({async next(){const r=await n.next();return r.done?{value:void 0,done:!0}:{value:e(r.value),done:!1}},return(){return n.return()},throw(r){return n.throw(r)},[Symbol.asyncIterator](){return this}}),yt=(n,e,r)=>Math.max(e,Math.min(r,n)),Jt="und",Ul=n=>{const e=Math.round(n);return Math.abs(n/e-1)<10*Number.EPSILON?e:n},hd=(n,e)=>Math.round(n/e)*e,nw=n=>{let e=0;for(;n;)e++,n>>=1;return e},rw=/^[a-z]{3}$/,fo=n=>rw.test(n),ii=1e6*(1+Number.EPSILON),iw=(n,e)=>{const r=n<0?-1:1;n=Math.abs(n);let s=0,a=1,l=1,c=0,u=n;for(;;){const f=Math.floor(u),m=f*l+s,g=f*c+a;if(g>e)return{numerator:r*l,denominator:c};if(s=l,a=c,l=m,c=g,u=1/(u-f),!isFinite(u))break}return{numerator:r*l,denominator:c}};class Jl{constructor(){this.currentPromise=Promise.resolve()}call(e){return this.currentPromise=this.currentPromise.then(e)}}let Vu=null;const lo=()=>Vu!==null?Vu:Vu=!!(typeof navigator<"u"&&(navigator.vendor?.match(/apple/i)||/AppleWebKit/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)||/\b(iPad|iPhone|iPod)\b/.test(navigator.userAgent)));let Wu=null;const Js=()=>Wu!==null?Wu:Wu=typeof navigator<"u"&&navigator.userAgent?.includes("Firefox");let Hu=null;const md=()=>Hu!==null?Hu:Hu=!!(typeof navigator<"u"&&(navigator.vendor?.includes("Google Inc")||/Chrome/.test(navigator.userAgent)));let $u=null;const sw=()=>{if($u!==null)return $u;if(typeof navigator>"u")return null;const n=/\bChrome\/(\d+)/.exec(navigator.userAgent);return n?$u=Number(n[1]):null},Os=(n,e)=>n!==-1?n:e,Fm=(n,e,r,s)=>n<=s&&r<=e,Vd=function*(n){for(const e in n){const r=n[e];r!==void 0&&(yield{key:e,value:r})}},aw=n=>{switch(n.toLowerCase()){case"image/jpeg":case"image/jpg":return".jpg";case"image/png":return".png";case"image/gif":return".gif";case"image/webp":return".webp";case"image/bmp":return".bmp";case"image/svg+xml":return".svg";case"image/tiff":return".tiff";case"image/avif":return".avif";case"image/x-icon":case"image/vnd.microsoft.icon":return".ico";default:return null}},ow=n=>{const e=atob(n),r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r},lw=(n,e)=>{if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(n[r]!==e[r])return!1;return!0},Up=()=>{Symbol.dispose??=Symbol("Symbol.dispose")},Lp=n=>typeof n=="number"&&!Number.isNaN(n);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Qs{constructor(e,r){if(this.data=e,this.mimeType=r,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(typeof r!="string")throw new TypeError("mimeType must be a string.")}}class Wd{constructor(e,r,s,a){if(this.data=e,this.mimeType=r,this.name=s,this.description=a,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(r!==void 0&&typeof r!="string")throw new TypeError("mimeType, when provided, must be a string.");if(s!==void 0&&typeof s!="string")throw new TypeError("name, when provided, must be a string.");if(a!==void 0&&typeof a!="string")throw new TypeError("description, when provided, must be a string.")}}const pd=n=>{if(!n||typeof n!="object")throw new TypeError("tags must be an object.");if(n.title!==void 0&&typeof n.title!="string")throw new TypeError("tags.title, when provided, must be a string.");if(n.description!==void 0&&typeof n.description!="string")throw new TypeError("tags.description, when provided, must be a string.");if(n.artist!==void 0&&typeof n.artist!="string")throw new TypeError("tags.artist, when provided, must be a string.");if(n.album!==void 0&&typeof n.album!="string")throw new TypeError("tags.album, when provided, must be a string.");if(n.albumArtist!==void 0&&typeof n.albumArtist!="string")throw new TypeError("tags.albumArtist, when provided, must be a string.");if(n.trackNumber!==void 0&&(!Number.isInteger(n.trackNumber)||n.trackNumber<=0))throw new TypeError("tags.trackNumber, when provided, must be a positive integer.");if(n.tracksTotal!==void 0&&(!Number.isInteger(n.tracksTotal)||n.tracksTotal<=0))throw new TypeError("tags.tracksTotal, when provided, must be a positive integer.");if(n.discNumber!==void 0&&(!Number.isInteger(n.discNumber)||n.discNumber<=0))throw new TypeError("tags.discNumber, when provided, must be a positive integer.");if(n.discsTotal!==void 0&&(!Number.isInteger(n.discsTotal)||n.discsTotal<=0))throw new TypeError("tags.discsTotal, when provided, must be a positive integer.");if(n.genre!==void 0&&typeof n.genre!="string")throw new TypeError("tags.genre, when provided, must be a string.");if(n.date!==void 0&&(!(n.date instanceof Date)||Number.isNaN(n.date.getTime())))throw new TypeError("tags.date, when provided, must be a valid Date.");if(n.lyrics!==void 0&&typeof n.lyrics!="string")throw new TypeError("tags.lyrics, when provided, must be a string.");if(n.images!==void 0){if(!Array.isArray(n.images))throw new TypeError("tags.images, when provided, must be an array.");for(const e of n.images){if(!e||typeof e!="object")throw new TypeError("Each image in tags.images must be an object.");if(!(e.data instanceof Uint8Array))throw new TypeError("Each image.data must be a Uint8Array.");if(typeof e.mimeType!="string")throw new TypeError("Each image.mimeType must be a string.");if(!["coverFront","coverBack","unknown"].includes(e.kind))throw new TypeError("Each image.kind must be 'coverFront', 'coverBack', or 'unknown'.")}}if(n.comment!==void 0&&typeof n.comment!="string")throw new TypeError("tags.comment, when provided, must be a string.");if(n.raw!==void 0){if(!n.raw||typeof n.raw!="object")throw new TypeError("tags.raw, when provided, must be an object.");for(const e of Object.values(n.raw))if(e!==null&&typeof e!="string"&&!(e instanceof Uint8Array)&&!(e instanceof Qs)&&!(e instanceof Wd))throw new TypeError("Each value in tags.raw must be a string, Uint8Array, RichImageData, AttachedFile, or null.")}},qi={default:!0,forced:!1,original:!1,commentary:!1,hearingImpaired:!1,visuallyImpaired:!1},cw=n=>{if(!n||typeof n!="object")throw new TypeError("disposition must be an object.");if(n.default!==void 0&&typeof n.default!="boolean")throw new TypeError("disposition.default must be a boolean.");if(n.forced!==void 0&&typeof n.forced!="boolean")throw new TypeError("disposition.forced must be a boolean.");if(n.original!==void 0&&typeof n.original!="boolean")throw new TypeError("disposition.original must be a boolean.");if(n.commentary!==void 0&&typeof n.commentary!="boolean")throw new TypeError("disposition.commentary must be a boolean.");if(n.hearingImpaired!==void 0&&typeof n.hearingImpaired!="boolean")throw new TypeError("disposition.hearingImpaired must be a boolean.");if(n.visuallyImpaired!==void 0&&typeof n.visuallyImpaired!="boolean")throw new TypeError("disposition.visuallyImpaired must be a boolean.")};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const pn=["avc","hevc","vp9","av1","vp8"],Tt=["pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be","pcm-u8","pcm-s8","ulaw","alaw"],qs=["aac","opus","mp3","vorbis","flac"],Fn=[...qs,...Tt],ea=["webvtt"],Nm=[{maxMacroblocks:99,maxBitrate:64e3,level:10},{maxMacroblocks:396,maxBitrate:192e3,level:11},{maxMacroblocks:396,maxBitrate:384e3,level:12},{maxMacroblocks:396,maxBitrate:768e3,level:13},{maxMacroblocks:396,maxBitrate:2e6,level:20},{maxMacroblocks:792,maxBitrate:4e6,level:21},{maxMacroblocks:1620,maxBitrate:4e6,level:22},{maxMacroblocks:1620,maxBitrate:1e7,level:30},{maxMacroblocks:3600,maxBitrate:14e6,level:31},{maxMacroblocks:5120,maxBitrate:2e7,level:32},{maxMacroblocks:8192,maxBitrate:2e7,level:40},{maxMacroblocks:8192,maxBitrate:5e7,level:41},{maxMacroblocks:8704,maxBitrate:5e7,level:42},{maxMacroblocks:22080,maxBitrate:135e6,level:50},{maxMacroblocks:36864,maxBitrate:24e7,level:51},{maxMacroblocks:36864,maxBitrate:24e7,level:52},{maxMacroblocks:139264,maxBitrate:24e7,level:60},{maxMacroblocks:139264,maxBitrate:48e7,level:61},{maxMacroblocks:139264,maxBitrate:8e8,level:62}],Rm=[{maxPictureSize:36864,maxBitrate:128e3,tier:"L",level:30},{maxPictureSize:122880,maxBitrate:15e5,tier:"L",level:60},{maxPictureSize:245760,maxBitrate:3e6,tier:"L",level:63},{maxPictureSize:552960,maxBitrate:6e6,tier:"L",level:90},{maxPictureSize:983040,maxBitrate:1e7,tier:"L",level:93},{maxPictureSize:2228224,maxBitrate:12e6,tier:"L",level:120},{maxPictureSize:2228224,maxBitrate:3e7,tier:"H",level:120},{maxPictureSize:2228224,maxBitrate:2e7,tier:"L",level:123},{maxPictureSize:2228224,maxBitrate:5e7,tier:"H",level:123},{maxPictureSize:8912896,maxBitrate:25e6,tier:"L",level:150},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:150},{maxPictureSize:8912896,maxBitrate:4e7,tier:"L",level:153},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:153},{maxPictureSize:8912896,maxBitrate:6e7,tier:"L",level:156},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:156},{maxPictureSize:35651584,maxBitrate:6e7,tier:"L",level:180},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:180},{maxPictureSize:35651584,maxBitrate:12e7,tier:"L",level:183},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:183},{maxPictureSize:35651584,maxBitrate:24e7,tier:"L",level:186},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:186}],si=[{maxPictureSize:36864,maxBitrate:2e5,level:10},{maxPictureSize:73728,maxBitrate:8e5,level:11},{maxPictureSize:122880,maxBitrate:18e5,level:20},{maxPictureSize:245760,maxBitrate:36e5,level:21},{maxPictureSize:552960,maxBitrate:72e5,level:30},{maxPictureSize:983040,maxBitrate:12e6,level:31},{maxPictureSize:2228224,maxBitrate:18e6,level:40},{maxPictureSize:2228224,maxBitrate:3e7,level:41},{maxPictureSize:8912896,maxBitrate:6e7,level:50},{maxPictureSize:8912896,maxBitrate:12e7,level:51},{maxPictureSize:8912896,maxBitrate:18e7,level:52},{maxPictureSize:35651584,maxBitrate:18e7,level:60},{maxPictureSize:35651584,maxBitrate:24e7,level:61},{maxPictureSize:35651584,maxBitrate:48e7,level:62}],zm=[{maxPictureSize:147456,maxBitrate:15e5,tier:"M",level:0},{maxPictureSize:278784,maxBitrate:3e6,tier:"M",level:1},{maxPictureSize:665856,maxBitrate:6e6,tier:"M",level:4},{maxPictureSize:1065024,maxBitrate:1e7,tier:"M",level:5},{maxPictureSize:2359296,maxBitrate:12e6,tier:"M",level:8},{maxPictureSize:2359296,maxBitrate:3e7,tier:"H",level:8},{maxPictureSize:2359296,maxBitrate:2e7,tier:"M",level:9},{maxPictureSize:2359296,maxBitrate:5e7,tier:"H",level:9},{maxPictureSize:8912896,maxBitrate:3e7,tier:"M",level:12},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:12},{maxPictureSize:8912896,maxBitrate:4e7,tier:"M",level:13},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:13},{maxPictureSize:8912896,maxBitrate:6e7,tier:"M",level:14},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:14},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:15},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:15},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:16},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:16},{maxPictureSize:35651584,maxBitrate:1e8,tier:"M",level:17},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:17},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:18},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:18},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:19},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:19}],Bm=".01.01.01.01.00",Dm=".0.110.01.01.01.0",uw=(n,e,r,s)=>{if(n==="avc"){const l=Math.ceil(e/16)*Math.ceil(r/16),c=Nm.find(y=>l<=y.maxMacroblocks&&s<=y.maxBitrate)??ot(Nm),u=c?c.level:0,f="64".padStart(2,"0"),m="00",g=u.toString(16).padStart(2,"0");return`avc1.${f}${m}${g}`}else if(n==="hevc"){const u=e*r,f=Rm.find(g=>u<=g.maxPictureSize&&s<=g.maxBitrate)??ot(Rm);return`hev1.1.6.${f.tier}${f.level}.B0`}else{if(n==="vp8")return"vp8";if(n==="vp9"){const l=e*r;return`vp09.00.${(si.find(f=>l<=f.maxPictureSize&&s<=f.maxBitrate)??ot(si)).level.toString().padStart(2,"0")}.08`}else if(n==="av1"){const l=e*r,c=zm.find(m=>l<=m.maxPictureSize&&s<=m.maxBitrate)??ot(zm);return`av01.0.${c.level.toString().padStart(2,"0")}${c.tier}.08`}}throw new TypeError(`Unhandled codec '${n}'.`)},dw=n=>{const e=n.split("."),r=Number(e[1]),s=Number(e[2]),a=Number(e[3]),l=e[4]?Number(e[4]):1;return[1,1,r,2,1,s,3,1,a,4,1,l]},jp=n=>{const e=n.split("."),a=(1<<7)+1,l=Number(e[1]),c=e[2],u=Number(c.slice(0,-1)),f=(l<<5)+u,m=c.slice(-1)==="H"?1:0,y=Number(e[3])===8?0:1,w=0,T=e[4]?Number(e[4]):0,S=e[5]?Number(e[5][0]):1,v=e[5]?Number(e[5][1]):1,x=e[5]?Number(e[5][2]):0,_=(m<<7)+(y<<6)+(w<<5)+(T<<4)+(S<<3)+(v<<2)+x;return[a,f,_,0]},Vp=n=>{const{codec:e,codecDescription:r,colorSpace:s,avcCodecInfo:a,hevcCodecInfo:l,vp9CodecInfo:c,av1CodecInfo:u}=n;if(e==="avc"){if(b(n.avcType!==null),a){const f=new Uint8Array([a.avcProfileIndication,a.profileCompatibility,a.avcLevelIndication]);return`avc${n.avcType}.${_m(f)}`}if(!r||r.byteLength<4)throw new TypeError("AVC decoder description is not provided or is not at least 4 bytes long.");return`avc${n.avcType}.${_m(r.subarray(1,4))}`}else if(e==="hevc"){let f,m,g,y,w,T;if(l)f=l.generalProfileSpace,m=l.generalProfileIdc,g=Im(l.generalProfileCompatibilityFlags),y=l.generalTierFlag,w=l.generalLevelIdc,T=[...l.generalConstraintIndicatorFlags];else{if(!r||r.byteLength<23)throw new TypeError("HEVC decoder description is not provided or is not at least 23 bytes long.");const v=tt(r),x=v.getUint8(1);f=x>>6&3,m=x&31,g=Im(v.getUint32(2)),y=x>>5&1,w=v.getUint8(12),T=[];for(let _=0;_<6;_++)T.push(v.getUint8(6+_))}let S="hev1.";for(S+=["","A","B","C"][f]+m,S+=".",S+=g.toString(16).toUpperCase(),S+=".",S+=y===0?"L":"H",S+=w;T.length>0&&T[T.length-1]===0;)T.pop();return T.length>0&&(S+=".",S+=T.map(v=>v.toString(16).toUpperCase()).join(".")),S}else{if(e==="vp8")return"vp8";if(e==="vp9"){if(!c){const _=n.width*n.height;let A=ot(si).level;for(const O of si)if(_<=O.maxPictureSize){A=O.level;break}return`vp09.00.${A.toString().padStart(2,"0")}.08`}const f=c.profile.toString().padStart(2,"0"),m=c.level.toString().padStart(2,"0"),g=c.bitDepth.toString().padStart(2,"0"),y=c.chromaSubsampling.toString().padStart(2,"0"),w=c.colourPrimaries.toString().padStart(2,"0"),T=c.transferCharacteristics.toString().padStart(2,"0"),S=c.matrixCoefficients.toString().padStart(2,"0"),v=c.videoFullRangeFlag.toString().padStart(2,"0");let x=`vp09.${f}.${m}.${g}.${y}`;return x+=`.${w}.${T}.${S}.${v}`,x.endsWith(Bm)&&(x=x.slice(0,-Bm.length)),x}else if(e==="av1"){if(!u){const O=n.width*n.height;let B=ot(si).level;for(const j of si)if(O<=j.maxPictureSize){B=j.level;break}return`av01.0.${B.toString().padStart(2,"0")}M.08`}const f=u.profile,m=u.level.toString().padStart(2,"0"),g=u.tier?"H":"M",y=u.bitDepth.toString().padStart(2,"0"),w=u.monochrome?"1":"0",T=100*u.chromaSubsamplingX+10*u.chromaSubsamplingY+1*(u.chromaSubsamplingX&&u.chromaSubsamplingY?u.chromaSamplePosition:0),S=s?.primaries?na[s.primaries]:1,v=s?.transfer?ra[s.transfer]:1,x=s?.matrix?ia[s.matrix]:1,_=s?.fullRange?1:0;let A=`av01.${f}.${m}${g}.${y}`;return A+=`.${w}.${T.toString().padStart(3,"0")}`,A+=`.${S.toString().padStart(2,"0")}`,A+=`.${v.toString().padStart(2,"0")}`,A+=`.${x.toString().padStart(2,"0")}`,A+=`.${_}`,A.endsWith(Dm)&&(A=A.slice(0,-Dm.length)),A}}throw new TypeError(`Unhandled codec '${e}'.`)},fw=(n,e,r)=>{if(n==="aac")return e>=2&&r<=24e3?"mp4a.40.29":r<=24e3?"mp4a.40.5":"mp4a.40.2";if(n==="mp3")return"mp3";if(n==="opus")return"opus";if(n==="vorbis")return"vorbis";if(n==="flac")return"flac";if(Tt.includes(n))return n;throw new TypeError(`Unhandled codec '${n}'.`)},Wp=n=>{const{codec:e,codecDescription:r,aacCodecInfo:s}=n;if(e==="aac"){if(!s)throw new TypeError("AAC codec info must be provided.");return s.isMpeg2?"mp4a.67":`mp4a.40.${$d(r).objectType}`}else{if(e==="mp3")return"mp3";if(e==="opus")return"opus";if(e==="vorbis")return"vorbis";if(e==="flac")return"flac";if(e&&Tt.includes(e))return e}throw new TypeError(`Unhandled codec '${e}'.`)},ho=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Hd=[-1,1,2,3,4,5,6,8],$d=n=>{if(!n||n.byteLength<2)throw new TypeError("AAC description must be at least 2 bytes long.");const e=new Ye(n);let r=e.readBits(5);r===31&&(r=32+e.readBits(6));const s=e.readBits(4);let a=null;s===15?a=e.readBits(24):s<ho.length&&(a=ho[s]);const l=e.readBits(4);let c=null;return l>=1&&l<=7&&(c=Hd[l]),{objectType:r,frequencyIndex:s,sampleRate:a,channelConfiguration:l,numberOfChannels:c}},hw=n=>{let e=ho.indexOf(n.sampleRate),r=null;e===-1&&(e=15,r=n.sampleRate);const s=Hd.indexOf(n.numberOfChannels);if(s===-1)throw new TypeError(`Unsupported number of channels: ${n.numberOfChannels}`);let a=13;n.objectType>=32&&(a+=6),e===15&&(a+=24);const l=Math.ceil(a/8),c=new Uint8Array(l),u=new Ye(c);return n.objectType<32?u.writeBits(5,n.objectType):(u.writeBits(5,31),u.writeBits(6,n.objectType-32)),u.writeBits(4,e),e===15&&u.writeBits(24,r),u.writeBits(4,s),c},wo=48e3,Hp=/^pcm-([usf])(\d+)+(be)?$/,kr=n=>{if(b(Tt.includes(n)),n==="ulaw")return{dataType:"ulaw",sampleSize:1,littleEndian:!0,silentValue:255};if(n==="alaw")return{dataType:"alaw",sampleSize:1,littleEndian:!0,silentValue:213};const e=Hp.exec(n);b(e);let r;e[1]==="u"?r="unsigned":e[1]==="s"?r="signed":r="float";const s=Number(e[2])/8,a=e[3]!=="be",l=n==="pcm-u8"?2**7:0;return{dataType:r,sampleSize:s,littleEndian:a,silentValue:l}},$p=n=>n.startsWith("avc1")||n.startsWith("avc3")?"avc":n.startsWith("hev1")||n.startsWith("hvc1")?"hevc":n==="vp8"?"vp8":n.startsWith("vp09")?"vp9":n.startsWith("av01")?"av1":n.startsWith("mp4a.40")||n==="mp4a.67"?"aac":n==="mp3"||n==="mp4a.69"||n==="mp4a.6B"||n==="mp4a.6b"?"mp3":n==="opus"?"opus":n==="vorbis"?"vorbis":n==="flac"?"flac":n==="ulaw"?"ulaw":n==="alaw"?"alaw":Hp.test(n)?n:n==="webvtt"?"webvtt":null,mw=n=>n==="avc"?{avc:{format:"avc"}}:n==="hevc"?{hevc:{format:"hevc"}}:{},pw=n=>n==="aac"?{aac:{format:"aac"}}:n==="opus"?{opus:{format:"opus"}}:{},gw=["avc1","avc3","hev1","hvc1","vp8","vp09","av01"],yw=/^(avc1|avc3)\.[0-9a-fA-F]{6}$/,ww=/^(hev1|hvc1)\.(?:[ABC]?\d+)\.[0-9a-fA-F]{1,8}\.[LH]\d+(?:\.[0-9a-fA-F]{1,2}){0,6}$/,kw=/^vp09(?:\.\d{2}){3}(?:(?:\.\d{2}){5})?$/,Tw=/^av01\.\d\.\d{2}[MH]\.\d{2}(?:\.\d\.\d{3}\.\d{2}\.\d{2}\.\d{2}\.\d)?$/,Qp=n=>{if(!n)throw new TypeError("Video chunk metadata must be provided.");if(typeof n!="object")throw new TypeError("Video chunk metadata must be an object.");if(!n.decoderConfig)throw new TypeError("Video chunk metadata must include a decoder configuration.");if(typeof n.decoderConfig!="object")throw new TypeError("Video chunk metadata decoder configuration must be an object.");if(typeof n.decoderConfig.codec!="string")throw new TypeError("Video chunk metadata decoder configuration must specify a codec string.");if(!gw.some(e=>n.decoderConfig.codec.startsWith(e)))throw new TypeError("Video chunk metadata decoder configuration codec string must be a valid video codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(n.decoderConfig.codedWidth)||n.decoderConfig.codedWidth<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedWidth (positive integer).");if(!Number.isInteger(n.decoderConfig.codedHeight)||n.decoderConfig.codedHeight<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedHeight (positive integer).");if(n.decoderConfig.description!==void 0&&!Xl(n.decoderConfig.description))throw new TypeError("Video chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(n.decoderConfig.colorSpace!==void 0){const{colorSpace:e}=n.decoderConfig;if(typeof e!="object")throw new TypeError("Video chunk metadata decoder configuration colorSpace, when provided, must be an object.");const r=Object.keys(na);if(e.primaries!=null&&!r.includes(e.primaries))throw new TypeError(`Video chunk metadata decoder configuration colorSpace primaries, when defined, must be one of ${r.join(", ")}.`);const s=Object.keys(ra);if(e.transfer!=null&&!s.includes(e.transfer))throw new TypeError(`Video chunk metadata decoder configuration colorSpace transfer, when defined, must be one of ${s.join(", ")}.`);const a=Object.keys(ia);if(e.matrix!=null&&!a.includes(e.matrix))throw new TypeError(`Video chunk metadata decoder configuration colorSpace matrix, when defined, must be one of ${a.join(", ")}.`);if(e.fullRange!=null&&typeof e.fullRange!="boolean")throw new TypeError("Video chunk metadata decoder configuration colorSpace fullRange, when defined, must be a boolean.")}if(n.decoderConfig.codec.startsWith("avc1")||n.decoderConfig.codec.startsWith("avc3")){if(!yw.test(n.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for AVC must be a valid AVC codec string as specified in Section 3.4 of RFC 6381.")}else if(n.decoderConfig.codec.startsWith("hev1")||n.decoderConfig.codec.startsWith("hvc1")){if(!ww.test(n.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for HEVC must be a valid HEVC codec string as specified in Section E.3 of ISO 14496-15.")}else if(n.decoderConfig.codec.startsWith("vp8")){if(n.decoderConfig.codec!=="vp8")throw new TypeError('Video chunk metadata decoder configuration codec string for VP8 must be "vp8".')}else if(n.decoderConfig.codec.startsWith("vp09")){if(!kw.test(n.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for VP9 must be a valid VP9 codec string as specified in Section "Codecs Parameter String" of https://www.webmproject.org/vp9/mp4/.')}else if(n.decoderConfig.codec.startsWith("av01")&&!Tw.test(n.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for AV1 must be a valid AV1 codec string as specified in Section "Codecs Parameter String" of https://aomediacodec.github.io/av1-isobmff/.')},Sw=["mp4a","mp3","opus","vorbis","flac","ulaw","alaw","pcm"],qp=n=>{if(!n)throw new TypeError("Audio chunk metadata must be provided.");if(typeof n!="object")throw new TypeError("Audio chunk metadata must be an object.");if(!n.decoderConfig)throw new TypeError("Audio chunk metadata must include a decoder configuration.");if(typeof n.decoderConfig!="object")throw new TypeError("Audio chunk metadata decoder configuration must be an object.");if(typeof n.decoderConfig.codec!="string")throw new TypeError("Audio chunk metadata decoder configuration must specify a codec string.");if(!Sw.some(e=>n.decoderConfig.codec.startsWith(e)))throw new TypeError("Audio chunk metadata decoder configuration codec string must be a valid audio codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(n.decoderConfig.sampleRate)||n.decoderConfig.sampleRate<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid sampleRate (positive integer).");if(!Number.isInteger(n.decoderConfig.numberOfChannels)||n.decoderConfig.numberOfChannels<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid numberOfChannels (positive integer).");if(n.decoderConfig.description!==void 0&&!Xl(n.decoderConfig.description))throw new TypeError("Audio chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(n.decoderConfig.codec.startsWith("mp4a")&&n.decoderConfig.codec!=="mp4a.69"&&n.decoderConfig.codec!=="mp4a.6B"&&n.decoderConfig.codec!=="mp4a.6b"){if(!["mp4a.40.2","mp4a.40.02","mp4a.40.5","mp4a.40.05","mp4a.40.29","mp4a.67"].includes(n.decoderConfig.codec))throw new TypeError("Audio chunk metadata decoder configuration codec string for AAC must be a valid AAC codec string as specified in https://www.w3.org/TR/webcodecs-aac-codec-registration/.");if(!n.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for AAC must include a description, which is expected to be an AudioSpecificConfig as specified in ISO 14496-3.")}else if(n.decoderConfig.codec.startsWith("mp3")||n.decoderConfig.codec.startsWith("mp4a")){if(n.decoderConfig.codec!=="mp3"&&n.decoderConfig.codec!=="mp4a.69"&&n.decoderConfig.codec!=="mp4a.6B"&&n.decoderConfig.codec!=="mp4a.6b")throw new TypeError('Audio chunk metadata decoder configuration codec string for MP3 must be "mp3", "mp4a.69" or "mp4a.6B".')}else if(n.decoderConfig.codec.startsWith("opus")){if(n.decoderConfig.codec!=="opus")throw new TypeError('Audio chunk metadata decoder configuration codec string for Opus must be "opus".');if(n.decoderConfig.description&&n.decoderConfig.description.byteLength<18)throw new TypeError("Audio chunk metadata decoder configuration description, when specified, is expected to be an Identification Header as specified in Section 5.1 of RFC 7845.")}else if(n.decoderConfig.codec.startsWith("vorbis")){if(n.decoderConfig.codec!=="vorbis")throw new TypeError('Audio chunk metadata decoder configuration codec string for Vorbis must be "vorbis".');if(!n.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for Vorbis must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-vorbis-codec-registration/.")}else if(n.decoderConfig.codec.startsWith("flac")){if(n.decoderConfig.codec!=="flac")throw new TypeError('Audio chunk metadata decoder configuration codec string for FLAC must be "flac".');if(!n.decoderConfig.description||n.decoderConfig.description.byteLength<42)throw new TypeError("Audio chunk metadata decoder configuration for FLAC must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-flac-codec-registration/.")}else if((n.decoderConfig.codec.startsWith("pcm")||n.decoderConfig.codec.startsWith("ulaw")||n.decoderConfig.codec.startsWith("alaw"))&&!Tt.includes(n.decoderConfig.codec))throw new TypeError(`Audio chunk metadata decoder configuration codec string for PCM must be one of the supported PCM codecs (${Tt.join(", ")}).`)},Kp=n=>{if(!n)throw new TypeError("Subtitle metadata must be provided.");if(typeof n!="object")throw new TypeError("Subtitle metadata must be an object.");if(!n.config)throw new TypeError("Subtitle metadata must include a config object.");if(typeof n.config!="object")throw new TypeError("Subtitle metadata config must be an object.");if(typeof n.config.description!="string")throw new TypeError("Subtitle metadata config description must be a string.")};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Gp{constructor(e){this.mutex=new sa,this.firstMediaStreamTimestamp=null,this.trackTimestampInfo=new WeakMap,this.output=e}onTrackClose(e){}validateAndNormalizeTimestamp(e,r,s){r+=e.source._timestampOffset;let a=this.trackTimestampInfo.get(e);if(!a){if(!s)throw new Error("First packet must be a key packet.");a={maxTimestamp:r,maxTimestampBeforeLastKeyPacket:r},this.trackTimestampInfo.set(e,a)}if(r<0)throw new Error(`Timestamps must be non-negative (got ${r}s).`);if(s&&(a.maxTimestampBeforeLastKeyPacket=a.maxTimestamp),r<a.maxTimestampBeforeLastKeyPacket)throw new Error(`Timestamps cannot be smaller than the largest timestamp of the previous GOP (a GOP begins with a key packet and ends right before the next key packet). Got ${r}s, but largest timestamp is ${a.maxTimestampBeforeLastKeyPacket}s.`);return a.maxTimestamp=Math.max(a.maxTimestamp,r),r}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var $i;(function(n){n[n.IDR=5]="IDR",n[n.SEI=6]="SEI",n[n.SPS=7]="SPS",n[n.PPS=8]="PPS",n[n.SPS_EXT=13]="SPS_EXT"})($i||($i={}));var Vt;(function(n){n[n.RASL_N=8]="RASL_N",n[n.RASL_R=9]="RASL_R",n[n.BLA_W_LP=16]="BLA_W_LP",n[n.RSV_IRAP_VCL23=23]="RSV_IRAP_VCL23",n[n.VPS_NUT=32]="VPS_NUT",n[n.SPS_NUT=33]="SPS_NUT",n[n.PPS_NUT=34]="PPS_NUT",n[n.PREFIX_SEI_NUT=39]="PREFIX_SEI_NUT",n[n.SUFFIX_SEI_NUT=40]="SUFFIX_SEI_NUT"})(Vt||(Vt={}));const ko=n=>{const e=[];let r=0;for(;r<n.length;){let s=-1,a=0;for(let l=r;l<n.length-3;l++){if(n[l]===0&&n[l+1]===0&&n[l+2]===1){s=l,a=3;break}if(l<n.length-4&&n[l]===0&&n[l+1]===0&&n[l+2]===0&&n[l+3]===1){s=l,a=4;break}}if(s===-1)break;if(r>0&&s>r){const l=n.subarray(r,s);l.length>0&&e.push(l)}r=s+a}if(r<n.length){const s=n.subarray(r);s.length>0&&e.push(s)}return e},Xp=(n,e)=>{const r=[];let s=0;const a=new DataView(n.buffer,n.byteOffset,n.byteLength);for(;s+e<=n.length;){let l;e===1?l=a.getUint8(s):e===2?l=a.getUint16(s,!1):e===3?l=Zl(a,s,!1):e===4?l=a.getUint32(s,!1):(Mn(e),b(!1)),s+=e;const c=n.subarray(s,s+l);r.push(c),s+=l}return r},Ll=n=>{const e=[],r=n.length;for(let s=0;s<r;s++)s+2<r&&n[s]===0&&n[s+1]===0&&n[s+2]===3?(e.push(0,0),s+=2):e.push(n[s]);return new Uint8Array(e)},Qu=new Uint8Array([0,0,0,1]),vw=n=>{const e=n.reduce((a,l)=>a+Qu.byteLength+l.byteLength,0),r=new Uint8Array(e);let s=0;for(const a of n)r.set(Qu,s),s+=Qu.byteLength,r.set(a,s),s+=a.byteLength;return r},Yp=(n,e)=>{const r=n.reduce((l,c)=>l+e+c.byteLength,0),s=new Uint8Array(r);let a=0;for(const l of n){const c=new DataView(s.buffer,s.byteOffset,s.byteLength);switch(e){case 1:c.setUint8(a,l.byteLength);break;case 2:c.setUint16(a,l.byteLength,!1);break;case 3:jd(c,a,l.byteLength,!1);break;case 4:c.setUint32(a,l.byteLength,!1);break}a+=e,s.set(l,a),a+=l.byteLength}return s},Zp=(n,e)=>{if(e.description){const a=(It(e.description)[4]&3)+1;return Xp(n,a)}else return ko(n)},bw=(n,e)=>{if(e.description){const a=(It(e.description)[4]&3)+1;return Yp(n,a)}else return vw(n)},Ks=n=>n[0]&31,Jp=n=>{try{const e=ko(n),r=e.filter(f=>Ks(f)===$i.SPS),s=e.filter(f=>Ks(f)===$i.PPS),a=e.filter(f=>Ks(f)===$i.SPS_EXT);if(r.length===0||s.length===0)return null;const l=r[0],c=eg(l);b(c!==null);const u=c.profileIdc===100||c.profileIdc===110||c.profileIdc===122||c.profileIdc===144;return{configurationVersion:1,avcProfileIndication:c.profileIdc,profileCompatibility:c.constraintFlags,avcLevelIndication:c.levelIdc,lengthSizeMinusOne:3,sequenceParameterSets:r,pictureParameterSets:s,chromaFormat:u?c.chromaFormatIdc:null,bitDepthLumaMinus8:u?c.bitDepthLumaMinus8:null,bitDepthChromaMinus8:u?c.bitDepthChromaMinus8:null,sequenceParameterSetExt:u?a:null}}catch(e){return console.error("Error building AVC Decoder Configuration Record:",e),null}},xw=n=>{const e=[];e.push(n.configurationVersion),e.push(n.avcProfileIndication),e.push(n.profileCompatibility),e.push(n.avcLevelIndication),e.push(252|n.lengthSizeMinusOne&3),e.push(224|n.sequenceParameterSets.length&31);for(const r of n.sequenceParameterSets){const s=r.byteLength;e.push(s>>8),e.push(s&255);for(let a=0;a<s;a++)e.push(r[a])}e.push(n.pictureParameterSets.length);for(const r of n.pictureParameterSets){const s=r.byteLength;e.push(s>>8),e.push(s&255);for(let a=0;a<s;a++)e.push(r[a])}if(n.avcProfileIndication===100||n.avcProfileIndication===110||n.avcProfileIndication===122||n.avcProfileIndication===144){b(n.chromaFormat!==null),b(n.bitDepthLumaMinus8!==null),b(n.bitDepthChromaMinus8!==null),b(n.sequenceParameterSetExt!==null),e.push(252|n.chromaFormat&3),e.push(248|n.bitDepthLumaMinus8&7),e.push(248|n.bitDepthChromaMinus8&7),e.push(n.sequenceParameterSetExt.length);for(const r of n.sequenceParameterSetExt){const s=r.byteLength;e.push(s>>8),e.push(s&255);for(let a=0;a<s;a++)e.push(r[a])}}return new Uint8Array(e)},Cw=n=>{try{const e=tt(n);let r=0;const s=e.getUint8(r++),a=e.getUint8(r++),l=e.getUint8(r++),c=e.getUint8(r++),u=e.getUint8(r++)&3,f=e.getUint8(r++)&31,m=[];for(let T=0;T<f;T++){const S=e.getUint16(r,!1);r+=2,m.push(n.subarray(r,r+S)),r+=S}const g=e.getUint8(r++),y=[];for(let T=0;T<g;T++){const S=e.getUint16(r,!1);r+=2,y.push(n.subarray(r,r+S)),r+=S}const w={configurationVersion:s,avcProfileIndication:a,profileCompatibility:l,avcLevelIndication:c,lengthSizeMinusOne:u,sequenceParameterSets:m,pictureParameterSets:y,chromaFormat:null,bitDepthLumaMinus8:null,bitDepthChromaMinus8:null,sequenceParameterSetExt:null};if((a===100||a===110||a===122||a===144)&&r+4<=n.length){const T=e.getUint8(r++)&3,S=e.getUint8(r++)&7,v=e.getUint8(r++)&7,x=e.getUint8(r++);w.chromaFormat=T,w.bitDepthLumaMinus8=S,w.bitDepthChromaMinus8=v;const _=[];for(let A=0;A<x;A++){const O=e.getUint16(r,!1);r+=2,_.push(n.subarray(r,r+O)),r+=O}w.sequenceParameterSetExt=_}return w}catch(e){return console.error("Error deserializing AVC Decoder Configuration Record:",e),null}},eg=n=>{try{const e=new Ye(Ll(n));if(e.skipBits(1),e.skipBits(2),e.readBits(5)!==7)return null;const s=e.readAlignedByte(),a=e.readAlignedByte(),l=e.readAlignedByte();ae(e);let c=null,u=null,f=null;if((s===100||s===110||s===122||s===244||s===44||s===83||s===86||s===118||s===128)&&(c=ae(e),c===3&&e.skipBits(1),u=ae(e),f=ae(e),e.skipBits(1),e.readBits(1))){for(let w=0;w<(c!==3?8:12);w++)if(e.readBits(1)){const S=w<6?16:64;let v=8,x=8;for(let _=0;_<S;_++){if(x!==0){const A=wr(e);x=(v+A+256)%256}v=x===0?v:x}}}ae(e);const m=ae(e);if(m===0)ae(e);else if(m===1){e.skipBits(1),wr(e),wr(e);const y=ae(e);for(let w=0;w<y;w++)wr(e)}ae(e),e.skipBits(1),ae(e),ae(e);const g=e.readBits(1);return{profileIdc:s,constraintFlags:a,levelIdc:l,frameMbsOnlyFlag:g,chromaFormatIdc:c,bitDepthLumaMinus8:u,bitDepthChromaMinus8:f}}catch(e){return console.error("Error parsing AVC SPS:",e),null}},tg=(n,e)=>{if(e.description){const a=(It(e.description)[21]&3)+1;return Xp(n,a)}else return ko(n)},ti=n=>n[0]>>1&63,ng=n=>{try{const e=ko(n),r=e.filter(oe=>ti(oe)===Vt.VPS_NUT),s=e.filter(oe=>ti(oe)===Vt.SPS_NUT),a=e.filter(oe=>ti(oe)===Vt.PPS_NUT),l=e.filter(oe=>ti(oe)===Vt.PREFIX_SEI_NUT||ti(oe)===Vt.SUFFIX_SEI_NUT);if(s.length===0||a.length===0)return null;const c=s[0],u=new Ye(Ll(c));u.skipBits(16),u.readBits(4);const f=u.readBits(3),m=u.readBits(1),{general_profile_space:g,general_tier_flag:y,general_profile_idc:w,general_profile_compatibility_flags:T,general_constraint_indicator_flags:S,general_level_idc:v}=Pw(u,f);ae(u);const x=ae(u);x===3&&u.skipBits(1),ae(u),ae(u),u.readBits(1)&&(ae(u),ae(u),ae(u),ae(u));const _=ae(u),A=ae(u);ae(u);const B=u.readBits(1)?0:f;for(let oe=B;oe<=f;oe++)ae(u),ae(u),ae(u);ae(u),ae(u),ae(u),ae(u),ae(u),ae(u),u.readBits(1)&&u.readBits(1)&&Ew(u),u.skipBits(1),u.skipBits(1),u.readBits(1)&&(u.skipBits(4),u.skipBits(4),ae(u),ae(u),u.skipBits(1));const j=ae(u);if(_w(u,j),u.readBits(1)){const oe=ae(u);for(let re=0;re<oe;re++)ae(u),u.skipBits(1)}u.skipBits(1),u.skipBits(1);let L=0;u.readBits(1)&&(L=Aw(u,f));let q=0;if(a.length>0){const oe=a[0],re=new Ye(Ll(oe));re.skipBits(16),ae(re),ae(re),re.skipBits(1),re.skipBits(1),re.skipBits(3),re.skipBits(1),re.skipBits(1),ae(re),ae(re),wr(re),re.skipBits(1),re.skipBits(1),re.readBits(1)&&ae(re),wr(re),wr(re),re.skipBits(1),re.skipBits(1),re.skipBits(1),re.skipBits(1);const ne=re.readBits(1),he=re.readBits(1);!ne&&!he?q=0:ne&&!he?q=2:!ne&&he?q=3:q=0}const G=[...r.length?[{arrayCompleteness:1,nalUnitType:Vt.VPS_NUT,nalUnits:r}]:[],...s.length?[{arrayCompleteness:1,nalUnitType:Vt.SPS_NUT,nalUnits:s}]:[],...a.length?[{arrayCompleteness:1,nalUnitType:Vt.PPS_NUT,nalUnits:a}]:[],...l.length?[{arrayCompleteness:1,nalUnitType:ti(l[0]),nalUnits:l}]:[]];return{configurationVersion:1,generalProfileSpace:g,generalTierFlag:y,generalProfileIdc:w,generalProfileCompatibilityFlags:T,generalConstraintIndicatorFlags:S,generalLevelIdc:v,minSpatialSegmentationIdc:L,parallelismType:q,chromaFormatIdc:x,bitDepthLumaMinus8:_,bitDepthChromaMinus8:A,avgFrameRate:0,constantFrameRate:0,numTemporalLayers:f+1,temporalIdNested:m,lengthSizeMinusOne:3,arrays:G}}catch(e){return console.error("Error building HEVC Decoder Configuration Record:",e),null}},Pw=(n,e)=>{const r=n.readBits(2),s=n.readBits(1),a=n.readBits(5);let l=0;for(let g=0;g<32;g++)l=l<<1|n.readBits(1);const c=new Uint8Array(6);for(let g=0;g<6;g++)c[g]=n.readBits(8);const u=n.readBits(8),f=[],m=[];for(let g=0;g<e;g++)f.push(n.readBits(1)),m.push(n.readBits(1));if(e>0)for(let g=e;g<8;g++)n.skipBits(2);for(let g=0;g<e;g++)f[g]&&n.skipBits(88),m[g]&&n.skipBits(8);return{general_profile_space:r,general_tier_flag:s,general_profile_idc:a,general_profile_compatibility_flags:l,general_constraint_indicator_flags:c,general_level_idc:u}},Ew=n=>{for(let e=0;e<4;e++)for(let r=0;r<(e===3?2:6);r++)if(!n.readBits(1))ae(n);else{const a=Math.min(64,1<<4+(e<<1));e>1&&wr(n);for(let l=0;l<a;l++)wr(n)}},_w=(n,e)=>{const r=[];for(let s=0;s<e;s++)r[s]=Iw(n,s,e,r)},Iw=(n,e,r,s)=>{let a=0,l=0,c=0;if(e!==0&&(l=n.readBits(1)),l){if(e===r){const f=ae(n);c=e-(f+1)}else c=e-1;n.readBits(1),ae(n);const u=s[c]??0;for(let f=0;f<=u;f++)n.readBits(1)||n.readBits(1);a=s[c]}else{const u=ae(n),f=ae(n);for(let m=0;m<u;m++)ae(n),n.readBits(1);for(let m=0;m<f;m++)ae(n),n.readBits(1);a=u+f}return a},Aw=(n,e)=>{if(n.readBits(1)&&n.readBits(8)===255&&(n.readBits(16),n.readBits(16)),n.readBits(1)&&n.readBits(1),n.readBits(1)&&(n.readBits(3),n.readBits(1),n.readBits(1)&&(n.readBits(8),n.readBits(8),n.readBits(8))),n.readBits(1)&&(ae(n),ae(n)),n.readBits(1),n.readBits(1),n.readBits(1),n.readBits(1)&&(ae(n),ae(n),ae(n),ae(n)),n.readBits(1)&&(n.readBits(32),n.readBits(32),n.readBits(1)&&ae(n),n.readBits(1)&&Mw(n,!0,e)),n.readBits(1)){n.readBits(1),n.readBits(1),n.readBits(1);const r=ae(n);return ae(n),ae(n),ae(n),ae(n),r}return 0},Mw=(n,e,r)=>{let s=!1,a=!1,l=!1;s=n.readBits(1)===1,a=n.readBits(1)===1,(s||a)&&(l=n.readBits(1)===1,l&&(n.readBits(8),n.readBits(5),n.readBits(1),n.readBits(5)),n.readBits(4),n.readBits(4),l&&n.readBits(4),n.readBits(5),n.readBits(5),n.readBits(5));for(let c=0;c<=r;c++){const u=n.readBits(1)===1;let f=!0;u||(f=n.readBits(1)===1);let m=!1;f?ae(n):m=n.readBits(1)===1;let g=1;m||(g=ae(n)+1),s&&Om(n,g,l),a&&Om(n,g,l)}},Om=(n,e,r)=>{for(let s=0;s<e;s++)ae(n),ae(n),r&&(ae(n),ae(n)),n.readBits(1)},Fw=n=>{const e=[];e.push(n.configurationVersion),e.push((n.generalProfileSpace&3)<<6|(n.generalTierFlag&1)<<5|n.generalProfileIdc&31),e.push(n.generalProfileCompatibilityFlags>>>24&255),e.push(n.generalProfileCompatibilityFlags>>>16&255),e.push(n.generalProfileCompatibilityFlags>>>8&255),e.push(n.generalProfileCompatibilityFlags&255),e.push(...n.generalConstraintIndicatorFlags),e.push(n.generalLevelIdc&255),e.push(240|n.minSpatialSegmentationIdc>>8&15),e.push(n.minSpatialSegmentationIdc&255),e.push(252|n.parallelismType&3),e.push(252|n.chromaFormatIdc&3),e.push(248|n.bitDepthLumaMinus8&7),e.push(248|n.bitDepthChromaMinus8&7),e.push(n.avgFrameRate>>8&255),e.push(n.avgFrameRate&255),e.push((n.constantFrameRate&3)<<6|(n.numTemporalLayers&7)<<3|(n.temporalIdNested&1)<<2|n.lengthSizeMinusOne&3),e.push(n.arrays.length&255);for(const r of n.arrays){e.push((r.arrayCompleteness&1)<<7|0|r.nalUnitType&63),e.push(r.nalUnits.length>>8&255),e.push(r.nalUnits.length&255);for(const s of r.nalUnits){e.push(s.length>>8&255),e.push(s.length&255);for(let a=0;a<s.length;a++)e.push(s[a])}}return new Uint8Array(e)},rg=n=>{const e=new Ye(n);if(e.readBits(2)!==2)return null;const s=e.readBits(1),l=(e.readBits(1)<<1)+s;if(l===3&&e.skipBits(1),e.readBits(1)===1||e.readBits(1)!==0||(e.skipBits(2),e.readBits(24)!==4817730))return null;let m=8;l>=2&&(m=e.readBits(1)?12:10);const g=e.readBits(3);let y=0,w=0;if(g!==7)if(w=e.readBits(1),l===1||l===3){const q=e.readBits(1),G=e.readBits(1);y=!q&&!G?3:q&&!G?2:1,e.skipBits(1)}else y=1;else y=3,w=1;const T=e.readBits(16),S=e.readBits(16),v=T+1,x=S+1,_=v*x;let A=ot(si).level;for(const L of si)if(_<=L.maxPictureSize){A=L.level;break}return{profile:l,level:A,bitDepth:m,chromaSubsampling:y,videoFullRangeFlag:w,colourPrimaries:g===2?1:g===1?6:2,transferCharacteristics:g===2?1:g===1?6:2,matrixCoefficients:g===7?0:g===2?1:g===1?6:2}},ig=function*(n){const e=new Ye(n),r=()=>{let s=0;for(let a=0;a<8;a++){const l=e.readAlignedByte();if(s|=(l&127)<<a*7,!(l&128))break;if(a===7&&l&128)return null}return s>=2**32-1?null:s};for(;e.getBitsLeft()>=8;){e.skipBits(1);const s=e.readBits(4),a=e.readBits(1),l=e.readBits(1);e.skipBits(1),a&&e.skipBits(8);let c;if(l){const u=r();if(u===null)return;c=u}else c=Math.floor(e.getBitsLeft()/8);b(e.pos%8===0),yield{type:s,data:n.subarray(e.pos/8,e.pos/8+c)},e.skipBits(c*8)}},sg=n=>{for(const{type:e,data:r}of ig(n)){if(e!==1)continue;const s=new Ye(r),a=s.readBits(3);s.readBits(1);const l=s.readBits(1);let c=0,u=0,f=0;if(l)c=s.readBits(5);else{if(s.readBits(1)&&(s.skipBits(32),s.skipBits(32),s.readBits(1)))return null;const j=s.readBits(1);j&&(f=s.readBits(5),s.skipBits(32),s.skipBits(5),s.skipBits(5));const L=s.readBits(5);for(let q=0;q<=L;q++){s.skipBits(12);const G=s.readBits(5);if(q===0&&(c=G),G>7){const oe=s.readBits(1);q===0&&(u=oe)}if(j&&s.readBits(1)){const re=f+1;s.skipBits(re),s.skipBits(re),s.skipBits(1)}s.readBits(1)&&s.skipBits(4)}}const m=s.readBits(4),g=s.readBits(4),y=m+1;s.skipBits(y);const w=g+1;s.skipBits(w);let T=0;if(l?T=0:T=s.readBits(1),T&&(s.skipBits(4),s.skipBits(3)),s.skipBits(1),s.skipBits(1),s.skipBits(1),!l){s.skipBits(1),s.skipBits(1),s.skipBits(1),s.skipBits(1);const B=s.readBits(1);B&&(s.skipBits(1),s.skipBits(1));const j=s.readBits(1);let L=0;j?L=2:L=s.readBits(1),L>0&&(s.readBits(1)||s.skipBits(1)),B&&s.skipBits(3)}s.skipBits(1),s.skipBits(1),s.skipBits(1);const S=s.readBits(1);let v=8;a===2&&S?v=s.readBits(1)?12:10:a<=2&&(v=S?10:8);let x=0;a!==1&&(x=s.readBits(1));let _=1,A=1,O=0;return x||(a===0?(_=1,A=1):a===1?(_=0,A=0):v===12&&(_=s.readBits(1),_&&(A=s.readBits(1))),_&&A&&(O=s.readBits(2))),{profile:a,level:c,tier:u,bitDepth:v,monochrome:x,chromaSubsamplingX:_,chromaSubsamplingY:A,chromaSamplePosition:O}}return null},Qd=n=>{const e=tt(n),r=e.getUint8(9),s=e.getUint16(10,!0),a=e.getUint32(12,!0),l=e.getInt16(16,!0),c=e.getUint8(18);let u=null;return c&&(u=n.subarray(19,21+r)),{outputChannelCount:r,preSkip:s,inputSampleRate:a,outputGain:l,channelMappingFamily:c,channelMappingTable:u}},Nw=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960],Rw=n=>{const e=n[0]>>3;return{durationInSamples:Nw[e]}},zw=n=>{if(n.length<7)throw new Error("Setup header is too short.");if(n[0]!==5)throw new Error("Wrong packet type in Setup header.");if(String.fromCharCode(...n.slice(1,7))!=="vorbis")throw new Error("Invalid packet signature in Setup header.");const r=n.length,s=new Uint8Array(r);for(let y=0;y<r;y++)s[y]=n[r-1-y];const a=new Ye(s);let l=0;for(;a.getBitsLeft()>97;)if(a.readBits(1)===1){l=a.pos;break}if(l===0)throw new Error("Invalid Setup header: framing bit not found.");let c=0,u=!1,f=0;for(;a.getBitsLeft()>=97;){const y=a.pos,w=a.readBits(8),T=a.readBits(16),S=a.readBits(16);if(w>63||T!==0||S!==0){a.pos=y;break}if(a.skipBits(1),c++,c>64)break;a.clone().readBits(6)+1===c&&(u=!0,f=c)}if(!u)throw new Error("Invalid Setup header: mode header not found.");if(f>63)throw new Error(`Unsupported mode count: ${f}.`);const m=f;a.pos=0,a.skipBits(l);const g=Array(m).fill(0);for(let y=m-1;y>=0;y--)a.skipBits(40),g[y]=a.readBits(1);return{modeBlockflags:g}},ag=(n,e,r)=>{switch(n){case"avc":{const s=Zp(r,e);let a=s.some(l=>Ks(l)===$i.IDR);if(!a&&(!md()||sw()>=144))for(const l of s){if(Ks(l)!==$i.SEI)continue;const u=Ll(l);let f=1;do{let m=0;for(;;){const w=u[f++];if(w===void 0||(m+=w,w<255))break}let g=0;for(;;){const w=u[f++];if(w===void 0||(g+=w,w<255))break}if(m===6){const w=new Ye(u);w.pos=8*f;const T=ae(w),S=w.readBits(1);if(T===0&&S===1){a=!0;break}}f+=g}while(f<u.length-1)}return a?"key":"delta"}case"hevc":return tg(r,e).some(l=>{const c=ti(l);return Vt.BLA_W_LP<=c&&c<=Vt.RSV_IRAP_VCL23})?"key":"delta";case"vp8":return(r[0]&1)===0?"key":"delta";case"vp9":{const s=new Ye(r);if(s.readBits(2)!==2)return null;const a=s.readBits(1);return(s.readBits(1)<<1)+a===3&&s.skipBits(1),s.readBits(1)?null:s.readBits(1)===0?"key":"delta"}case"av1":{let s=!1;for(const{type:a,data:l}of ig(r))if(a===1){const c=new Ye(l);c.skipBits(4),s=!!c.readBits(1)}else if(a===3||a===6||a===7){if(s)return"key";const c=new Ye(l);return c.readBits(1)?null:c.readBits(2)===0?"key":"delta"}return null}default:Mn(n),b(!1)}};var Gs;(function(n){n[n.STREAMINFO=0]="STREAMINFO",n[n.VORBIS_COMMENT=4]="VORBIS_COMMENT",n[n.PICTURE=6]="PICTURE"})(Gs||(Gs={}));const gd=(n,e)=>{const r=tt(n);let s=0;const a=r.getUint32(s,!0);s+=4;const l=mn.decode(n.subarray(s,s+a));s+=a,a>0&&(e.raw??={},e.raw.vendor??=l);const c=r.getUint32(s,!0);s+=4;for(let u=0;u<c;u++){const f=r.getUint32(s,!0);s+=4;const m=mn.decode(n.subarray(s,s+f));s+=f;const g=m.indexOf("=");if(g===-1)continue;const y=m.slice(0,g).toUpperCase(),w=m.slice(g+1);switch(e.raw??={},e.raw[y]??=w,y){case"TITLE":e.title??=w;break;case"DESCRIPTION":e.description??=w;break;case"ARTIST":e.artist??=w;break;case"ALBUM":e.album??=w;break;case"ALBUMARTIST":e.albumArtist??=w;break;case"COMMENT":e.comment??=w;break;case"LYRICS":e.lyrics??=w;break;case"TRACKNUMBER":{const T=w.split("/"),S=Number.parseInt(T[0],10),v=T[1]&&Number.parseInt(T[1],10);Number.isInteger(S)&&S>0&&(e.trackNumber??=S),v&&Number.isInteger(v)&&v>0&&(e.tracksTotal??=v)}break;case"TRACKTOTAL":{const T=Number.parseInt(w,10);Number.isInteger(T)&&T>0&&(e.tracksTotal??=T)}break;case"DISCNUMBER":{const T=w.split("/"),S=Number.parseInt(T[0],10),v=T[1]&&Number.parseInt(T[1],10);Number.isInteger(S)&&S>0&&(e.discNumber??=S),v&&Number.isInteger(v)&&v>0&&(e.discsTotal??=v)}break;case"DISCTOTAL":{const T=Number.parseInt(w,10);Number.isInteger(T)&&T>0&&(e.discsTotal??=T)}break;case"DATE":{const T=new Date(w);Number.isNaN(T.getTime())||(e.date??=T)}break;case"GENRE":e.genre??=w;break;case"METADATA_BLOCK_PICTURE":{const T=ow(w),S=tt(T),v=S.getUint32(0,!1),x=S.getUint32(4,!1),_=String.fromCharCode(...T.subarray(8,8+x)),A=S.getUint32(8+x,!1),O=mn.decode(T.subarray(12+x,12+x+A)),B=S.getUint32(x+A+28),j=T.subarray(x+A+32,x+A+32+B);e.images??=[],e.images.push({data:j,mimeType:_,kind:v===3?"coverFront":v===4?"coverBack":"unknown",name:void 0,description:O||void 0})}break}}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Ki{constructor(e){this.input=e}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const og=[],lg=[],yd=[],wd=[];/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const gn=new Uint8Array(0);class qe{constructor(e,r,s,a,l=-1,c,u){if(this.data=e,this.type=r,this.timestamp=s,this.duration=a,this.sequenceNumber=l,e===gn&&c===void 0)throw new Error("Internal error: byteLength must be explicitly provided when constructing metadata-only packets.");if(c===void 0&&(c=e.byteLength),!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(r!=="key"&&r!=="delta")throw new TypeError('type must be either "key" or "delta".');if(!Number.isFinite(s))throw new TypeError("timestamp must be a number.");if(!Number.isFinite(a)||a<0)throw new TypeError("duration must be a non-negative number.");if(!Number.isFinite(l))throw new TypeError("sequenceNumber must be a number.");if(!Number.isInteger(c)||c<0)throw new TypeError("byteLength must be a non-negative integer.");if(u!==void 0&&(typeof u!="object"||!u))throw new TypeError("sideData, when provided, must be an object.");if(u?.alpha!==void 0&&!(u.alpha instanceof Uint8Array))throw new TypeError("sideData.alpha, when provided, must be a Uint8Array.");if(u?.alphaByteLength!==void 0&&(!Number.isInteger(u.alphaByteLength)||u.alphaByteLength<0))throw new TypeError("sideData.alphaByteLength, when provided, must be a non-negative integer.");this.byteLength=c,this.sideData=u??{},this.sideData.alpha&&this.sideData.alphaByteLength===void 0&&(this.sideData.alphaByteLength=this.sideData.alpha.byteLength)}get isMetadataOnly(){return this.data===gn}get microsecondTimestamp(){return Math.trunc(ii*this.timestamp)}get microsecondDuration(){return Math.trunc(ii*this.duration)}toEncodedVideoChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if(typeof EncodedVideoChunk>"u")throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}alphaToEncodedVideoChunk(e=this.type){if(!this.sideData.alpha)throw new TypeError("This packet does not contain alpha side data.");if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if(typeof EncodedVideoChunk>"u")throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.sideData.alpha,type:e,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}toEncodedAudioChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to an audio chunk.");if(typeof EncodedAudioChunk>"u")throw new Error("Your browser does not support EncodedAudioChunk.");return new EncodedAudioChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}static fromEncodedChunk(e,r){if(!(e instanceof EncodedVideoChunk||e instanceof EncodedAudioChunk))throw new TypeError("chunk must be an EncodedVideoChunk or EncodedAudioChunk.");const s=new Uint8Array(e.byteLength);return e.copyTo(s),new qe(s,e.type,e.timestamp/1e6,(e.duration??0)/1e6,void 0,void 0,r)}clone(e){if(e!==void 0&&(typeof e!="object"||e===null))throw new TypeError("options, when provided, must be an object.");if(e?.timestamp!==void 0&&!Number.isFinite(e.timestamp))throw new TypeError("options.timestamp, when provided, must be a number.");if(e?.duration!==void 0&&!Number.isFinite(e.duration))throw new TypeError("options.duration, when provided, must be a number.");return new qe(this.data,this.type,e?.timestamp??this.timestamp,e?.duration??this.duration,this.sequenceNumber,this.byteLength)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Bw=n=>{let s=n,a=4096,l=0,c=12,u=0;for(s<0&&(s=-s,l=128),s+=33,s>8191&&(s=8191);(s&a)!==a&&c>=5;)a>>=1,c--;return u=s>>c-4&15,~(l|c-5<<4|u)&255},Dw=n=>{let r=0,s=0,a=~n;a&128&&(a&=-129,r=-1),s=((a&240)>>4)+5;const l=(1<<s|(a&15)<<s-4|1<<s-5)-33;return r===0?l:-l},Ow=n=>{let r=2048,s=0,a=11,l=0,c=n;for(c<0&&(c=-c,s=128),c>4095&&(c=4095);(c&r)!==r&&a>=5;)r>>=1,a--;return l=c>>(a===4?1:a-4)&15,(s|a-4<<4|l)^85},Uw=n=>{let e=0,r=0,s=n^85;s&128&&(s&=-129,e=-1),r=((s&240)>>4)+4;let a=0;return r!==4?a=1<<r|(s&15)<<r-4|1<<r-5:a=s<<1|1,e===0?a:-a};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */Up();let Um=-1/0,Lm=-1/0,mo=null;typeof FinalizationRegistry<"u"&&(mo=new FinalizationRegistry(n=>{const e=Date.now();n.type==="video"?(e-Um>=1e3&&(console.error("A VideoSample was garbage collected without first being closed. For proper resource management, make sure to call close() on all your VideoSamples as soon as you're done using them."),Um=e),typeof VideoFrame<"u"&&n.data instanceof VideoFrame&&n.data.close()):(e-Lm>=1e3&&(console.error("An AudioSample was garbage collected without first being closed. For proper resource management, make sure to call close() on all your AudioSamples as soon as you're done using them."),Lm=e),typeof AudioData<"u"&&n.data instanceof AudioData&&n.data.close())}));const cg=["I420","I420P10","I420P12","I420A","I420AP10","I420AP12","I422","I422P10","I422P12","I422A","I422AP10","I422AP12","I444","I444P10","I444P12","I444A","I444AP10","I444AP12","NV12","RGBA","RGBX","BGRA","BGRX"],Lw=new Set(cg);class _t{get displayWidth(){return this.rotation%180===0?this.codedWidth:this.codedHeight}get displayHeight(){return this.rotation%180===0?this.codedHeight:this.codedWidth}get microsecondTimestamp(){return Math.trunc(ii*this.timestamp)}get microsecondDuration(){return Math.trunc(ii*this.duration)}get hasAlpha(){return this.format&&this.format.includes("A")}constructor(e,r){if(this._closed=!1,e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer||ArrayBuffer.isView(e)){if(!r||typeof r!="object")throw new TypeError("init must be an object.");if(r.format===void 0||!Lw.has(r.format))throw new TypeError("init.format must be one of: "+cg.join(", "));if(!Number.isInteger(r.codedWidth)||r.codedWidth<=0)throw new TypeError("init.codedWidth must be a positive integer.");if(!Number.isInteger(r.codedHeight)||r.codedHeight<=0)throw new TypeError("init.codedHeight must be a positive integer.");if(r.rotation!==void 0&&![0,90,180,270].includes(r.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(r.timestamp))throw new TypeError("init.timestamp must be a number.");if(r.duration!==void 0&&(!Number.isFinite(r.duration)||r.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=It(e).slice(),this._layout=r.layout??jw(r.format,r.codedWidth,r.codedHeight),this.format=r.format,this.codedWidth=r.codedWidth,this.codedHeight=r.codedHeight,this.rotation=r.rotation??0,this.timestamp=r.timestamp,this.duration=r.duration??0,this.colorSpace=new qu(r.colorSpace)}else if(typeof VideoFrame<"u"&&e instanceof VideoFrame){if(r?.rotation!==void 0&&![0,90,180,270].includes(r.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(r?.timestamp!==void 0&&!Number.isFinite(r?.timestamp))throw new TypeError("init.timestamp, when provided, must be a number.");if(r?.duration!==void 0&&(!Number.isFinite(r.duration)||r.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=e,this._layout=null,this.format=e.format,this.codedWidth=e.displayWidth,this.codedHeight=e.displayHeight,this.rotation=r?.rotation??0,this.timestamp=r?.timestamp??e.timestamp/1e6,this.duration=r?.duration??(e.duration??0)/1e6,this.colorSpace=new qu(e.colorSpace)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof SVGImageElement<"u"&&e instanceof SVGImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas){if(!r||typeof r!="object")throw new TypeError("init must be an object.");if(r.rotation!==void 0&&![0,90,180,270].includes(r.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(r.timestamp))throw new TypeError("init.timestamp must be a number.");if(r.duration!==void 0&&(!Number.isFinite(r.duration)||r.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");if(typeof VideoFrame<"u")return new _t(new VideoFrame(e,{timestamp:Math.trunc(r.timestamp*ii),duration:Math.trunc((r.duration??0)*ii)||void 0}),r);let s=0,a=0;if("naturalWidth"in e?(s=e.naturalWidth,a=e.naturalHeight):"videoWidth"in e?(s=e.videoWidth,a=e.videoHeight):"width"in e&&(s=Number(e.width),a=Number(e.height)),!s||!a)throw new TypeError("Could not determine dimensions.");const l=new OffscreenCanvas(s,a),c=l.getContext("2d",{alpha:Js(),willReadFrequently:!0});b(c),c.drawImage(e,0,0),this._data=l,this._layout=null,this.format="RGBX",this.codedWidth=s,this.codedHeight=a,this.rotation=r.rotation??0,this.timestamp=r.timestamp,this.duration=r.duration??0,this.colorSpace=new qu({matrix:"rgb",primaries:"bt709",transfer:"iec61966-2-1",fullRange:!0})}else throw new TypeError("Invalid data type: Must be a BufferSource or CanvasImageSource.");mo?.register(this,{type:"video",data:this._data},this)}clone(){if(this._closed)throw new Error("VideoSample is closed.");return b(this._data!==null),Oi(this._data)?new _t(this._data.clone(),{timestamp:this.timestamp,duration:this.duration,rotation:this.rotation}):this._data instanceof Uint8Array?(b(this._layout),new _t(this._data,{format:this.format,layout:this._layout,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})):new _t(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})}close(){this._closed||(mo?.unregister(this),Oi(this._data)?this._data.close():this._data=null,this._closed=!0)}allocationSize(e={}){if(jm(e),this._closed)throw new Error("VideoSample is closed.");if((e.format??this.format)===null)throw new Error("Cannot get allocation size when format is null. Please manually provide an RGB pixel format in the options instead.");if(b(this._data!==null),!Oi(this._data)&&(e.colorSpace||e.format&&e.format!==this.format||e.layout||e.rect)){const r=this.toVideoFrame(),s=r.allocationSize(e);return r.close(),s}return Oi(this._data)?this._data.allocationSize(e):this._data instanceof Uint8Array?this._data.byteLength:this.codedWidth*this.codedHeight*4}async copyTo(e,r={}){if(!Xl(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(jm(r),this._closed)throw new Error("VideoSample is closed.");if((r.format??this.format)===null)throw new Error("Cannot copy video sample data when format is null. Please manually provide an RGB pixel format in the options instead.");if(b(this._data!==null),!Oi(this._data)&&(r.colorSpace||r.format&&r.format!==this.format||r.layout||r.rect)){const s=this.toVideoFrame(),a=await s.copyTo(e,r);return s.close(),a}if(Oi(this._data))return this._data.copyTo(e,r);if(this._data instanceof Uint8Array)return b(this._layout),It(e).set(this._data),this._layout;{const a=this._data.getContext("2d");b(a);const l=a.getImageData(0,0,this.codedWidth,this.codedHeight);return It(e).set(l.data),[{offset:0,stride:4*this.codedWidth}]}}toVideoFrame(){if(this._closed)throw new Error("VideoSample is closed.");return b(this._data!==null),Oi(this._data)?new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0}):this._data instanceof Uint8Array?new VideoFrame(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0,colorSpace:this.colorSpace}):new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0})}draw(e,r,s,a,l,c,u,f,m){let g=0,y=0,w=this.displayWidth,T=this.displayHeight,S=0,v=0,x=this.displayWidth,_=this.displayHeight;if(c!==void 0?(g=r,y=s,w=a,T=l,S=c,v=u,f!==void 0?(x=f,_=m):(x=w,_=T)):(S=r,v=s,a!==void 0&&(x=a,_=l)),!(typeof CanvasRenderingContext2D<"u"&&e instanceof CanvasRenderingContext2D||typeof OffscreenCanvasRenderingContext2D<"u"&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!Number.isFinite(g))throw new TypeError("sx must be a number.");if(!Number.isFinite(y))throw new TypeError("sy must be a number.");if(!Number.isFinite(w)||w<0)throw new TypeError("sWidth must be a non-negative number.");if(!Number.isFinite(T)||T<0)throw new TypeError("sHeight must be a non-negative number.");if(!Number.isFinite(S))throw new TypeError("dx must be a number.");if(!Number.isFinite(v))throw new TypeError("dy must be a number.");if(!Number.isFinite(x)||x<0)throw new TypeError("dWidth must be a non-negative number.");if(!Number.isFinite(_)||_<0)throw new TypeError("dHeight must be a non-negative number.");if(this._closed)throw new Error("VideoSample is closed.");({sx:g,sy:y,sWidth:w,sHeight:T}=this._rotateSourceRegion(g,y,w,T,this.rotation));const A=this.toCanvasImageSource();e.save();const O=S+x/2,B=v+_/2;e.translate(O,B),e.rotate(this.rotation*Math.PI/180);const j=this.rotation%180===0?1:x/_;e.scale(1/j,j),e.drawImage(A,g,y,w,T,-x/2,-_/2,x,_),e.restore()}drawWithFit(e,r){if(!(typeof CanvasRenderingContext2D<"u"&&e instanceof CanvasRenderingContext2D||typeof OffscreenCanvasRenderingContext2D<"u"&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!r||typeof r!="object")throw new TypeError("options must be an object.");if(!["fill","contain","cover"].includes(r.fit))throw new TypeError("options.fit must be 'fill', 'contain', or 'cover'.");if(r.rotation!==void 0&&![0,90,180,270].includes(r.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180, or 270.");r.crop!==void 0&&Kd(r.crop,"options.");const s=e.canvas.width,a=e.canvas.height,l=r.rotation??this.rotation,[c,u]=l%180===0?[this.codedWidth,this.codedHeight]:[this.codedHeight,this.codedWidth];r.crop&&qd(r.crop,c,u);let f,m,g,y;const{sx:w,sy:T,sWidth:S,sHeight:v}=this._rotateSourceRegion(r.crop?.left??0,r.crop?.top??0,r.crop?.width??c,r.crop?.height??u,l);if(r.fit==="fill")f=0,m=0,g=s,y=a;else{const[_,A]=r.crop?[r.crop.width,r.crop.height]:[c,u],O=r.fit==="contain"?Math.min(s/_,a/A):Math.max(s/_,a/A);g=_*O,y=A*O,f=(s-g)/2,m=(a-y)/2}e.save();const x=l%180===0?1:g/y;e.translate(s/2,a/2),e.rotate(l*Math.PI/180),e.scale(1/x,x),e.translate(-s/2,-a/2),e.drawImage(this.toCanvasImageSource(),w,T,S,v,f,m,g,y),e.restore()}_rotateSourceRegion(e,r,s,a,l){return l===90?[e,r,s,a]=[r,this.codedHeight-e-s,a,s]:l===180?[e,r]=[this.codedWidth-e-s,this.codedHeight-r-a]:l===270&&([e,r,s,a]=[this.codedWidth-r-a,e,a,s]),{sx:e,sy:r,sWidth:s,sHeight:a}}toCanvasImageSource(){if(this._closed)throw new Error("VideoSample is closed.");if(b(this._data!==null),this._data instanceof Uint8Array){const e=this.toVideoFrame();return queueMicrotask(()=>e.close()),e}else return this._data}setRotation(e){if(![0,90,180,270].includes(e))throw new TypeError("newRotation must be 0, 90, 180, or 270.");this.rotation=e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}setDuration(e){if(!Number.isFinite(e)||e<0)throw new TypeError("newDuration must be a non-negative number.");this.duration=e}[Symbol.dispose](){this.close()}}class qu{constructor(e){this.primaries=e?.primaries??null,this.transfer=e?.transfer??null,this.matrix=e?.matrix??null,this.fullRange=e?.fullRange??null}toJSON(){return{primaries:this.primaries,transfer:this.transfer,matrix:this.matrix,fullRange:this.fullRange}}}const Oi=n=>typeof VideoFrame<"u"&&n instanceof VideoFrame,qd=(n,e,r)=>{n.left=Math.min(n.left,e),n.top=Math.min(n.top,r),n.width=Math.min(n.width,e-n.left),n.height=Math.min(n.height,r-n.top),b(n.width>=0),b(n.height>=0)},Kd=(n,e)=>{if(!n||typeof n!="object")throw new TypeError(e+"crop, when provided, must be an object.");if(!Number.isInteger(n.left)||n.left<0)throw new TypeError(e+"crop.left must be a non-negative integer.");if(!Number.isInteger(n.top)||n.top<0)throw new TypeError(e+"crop.top must be a non-negative integer.");if(!Number.isInteger(n.width)||n.width<0)throw new TypeError(e+"crop.width must be a non-negative integer.");if(!Number.isInteger(n.height)||n.height<0)throw new TypeError(e+"crop.height must be a non-negative integer.")},jm=n=>{if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(n.colorSpace!==void 0&&!["display-p3","srgb"].includes(n.colorSpace))throw new TypeError("options.colorSpace, when provided, must be 'display-p3' or 'srgb'.");if(n.format!==void 0&&typeof n.format!="string")throw new TypeError("options.format, when provided, must be a string.");if(n.layout!==void 0){if(!Array.isArray(n.layout))throw new TypeError("options.layout, when provided, must be an array.");for(const e of n.layout){if(!e||typeof e!="object")throw new TypeError("Each entry in options.layout must be an object.");if(!Number.isInteger(e.offset)||e.offset<0)throw new TypeError("plane.offset must be a non-negative integer.");if(!Number.isInteger(e.stride)||e.stride<0)throw new TypeError("plane.stride must be a non-negative integer.")}}if(n.rect!==void 0){if(!n.rect||typeof n.rect!="object")throw new TypeError("options.rect, when provided, must be an object.");if(n.rect.x!==void 0&&(!Number.isInteger(n.rect.x)||n.rect.x<0))throw new TypeError("options.rect.x, when provided, must be a non-negative integer.");if(n.rect.y!==void 0&&(!Number.isInteger(n.rect.y)||n.rect.y<0))throw new TypeError("options.rect.y, when provided, must be a non-negative integer.");if(n.rect.width!==void 0&&(!Number.isInteger(n.rect.width)||n.rect.width<0))throw new TypeError("options.rect.width, when provided, must be a non-negative integer.");if(n.rect.height!==void 0&&(!Number.isInteger(n.rect.height)||n.rect.height<0))throw new TypeError("options.rect.height, when provided, must be a non-negative integer.")}},jw=(n,e,r)=>{const s=Vw(n),a=[];let l=0;for(const c of s){const u=Math.ceil(e/c.widthDivisor),f=Math.ceil(r/c.heightDivisor),m=u*c.sampleBytes,g=m*f;a.push({offset:l,stride:m}),l+=g}return a},Vw=n=>{const e=(r,s,a,l,c)=>{const u=[{sampleBytes:r,widthDivisor:1,heightDivisor:1},{sampleBytes:s,widthDivisor:a,heightDivisor:l},{sampleBytes:s,widthDivisor:a,heightDivisor:l}];return c&&u.push({sampleBytes:r,widthDivisor:1,heightDivisor:1}),u};switch(n){case"I420":return e(1,1,2,2,!1);case"I420P10":case"I420P12":return e(2,2,2,2,!1);case"I420A":return e(1,1,2,2,!0);case"I420AP10":case"I420AP12":return e(2,2,2,2,!0);case"I422":return e(1,1,2,1,!1);case"I422P10":case"I422P12":return e(2,2,2,1,!1);case"I422A":return e(1,1,2,1,!0);case"I422AP10":case"I422AP12":return e(2,2,2,1,!0);case"I444":return e(1,1,1,1,!1);case"I444P10":case"I444P12":return e(2,2,1,1,!1);case"I444A":return e(1,1,1,1,!0);case"I444AP10":case"I444AP12":return e(2,2,1,1,!0);case"NV12":return[{sampleBytes:1,widthDivisor:1,heightDivisor:1},{sampleBytes:2,widthDivisor:2,heightDivisor:2}];case"RGBA":case"RGBX":case"BGRA":case"BGRX":return[{sampleBytes:4,widthDivisor:1,heightDivisor:1}];default:Mn(n),b(!1)}},Ku=new Set(["f32","f32-planar","s16","s16-planar","s32","s32-planar","u8","u8-planar"]);class hn{get microsecondTimestamp(){return Math.trunc(ii*this.timestamp)}get microsecondDuration(){return Math.trunc(ii*this.duration)}constructor(e){if(this._closed=!1,to(e)){if(e.format===null)throw new TypeError("AudioData with null format is not supported.");this._data=e,this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=e.numberOfFrames,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp/1e6,this.duration=e.numberOfFrames/e.sampleRate}else{if(!e||typeof e!="object")throw new TypeError("Invalid AudioDataInit: must be an object.");if(!Ku.has(e.format))throw new TypeError("Invalid AudioDataInit: invalid format.");if(!Number.isFinite(e.sampleRate)||e.sampleRate<=0)throw new TypeError("Invalid AudioDataInit: sampleRate must be > 0.");if(!Number.isInteger(e.numberOfChannels)||e.numberOfChannels===0)throw new TypeError("Invalid AudioDataInit: numberOfChannels must be an integer > 0.");if(!Number.isFinite(e?.timestamp))throw new TypeError("init.timestamp must be a number.");const r=e.data.byteLength/(ji(e.format)*e.numberOfChannels);if(!Number.isInteger(r))throw new TypeError("Invalid AudioDataInit: data size is not a multiple of frame size.");this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=r,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp,this.duration=r/e.sampleRate;let s;if(e.data instanceof ArrayBuffer)s=new Uint8Array(e.data);else if(ArrayBuffer.isView(e.data))s=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength);else throw new TypeError("Invalid AudioDataInit: data is not a BufferSource.");const a=this.numberOfFrames*this.numberOfChannels*ji(this.format);if(s.byteLength<a)throw new TypeError("Invalid AudioDataInit: insufficient data size.");this._data=s}mo?.register(this,{type:"audio",data:this._data},this)}allocationSize(e){if(!e||typeof e!="object")throw new TypeError("options must be an object.");if(!Number.isInteger(e.planeIndex)||e.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(e.format!==void 0&&!Ku.has(e.format))throw new TypeError("Invalid format.");if(e.frameOffset!==void 0&&(!Number.isInteger(e.frameOffset)||e.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(e.frameCount!==void 0&&(!Number.isInteger(e.frameCount)||e.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const r=e.format??this.format,s=e.frameOffset??0;if(s>=this.numberOfFrames)throw new RangeError("frameOffset out of range");const a=e.frameCount!==void 0?e.frameCount:this.numberOfFrames-s;if(a>this.numberOfFrames-s)throw new RangeError("frameCount out of range");const l=ji(r),c=js(r);if(c&&e.planeIndex>=this.numberOfChannels)throw new RangeError("planeIndex out of range");if(!c&&e.planeIndex!==0)throw new RangeError("planeIndex out of range");return(c?a:a*this.numberOfChannels)*l}copyTo(e,r){if(!Xl(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(!r||typeof r!="object")throw new TypeError("options must be an object.");if(!Number.isInteger(r.planeIndex)||r.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(r.format!==void 0&&!Ku.has(r.format))throw new TypeError("Invalid format.");if(r.frameOffset!==void 0&&(!Number.isInteger(r.frameOffset)||r.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(r.frameCount!==void 0&&(!Number.isInteger(r.frameCount)||r.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const{planeIndex:s,format:a,frameCount:l,frameOffset:c}=r,u=this.format,f=a??this.format;if(!f)throw new Error("Destination format not determined");const m=this.numberOfFrames,g=this.numberOfChannels,y=c??0;if(y>=m)throw new RangeError("frameOffset out of range");const w=l!==void 0?l:m-y;if(w>m-y)throw new RangeError("frameCount out of range");const T=ji(f),S=js(f);if(S&&s>=g)throw new RangeError("planeIndex out of range");if(!S&&s!==0)throw new RangeError("planeIndex out of range");const x=(S?w:w*g)*T;if(e.byteLength<x)throw new RangeError("Destination buffer is too small");const _=tt(e),A=dg(f);if(to(this._data))lo()&&g>2&&f!==u?Ww(this._data,_,u,f,g,s,y,w):this._data.copyTo(e,{planeIndex:s,frameOffset:y,frameCount:w,format:f});else{const O=this._data,B=tt(O),j=ug(u),L=ji(u),q=js(u);for(let G=0;G<w;G++)if(S){const se=G*T;let oe;q?oe=(s*m+(G+y))*L:oe=((G+y)*g+s)*L;const re=j(B,oe);A(_,se,re)}else for(let se=0;se<g;se++){const re=(G*g+se)*T;let ne;q?ne=(se*m+(G+y))*L:ne=((G+y)*g+se)*L;const he=j(B,ne);A(_,re,he)}}}clone(){if(this._closed)throw new Error("AudioSample is closed.");if(to(this._data)){const e=new hn(this._data.clone());return e.setTimestamp(this.timestamp),e}else return new hn({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.timestamp,data:this._data})}close(){this._closed||(mo?.unregister(this),to(this._data)?this._data.close():this._data=new Uint8Array(0),this._closed=!0)}toAudioData(){if(this._closed)throw new Error("AudioSample is closed.");if(to(this._data)){if(this._data.timestamp===this.microsecondTimestamp)return this._data.clone();if(js(this.format)){const e=this.allocationSize({planeIndex:0,format:this.format}),r=new ArrayBuffer(e*this.numberOfChannels);for(let s=0;s<this.numberOfChannels;s++)this.copyTo(new Uint8Array(r,s*e,e),{planeIndex:s,format:this.format});return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:r})}else{const e=new ArrayBuffer(this.allocationSize({planeIndex:0,format:this.format}));return this.copyTo(e,{planeIndex:0,format:this.format}),new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:e})}}else return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:this._data.buffer instanceof ArrayBuffer?this._data.buffer:this._data.slice()})}toAudioBuffer(){if(this._closed)throw new Error("AudioSample is closed.");const e=new AudioBuffer({numberOfChannels:this.numberOfChannels,length:this.numberOfFrames,sampleRate:this.sampleRate}),r=new Float32Array(this.allocationSize({planeIndex:0,format:"f32-planar"})/4);for(let s=0;s<this.numberOfChannels;s++)this.copyTo(r,{planeIndex:s,format:"f32-planar"}),e.copyToChannel(r,s);return e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}[Symbol.dispose](){this.close()}static*_fromAudioBuffer(e,r){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const s=48e3*5,a=e.numberOfChannels,l=e.sampleRate,c=e.length,u=Math.floor(s/a);let f=0,m=c;for(;m>0;){const g=Math.min(u,m),y=new Float32Array(a*g);for(let w=0;w<a;w++)e.copyFromChannel(y.subarray(w*g,(w+1)*g),w,f);yield new hn({format:"f32-planar",sampleRate:l,numberOfFrames:g,numberOfChannels:a,timestamp:r+f/l,data:y}),f+=g,m-=g}}static fromAudioBuffer(e,r){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const s=48e3*5,a=e.numberOfChannels,l=e.sampleRate,c=e.length,u=Math.floor(s/a);let f=0,m=c;const g=[];for(;m>0;){const y=Math.min(u,m),w=new Float32Array(a*y);for(let S=0;S<a;S++)e.copyFromChannel(w.subarray(S*y,(S+1)*y),S,f);const T=new hn({format:"f32-planar",sampleRate:l,numberOfFrames:y,numberOfChannels:a,timestamp:r+f/l,data:w});g.push(T),f+=y,m-=y}return g}}const ji=n=>{switch(n){case"u8":case"u8-planar":return 1;case"s16":case"s16-planar":return 2;case"s32":case"s32-planar":return 4;case"f32":case"f32-planar":return 4;default:throw new Error("Unknown AudioSampleFormat")}},js=n=>{switch(n){case"u8-planar":case"s16-planar":case"s32-planar":case"f32-planar":return!0;default:return!1}},ug=n=>{switch(n){case"u8":case"u8-planar":return(e,r)=>(e.getUint8(r)-128)/128;case"s16":case"s16-planar":return(e,r)=>e.getInt16(r,!0)/32768;case"s32":case"s32-planar":return(e,r)=>e.getInt32(r,!0)/2147483648;case"f32":case"f32-planar":return(e,r)=>e.getFloat32(r,!0)}},dg=n=>{switch(n){case"u8":case"u8-planar":return(e,r,s)=>e.setUint8(r,yt((s+1)*127.5,0,255));case"s16":case"s16-planar":return(e,r,s)=>e.setInt16(r,yt(Math.round(s*32767),-32768,32767),!0);case"s32":case"s32-planar":return(e,r,s)=>e.setInt32(r,yt(Math.round(s*2147483647),-2147483648,2147483647),!0);case"f32":case"f32-planar":return(e,r,s)=>e.setFloat32(r,s,!0)}},to=n=>typeof AudioData<"u"&&n instanceof AudioData,Ww=(n,e,r,s,a,l,c,u)=>{const f=ug(r),m=dg(s),g=ji(r),y=ji(s),w=js(r);if(js(s))if(w){const S=new ArrayBuffer(u*g),v=tt(S);n.copyTo(S,{planeIndex:l,frameOffset:c,frameCount:u,format:r});for(let x=0;x<u;x++){const _=x*g,A=x*y,O=f(v,_);m(e,A,O)}}else{const S=new ArrayBuffer(u*a*g),v=tt(S);n.copyTo(S,{planeIndex:0,frameOffset:c,frameCount:u,format:r});for(let x=0;x<u;x++){const _=(x*a+l)*g,A=x*y,O=f(v,_);m(e,A,O)}}else if(w){const S=u*g,v=new ArrayBuffer(S),x=tt(v);for(let _=0;_<a;_++){n.copyTo(v,{planeIndex:_,frameOffset:c,frameCount:u,format:r});for(let A=0;A<u;A++){const O=A*g,B=(A*a+_)*y,j=f(x,O);m(e,B,j)}}}else{const S=new ArrayBuffer(u*a*g),v=tt(S);n.copyTo(S,{planeIndex:0,frameOffset:c,frameCount:u,format:r});for(let x=0;x<u;x++)for(let _=0;_<a;_++){const A=x*a+_,O=A*g,B=A*y,j=f(v,O);m(e,B,j)}}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const zs=n=>{if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(n.metadataOnly!==void 0&&typeof n.metadataOnly!="boolean")throw new TypeError("options.metadataOnly, when defined, must be a boolean.");if(n.verifyKeyPackets!==void 0&&typeof n.verifyKeyPackets!="boolean")throw new TypeError("options.verifyKeyPackets, when defined, must be a boolean.");if(n.verifyKeyPackets&&n.metadataOnly)throw new TypeError("options.verifyKeyPackets and options.metadataOnly cannot be enabled together.")},oi=n=>{if(!Lp(n))throw new TypeError("timestamp must be a number.")},Gu=(n,e,r)=>r.verifyKeyPackets?e.then(async s=>{if(!s||s.type==="delta")return s;const a=await n.determinePacketType(s);return a&&(s.type=a),s}):e;class po{constructor(e){if(!(e instanceof Xd))throw new TypeError("track must be an InputTrack.");this._track=e}getFirstPacket(e={}){if(zs(e),this._track.input._disposed)throw new Zt;return Gu(this._track,this._track._backing.getFirstPacket(e),e)}getPacket(e,r={}){if(oi(e),zs(r),this._track.input._disposed)throw new Zt;return Gu(this._track,this._track._backing.getPacket(e,r),r)}getNextPacket(e,r={}){if(!(e instanceof qe))throw new TypeError("packet must be an EncodedPacket.");if(zs(r),this._track.input._disposed)throw new Zt;return Gu(this._track,this._track._backing.getNextPacket(e,r),r)}async getKeyPacket(e,r={}){if(oi(e),zs(r),this._track.input._disposed)throw new Zt;if(!r.verifyKeyPackets)return this._track._backing.getKeyPacket(e,r);const s=await this._track._backing.getKeyPacket(e,r);return s&&(b(s.type==="key"),await this._track.determinePacketType(s)==="delta"?this.getKeyPacket(s.timestamp-1/this._track.timeResolution,r):s)}async getNextKeyPacket(e,r={}){if(!(e instanceof qe))throw new TypeError("packet must be an EncodedPacket.");if(zs(r),this._track.input._disposed)throw new Zt;if(!r.verifyKeyPackets)return this._track._backing.getNextKeyPacket(e,r);const s=await this._track._backing.getNextKeyPacket(e,r);return s&&(b(s.type==="key"),await this._track.determinePacketType(s)==="delta"?this.getNextKeyPacket(s,r):s)}packets(e,r,s={}){if(e!==void 0&&!(e instanceof qe))throw new TypeError("startPacket must be an EncodedPacket.");if(e!==void 0&&e.isMetadataOnly&&!s?.metadataOnly)throw new TypeError("startPacket can only be metadata-only if options.metadataOnly is enabled.");if(r!==void 0&&!(r instanceof qe))throw new TypeError("endPacket must be an EncodedPacket.");if(zs(s),this._track.input._disposed)throw new Zt;const a=[];let{promise:l,resolve:c}=wt(),{promise:u,resolve:f}=wt(),m=!1,g=!1,y=null;const w=[],T=()=>Math.max(2,w.length);(async()=>{let v=e??await this.getFirstPacket(s);for(;v&&!g&&!this._track.input._disposed&&!(r&&v.sequenceNumber>=r?.sequenceNumber);){if(a.length>T()){({promise:u,resolve:f}=wt()),await u;continue}a.push(v),c(),{promise:l,resolve:c}=wt(),v=await this.getNextPacket(v,s)}m=!0,c()})().catch(v=>{y||(y=v,c())});const S=this._track;return{async next(){for(;;){if(S.input._disposed)throw new Zt;if(g)return{value:void 0,done:!0};if(y)throw y;if(a.length>0){const v=a.shift(),x=performance.now();for(w.push(x);w.length>0&&x-w[0]>=1e3;)w.shift();return f(),{value:v,done:!1}}else{if(m)return{value:void 0,done:!0};await l}}},async return(){return g=!0,f(),c(),{value:void 0,done:!0}},async throw(v){throw v},[Symbol.asyncIterator](){return this}}}}class Gd{constructor(e,r){this.onSample=e,this.onError=r}}class fg{mediaSamplesInRange(e=0,r=1/0){oi(e),oi(r);const s=[];let a=!1,l=null,{promise:c,resolve:u}=wt(),{promise:f,resolve:m}=wt(),g=!1,y=!1,w=!1,T=null;(async()=>{const x=await this._createDecoder(L=>{if(m(),L.timestamp>=r&&(y=!0),y){L.close();return}l&&(L.timestamp>e?(s.push(l),a=!0):l.close()),L.timestamp>=e&&(s.push(L),a=!0),l=a?null:L,s.length>0&&(u(),{promise:c,resolve:u}=wt())},L=>{T||(T=L,u())}),_=this._createPacketSink(),A=await _.getKeyPacket(e,{verifyKeyPackets:!0})??await _.getFirstPacket();let O=A,B;if(r<1/0){const L=await _.getPacket(r),q=L?L.type==="key"&&L.timestamp===r?L:await _.getNextKeyPacket(L,{verifyKeyPackets:!0}):null;q&&(B=q)}const j=_.packets(A??void 0,B);for(await j.next();O&&!y&&!this._track.input._disposed;){const L=Vm(s.length);if(s.length+x.getDecodeQueueSize()>L){({promise:f,resolve:m}=wt()),await f;continue}x.decode(O);const q=await j.next();if(q.done)break;O=q.value}await j.return(),!w&&!this._track.input._disposed&&await x.flush(),x.close(),!a&&l&&s.push(l),g=!0,u()})().catch(x=>{T||(T=x,u())});const S=this._track,v=()=>{l?.close();for(const x of s)x.close()};return{async next(){for(;;){if(S.input._disposed)throw v(),new Zt;if(w)return{value:void 0,done:!0};if(T)throw v(),T;if(s.length>0){const x=s.shift();return m(),{value:x,done:!1}}else if(!g)await c;else return{value:void 0,done:!0}}},async return(){return w=!0,y=!0,m(),u(),v(),{value:void 0,done:!0}},async throw(x){throw x},[Symbol.asyncIterator](){return this}}}mediaSamplesAtTimestamps(e){Jy(e);const r=Zy(e),s=[],a=[];let{promise:l,resolve:c}=wt(),{promise:u,resolve:f}=wt(),m=!1,g=!1,y=null;const w=v=>{a.push(v),c(),{promise:l,resolve:c}=wt()};(async()=>{const v=await this._createDecoder(L=>{if(f(),g){L.close();return}let q=0;for(;s.length>0&&L.timestamp-s[0]>-1e-10;)q++,s.shift();if(q>0)for(let G=0;G<q;G++)w(G<q-1?L.clone():L);else L.close()},L=>{y||(y=L,c())}),x=this._createPacketSink();let _=null,A=null,O=-1;const B=async()=>{b(A);let L=A;for(v.decode(L);L.sequenceNumber<O;){const q=Vm(a.length);for(;a.length+v.getDecodeQueueSize()>q&&!g;)({promise:u,resolve:f}=wt()),await u;if(g)break;const G=await x.getNextPacket(L);b(G),v.decode(G),L=G}O=-1},j=async()=>{await v.flush();for(let L=0;L<s.length;L++)w(null);s.length=0};for await(const L of r){if(oi(L),g||this._track.input._disposed)break;const q=await x.getPacket(L),G=q&&await x.getKeyPacket(L,{verifyKeyPackets:!0});if(!G){O!==-1&&(await B(),await j()),w(null),_=null;continue}_&&(G.sequenceNumber!==A.sequenceNumber||q.timestamp<_.timestamp)&&(await B(),await j()),s.push(q.timestamp),O=Math.max(q.sequenceNumber,O),_=q,A=G}!g&&!this._track.input._disposed&&(O!==-1&&await B(),await j()),v.close(),m=!0,c()})().catch(v=>{y||(y=v,c())});const T=this._track,S=()=>{for(const v of a)v?.close()};return{async next(){for(;;){if(T.input._disposed)throw S(),new Zt;if(g)return{value:void 0,done:!0};if(y)throw S(),y;if(a.length>0){const v=a.shift();return b(v!==void 0),f(),{value:v,done:!1}}else if(!m)await l;else return{value:void 0,done:!0}}},async return(){return g=!0,f(),c(),S(),{value:void 0,done:!0}},async throw(v){throw v},[Symbol.asyncIterator](){return this}}}}const Vm=n=>n===0?40:8;class Hw extends Gd{constructor(e,r,s,a,l,c){super(e,r),this.codec=s,this.decoderConfig=a,this.rotation=l,this.timeResolution=c,this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new Jl,this.customDecoderQueueSize=0,this.inputTimestamps=[],this.sampleQueue=[],this.currentPacketIndex=0,this.raslSkipped=!1,this.alphaDecoder=null,this.alphaHadKeyframe=!1,this.colorQueue=[],this.alphaQueue=[],this.merger=null,this.mergerCreationFailed=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue=[],this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1;const u=og.find(f=>f.supports(s,a));if(u)this.customDecoder=new u,this.customDecoder.codec=s,this.customDecoder.config=a,this.customDecoder.onSample=f=>{if(!(f instanceof _t))throw new TypeError("The argument passed to onSample must be a VideoSample.");this.finalizeAndEmitSample(f)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init());else{const f=g=>{if(this.alphaQueue.length>0){const y=this.alphaQueue.shift();b(y!==void 0),this.mergeAlpha(g,y)}else this.colorQueue.push(g)};if(s==="avc"&&this.decoderConfig.description&&md()){const g=Cw(It(this.decoderConfig.description));if(g&&g.sequenceParameterSets.length>0){const y=eg(g.sequenceParameterSets[0]);y&&y.frameMbsOnlyFlag===0&&(this.decoderConfig={...this.decoderConfig,hardwareAcceleration:"prefer-software"})}}const m=new Error("Decoding error").stack;this.decoder=new VideoDecoder({output:g=>{try{f(g)}catch(y){this.onError(y)}},error:g=>{g.stack=m,this.onError(g)}}),this.decoder.configure(this.decoderConfig)}}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(b(this.decoder),Math.max(this.decoder.decodeQueueSize,this.alphaDecoder?.decodeQueueSize??0))}decode(e){if(this.codec==="hevc"&&this.currentPacketIndex>0&&!this.raslSkipped){if(this.hasHevcRaslPicture(e.data))return;this.raslSkipped=!0}if(this.customDecoder)this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--);else{if(b(this.decoder),lo()||Am(this.inputTimestamps,e.timestamp,r=>r),md()&&this.currentPacketIndex===0&&this.codec==="avc"){const s=Zp(e.data,this.decoderConfig).filter(l=>{const c=Ks(l);return!(c>=20&&c<=31)}),a=bw(s,this.decoderConfig);e=new qe(a,e.type,e.timestamp,e.duration)}this.decoder.decode(e.toEncodedVideoChunk()),this.decodeAlphaData(e)}this.currentPacketIndex++}decodeAlphaData(e){if(!e.sideData.alpha||this.mergerCreationFailed){this.pushNullAlphaFrame();return}if(!this.merger)try{this.merger=new $w}catch(s){console.error("Due to an error, only color data will be decoded.",s),this.mergerCreationFailed=!0,this.decodeAlphaData(e);return}if(!this.alphaDecoder){const s=l=>{if(this.alphaDecoderQueueSize--,this.colorQueue.length>0){const c=this.colorQueue.shift();b(c!==void 0),this.mergeAlpha(c,l)}else this.alphaQueue.push(l);for(this.decodedAlphaChunkCount++;this.nullAlphaFrameQueue.length>0&&this.nullAlphaFrameQueue[0]===this.decodedAlphaChunkCount;)if(this.nullAlphaFrameQueue.shift(),this.colorQueue.length>0){const c=this.colorQueue.shift();b(c!==void 0),this.mergeAlpha(c,null)}else this.alphaQueue.push(null)},a=new Error("Decoding error").stack;this.alphaDecoder=new VideoDecoder({output:l=>{try{s(l)}catch(c){this.onError(c)}},error:l=>{l.stack=a,this.onError(l)}}),this.alphaDecoder.configure(this.decoderConfig)}const r=ag(this.codec,this.decoderConfig,e.sideData.alpha);if(this.alphaHadKeyframe||(this.alphaHadKeyframe=r==="key"),this.alphaHadKeyframe){if(this.codec==="hevc"&&this.currentAlphaPacketIndex>0&&!this.alphaRaslSkipped){if(this.hasHevcRaslPicture(e.sideData.alpha)){this.pushNullAlphaFrame();return}this.alphaRaslSkipped=!0}this.currentAlphaPacketIndex++,this.alphaDecoder.decode(e.alphaToEncodedVideoChunk(r??e.type)),this.alphaDecoderQueueSize++}else this.pushNullAlphaFrame()}pushNullAlphaFrame(){this.alphaDecoderQueueSize===0?this.alphaQueue.push(null):this.nullAlphaFrameQueue.push(this.decodedAlphaChunkCount+this.alphaDecoderQueueSize)}hasHevcRaslPicture(e){return tg(e,this.decoderConfig).some(s=>{const a=ti(s);return a===Vt.RASL_N||a===Vt.RASL_R})}sampleHandler(e){if(lo()){if(this.sampleQueue.length>0&&e.timestamp>=ot(this.sampleQueue).timestamp){for(const r of this.sampleQueue)this.finalizeAndEmitSample(r);this.sampleQueue.length=0}Am(this.sampleQueue,e,r=>r.timestamp)}else{const r=this.inputTimestamps.shift();b(r!==void 0),e.setTimestamp(r),this.finalizeAndEmitSample(e)}}finalizeAndEmitSample(e){e.setTimestamp(Math.round(e.timestamp*this.timeResolution)/this.timeResolution),e.setDuration(Math.round(e.duration*this.timeResolution)/this.timeResolution),e.setRotation(this.rotation),this.onSample(e)}mergeAlpha(e,r){if(!r){const l=new _t(e);this.sampleHandler(l);return}b(this.merger),this.merger.update(e,r),e.close(),r.close();const s=new VideoFrame(this.merger.canvas,{timestamp:e.timestamp,duration:e.duration??void 0}),a=new _t(s);this.sampleHandler(a)}async flush(){if(this.customDecoder?await this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(b(this.decoder),await Promise.all([this.decoder.flush(),this.alphaDecoder?.flush()]),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.alphaHadKeyframe=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue.length=0,this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1),lo()){for(const e of this.sampleQueue)this.finalizeAndEmitSample(e);this.sampleQueue.length=0}this.currentPacketIndex=0,this.raslSkipped=!1}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(b(this.decoder),this.decoder.close(),this.alphaDecoder?.close(),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.merger?.close());for(const e of this.sampleQueue)e.close();this.sampleQueue.length=0}}class $w{constructor(){typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(300,150):this.canvas=document.createElement("canvas");const e=this.canvas.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=e,this.program=this.createProgram(),this.vao=this.createVAO(),this.colorTexture=this.createTexture(),this.alphaTexture=this.createTexture(),this.gl.useProgram(this.program),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_colorTexture"),0),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_alphaTexture"),1)}createProgram(){const e=this.createShader(this.gl.VERTEX_SHADER,`#version 300 es
			in vec2 a_position;
			in vec2 a_texCoord;
			out vec2 v_texCoord;
			
			void main() {
				gl_Position = vec4(a_position, 0.0, 1.0);
				v_texCoord = a_texCoord;
			}
		`),r=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_colorTexture;
			uniform sampler2D u_alphaTexture;
			in vec2 v_texCoord;
			out vec4 fragColor;
			
			void main() {
				vec3 color = texture(u_colorTexture, v_texCoord).rgb;
				float alpha = texture(u_alphaTexture, v_texCoord).r;
				fragColor = vec4(color, alpha);
			}
		`),s=this.gl.createProgram();return this.gl.attachShader(s,e),this.gl.attachShader(s,r),this.gl.linkProgram(s),s}createShader(e,r){const s=this.gl.createShader(e);return this.gl.shaderSource(s,r),this.gl.compileShader(s),s}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const r=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),s=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.STATIC_DRAW);const a=this.gl.getAttribLocation(this.program,"a_position"),l=this.gl.getAttribLocation(this.program,"a_texCoord");return this.gl.enableVertexAttribArray(a),this.gl.vertexAttribPointer(a,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(l),this.gl.vertexAttribPointer(l,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}update(e,r){(e.displayWidth!==this.canvas.width||e.displayHeight!==this.canvas.height)&&(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colorTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.alphaTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class kd extends fg{constructor(e){if(!(e instanceof To))throw new TypeError("videoTrack must be an InputVideoTrack.");super(),this._track=e}async _createDecoder(e,r){if(!await this._track.canDecode())throw new Error("This video track cannot be decoded by this browser. Make sure to check decodability before using a track.");const s=this._track.codec,a=this._track.rotation,l=await this._track.getDecoderConfig(),c=this._track.timeResolution;return b(s&&l),new Hw(e,r,s,l,a,c)}_createPacketSink(){return new po(this._track)}async getSample(e){oi(e);for await(const r of this.mediaSamplesAtTimestamps([e]))return r;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,r=1/0){return this.mediaSamplesInRange(e,r)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}class Qw{constructor(e,r={}){if(this._nextCanvasIndex=0,!(e instanceof To))throw new TypeError("videoTrack must be an InputVideoTrack.");if(r&&typeof r!="object")throw new TypeError("options must be an object.");if(r.alpha!==void 0&&typeof r.alpha!="boolean")throw new TypeError("options.alpha, when provided, must be a boolean.");if(r.width!==void 0&&(!Number.isInteger(r.width)||r.width<=0))throw new TypeError("options.width, when defined, must be a positive integer.");if(r.height!==void 0&&(!Number.isInteger(r.height)||r.height<=0))throw new TypeError("options.height, when defined, must be a positive integer.");if(r.fit!==void 0&&!["fill","contain","cover"].includes(r.fit))throw new TypeError('options.fit, when provided, must be one of "fill", "contain", or "cover".');if(r.width!==void 0&&r.height!==void 0&&r.fit===void 0)throw new TypeError("When both options.width and options.height are provided, options.fit must also be provided.");if(r.rotation!==void 0&&![0,90,180,270].includes(r.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180 or 270.");if(r.crop!==void 0&&Kd(r.crop,"options."),r.poolSize!==void 0&&(typeof r.poolSize!="number"||!Number.isInteger(r.poolSize)||r.poolSize<0))throw new TypeError("poolSize must be a non-negative integer.");const s=r.rotation??e.rotation,[a,l]=s%180===0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],c=r.crop;c&&qd(c,a,l);let[u,f]=c?[c.width,c.height]:[a,l];const m=u/f;r.width!==void 0&&r.height===void 0?(u=r.width,f=Math.round(u/m)):r.width===void 0&&r.height!==void 0?(f=r.height,u=Math.round(f*m)):r.width!==void 0&&r.height!==void 0&&(u=r.width,f=r.height),this._videoTrack=e,this._alpha=r.alpha??!1,this._width=u,this._height=f,this._rotation=s,this._crop=c,this._fit=r.fit??"fill",this._videoSampleSink=new kd(e),this._canvasPool=Array.from({length:r.poolSize??0},()=>null)}_videoSampleToWrappedCanvas(e){let r=this._canvasPool[this._nextCanvasIndex],s=!1;r||(typeof document<"u"?(r=document.createElement("canvas"),r.width=this._width,r.height=this._height):r=new OffscreenCanvas(this._width,this._height),this._canvasPool.length>0&&(this._canvasPool[this._nextCanvasIndex]=r),s=!0),this._canvasPool.length>0&&(this._nextCanvasIndex=(this._nextCanvasIndex+1)%this._canvasPool.length);const a=r.getContext("2d",{alpha:this._alpha||Js()});b(a),a.resetTransform(),s||(!this._alpha&&Js()?(a.fillStyle="black",a.fillRect(0,0,this._width,this._height)):a.clearRect(0,0,this._width,this._height)),e.drawWithFit(a,{fit:this._fit,rotation:this._rotation,crop:this._crop});const l={canvas:r,timestamp:e.timestamp,duration:e.duration};return e.close(),l}async getCanvas(e){oi(e);const r=await this._videoSampleSink.getSample(e);return r&&this._videoSampleToWrappedCanvas(r)}canvases(e=0,r=1/0){return Mm(this._videoSampleSink.samples(e,r),s=>this._videoSampleToWrappedCanvas(s))}canvasesAtTimestamps(e){return Mm(this._videoSampleSink.samplesAtTimestamps(e),r=>r&&this._videoSampleToWrappedCanvas(r))}}class qw extends Gd{constructor(e,r,s,a){super(e,r),this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new Jl,this.customDecoderQueueSize=0,this.currentTimestamp=null;const l=u=>{(this.currentTimestamp===null||Math.abs(u.timestamp-this.currentTimestamp)>=u.duration)&&(this.currentTimestamp=u.timestamp);const f=this.currentTimestamp;if(this.currentTimestamp+=u.duration,u.numberOfFrames===0){u.close();return}const m=a.sampleRate;u.setTimestamp(Math.round(f*m)/m),e(u)},c=lg.find(u=>u.supports(s,a));if(c)this.customDecoder=new c,this.customDecoder.codec=s,this.customDecoder.config=a,this.customDecoder.onSample=u=>{if(!(u instanceof hn))throw new TypeError("The argument passed to onSample must be an AudioSample.");l(u)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init());else{const u=new Error("Decoding error").stack;this.decoder=new AudioDecoder({output:f=>{try{l(new hn(f))}catch(m){this.onError(m)}},error:f=>{f.stack=u,this.onError(f)}}),this.decoder.configure(a)}}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(b(this.decoder),this.decoder.decodeQueueSize)}decode(e){this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--)):(b(this.decoder),this.decoder.decode(e.toEncodedAudioChunk()))}flush(){return this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(b(this.decoder),this.decoder.flush())}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(b(this.decoder),this.decoder.close())}}class Kw extends Gd{constructor(e,r,s){super(e,r),this.decoderConfig=s,this.currentTimestamp=null,b(Tt.includes(s.codec)),this.codec=s.codec;const{dataType:a,sampleSize:l,littleEndian:c}=kr(this.codec);switch(this.inputSampleSize=l,l){case 1:a==="unsigned"?this.readInputValue=(u,f)=>u.getUint8(f)-2**7:a==="signed"?this.readInputValue=(u,f)=>u.getInt8(f):a==="ulaw"?this.readInputValue=(u,f)=>Dw(u.getUint8(f)):a==="alaw"?this.readInputValue=(u,f)=>Uw(u.getUint8(f)):b(!1);break;case 2:a==="unsigned"?this.readInputValue=(u,f)=>u.getUint16(f,c)-2**15:a==="signed"?this.readInputValue=(u,f)=>u.getInt16(f,c):b(!1);break;case 3:a==="unsigned"?this.readInputValue=(u,f)=>Zl(u,f,c)-2**23:a==="signed"?this.readInputValue=(u,f)=>ew(u,f,c):b(!1);break;case 4:a==="unsigned"?this.readInputValue=(u,f)=>u.getUint32(f,c)-2**31:a==="signed"?this.readInputValue=(u,f)=>u.getInt32(f,c):a==="float"?this.readInputValue=(u,f)=>u.getFloat32(f,c):b(!1);break;case 8:a==="float"?this.readInputValue=(u,f)=>u.getFloat64(f,c):b(!1);break;default:Mn(l),b(!1)}switch(l){case 1:a==="ulaw"||a==="alaw"?(this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(u,f,m)=>u.setInt16(f,m,!0)):(this.outputSampleSize=1,this.outputFormat="u8",this.writeOutputValue=(u,f,m)=>u.setUint8(f,m+2**7));break;case 2:this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(u,f,m)=>u.setInt16(f,m,!0);break;case 3:this.outputSampleSize=4,this.outputFormat="s32",this.writeOutputValue=(u,f,m)=>u.setInt32(f,m<<8,!0);break;case 4:this.outputSampleSize=4,a==="float"?(this.outputFormat="f32",this.writeOutputValue=(u,f,m)=>u.setFloat32(f,m,!0)):(this.outputFormat="s32",this.writeOutputValue=(u,f,m)=>u.setInt32(f,m,!0));break;case 8:this.outputSampleSize=4,this.outputFormat="f32",this.writeOutputValue=(u,f,m)=>u.setFloat32(f,m,!0);break;default:Mn(l),b(!1)}}getDecodeQueueSize(){return 0}decode(e){const r=tt(e.data),s=e.byteLength/this.decoderConfig.numberOfChannels/this.inputSampleSize,a=s*this.decoderConfig.numberOfChannels*this.outputSampleSize,l=new ArrayBuffer(a),c=new DataView(l);for(let g=0;g<s*this.decoderConfig.numberOfChannels;g++){const y=g*this.inputSampleSize,w=g*this.outputSampleSize,T=this.readInputValue(r,y);this.writeOutputValue(c,w,T)}const u=s/this.decoderConfig.sampleRate;(this.currentTimestamp===null||Math.abs(e.timestamp-this.currentTimestamp)>=u)&&(this.currentTimestamp=e.timestamp);const f=this.currentTimestamp;this.currentTimestamp+=u;const m=new hn({format:this.outputFormat,data:l,numberOfChannels:this.decoderConfig.numberOfChannels,sampleRate:this.decoderConfig.sampleRate,numberOfFrames:s,timestamp:f});this.onSample(m)}async flush(){}close(){}}class Wm extends fg{constructor(e){if(!(e instanceof Tr))throw new TypeError("audioTrack must be an InputAudioTrack.");super(),this._track=e}async _createDecoder(e,r){if(!await this._track.canDecode())throw new Error("This audio track cannot be decoded by this browser. Make sure to check decodability before using a track.");const s=this._track.codec,a=await this._track.getDecoderConfig();return b(s&&a),Tt.includes(a.codec)?new Kw(e,r,a):new qw(e,r,s,a)}_createPacketSink(){return new po(this._track)}async getSample(e){oi(e);for await(const r of this.mediaSamplesAtTimestamps([e]))return r;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,r=1/0){return this.mediaSamplesInRange(e,r)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Xd{constructor(e,r){this.input=e,this._backing=r}isVideoTrack(){return this instanceof To}isAudioTrack(){return this instanceof Tr}get id(){return this._backing.getId()}get internalCodecId(){return this._backing.getInternalCodecId()}get languageCode(){return this._backing.getLanguageCode()}get name(){return this._backing.getName()}get timeResolution(){return this._backing.getTimeResolution()}get disposition(){return this._backing.getDisposition()}getFirstTimestamp(){return this._backing.getFirstTimestamp()}computeDuration(){return this._backing.computeDuration()}async computePacketStats(e=1/0){const r=new po(this);let s=1/0,a=-1/0,l=0,c=0;for await(const u of r.packets(void 0,void 0,{metadataOnly:!0})){if(l>=e&&u.timestamp>=a)break;s=Math.min(s,u.timestamp),a=Math.max(a,u.timestamp+u.duration),l++,c+=u.byteLength}return{packetCount:l,averagePacketRate:l?Number((l/(a-s)).toPrecision(16)):0,averageBitrate:l?Number((8*c/(a-s)).toPrecision(16)):0}}}class To extends Xd{constructor(e,r){super(e,r),this._backing=r}get type(){return"video"}get codec(){return this._backing.getCodec()}get codedWidth(){return this._backing.getCodedWidth()}get codedHeight(){return this._backing.getCodedHeight()}get rotation(){return this._backing.getRotation()}get displayWidth(){return this._backing.getRotation()%180===0?this._backing.getCodedWidth():this._backing.getCodedHeight()}get displayHeight(){return this._backing.getRotation()%180===0?this._backing.getCodedHeight():this._backing.getCodedWidth()}getColorSpace(){return this._backing.getColorSpace()}async hasHighDynamicRange(){const e=await this._backing.getColorSpace();return e.primaries==="bt2020"||e.primaries==="smpte432"||e.transfer==="pg"||e.transfer==="hlg"||e.matrix==="bt2020-ncl"}canBeTransparent(){return this._backing.canBeTransparent()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){return(await this._backing.getDecoderConfig())?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const r=this._backing.getCodec();return b(r!==null),og.some(a=>a.supports(r,e))?!0:typeof VideoDecoder>"u"?!1:(await VideoDecoder.isConfigSupported(e)).supported===!0}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof qe))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("packet must not be metadata-only to determine its type.");if(this.codec===null)return null;const r=await this.getDecoderConfig();return b(r),ag(this.codec,r,e.data)}}class Tr extends Xd{constructor(e,r){super(e,r),this._backing=r}get type(){return"audio"}get codec(){return this._backing.getCodec()}get numberOfChannels(){return this._backing.getNumberOfChannels()}get sampleRate(){return this._backing.getSampleRate()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){return(await this._backing.getDecoderConfig())?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const r=this._backing.getCodec();return b(r!==null),lg.some(s=>s.supports(r,e))||e.codec.startsWith("pcm-")?!0:typeof AudioDecoder>"u"?!1:(await AudioDecoder.isConfigSupported(e)).supported===!0}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof qe))throw new TypeError("packet must be an EncodedPacket.");return this.codec===null?null:"key"}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const hg=n=>{let r=(n.hasVideo?"video/":n.hasAudio?"audio/":"application/")+(n.isQuickTime?"quicktime":"mp4");if(n.codecStrings.length>0){const s=[...new Set(n.codecStrings)];r+=`; codecs="${s.join(", ")}"`}return r};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const gr=8,Vi=16,ni=n=>{let e=te(n);const r=kt(n,4);let s=8;e===1&&(e=_n(n),s=16);const l=e-s;return l<0?null:{name:r,totalSize:e,headerSize:s,contentSize:l}},Ui=n=>Hi(n)/65536,Xu=n=>Hi(n)/1073741824,Yu=n=>{let e=0;for(let r=0;r<4;r++){e<<=7;const s=me(n);if(e|=s&127,(s&128)===0)break}return e},Hn=n=>{let e=Pt(n);return n.skip(2),e=Math.min(e,n.remainingLength),mn.decode(ve(n,e))},Gw=n=>{const e=ni(n);if(!e||e.name!=="data"||n.remainingLength<8)return null;const r=te(n);n.skip(4);const s=ve(n,e.contentSize-8);switch(r){case 1:return mn.decode(s);case 2:return new TextDecoder("utf-16be").decode(s);case 13:return new Qs(s,"image/jpeg");case 14:return new Qs(s,"image/png");case 27:return new Qs(s,"image/bmp");default:return s}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Xw extends Ki{constructor(e){super(e),this.moovSlice=null,this.currentTrack=null,this.tracks=[],this.metadataPromise=null,this.movieTimescale=-1,this.movieDurationInTimescale=-1,this.isQuickTime=!1,this.metadataTags={},this.currentMetadataKeys=null,this.isFragmented=!1,this.fragmentTrackDefaults=[],this.currentFragment=null,this.lastReadFragment=null,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),r=await Promise.all(e.map(s=>s.computeDuration()));return Math.max(0,...r)}async getTracks(){return await this.readMetadata(),this.tracks.map(e=>e.inputTrack)}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(r=>r.inputTrack.getCodecParameterString()));return hg({isQuickTime:this.isQuickTime,hasVideo:this.tracks.some(r=>r.info?.type==="video"),hasAudio:this.tracks.some(r=>r.info?.type==="audio"),codecStrings:e.filter(Boolean)})}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let r=this.reader.requestSliceRange(e,gr,Vi);if(r instanceof Promise&&(r=await r),!r)break;const s=e,a=ni(r);if(!a)break;if(a.name==="ftyp"){const l=kt(r,4);this.isQuickTime=l==="qt  "}else if(a.name==="moov"){let l=this.reader.requestSlice(r.filePos,a.contentSize);if(l instanceof Promise&&(l=await l),!l)break;this.moovSlice=l,this.readContiguousBoxes(this.moovSlice),this.tracks.sort((c,u)=>Number(u.disposition.default)-Number(c.disposition.default));for(const c of this.tracks){const u=c.editListPreviousSegmentDurations/this.movieTimescale;c.editListOffset-=Math.round(u*c.timescale)}break}e=s+a.totalSize}if(this.isFragmented&&this.reader.fileSize!==null){let r=this.reader.requestSlice(this.reader.fileSize-4,4);r instanceof Promise&&(r=await r),b(r);const s=te(r),a=this.reader.fileSize-s;if(a>=0&&a<=this.reader.fileSize-Vi){let l=this.reader.requestSliceRange(a,gr,Vi);if(l instanceof Promise&&(l=await l),l){const c=ni(l);if(c&&c.name==="mfra"){let u=this.reader.requestSlice(l.filePos,c.contentSize);u instanceof Promise&&(u=await u),u&&this.readContiguousBoxes(u)}}}}})()}getSampleTableForTrack(e){if(e.sampleTable)return e.sampleTable;const r={sampleTimingEntries:[],sampleCompositionTimeOffsets:[],sampleSizes:[],keySampleIndices:null,chunkOffsets:[],sampleToChunk:[],presentationTimestamps:null,presentationTimestampIndexMap:null};e.sampleTable=r,b(this.moovSlice);const s=this.moovSlice.slice(e.sampleTableByteOffset);if(this.currentTrack=e,this.traverseBox(s),this.currentTrack=null,e.info?.type==="audio"&&e.info.codec&&Tt.includes(e.info.codec)&&r.sampleCompositionTimeOffsets.length===0){b(e.info?.type==="audio");const l=kr(e.info.codec),c=[],u=[];for(let f=0;f<r.sampleToChunk.length;f++){const m=r.sampleToChunk[f],g=r.sampleToChunk[f+1],y=(g?g.startChunkIndex:r.chunkOffsets.length)-m.startChunkIndex;for(let w=0;w<y;w++){const T=m.startSampleIndex+w*m.samplesPerChunk,S=T+m.samplesPerChunk,v=Ve(r.sampleTimingEntries,T,G=>G.startIndex),x=r.sampleTimingEntries[v],_=Ve(r.sampleTimingEntries,S,G=>G.startIndex),A=r.sampleTimingEntries[_],O=x.startDecodeTimestamp+(T-x.startIndex)*x.delta,j=A.startDecodeTimestamp+(S-A.startIndex)*A.delta-O,L=ot(c);L&&L.delta===j?L.count++:c.push({startIndex:m.startChunkIndex+w,startDecodeTimestamp:O,count:1,delta:j});const q=m.samplesPerChunk*l.sampleSize*e.info.numberOfChannels;u.push(q)}m.startSampleIndex=m.startChunkIndex,m.samplesPerChunk=1}r.sampleTimingEntries=c,r.sampleSizes=u}if(r.sampleCompositionTimeOffsets.length>0){r.presentationTimestamps=[];for(const l of r.sampleTimingEntries)for(let c=0;c<l.count;c++)r.presentationTimestamps.push({presentationTimestamp:l.startDecodeTimestamp+c*l.delta,sampleIndex:l.startIndex+c});for(const l of r.sampleCompositionTimeOffsets)for(let c=0;c<l.count;c++){const u=l.startIndex+c,f=r.presentationTimestamps[u];f&&(f.presentationTimestamp+=l.offset)}r.presentationTimestamps.sort((l,c)=>l.presentationTimestamp-c.presentationTimestamp),r.presentationTimestampIndexMap=Array(r.presentationTimestamps.length).fill(-1);for(let l=0;l<r.presentationTimestamps.length;l++)r.presentationTimestampIndexMap[r.presentationTimestamps[l].sampleIndex]=l}return r}async readFragment(e){if(this.lastReadFragment?.moofOffset===e)return this.lastReadFragment;let r=this.reader.requestSliceRange(e,gr,Vi);r instanceof Promise&&(r=await r),b(r);const s=ni(r);b(s?.name==="moof");let a=this.reader.requestSlice(e,s.totalSize);a instanceof Promise&&(a=await a),b(a),this.traverseBox(a);const l=this.lastReadFragment;b(l&&l.moofOffset===e);for(const[,c]of l.trackData){const u=c.track,{fragmentPositionCache:f}=u;if(!c.startTimestampIsFinal){const g=u.fragmentLookupTable.find(y=>y.moofOffset===l.moofOffset);if(g)Zu(c,g.timestamp);else{const y=Ve(f,l.moofOffset-1,w=>w.moofOffset);if(y!==-1){const w=f[y];Zu(c,w.endTimestamp)}}c.startTimestampIsFinal=!0}const m=Ve(f,c.startTimestamp,g=>g.startTimestamp);(m===-1||f[m].moofOffset!==l.moofOffset)&&f.splice(m+1,0,{moofOffset:l.moofOffset,startTimestamp:c.startTimestamp,endTimestamp:c.endTimestamp})}return l}readContiguousBoxes(e){const r=e.filePos;for(;e.filePos-r<=e.length-gr&&this.traverseBox(e););}*iterateContiguousBoxes(e){const r=e.filePos;for(;e.filePos-r<=e.length-gr;){const s=e.filePos,a=ni(e);if(!a)break;yield{boxInfo:a,slice:e},e.filePos=s+a.totalSize}}traverseBox(e){const r=e.filePos,s=ni(e);if(!s)return!1;const a=e.filePos,l=r+s.totalSize;switch(s.name){case"mdia":case"minf":case"dinf":case"mfra":case"edts":this.readContiguousBoxes(e.slice(a,s.contentSize));break;case"mvhd":{const c=me(e);e.skip(3),c===1?(e.skip(16),this.movieTimescale=te(e),this.movieDurationInTimescale=_n(e)):(e.skip(8),this.movieTimescale=te(e),this.movieDurationInTimescale=te(e))}break;case"trak":{const c={id:-1,demuxer:this,inputTrack:null,disposition:{...qi},info:null,timescale:-1,durationInMovieTimescale:-1,durationInMediaTimescale:-1,rotation:0,internalCodecId:null,name:null,languageCode:Jt,sampleTableByteOffset:-1,sampleTable:null,fragmentLookupTable:[],currentFragmentState:null,fragmentPositionCache:[],editListPreviousSegmentDurations:0,editListOffset:0};if(this.currentTrack=c,this.readContiguousBoxes(e.slice(a,s.contentSize)),c.id!==-1&&c.timescale!==-1&&c.info!==null){if(c.info.type==="video"&&c.info.width!==-1){const u=c;c.inputTrack=new To(this.input,new Yw(u)),this.tracks.push(c)}else if(c.info.type==="audio"&&c.info.numberOfChannels!==-1){const u=c;c.inputTrack=new Tr(this.input,new Zw(u)),this.tracks.push(c)}}this.currentTrack=null}break;case"tkhd":{const c=this.currentTrack;if(!c)break;const u=me(e),m=!!(Ls(e)&1);if(c.disposition.default=m,u===0)e.skip(8),c.id=te(e),e.skip(4),c.durationInMovieTimescale=te(e);else if(u===1)e.skip(16),c.id=te(e),e.skip(4),c.durationInMovieTimescale=_n(e);else throw new Error(`Incorrect track header version ${u}.`);e.skip(16);const g=[Ui(e),Ui(e),Xu(e),Ui(e),Ui(e),Xu(e),Ui(e),Ui(e),Xu(e)],y=Gl(hd(nk(g),90));b(y===0||y===90||y===180||y===270),c.rotation=y}break;case"elst":{const c=this.currentTrack;if(!c)break;const u=me(e);e.skip(3);let f=!1,m=0;const g=te(e);for(let y=0;y<g;y++){const w=u===1?_n(e):te(e),T=u===1?uT(e):Hi(e),S=Ui(e);if(w!==0){if(f){console.warn("Unsupported edit list: multiple edits are not currently supported. Only using first edit.");break}if(T===-1){m+=w;continue}if(S!==1){console.warn("Unsupported edit list entry: media rate must be 1.");break}c.editListPreviousSegmentDurations=m,c.editListOffset=T,f=!0}}}break;case"mdhd":{const c=this.currentTrack;if(!c)break;const u=me(e);e.skip(3),u===0?(e.skip(8),c.timescale=te(e),c.durationInMediaTimescale=te(e)):u===1&&(e.skip(16),c.timescale=te(e),c.durationInMediaTimescale=_n(e));let f=Pt(e);if(f>0){c.languageCode="";for(let m=0;m<3;m++)c.languageCode=String.fromCharCode(96+(f&31))+c.languageCode,f>>=5;fo(c.languageCode)||(c.languageCode=Jt)}}break;case"hdlr":{const c=this.currentTrack;if(!c)break;e.skip(8);const u=kt(e,4);u==="vide"?c.info={type:"video",width:-1,height:-1,codec:null,codecDescription:null,colorSpace:null,avcType:null,avcCodecInfo:null,hevcCodecInfo:null,vp9CodecInfo:null,av1CodecInfo:null}:u==="soun"&&(c.info={type:"audio",numberOfChannels:-1,sampleRate:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case"stbl":{const c=this.currentTrack;if(!c)break;c.sampleTableByteOffset=r,this.readContiguousBoxes(e.slice(a,s.contentSize))}break;case"stsd":{const c=this.currentTrack;if(!c||c.info===null||c.sampleTable)break;const u=me(e);e.skip(3);const f=te(e);for(let m=0;m<f;m++){const g=e.filePos,y=ni(e);if(!y)break;c.internalCodecId=y.name;const w=y.name.toLowerCase();if(c.info.type==="video")w==="avc1"||w==="avc3"?(c.info.codec="avc",c.info.avcType=w==="avc1"?1:3):w==="hvc1"||w==="hev1"?c.info.codec="hevc":w==="vp08"?c.info.codec="vp8":w==="vp09"?c.info.codec="vp9":w==="av01"?c.info.codec="av1":console.warn(`Unsupported video codec (sample entry type '${y.name}').`),e.skip(24),c.info.width=Pt(e),c.info.height=Pt(e),e.skip(50),this.readContiguousBoxes(e.slice(e.filePos,g+y.totalSize-e.filePos));else{w==="mp4a"||(w==="opus"?c.info.codec="opus":w==="flac"?c.info.codec="flac":w==="twos"||w==="sowt"||w==="raw "||w==="in24"||w==="in32"||w==="fl32"||w==="fl64"||w==="lpcm"||w==="ipcm"||w==="fpcm"||(w==="ulaw"?c.info.codec="ulaw":w==="alaw"?c.info.codec="alaw":console.warn(`Unsupported audio codec (sample entry type '${y.name}').`))),e.skip(8);const T=Pt(e);e.skip(6);let S=Pt(e),v=Pt(e);e.skip(4);let x=te(e)/65536;if(u===0&&T>0){if(T===1)e.skip(4),v=8*te(e),e.skip(8);else if(T===2){e.skip(4),x=Ag(e),S=te(e),e.skip(4),v=te(e);const _=te(e);if(e.skip(8),w==="lpcm"){const A=v+7>>3,O=!!(_&1),B=!!(_&2),j=_&4?-1:0;v>0&&v<=64&&(O?v===32&&(c.info.codec=B?"pcm-f32be":"pcm-f32"):j&1<<A-1?A===1?c.info.codec="pcm-s8":A===2?c.info.codec=B?"pcm-s16be":"pcm-s16":A===3?c.info.codec=B?"pcm-s24be":"pcm-s24":A===4&&(c.info.codec=B?"pcm-s32be":"pcm-s32"):A===1&&(c.info.codec="pcm-u8")),c.info.codec===null&&console.warn("Unsupported PCM format.")}}}c.info.codec==="opus"&&(x=wo),c.info.numberOfChannels=S,c.info.sampleRate=x,w==="twos"?v===8?c.info.codec="pcm-s8":v===16?c.info.codec="pcm-s16be":(console.warn(`Unsupported sample size ${v} for codec 'twos'.`),c.info.codec=null):w==="sowt"?v===8?c.info.codec="pcm-s8":v===16?c.info.codec="pcm-s16":(console.warn(`Unsupported sample size ${v} for codec 'sowt'.`),c.info.codec=null):w==="raw "?c.info.codec="pcm-u8":w==="in24"?c.info.codec="pcm-s24be":w==="in32"?c.info.codec="pcm-s32be":w==="fl32"?c.info.codec="pcm-f32be":w==="fl64"?c.info.codec="pcm-f64be":w==="ipcm"?c.info.codec="pcm-s16be":w==="fpcm"&&(c.info.codec="pcm-f32be"),this.readContiguousBoxes(e.slice(e.filePos,g+y.totalSize-e.filePos))}}}break;case"avcC":{const c=this.currentTrack;if(!c)break;b(c.info),c.info.codecDescription=ve(e,s.contentSize)}break;case"hvcC":{const c=this.currentTrack;if(!c)break;b(c.info),c.info.codecDescription=ve(e,s.contentSize)}break;case"vpcC":{const c=this.currentTrack;if(!c)break;b(c.info?.type==="video"),e.skip(4);const u=me(e),f=me(e),m=me(e),g=m>>4,y=m>>1&7,w=m&1,T=me(e),S=me(e),v=me(e);c.info.vp9CodecInfo={profile:u,level:f,bitDepth:g,chromaSubsampling:y,videoFullRangeFlag:w,colourPrimaries:T,transferCharacteristics:S,matrixCoefficients:v}}break;case"av1C":{const c=this.currentTrack;if(!c)break;b(c.info?.type==="video"),e.skip(1);const u=me(e),f=u>>5,m=u&31,g=me(e),y=g>>7,w=g>>6&1,T=g>>5&1,S=g>>4&1,v=g>>3&1,x=g>>2&1,_=g&3,A=f===2&&w?T?12:10:w?10:8;c.info.av1CodecInfo={profile:f,level:m,tier:y,bitDepth:A,monochrome:S,chromaSubsamplingX:v,chromaSubsamplingY:x,chromaSamplePosition:_}}break;case"colr":{const c=this.currentTrack;if(!c||(b(c.info?.type==="video"),kt(e,4)!=="nclx"))break;const f=Pt(e),m=Pt(e),g=Pt(e),y=!!(me(e)&128);c.info.colorSpace={primaries:Np[f],transfer:Rp[m],matrix:zp[g],fullRange:y}}break;case"wave":this.readContiguousBoxes(e.slice(a,s.contentSize));break;case"esds":{const c=this.currentTrack;if(!c)break;b(c.info?.type==="audio"),e.skip(4);const u=me(e);b(u===3),Yu(e),e.skip(2);const f=me(e),m=(f&128)!==0,g=(f&64)!==0,y=(f&32)!==0;if(m&&e.skip(2),g){const x=me(e);e.skip(x)}y&&e.skip(2);const w=me(e);b(w===4);const T=Yu(e),S=e.filePos,v=me(e);if(v===64||v===103?(c.info.codec="aac",c.info.aacCodecInfo={isMpeg2:v===103}):v===105||v===107?c.info.codec="mp3":v===221?c.info.codec="vorbis":console.warn(`Unsupported audio codec (objectTypeIndication ${v}) - discarding track.`),e.skip(12),T>e.filePos-S){const x=me(e);b(x===5);const _=Yu(e);if(c.info.codecDescription=ve(e,_),c.info.codec==="aac"){const A=$d(c.info.codecDescription);A.numberOfChannels!==null&&(c.info.numberOfChannels=A.numberOfChannels),A.sampleRate!==null&&(c.info.sampleRate=A.sampleRate)}}}break;case"enda":{const c=this.currentTrack;if(!c)break;b(c.info?.type==="audio"),Pt(e)&255&&(c.info.codec==="pcm-s16be"?c.info.codec="pcm-s16":c.info.codec==="pcm-s24be"?c.info.codec="pcm-s24":c.info.codec==="pcm-s32be"?c.info.codec="pcm-s32":c.info.codec==="pcm-f32be"?c.info.codec="pcm-f32":c.info.codec==="pcm-f64be"&&(c.info.codec="pcm-f64"))}break;case"pcmC":{const c=this.currentTrack;if(!c)break;b(c.info?.type==="audio"),e.skip(4);const f=!!(me(e)&1),m=me(e);c.info.codec==="pcm-s16be"?f?m===16?c.info.codec="pcm-s16":m===24?c.info.codec="pcm-s24":m===32?c.info.codec="pcm-s32":(console.warn(`Invalid ipcm sample size ${m}.`),c.info.codec=null):m===16?c.info.codec="pcm-s16be":m===24?c.info.codec="pcm-s24be":m===32?c.info.codec="pcm-s32be":(console.warn(`Invalid ipcm sample size ${m}.`),c.info.codec=null):c.info.codec==="pcm-f32be"&&(f?m===32?c.info.codec="pcm-f32":m===64?c.info.codec="pcm-f64":(console.warn(`Invalid fpcm sample size ${m}.`),c.info.codec=null):m===32?c.info.codec="pcm-f32be":m===64?c.info.codec="pcm-f64be":(console.warn(`Invalid fpcm sample size ${m}.`),c.info.codec=null));break}case"dOps":{const c=this.currentTrack;if(!c)break;b(c.info?.type==="audio"),e.skip(1);const u=me(e),f=Pt(e),m=te(e),g=Id(e),y=me(e);let w;y!==0?w=ve(e,2+u):w=new Uint8Array(0);const T=new Uint8Array(19+w.byteLength),S=new DataView(T.buffer);S.setUint32(0,1332770163,!1),S.setUint32(4,1214603620,!1),S.setUint8(8,1),S.setUint8(9,u),S.setUint16(10,f,!0),S.setUint32(12,m,!0),S.setInt16(16,g,!0),S.setUint8(18,y),T.set(w,19),c.info.codecDescription=T,c.info.numberOfChannels=u}break;case"dfLa":{const c=this.currentTrack;if(!c)break;b(c.info?.type==="audio"),e.skip(4);const u=127,f=128,m=e.filePos;for(;e.filePos<l;){const S=me(e),v=Ls(e);if((S&u)===Gs.STREAMINFO){e.skip(10);const _=te(e),A=_>>>12,O=(_>>9&7)+1;c.info.sampleRate=A,c.info.numberOfChannels=O,e.skip(20)}else e.skip(v);if(S&f)break}const g=e.filePos;e.filePos=m;const y=ve(e,g-m),w=new Uint8Array(4+y.byteLength);new DataView(w.buffer).setUint32(0,1716281667,!1),w.set(y,4),c.info.codecDescription=w}break;case"stts":{const c=this.currentTrack;if(!c||!c.sampleTable)break;e.skip(4);const u=te(e);let f=0,m=0;for(let g=0;g<u;g++){const y=te(e),w=te(e);c.sampleTable.sampleTimingEntries.push({startIndex:f,startDecodeTimestamp:m,count:y,delta:w}),f+=y,m+=y*w}}break;case"ctts":{const c=this.currentTrack;if(!c||!c.sampleTable)break;e.skip(4);const u=te(e);let f=0;for(let m=0;m<u;m++){const g=te(e),y=Hi(e);c.sampleTable.sampleCompositionTimeOffsets.push({startIndex:f,count:g,offset:y}),f+=g}}break;case"stsz":{const c=this.currentTrack;if(!c||!c.sampleTable)break;e.skip(4);const u=te(e),f=te(e);if(u===0)for(let m=0;m<f;m++){const g=te(e);c.sampleTable.sampleSizes.push(g)}else c.sampleTable.sampleSizes.push(u)}break;case"stz2":{const c=this.currentTrack;if(!c||!c.sampleTable)break;e.skip(4),e.skip(3);const u=me(e),f=te(e),m=ve(e,Math.ceil(f*u/8)),g=new Ye(m);for(let y=0;y<f;y++){const w=g.readBits(u);c.sampleTable.sampleSizes.push(w)}}break;case"stss":{const c=this.currentTrack;if(!c||!c.sampleTable)break;e.skip(4),c.sampleTable.keySampleIndices=[];const u=te(e);for(let f=0;f<u;f++){const m=te(e)-1;c.sampleTable.keySampleIndices.push(m)}c.sampleTable.keySampleIndices[0]!==0&&c.sampleTable.keySampleIndices.unshift(0)}break;case"stsc":{const c=this.currentTrack;if(!c||!c.sampleTable)break;e.skip(4);const u=te(e);for(let m=0;m<u;m++){const g=te(e)-1,y=te(e),w=te(e);c.sampleTable.sampleToChunk.push({startSampleIndex:-1,startChunkIndex:g,samplesPerChunk:y,sampleDescriptionIndex:w})}let f=0;for(let m=0;m<c.sampleTable.sampleToChunk.length;m++)if(c.sampleTable.sampleToChunk[m].startSampleIndex=f,m<c.sampleTable.sampleToChunk.length-1){const y=c.sampleTable.sampleToChunk[m+1].startChunkIndex-c.sampleTable.sampleToChunk[m].startChunkIndex;f+=y*c.sampleTable.sampleToChunk[m].samplesPerChunk}}break;case"stco":{const c=this.currentTrack;if(!c||!c.sampleTable)break;e.skip(4);const u=te(e);for(let f=0;f<u;f++){const m=te(e);c.sampleTable.chunkOffsets.push(m)}}break;case"co64":{const c=this.currentTrack;if(!c||!c.sampleTable)break;e.skip(4);const u=te(e);for(let f=0;f<u;f++){const m=_n(e);c.sampleTable.chunkOffsets.push(m)}}break;case"mvex":this.isFragmented=!0,this.readContiguousBoxes(e.slice(a,s.contentSize));break;case"mehd":{const c=me(e);e.skip(3);const u=c===1?_n(e):te(e);this.movieDurationInTimescale=u}break;case"trex":{e.skip(4);const c=te(e),u=te(e),f=te(e),m=te(e),g=te(e);this.fragmentTrackDefaults.push({trackId:c,defaultSampleDescriptionIndex:u,defaultSampleDuration:f,defaultSampleSize:m,defaultSampleFlags:g})}break;case"tfra":{const c=me(e);e.skip(3);const u=te(e),f=this.tracks.find(A=>A.id===u);if(!f)break;const m=te(e),g=(m&48)>>4,y=(m&12)>>2,w=m&3,T=[me,Pt,Ls,te],S=T[g],v=T[y],x=T[w],_=te(e);for(let A=0;A<_;A++){const O=c===1?_n(e):te(e),B=c===1?_n(e):te(e);S(e),v(e),x(e),f.fragmentLookupTable.push({timestamp:O,moofOffset:B})}f.fragmentLookupTable.sort((A,O)=>A.timestamp-O.timestamp);for(let A=0;A<f.fragmentLookupTable.length-1;A++){const O=f.fragmentLookupTable[A],B=f.fragmentLookupTable[A+1];O.timestamp===B.timestamp&&(f.fragmentLookupTable.splice(A+1,1),A--)}}break;case"moof":this.currentFragment={moofOffset:r,moofSize:s.totalSize,implicitBaseDataOffset:r,trackData:new Map},this.readContiguousBoxes(e.slice(a,s.contentSize)),this.lastReadFragment=this.currentFragment,this.currentFragment=null;break;case"traf":if(b(this.currentFragment),this.readContiguousBoxes(e.slice(a,s.contentSize)),this.currentTrack){const c=this.currentFragment.trackData.get(this.currentTrack.id);if(c){const{currentFragmentState:u}=this.currentTrack;b(u),u.startTimestamp!==null&&(Zu(c,u.startTimestamp),c.startTimestampIsFinal=!0)}this.currentTrack.currentFragmentState=null,this.currentTrack=null}break;case"tfhd":{b(this.currentFragment),e.skip(1);const c=Ls(e),u=!!(c&1),f=!!(c&2),m=!!(c&8),g=!!(c&16),y=!!(c&32),w=!!(c&65536),T=!!(c&131072),S=te(e),v=this.tracks.find(_=>_.id===S);if(!v)break;const x=this.fragmentTrackDefaults.find(_=>_.trackId===S);this.currentTrack=v,v.currentFragmentState={baseDataOffset:this.currentFragment.implicitBaseDataOffset,sampleDescriptionIndex:x?.defaultSampleDescriptionIndex??null,defaultSampleDuration:x?.defaultSampleDuration??null,defaultSampleSize:x?.defaultSampleSize??null,defaultSampleFlags:x?.defaultSampleFlags??null,startTimestamp:null},u?v.currentFragmentState.baseDataOffset=_n(e):T&&(v.currentFragmentState.baseDataOffset=this.currentFragment.moofOffset),f&&(v.currentFragmentState.sampleDescriptionIndex=te(e)),m&&(v.currentFragmentState.defaultSampleDuration=te(e)),g&&(v.currentFragmentState.defaultSampleSize=te(e)),y&&(v.currentFragmentState.defaultSampleFlags=te(e)),w&&(v.currentFragmentState.defaultSampleDuration=0)}break;case"tfdt":{const c=this.currentTrack;if(!c)break;b(c.currentFragmentState);const u=me(e);e.skip(3);const f=u===0?te(e):_n(e);c.currentFragmentState.startTimestamp=f}break;case"trun":{const c=this.currentTrack;if(!c)break;if(b(this.currentFragment),b(c.currentFragmentState),this.currentFragment.trackData.has(c.id)){console.warn("Can't have two trun boxes for the same track in one fragment. Ignoring...");break}const u=me(e),f=Ls(e),m=!!(f&1),g=!!(f&4),y=!!(f&256),w=!!(f&512),T=!!(f&1024),S=!!(f&2048),v=te(e);let x=c.currentFragmentState.baseDataOffset;m&&(x+=Hi(e));let _=null;g&&(_=te(e));let A=x;if(v===0){this.currentFragment.implicitBaseDataOffset=A;break}let O=0;const B={track:c,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,samples:[],presentationTimestamps:[],startTimestampIsFinal:!1};this.currentFragment.trackData.set(c.id,B);for(let q=0;q<v;q++){let G;y?G=te(e):(b(c.currentFragmentState.defaultSampleDuration!==null),G=c.currentFragmentState.defaultSampleDuration);let se;w?se=te(e):(b(c.currentFragmentState.defaultSampleSize!==null),se=c.currentFragmentState.defaultSampleSize);let oe;T?oe=te(e):(b(c.currentFragmentState.defaultSampleFlags!==null),oe=c.currentFragmentState.defaultSampleFlags),q===0&&_!==null&&(oe=_);let re=0;S&&(u===0?re=te(e):re=Hi(e));const ne=!(oe&65536);B.samples.push({presentationTimestamp:O+re,duration:G,byteOffset:A,byteSize:se,isKeyFrame:ne}),A+=se,O+=G}B.presentationTimestamps=B.samples.map((q,G)=>({presentationTimestamp:q.presentationTimestamp,sampleIndex:G})).sort((q,G)=>q.presentationTimestamp-G.presentationTimestamp);for(let q=0;q<B.presentationTimestamps.length;q++){const G=B.presentationTimestamps[q],se=B.samples[G.sampleIndex];if(B.firstKeyFrameTimestamp===null&&se.isKeyFrame&&(B.firstKeyFrameTimestamp=se.presentationTimestamp),q<B.presentationTimestamps.length-1){const oe=B.presentationTimestamps[q+1];se.duration=oe.presentationTimestamp-G.presentationTimestamp}}const j=B.samples[B.presentationTimestamps[0].sampleIndex],L=B.samples[ot(B.presentationTimestamps).sampleIndex];B.startTimestamp=j.presentationTimestamp,B.endTimestamp=L.presentationTimestamp+L.duration,this.currentFragment.implicitBaseDataOffset=A}break;case"udta":{const c=this.iterateContiguousBoxes(e.slice(a,s.contentSize));for(const{boxInfo:u,slice:f}of c){if(u.name!=="meta"&&!this.currentTrack){const m=f.filePos;this.metadataTags.raw??={},u.name[0]===""?this.metadataTags.raw[u.name]??=Hn(f):this.metadataTags.raw[u.name]??=ve(f,u.contentSize),f.filePos=m}switch(u.name){case"meta":f.skip(-u.headerSize),this.traverseBox(f);break;case"nam":case"name":this.currentTrack?this.currentTrack.name=mn.decode(ve(f,u.contentSize)):this.metadataTags.title??=Hn(f);break;case"des":this.currentTrack||(this.metadataTags.description??=Hn(f));break;case"ART":this.currentTrack||(this.metadataTags.artist??=Hn(f));break;case"alb":this.currentTrack||(this.metadataTags.album??=Hn(f));break;case"albr":this.currentTrack||(this.metadataTags.albumArtist??=Hn(f));break;case"gen":this.currentTrack||(this.metadataTags.genre??=Hn(f));break;case"day":if(!this.currentTrack){const m=new Date(Hn(f));Number.isNaN(m.getTime())||(this.metadataTags.date??=m)}break;case"cmt":this.currentTrack||(this.metadataTags.comment??=Hn(f));break;case"lyr":this.currentTrack||(this.metadataTags.lyrics??=Hn(f));break}}}break;case"meta":{if(this.currentTrack)break;const u=te(e)!==0;this.currentMetadataKeys=new Map,u?this.readContiguousBoxes(e.slice(a,s.contentSize)):this.readContiguousBoxes(e.slice(a+4,s.contentSize-4)),this.currentMetadataKeys=null}break;case"keys":{if(!this.currentMetadataKeys)break;e.skip(4);const c=te(e);for(let u=0;u<c;u++){const f=te(e);e.skip(4);const m=mn.decode(ve(e,f-8));this.currentMetadataKeys.set(u+1,m)}}break;case"ilst":{if(!this.currentMetadataKeys)break;const c=this.iterateContiguousBoxes(e.slice(a,s.contentSize));for(const{boxInfo:u,slice:f}of c){let m=u.name;const g=(m.charCodeAt(0)<<24)+(m.charCodeAt(1)<<16)+(m.charCodeAt(2)<<8)+m.charCodeAt(3);this.currentMetadataKeys.has(g)&&(m=this.currentMetadataKeys.get(g));const y=Gw(f);switch(this.metadataTags.raw??={},this.metadataTags.raw[m]??=y,m){case"nam":case"titl":case"com.apple.quicktime.title":case"title":typeof y=="string"&&(this.metadataTags.title??=y);break;case"des":case"desc":case"dscp":case"com.apple.quicktime.description":case"description":typeof y=="string"&&(this.metadataTags.description??=y);break;case"ART":case"com.apple.quicktime.artist":case"artist":typeof y=="string"&&(this.metadataTags.artist??=y);break;case"alb":case"albm":case"com.apple.quicktime.album":case"album":typeof y=="string"&&(this.metadataTags.album??=y);break;case"aART":case"album_artist":typeof y=="string"&&(this.metadataTags.albumArtist??=y);break;case"cmt":case"com.apple.quicktime.comment":case"comment":typeof y=="string"&&(this.metadataTags.comment??=y);break;case"gen":case"gnre":case"com.apple.quicktime.genre":case"genre":typeof y=="string"&&(this.metadataTags.genre??=y);break;case"lyr":case"lyrics":typeof y=="string"&&(this.metadataTags.lyrics??=y);break;case"day":case"rldt":case"com.apple.quicktime.creationdate":case"date":if(typeof y=="string"){const w=new Date(y);Number.isNaN(w.getTime())||(this.metadataTags.date??=w)}break;case"covr":case"com.apple.quicktime.artwork":y instanceof Qs?(this.metadataTags.images??=[],this.metadataTags.images.push({data:y.data,kind:"coverFront",mimeType:y.mimeType})):y instanceof Uint8Array&&(this.metadataTags.images??=[],this.metadataTags.images.push({data:y,kind:"coverFront",mimeType:"image/*"}));break;case"track":if(typeof y=="string"){const w=y.split("/"),T=Number.parseInt(w[0],10),S=w[1]&&Number.parseInt(w[1],10);Number.isInteger(T)&&T>0&&(this.metadataTags.trackNumber??=T),S&&Number.isInteger(S)&&S>0&&(this.metadataTags.tracksTotal??=S)}break;case"trkn":if(y instanceof Uint8Array&&y.length>=6){const w=tt(y),T=w.getUint16(2,!1),S=w.getUint16(4,!1);T>0&&(this.metadataTags.trackNumber??=T),S>0&&(this.metadataTags.tracksTotal??=S)}break;case"disc":case"disk":if(y instanceof Uint8Array&&y.length>=6){const w=tt(y),T=w.getUint16(2,!1),S=w.getUint16(4,!1);T>0&&(this.metadataTags.discNumber??=T),S>0&&(this.metadataTags.discsTotal??=S)}break}}}break}return e.filePos=l,!0}}class mg{constructor(e){this.internalTrack=e,this.packetToSampleIndex=new WeakMap,this.packetToFragmentLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.internalCodecId}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}getTimeResolution(){return this.internalTrack.timescale}getDisposition(){return this.internalTrack.disposition}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}async getFirstPacket(e){const r=await this.fetchPacketForSampleIndex(0,e);return r||!this.internalTrack.demuxer.isFragmented?r:this.performFragmentedLookup(null,s=>s.trackData.get(this.internalTrack.id)?{sampleIndex:0,correctSampleFound:!0}:{sampleIndex:-1,correctSampleFound:!1},-1/0,1/0,e)}mapTimestampIntoTimescale(e){return Ul(e*this.internalTrack.timescale)+this.internalTrack.editListOffset}async getPacket(e,r){const s=this.mapTimestampIntoTimescale(e),a=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),l=Td(a,s),c=await this.fetchPacketForSampleIndex(l,r);return!Hm(a)||!this.internalTrack.demuxer.isFragmented?c:this.performFragmentedLookup(null,u=>{const f=u.trackData.get(this.internalTrack.id);if(!f)return{sampleIndex:-1,correctSampleFound:!1};const m=Ve(f.presentationTimestamps,s,w=>w.presentationTimestamp),g=m!==-1?f.presentationTimestamps[m].sampleIndex:-1,y=m!==-1&&s<f.endTimestamp;return{sampleIndex:g,correctSampleFound:y}},s,s,r)}async getNextPacket(e,r){const s=this.packetToSampleIndex.get(e);if(s!==void 0)return this.fetchPacketForSampleIndex(s+1,r);const a=this.packetToFragmentLocation.get(e);if(a===void 0)throw new Error("Packet was not created from this track.");return this.performFragmentedLookup(a.fragment,l=>{if(l===a.fragment){const c=l.trackData.get(this.internalTrack.id);if(a.sampleIndex+1<c.samples.length)return{sampleIndex:a.sampleIndex+1,correctSampleFound:!0}}else if(l.trackData.get(this.internalTrack.id))return{sampleIndex:0,correctSampleFound:!0};return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,r)}async getKeyPacket(e,r){const s=this.mapTimestampIntoTimescale(e),a=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),l=Jw(a,s),c=await this.fetchPacketForSampleIndex(l,r);return!Hm(a)||!this.internalTrack.demuxer.isFragmented?c:this.performFragmentedLookup(null,u=>{const f=u.trackData.get(this.internalTrack.id);if(!f)return{sampleIndex:-1,correctSampleFound:!1};const m=Op(f.presentationTimestamps,w=>f.samples[w.sampleIndex].isKeyFrame&&w.presentationTimestamp<=s),g=m!==-1?f.presentationTimestamps[m].sampleIndex:-1,y=m!==-1&&s<f.endTimestamp;return{sampleIndex:g,correctSampleFound:y}},s,s,r)}async getNextKeyPacket(e,r){const s=this.packetToSampleIndex.get(e);if(s!==void 0){const l=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),c=tk(l,s);return this.fetchPacketForSampleIndex(c,r)}const a=this.packetToFragmentLocation.get(e);if(a===void 0)throw new Error("Packet was not created from this track.");return this.performFragmentedLookup(a.fragment,l=>{if(l===a.fragment){const u=l.trackData.get(this.internalTrack.id).samples.findIndex((f,m)=>f.isKeyFrame&&m>a.sampleIndex);if(u!==-1)return{sampleIndex:u,correctSampleFound:!0}}else{const c=l.trackData.get(this.internalTrack.id);if(c&&c.firstKeyFrameTimestamp!==null){const u=c.samples.findIndex(f=>f.isKeyFrame);return b(u!==-1),{sampleIndex:u,correctSampleFound:!0}}}return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,r)}async fetchPacketForSampleIndex(e,r){if(e===-1)return null;const s=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),a=ek(s,e);if(!a)return null;let l;if(r.metadataOnly)l=gn;else{let m=this.internalTrack.demuxer.reader.requestSlice(a.sampleOffset,a.sampleSize);m instanceof Promise&&(m=await m),b(m),l=ve(m,a.sampleSize)}const c=(a.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,u=a.duration/this.internalTrack.timescale,f=new qe(l,a.isKeyFrame?"key":"delta",c,u,e,a.sampleSize);return this.packetToSampleIndex.set(f,e),f}async fetchPacketInFragment(e,r,s){if(r===-1)return null;const l=e.trackData.get(this.internalTrack.id).samples[r];b(l);let c;if(s.metadataOnly)c=gn;else{let g=this.internalTrack.demuxer.reader.requestSlice(l.byteOffset,l.byteSize);g instanceof Promise&&(g=await g),b(g),c=ve(g,l.byteSize)}const u=(l.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,f=l.duration/this.internalTrack.timescale,m=new qe(c,l.isKeyFrame?"key":"delta",u,f,e.moofOffset+r,l.byteSize);return this.packetToFragmentLocation.set(m,{fragment:e,sampleIndex:r}),m}async performFragmentedLookup(e,r,s,a,l){const c=this.internalTrack.demuxer;let u=null,f=null,m=-1;if(e){const{sampleIndex:x,correctSampleFound:_}=r(e);if(_)return this.fetchPacketInFragment(e,x,l);x!==-1&&(f=e,m=x)}const g=Ve(this.internalTrack.fragmentLookupTable,s,x=>x.timestamp),y=g!==-1?this.internalTrack.fragmentLookupTable[g]:null,w=Ve(this.internalTrack.fragmentPositionCache,s,x=>x.startTimestamp),T=w!==-1?this.internalTrack.fragmentPositionCache[w]:null,S=Math.max(y?.moofOffset??0,T?.moofOffset??0)||null;let v;for(e?S===null||e.moofOffset>=S?(v=e.moofOffset+e.moofSize,u=e):v=S:v=S??0;;){if(u){const O=u.trackData.get(this.internalTrack.id);if(O&&O.startTimestamp>a)break}let x=c.reader.requestSliceRange(v,gr,Vi);if(x instanceof Promise&&(x=await x),!x)break;const _=v,A=ni(x);if(!A)break;if(A.name==="moof"){u=await c.readFragment(_);const{sampleIndex:O,correctSampleFound:B}=r(u);if(B)return this.fetchPacketInFragment(u,O,l);O!==-1&&(f=u,m=O)}v=_+A.totalSize}if(y&&(!f||f.moofOffset<y.moofOffset)){const x=this.internalTrack.fragmentLookupTable[g-1];b(!x||x.timestamp<y.timestamp);const _=x?.timestamp??-1/0;return this.performFragmentedLookup(null,r,_,a,l)}return f?this.fetchPacketInFragment(f,m,l):null}}class Yw extends mg{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return!1}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{if(this.internalTrack.info.codec==="vp9"&&!this.internalTrack.info.vp9CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.vp9CodecInfo=e&&rg(e.data)}else if(this.internalTrack.info.codec==="av1"&&!this.internalTrack.info.av1CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.av1CodecInfo=e&&sg(e.data)}return{codec:Vp(this.internalTrack.info),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class Zw extends mg{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:Wp(this.internalTrack.info),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}const Td=(n,e)=>{if(n.presentationTimestamps){const r=Ve(n.presentationTimestamps,e,s=>s.presentationTimestamp);return r===-1?-1:n.presentationTimestamps[r].sampleIndex}else{const r=Ve(n.sampleTimingEntries,e,a=>a.startDecodeTimestamp);if(r===-1)return-1;const s=n.sampleTimingEntries[r];return s.startIndex+Math.min(Math.floor((e-s.startDecodeTimestamp)/s.delta),s.count-1)}},Jw=(n,e)=>{if(!n.keySampleIndices)return Td(n,e);if(n.presentationTimestamps){const r=Ve(n.presentationTimestamps,e,s=>s.presentationTimestamp);if(r===-1)return-1;for(let s=r;s>=0;s--){const a=n.presentationTimestamps[s].sampleIndex;if(Yl(n.keySampleIndices,a,c=>c)!==-1)return a}return-1}else{const r=Td(n,e),s=Ve(n.keySampleIndices,r,a=>a);return n.keySampleIndices[s]??-1}},ek=(n,e)=>{const r=Ve(n.sampleTimingEntries,e,_=>_.startIndex),s=n.sampleTimingEntries[r];if(!s||s.startIndex+s.count<=e)return null;let l=s.startDecodeTimestamp+(e-s.startIndex)*s.delta;const c=Ve(n.sampleCompositionTimeOffsets,e,_=>_.startIndex),u=n.sampleCompositionTimeOffsets[c];u&&e-u.startIndex<u.count&&(l+=u.offset);const f=n.sampleSizes[Math.min(e,n.sampleSizes.length-1)],m=Ve(n.sampleToChunk,e,_=>_.startSampleIndex),g=n.sampleToChunk[m];b(g);const y=g.startChunkIndex+Math.floor((e-g.startSampleIndex)/g.samplesPerChunk),w=n.chunkOffsets[y],T=g.startSampleIndex+(y-g.startChunkIndex)*g.samplesPerChunk;let S=0,v=w;if(n.sampleSizes.length===1)v+=f*(e-T),S+=f*g.samplesPerChunk;else for(let _=T;_<T+g.samplesPerChunk;_++){const A=n.sampleSizes[_];_<e&&(v+=A),S+=A}let x=s.delta;if(n.presentationTimestamps){const _=n.presentationTimestampIndexMap[e];b(_!==void 0),_<n.presentationTimestamps.length-1&&(x=n.presentationTimestamps[_+1].presentationTimestamp-l)}return{presentationTimestamp:l,duration:x,sampleOffset:v,sampleSize:f,chunkOffset:w,chunkSize:S,isKeyFrame:n.keySampleIndices?Yl(n.keySampleIndices,e,_=>_)!==-1:!0}},tk=(n,e)=>{if(!n.keySampleIndices)return e+1;const r=Ve(n.keySampleIndices,e,s=>s);return n.keySampleIndices[r+1]??-1},Zu=(n,e)=>{n.startTimestamp+=e,n.endTimestamp+=e;for(const r of n.samples)r.presentationTimestamp+=e;for(const r of n.presentationTimestamps)r.presentationTimestamp+=e},nk=n=>{const[e,,,r]=n,s=Math.hypot(e,r),a=e/s,l=r/s,c=-Math.atan2(l,a)*(180/Math.PI);return Number.isFinite(c)?c:0},Hm=n=>n.sampleSizes.length===0;/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Sd{constructor(e){this.value=e}}class vd{constructor(e){this.value=e}}class pg{constructor(e){this.value=e}}class Jr{constructor(e){this.value=e}}var I;(function(n){n[n.EBML=440786851]="EBML",n[n.EBMLVersion=17030]="EBMLVersion",n[n.EBMLReadVersion=17143]="EBMLReadVersion",n[n.EBMLMaxIDLength=17138]="EBMLMaxIDLength",n[n.EBMLMaxSizeLength=17139]="EBMLMaxSizeLength",n[n.DocType=17026]="DocType",n[n.DocTypeVersion=17031]="DocTypeVersion",n[n.DocTypeReadVersion=17029]="DocTypeReadVersion",n[n.Void=236]="Void",n[n.Segment=408125543]="Segment",n[n.SeekHead=290298740]="SeekHead",n[n.Seek=19899]="Seek",n[n.SeekID=21419]="SeekID",n[n.SeekPosition=21420]="SeekPosition",n[n.Duration=17545]="Duration",n[n.Info=357149030]="Info",n[n.TimestampScale=2807729]="TimestampScale",n[n.MuxingApp=19840]="MuxingApp",n[n.WritingApp=22337]="WritingApp",n[n.Tracks=374648427]="Tracks",n[n.TrackEntry=174]="TrackEntry",n[n.TrackNumber=215]="TrackNumber",n[n.TrackUID=29637]="TrackUID",n[n.TrackType=131]="TrackType",n[n.FlagEnabled=185]="FlagEnabled",n[n.FlagDefault=136]="FlagDefault",n[n.FlagForced=21930]="FlagForced",n[n.FlagOriginal=21934]="FlagOriginal",n[n.FlagHearingImpaired=21931]="FlagHearingImpaired",n[n.FlagVisualImpaired=21932]="FlagVisualImpaired",n[n.FlagCommentary=21935]="FlagCommentary",n[n.FlagLacing=156]="FlagLacing",n[n.Name=21358]="Name",n[n.Language=2274716]="Language",n[n.LanguageBCP47=2274717]="LanguageBCP47",n[n.CodecID=134]="CodecID",n[n.CodecPrivate=25506]="CodecPrivate",n[n.CodecDelay=22186]="CodecDelay",n[n.SeekPreRoll=22203]="SeekPreRoll",n[n.DefaultDuration=2352003]="DefaultDuration",n[n.Video=224]="Video",n[n.PixelWidth=176]="PixelWidth",n[n.PixelHeight=186]="PixelHeight",n[n.AlphaMode=21440]="AlphaMode",n[n.Audio=225]="Audio",n[n.SamplingFrequency=181]="SamplingFrequency",n[n.Channels=159]="Channels",n[n.BitDepth=25188]="BitDepth",n[n.SimpleBlock=163]="SimpleBlock",n[n.BlockGroup=160]="BlockGroup",n[n.Block=161]="Block",n[n.BlockAdditions=30113]="BlockAdditions",n[n.BlockMore=166]="BlockMore",n[n.BlockAdditional=165]="BlockAdditional",n[n.BlockAddID=238]="BlockAddID",n[n.BlockDuration=155]="BlockDuration",n[n.ReferenceBlock=251]="ReferenceBlock",n[n.Cluster=524531317]="Cluster",n[n.Timestamp=231]="Timestamp",n[n.Cues=475249515]="Cues",n[n.CuePoint=187]="CuePoint",n[n.CueTime=179]="CueTime",n[n.CueTrackPositions=183]="CueTrackPositions",n[n.CueTrack=247]="CueTrack",n[n.CueClusterPosition=241]="CueClusterPosition",n[n.Colour=21936]="Colour",n[n.MatrixCoefficients=21937]="MatrixCoefficients",n[n.TransferCharacteristics=21946]="TransferCharacteristics",n[n.Primaries=21947]="Primaries",n[n.Range=21945]="Range",n[n.Projection=30320]="Projection",n[n.ProjectionType=30321]="ProjectionType",n[n.ProjectionPoseRoll=30325]="ProjectionPoseRoll",n[n.Attachments=423732329]="Attachments",n[n.AttachedFile=24999]="AttachedFile",n[n.FileDescription=18046]="FileDescription",n[n.FileName=18030]="FileName",n[n.FileMediaType=18016]="FileMediaType",n[n.FileData=18012]="FileData",n[n.FileUID=18094]="FileUID",n[n.Chapters=272869232]="Chapters",n[n.Tags=307544935]="Tags",n[n.Tag=29555]="Tag",n[n.Targets=25536]="Targets",n[n.TargetTypeValue=26826]="TargetTypeValue",n[n.TargetType=25546]="TargetType",n[n.TagTrackUID=25541]="TagTrackUID",n[n.TagEditionUID=25545]="TagEditionUID",n[n.TagChapterUID=25540]="TagChapterUID",n[n.TagAttachmentUID=25542]="TagAttachmentUID",n[n.SimpleTag=26568]="SimpleTag",n[n.TagName=17827]="TagName",n[n.TagLanguage=17530]="TagLanguage",n[n.TagString=17543]="TagString",n[n.TagBinary=17541]="TagBinary",n[n.ContentEncodings=28032]="ContentEncodings",n[n.ContentEncoding=25152]="ContentEncoding",n[n.ContentEncodingOrder=20529]="ContentEncodingOrder",n[n.ContentEncodingScope=20530]="ContentEncodingScope",n[n.ContentCompression=20532]="ContentCompression",n[n.ContentCompAlgo=16980]="ContentCompAlgo",n[n.ContentCompSettings=16981]="ContentCompSettings",n[n.ContentEncryption=20533]="ContentEncryption"})(I||(I={}));const rk=[I.EBML,I.Segment],go=[I.SeekHead,I.Info,I.Cluster,I.Tracks,I.Cues,I.Attachments,I.Chapters,I.Tags],zl=[...rk,...go],$m=n=>n<256?1:n<65536?2:n<1<<24?3:n<2**32?4:n<2**40?5:6,Qm=n=>n<1n<<8n?1:n<1n<<16n?2:n<1n<<24n?3:n<1n<<32n?4:n<1n<<40n?5:n<1n<<48n?6:n<1n<<56n?7:8,qm=n=>n>=-64&&n<64?1:n>=-8192&&n<8192?2:n>=-1048576&&n<1<<20?3:n>=-134217728&&n<1<<27?4:n>=-17179869184&&n<2**34?5:6,ik=n=>{if(n<127)return 1;if(n<16383)return 2;if(n<(1<<21)-1)return 3;if(n<(1<<28)-1)return 4;if(n<2**35-1)return 5;if(n<2**42-1)return 6;throw new Error("EBML varint size not supported "+n)};class sk{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap,this.dataOffsets=new WeakMap}writeByte(e){this.helperView.setUint8(0,e),this.writer.write(this.helper.subarray(0,1))}writeFloat32(e){this.helperView.setFloat32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeFloat64(e){this.helperView.setFloat64(0,e,!1),this.writer.write(this.helper)}writeUnsignedInt(e,r=$m(e)){let s=0;switch(r){case 6:this.helperView.setUint8(s++,e/2**40|0);case 5:this.helperView.setUint8(s++,e/2**32|0);case 4:this.helperView.setUint8(s++,e>>24);case 3:this.helperView.setUint8(s++,e>>16);case 2:this.helperView.setUint8(s++,e>>8);case 1:this.helperView.setUint8(s++,e);break;default:throw new Error("Bad unsigned int size "+r)}this.writer.write(this.helper.subarray(0,s))}writeUnsignedBigInt(e,r=Qm(e)){let s=0;for(let a=r-1;a>=0;a--)this.helperView.setUint8(s++,Number(e>>BigInt(a*8)&0xffn));this.writer.write(this.helper.subarray(0,s))}writeSignedInt(e,r=qm(e)){e<0&&(e+=2**(r*8)),this.writeUnsignedInt(e,r)}writeVarInt(e,r=ik(e)){let s=0;switch(r){case 1:this.helperView.setUint8(s++,128|e);break;case 2:this.helperView.setUint8(s++,64|e>>8),this.helperView.setUint8(s++,e);break;case 3:this.helperView.setUint8(s++,32|e>>16),this.helperView.setUint8(s++,e>>8),this.helperView.setUint8(s++,e);break;case 4:this.helperView.setUint8(s++,16|e>>24),this.helperView.setUint8(s++,e>>16),this.helperView.setUint8(s++,e>>8),this.helperView.setUint8(s++,e);break;case 5:this.helperView.setUint8(s++,8|e/2**32&7),this.helperView.setUint8(s++,e>>24),this.helperView.setUint8(s++,e>>16),this.helperView.setUint8(s++,e>>8),this.helperView.setUint8(s++,e);break;case 6:this.helperView.setUint8(s++,4|e/2**40&3),this.helperView.setUint8(s++,e/2**32|0),this.helperView.setUint8(s++,e>>24),this.helperView.setUint8(s++,e>>16),this.helperView.setUint8(s++,e>>8),this.helperView.setUint8(s++,e);break;default:throw new Error("Bad EBML varint size "+r)}this.writer.write(this.helper.subarray(0,s))}writeAsciiString(e){this.writer.write(new Uint8Array(e.split("").map(r=>r.charCodeAt(0))))}writeEBML(e){if(e!==null)if(e instanceof Uint8Array)this.writer.write(e);else if(Array.isArray(e))for(const r of e)this.writeEBML(r);else if(this.offsets.set(e,this.writer.getPos()),this.writeUnsignedInt(e.id),Array.isArray(e.data)){const r=this.writer.getPos(),s=e.size===-1?1:e.size??4;e.size===-1?this.writeByte(255):this.writer.seek(this.writer.getPos()+s);const a=this.writer.getPos();if(this.dataOffsets.set(e,a),this.writeEBML(e.data),e.size!==-1){const l=this.writer.getPos()-a,c=this.writer.getPos();this.writer.seek(r),this.writeVarInt(l,s),this.writer.seek(c)}}else if(typeof e.data=="number"){const r=e.size??$m(e.data);this.writeVarInt(r),this.writeUnsignedInt(e.data,r)}else if(typeof e.data=="bigint"){const r=e.size??Qm(e.data);this.writeVarInt(r),this.writeUnsignedBigInt(e.data,r)}else if(typeof e.data=="string")this.writeVarInt(e.data.length),this.writeAsciiString(e.data);else if(e.data instanceof Uint8Array)this.writeVarInt(e.data.byteLength,e.size),this.writer.write(e.data);else if(e.data instanceof Sd)this.writeVarInt(4),this.writeFloat32(e.data.value);else if(e.data instanceof vd)this.writeVarInt(8),this.writeFloat64(e.data.value);else if(e.data instanceof pg){const r=e.size??qm(e.data.value);this.writeVarInt(r),this.writeSignedInt(e.data.value,r)}else if(e.data instanceof Jr){const r=Wt.encode(e.data.value);this.writeVarInt(r.length),this.writer.write(r)}else Mn(e.data)}}const bd=8,An=2,yr=2*bd,gg=n=>{const e=me(n);if(n.skip(-1),e===0)return null;let r=1,s=128;for(;(e&s)===0;)r++,s>>=1;return r},oo=n=>{const e=me(n);if(e===0)return null;let r=1,s=128;for(;(e&s)===0;)r++,s>>=1;let a=e&s-1;for(let l=1;l<r;l++)a*=256,a+=me(n);return a},Ie=(n,e)=>{if(e<1||e>8)throw new Error("Bad unsigned int size "+e);let r=0;for(let s=0;s<e;s++)r*=256,r+=me(n);return r},ak=(n,e)=>{if(e<1)throw new Error("Bad unsigned int size "+e);let r=0n;for(let s=0;s<e;s++)r<<=8n,r+=BigInt(me(n));return r},Yd=n=>{const e=gg(n);return e===null?null:Ie(n,e)},yg=n=>{let e=me(n);return e===255?e=null:(n.skip(-1),e=oo(n),e===72057594037927940&&(e=null)),e},mr=n=>{const e=Yd(n);if(e===null)return null;const r=yg(n);return{id:e,size:r}},Us=(n,e)=>{const r=ve(n,e);let s=0;for(;s<e&&r[s]!==0;)s+=1;return String.fromCharCode(...r.subarray(0,s))},no=(n,e)=>{const r=ve(n,e);let s=0;for(;s<e&&r[s]!==0;)s+=1;return mn.decode(r.subarray(0,s))},Ju=(n,e)=>{if(e===0)return 0;if(e!==4&&e!==8)throw new Error("Bad float size "+e);return e===4?fT(n):Ag(n)},xd=async(n,e,r,s)=>{const a=new Set(r);let l=e;for(;s===null||l<s;){let c=n.requestSliceRange(l,An,yr);if(c instanceof Promise&&(c=await c),!c)break;const u=mr(c);if(!u)break;if(a.has(u.id))return{pos:l,found:!0};ei(u.size),l=c.filePos+u.size}return{pos:s!==null&&s>l?s:l,found:!1}},wg=async(n,e,r,s)=>{const l=new Set(r);let c=e;for(;c<s;){let u=n.requestSliceRange(c,0,Math.min(65536,s-c));if(u instanceof Promise&&(u=await u),!u||u.length<bd)break;for(let f=0;f<u.length-bd;f++){u.filePos=c;const m=Yd(u);if(m!==null&&l.has(m))return c;c++}}return null},En={avc:"V_MPEG4/ISO/AVC",hevc:"V_MPEGH/ISO/HEVC",vp8:"V_VP8",vp9:"V_VP9",av1:"V_AV1",aac:"A_AAC",mp3:"A_MPEG/L3",opus:"A_OPUS",vorbis:"A_VORBIS",flac:"A_FLAC","pcm-u8":"A_PCM/INT/LIT","pcm-s16":"A_PCM/INT/LIT","pcm-s16be":"A_PCM/INT/BIG","pcm-s24":"A_PCM/INT/LIT","pcm-s24be":"A_PCM/INT/BIG","pcm-s32":"A_PCM/INT/LIT","pcm-s32be":"A_PCM/INT/BIG","pcm-f32":"A_PCM/FLOAT/IEEE","pcm-f64":"A_PCM/FLOAT/IEEE",webvtt:"S_TEXT/WEBVTT"};function ei(n){if(n===null)throw new Error("Undefined element size is used in a place where it is not supported.")}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const kg=n=>{let r=(n.hasVideo?"video/":n.hasAudio?"audio/":"application/")+(n.isWebM?"webm":"x-matroska");if(n.codecStrings.length>0){const s=[...new Set(n.codecStrings.filter(Boolean))];r+=`; codecs="${s.join(", ")}"`}return r};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var fr;(function(n){n[n.None=0]="None",n[n.Xiph=1]="Xiph",n[n.FixedSize=2]="FixedSize",n[n.Ebml=3]="Ebml"})(fr||(fr={}));var jl;(function(n){n[n.Block=1]="Block",n[n.Private=2]="Private",n[n.Next=4]="Next"})(jl||(jl={}));var co;(function(n){n[n.Zlib=0]="Zlib",n[n.Bzlib=1]="Bzlib",n[n.lzo1x=2]="lzo1x",n[n.HeaderStripping=3]="HeaderStripping"})(co||(co={}));const ed=[{id:I.SeekHead,flag:"seekHeadSeen"},{id:I.Info,flag:"infoSeen"},{id:I.Tracks,flag:"tracksSeen"},{id:I.Cues,flag:"cuesSeen"}],Tg=10*2**20;class ok extends Ki{constructor(e){super(e),this.readMetadataPromise=null,this.segments=[],this.currentSegment=null,this.currentTrack=null,this.currentCluster=null,this.currentBlock=null,this.currentBlockAdditional=null,this.currentCueTime=null,this.currentDecodingInstruction=null,this.currentTagTargetIsMovie=!0,this.currentSimpleTagName=null,this.currentAttachedFile=null,this.isWebM=!1,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),r=await Promise.all(e.map(s=>s.computeDuration()));return Math.max(0,...r)}async getTracks(){return await this.readMetadata(),this.segments.flatMap(e=>e.tracks.map(r=>r.inputTrack))}async getMimeType(){await this.readMetadata();const e=await this.getTracks(),r=await Promise.all(e.map(s=>s.getCodecParameterString()));return kg({isWebM:this.isWebM,hasVideo:this.segments.some(s=>s.tracks.some(a=>a.info?.type==="video")),hasAudio:this.segments.some(s=>s.tracks.some(a=>a.info?.type==="audio")),codecStrings:r.filter(Boolean)})}async getMetadataTags(){await this.readMetadata();for(const r of this.segments)r.metadataTagsCollected||(this.reader.fileSize!==null&&await this.loadSegmentMetadata(r),r.metadataTagsCollected=!0);let e={};for(const r of this.segments)e={...e,...r.metadataTags};return e}readMetadata(){return this.readMetadataPromise??=(async()=>{let e=0;for(;;){let r=this.reader.requestSliceRange(e,An,yr);if(r instanceof Promise&&(r=await r),!r)break;const s=mr(r);if(!s)break;const a=s.id;let l=s.size;const c=r.filePos;if(a===I.EBML){ei(l);let u=this.reader.requestSlice(c,l);if(u instanceof Promise&&(u=await u),!u)break;this.readContiguousElements(u)}else if(a===I.Segment){if(await this.readSegment(c,l),l===null||this.reader.fileSize===null)break}else if(a===I.Cluster){if(this.reader.fileSize===null)break;l===null&&(l=(await xd(this.reader,c,zl,this.reader.fileSize)).pos-c);const u=ot(this.segments);u&&(u.elementEndPos=c+l)}ei(l),e=c+l}})()}async readSegment(e,r){this.currentSegment={seekHeadSeen:!1,infoSeen:!1,tracksSeen:!1,cuesSeen:!1,tagsSeen:!1,attachmentsSeen:!1,timestampScale:-1,timestampFactor:-1,duration:-1,seekEntries:[],tracks:[],cuePoints:[],dataStartPos:e,elementEndPos:r===null?null:e+r,clusterSeekStartPos:e,lastReadCluster:null,metadataTags:{},metadataTagsCollected:!1},this.segments.push(this.currentSegment);let s=e;for(;this.currentSegment.elementEndPos===null||s<this.currentSegment.elementEndPos;){let u=this.reader.requestSliceRange(s,An,yr);if(u instanceof Promise&&(u=await u),!u)break;const f=s,m=mr(u);if(!m||!go.includes(m.id)&&m.id!==I.Void){const S=await wg(this.reader,f,go,Math.min(this.currentSegment.elementEndPos??1/0,f+Tg));if(S){s=S;continue}else break}const{id:g,size:y}=m,w=u.filePos,T=ed.findIndex(S=>S.id===g);if(T!==-1){const S=ed[T].flag;this.currentSegment[S]=!0,ei(y);let v=this.reader.requestSlice(w,y);v instanceof Promise&&(v=await v),v&&this.readContiguousElements(v)}else if(g===I.Tags||g===I.Attachments){g===I.Tags?this.currentSegment.tagsSeen=!0:this.currentSegment.attachmentsSeen=!0,ei(y);let S=this.reader.requestSlice(w,y);S instanceof Promise&&(S=await S),S&&this.readContiguousElements(S)}else if(g===I.Cluster){this.currentSegment.clusterSeekStartPos=f;break}if(y===null)break;s=w+y}if(this.currentSegment.seekEntries.sort((u,f)=>u.segmentPosition-f.segmentPosition),this.reader.fileSize!==null)for(const u of this.currentSegment.seekEntries){const f=ed.find(S=>S.id===u.id);if(!f||this.currentSegment[f.flag])continue;let m=this.reader.requestSliceRange(e+u.segmentPosition,An,yr);if(m instanceof Promise&&(m=await m),!m)continue;const g=mr(m);if(!g)continue;const{id:y,size:w}=g;if(y!==f.id)continue;ei(w),this.currentSegment[f.flag]=!0;let T=this.reader.requestSlice(m.filePos,w);T instanceof Promise&&(T=await T),T&&this.readContiguousElements(T)}this.currentSegment.timestampScale===-1&&(this.currentSegment.timestampScale=1e6,this.currentSegment.timestampFactor=1e9/1e6),this.currentSegment.tracks.sort((u,f)=>Number(f.disposition.default)-Number(u.disposition.default));const a=new Map(this.currentSegment.tracks.map(u=>[u.id,u]));for(const u of this.currentSegment.cuePoints){const f=a.get(u.trackId);f&&f.cuePoints.push(u)}for(const u of this.currentSegment.tracks){u.cuePoints.sort((f,m)=>f.time-m.time);for(let f=0;f<u.cuePoints.length-1;f++){const m=u.cuePoints[f],g=u.cuePoints[f+1];m.time===g.time&&(u.cuePoints.splice(f+1,1),f--)}}let l=null,c=-1/0;for(const u of this.currentSegment.tracks)u.cuePoints.length>c&&(c=u.cuePoints.length,l=u);for(const u of this.currentSegment.tracks)u.cuePoints.length===0&&(u.cuePoints=l.cuePoints);this.currentSegment=null}async readCluster(e,r){if(r.lastReadCluster?.elementStartPos===e)return r.lastReadCluster;let s=this.reader.requestSliceRange(e,An,yr);s instanceof Promise&&(s=await s),b(s);const a=e,l=mr(s);b(l);const c=l.id;b(c===I.Cluster);let u=l.size;const f=s.filePos;u===null&&(u=(await xd(this.reader,f,zl,r.elementEndPos)).pos-f);let m=this.reader.requestSlice(f,u);m instanceof Promise&&(m=await m);const g={segment:r,elementStartPos:a,elementEndPos:f+u,dataStartPos:f,timestamp:-1,trackData:new Map};if(this.currentCluster=g,m){const y=this.readContiguousElements(m,zl);g.elementEndPos=y}for(const[,y]of g.trackData){const w=y.track;b(y.blocks.length>0);let T=!1;for(let _=0;_<y.blocks.length;_++){const A=y.blocks[_];A.timestamp+=g.timestamp,T||=A.lacing!==fr.None}y.presentationTimestamps=y.blocks.map((_,A)=>({timestamp:_.timestamp,blockIndex:A})).sort((_,A)=>_.timestamp-A.timestamp);for(let _=0;_<y.presentationTimestamps.length;_++){const A=y.presentationTimestamps[_],O=y.blocks[A.blockIndex];if(y.firstKeyFrameTimestamp===null&&O.isKeyFrame&&(y.firstKeyFrameTimestamp=O.timestamp),_<y.presentationTimestamps.length-1){const B=y.presentationTimestamps[_+1];O.duration=B.timestamp-O.timestamp}else O.duration===0&&w.defaultDuration!=null&&O.lacing===fr.None&&(O.duration=w.defaultDuration)}T&&(this.expandLacedBlocks(y.blocks,w),y.presentationTimestamps=y.blocks.map((_,A)=>({timestamp:_.timestamp,blockIndex:A})).sort((_,A)=>_.timestamp-A.timestamp));const S=y.blocks[y.presentationTimestamps[0].blockIndex],v=y.blocks[ot(y.presentationTimestamps).blockIndex];y.startTimestamp=S.timestamp,y.endTimestamp=v.timestamp+v.duration;const x=Ve(w.clusterPositionCache,y.startTimestamp,_=>_.startTimestamp);(x===-1||w.clusterPositionCache[x].elementStartPos!==a)&&w.clusterPositionCache.splice(x+1,0,{elementStartPos:g.elementStartPos,startTimestamp:y.startTimestamp})}return r.lastReadCluster=g,g}getTrackDataInCluster(e,r){let s=e.trackData.get(r);if(!s){const a=e.segment.tracks.find(l=>l.id===r);if(!a)return null;s={track:a,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,blocks:[],presentationTimestamps:[]},e.trackData.set(r,s)}return s}expandLacedBlocks(e,r){for(let s=0;s<e.length;s++){const a=e[s];if(a.lacing===fr.None)continue;a.decoded||(a.data=this.decodeBlockData(r,a.data),a.decoded=!0);const l=ta.tempFromBytes(a.data),c=[],u=me(l)+1;switch(a.lacing){case fr.Xiph:{let m=0;for(let g=0;g<u-1;g++){let y=0;for(;l.bufferPos<l.length;){const w=me(l);if(y+=w,w<255){c.push(y),m+=y;break}}}c.push(l.length-(l.bufferPos+m))}break;case fr.FixedSize:{const m=l.length-1,g=Math.floor(m/u);for(let y=0;y<u;y++)c.push(g)}break;case fr.Ebml:{const m=oo(l);b(m!==null);let g=m;c.push(g);let y=g;for(let w=1;w<u-1;w++){const T=l.bufferPos,S=oo(l);b(S!==null);const v=S,_=(1<<(l.bufferPos-T)*7-1)-1,A=v-_;g+=A,c.push(g),y+=g}c.push(l.length-(l.bufferPos+y))}break;default:b(!1)}b(c.length===u),e.splice(s,1);const f=a.duration||u*(r.defaultDuration??0);for(let m=0;m<u;m++){const g=c[m],y=ve(l,g),w=a.timestamp+f*m/u,T=f/u;e.splice(s+m,0,{timestamp:w,duration:T,isKeyFrame:a.isKeyFrame,data:y,lacing:fr.None,decoded:!0,mainAdditional:a.mainAdditional})}s+=u,s--}}async loadSegmentMetadata(e){for(const r of e.seekEntries){if(!(r.id===I.Tags&&!e.tagsSeen)){if(!(r.id===I.Attachments&&!e.attachmentsSeen))continue}let s=this.reader.requestSliceRange(e.dataStartPos+r.segmentPosition,An,yr);if(s instanceof Promise&&(s=await s),!s)continue;const a=mr(s);if(!a||a.id!==r.id)continue;const{size:l}=a;ei(l),b(!this.currentSegment),this.currentSegment=e;let c=this.reader.requestSlice(s.filePos,l);c instanceof Promise&&(c=await c),c&&this.readContiguousElements(c),this.currentSegment=null,r.id===I.Tags?e.tagsSeen=!0:r.id===I.Attachments&&(e.attachmentsSeen=!0)}}readContiguousElements(e,r){const s=e.filePos;for(;e.filePos-s<=e.length-An;){const a=e.filePos;if(!this.traverseElement(e,r))return a}return e.filePos}traverseElement(e,r){const s=mr(e);if(!s||r&&r.includes(s.id))return!1;const{id:a,size:l}=s,c=e.filePos;switch(ei(l),a){case I.DocType:this.isWebM=Us(e,l)==="webm";break;case I.Seek:{if(!this.currentSegment)break;const u={id:-1,segmentPosition:-1};this.currentSegment.seekEntries.push(u),this.readContiguousElements(e.slice(c,l)),(u.id===-1||u.segmentPosition===-1)&&this.currentSegment.seekEntries.pop()}break;case I.SeekID:{const u=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!u)break;u.id=Ie(e,l)}break;case I.SeekPosition:{const u=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!u)break;u.segmentPosition=Ie(e,l)}break;case I.TimestampScale:{if(!this.currentSegment)break;this.currentSegment.timestampScale=Ie(e,l),this.currentSegment.timestampFactor=1e9/this.currentSegment.timestampScale}break;case I.Duration:{if(!this.currentSegment)break;this.currentSegment.duration=Ju(e,l)}break;case I.TrackEntry:{if(!this.currentSegment)break;if(this.currentTrack={id:-1,segment:this.currentSegment,demuxer:this,clusterPositionCache:[],cuePoints:[],disposition:{...qi},inputTrack:null,codecId:null,codecPrivate:null,defaultDuration:null,name:null,languageCode:Jt,decodingInstructions:[],info:null},this.readContiguousElements(e.slice(c,l)),this.currentTrack.decodingInstructions.some(u=>u.data?.type!=="decompress"||u.scope!==jl.Block||u.data.algorithm!==co.HeaderStripping)&&(console.warn(`Track #${this.currentTrack.id} has an unsupported content encoding; dropping.`),this.currentTrack=null),this.currentTrack&&this.currentTrack.id!==-1&&this.currentTrack.codecId&&this.currentTrack.info){const u=this.currentTrack.codecId.indexOf("/"),f=u===-1?this.currentTrack.codecId:this.currentTrack.codecId.slice(0,u);if(this.currentTrack.info.type==="video"&&this.currentTrack.info.width!==-1&&this.currentTrack.info.height!==-1){this.currentTrack.codecId===En.avc?(this.currentTrack.info.codec="avc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===En.hevc?(this.currentTrack.info.codec="hevc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):f===En.vp8?this.currentTrack.info.codec="vp8":f===En.vp9?this.currentTrack.info.codec="vp9":f===En.av1&&(this.currentTrack.info.codec="av1");const m=this.currentTrack,g=new To(this.input,new lk(m));this.currentTrack.inputTrack=g,this.currentSegment.tracks.push(this.currentTrack)}else if(this.currentTrack.info.type==="audio"&&this.currentTrack.info.numberOfChannels!==-1&&this.currentTrack.info.sampleRate!==-1){f===En.aac?(this.currentTrack.info.codec="aac",this.currentTrack.info.aacCodecInfo={isMpeg2:this.currentTrack.codecId.includes("MPEG2")},this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===En.mp3?this.currentTrack.info.codec="mp3":f===En.opus?(this.currentTrack.info.codec="opus",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate,this.currentTrack.info.sampleRate=wo):f===En.vorbis?(this.currentTrack.info.codec="vorbis",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):f===En.flac?(this.currentTrack.info.codec="flac",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId==="A_PCM/INT/LIT"?this.currentTrack.info.bitDepth===8?this.currentTrack.info.codec="pcm-u8":this.currentTrack.info.bitDepth===16?this.currentTrack.info.codec="pcm-s16":this.currentTrack.info.bitDepth===24?this.currentTrack.info.codec="pcm-s24":this.currentTrack.info.bitDepth===32&&(this.currentTrack.info.codec="pcm-s32"):this.currentTrack.codecId==="A_PCM/INT/BIG"?this.currentTrack.info.bitDepth===8?this.currentTrack.info.codec="pcm-u8":this.currentTrack.info.bitDepth===16?this.currentTrack.info.codec="pcm-s16be":this.currentTrack.info.bitDepth===24?this.currentTrack.info.codec="pcm-s24be":this.currentTrack.info.bitDepth===32&&(this.currentTrack.info.codec="pcm-s32be"):this.currentTrack.codecId==="A_PCM/FLOAT/IEEE"&&(this.currentTrack.info.bitDepth===32?this.currentTrack.info.codec="pcm-f32":this.currentTrack.info.bitDepth===64&&(this.currentTrack.info.codec="pcm-f64"));const m=this.currentTrack,g=new Tr(this.input,new ck(m));this.currentTrack.inputTrack=g,this.currentSegment.tracks.push(this.currentTrack)}}this.currentTrack=null}break;case I.TrackNumber:{if(!this.currentTrack)break;this.currentTrack.id=Ie(e,l)}break;case I.TrackType:{if(!this.currentTrack)break;const u=Ie(e,l);u===1?this.currentTrack.info={type:"video",width:-1,height:-1,rotation:0,codec:null,codecDescription:null,colorSpace:null,alphaMode:!1}:u===2&&(this.currentTrack.info={type:"audio",numberOfChannels:-1,sampleRate:-1,bitDepth:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case I.FlagEnabled:{if(!this.currentTrack)break;Ie(e,l)||(this.currentSegment.tracks.pop(),this.currentTrack=null)}break;case I.FlagDefault:{if(!this.currentTrack)break;this.currentTrack.disposition.default=!!Ie(e,l)}break;case I.FlagForced:{if(!this.currentTrack)break;this.currentTrack.disposition.forced=!!Ie(e,l)}break;case I.FlagOriginal:{if(!this.currentTrack)break;this.currentTrack.disposition.original=!!Ie(e,l)}break;case I.FlagHearingImpaired:{if(!this.currentTrack)break;this.currentTrack.disposition.hearingImpaired=!!Ie(e,l)}break;case I.FlagVisualImpaired:{if(!this.currentTrack)break;this.currentTrack.disposition.visuallyImpaired=!!Ie(e,l)}break;case I.FlagCommentary:{if(!this.currentTrack)break;this.currentTrack.disposition.commentary=!!Ie(e,l)}break;case I.CodecID:{if(!this.currentTrack)break;this.currentTrack.codecId=Us(e,l)}break;case I.CodecPrivate:{if(!this.currentTrack)break;this.currentTrack.codecPrivate=ve(e,l)}break;case I.DefaultDuration:{if(!this.currentTrack)break;this.currentTrack.defaultDuration=this.currentTrack.segment.timestampFactor*Ie(e,l)/1e9}break;case I.Name:{if(!this.currentTrack)break;this.currentTrack.name=no(e,l)}break;case I.Language:{if(!this.currentTrack||this.currentTrack.languageCode!==Jt)break;this.currentTrack.languageCode=Us(e,l),fo(this.currentTrack.languageCode)||(this.currentTrack.languageCode=Jt)}break;case I.LanguageBCP47:{if(!this.currentTrack)break;const f=Us(e,l).split("-")[0];f?this.currentTrack.languageCode=f:this.currentTrack.languageCode=Jt}break;case I.Video:{if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e.slice(c,l))}break;case I.PixelWidth:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.width=Ie(e,l)}break;case I.PixelHeight:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.height=Ie(e,l)}break;case I.AlphaMode:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.alphaMode=Ie(e,l)===1}break;case I.Colour:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.colorSpace={},this.readContiguousElements(e.slice(c,l))}break;case I.MatrixCoefficients:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const u=Ie(e,l),f=zp[u]??null;this.currentTrack.info.colorSpace.matrix=f}break;case I.Range:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;this.currentTrack.info.colorSpace.fullRange=Ie(e,l)===2}break;case I.TransferCharacteristics:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const u=Ie(e,l),f=Rp[u]??null;this.currentTrack.info.colorSpace.transfer=f}break;case I.Primaries:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const u=Ie(e,l),f=Np[u]??null;this.currentTrack.info.colorSpace.primaries=f}break;case I.Projection:{if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e.slice(c,l))}break;case I.ProjectionPoseRoll:{if(this.currentTrack?.info?.type!=="video")break;const f=-Ju(e,l);try{this.currentTrack.info.rotation=Gl(f)}catch{}}break;case I.Audio:{if(this.currentTrack?.info?.type!=="audio")break;this.readContiguousElements(e.slice(c,l))}break;case I.SamplingFrequency:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.sampleRate=Ju(e,l)}break;case I.Channels:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.numberOfChannels=Ie(e,l)}break;case I.BitDepth:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.bitDepth=Ie(e,l)}break;case I.CuePoint:{if(!this.currentSegment)break;this.readContiguousElements(e.slice(c,l)),this.currentCueTime=null}break;case I.CueTime:this.currentCueTime=Ie(e,l);break;case I.CueTrackPositions:{if(this.currentCueTime===null)break;b(this.currentSegment);const u={time:this.currentCueTime,trackId:-1,clusterPosition:-1};this.currentSegment.cuePoints.push(u),this.readContiguousElements(e.slice(c,l)),(u.trackId===-1||u.clusterPosition===-1)&&this.currentSegment.cuePoints.pop()}break;case I.CueTrack:{const u=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!u)break;u.trackId=Ie(e,l)}break;case I.CueClusterPosition:{const u=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!u)break;b(this.currentSegment),u.clusterPosition=this.currentSegment.dataStartPos+Ie(e,l)}break;case I.Timestamp:{if(!this.currentCluster)break;this.currentCluster.timestamp=Ie(e,l)}break;case I.SimpleBlock:{if(!this.currentCluster)break;const u=oo(e);if(u===null)break;const f=this.getTrackDataInCluster(this.currentCluster,u);if(!f)break;const m=Id(e),g=me(e),y=g>>1&3;let w=!!(g&128);f.track.info?.type==="audio"&&f.track.info.codec&&(w=!0);const T=ve(e,l-(e.filePos-c)),S=f.track.decodingInstructions.length>0;f.blocks.push({timestamp:m,duration:0,isKeyFrame:w,data:T,lacing:y,decoded:!S,mainAdditional:null})}break;case I.BlockGroup:{if(!this.currentCluster)break;this.readContiguousElements(e.slice(c,l)),this.currentBlock=null}break;case I.Block:{if(!this.currentCluster)break;const u=oo(e);if(u===null)break;const f=this.getTrackDataInCluster(this.currentCluster,u);if(!f)break;const m=Id(e),y=me(e)>>1&3,w=ve(e,l-(e.filePos-c)),T=f.track.decodingInstructions.length>0;this.currentBlock={timestamp:m,duration:0,isKeyFrame:!0,data:w,lacing:y,decoded:!T,mainAdditional:null},f.blocks.push(this.currentBlock)}break;case I.BlockAdditions:this.readContiguousElements(e.slice(c,l));break;case I.BlockMore:{if(!this.currentBlock)break;this.currentBlockAdditional={addId:1,data:null},this.readContiguousElements(e.slice(c,l)),this.currentBlockAdditional.data&&this.currentBlockAdditional.addId===1&&(this.currentBlock.mainAdditional=this.currentBlockAdditional.data),this.currentBlockAdditional=null}break;case I.BlockAdditional:{if(!this.currentBlockAdditional)break;this.currentBlockAdditional.data=ve(e,l)}break;case I.BlockAddID:{if(!this.currentBlockAdditional)break;this.currentBlockAdditional.addId=Ie(e,l)}break;case I.BlockDuration:{if(!this.currentBlock)break;this.currentBlock.duration=Ie(e,l)}break;case I.ReferenceBlock:{if(!this.currentBlock)break;this.currentBlock.isKeyFrame=!1}break;case I.Tag:this.currentTagTargetIsMovie=!0,this.readContiguousElements(e.slice(c,l));break;case I.Targets:this.readContiguousElements(e.slice(c,l));break;case I.TargetTypeValue:Ie(e,l)!==50&&(this.currentTagTargetIsMovie=!1);break;case I.TagTrackUID:case I.TagEditionUID:case I.TagChapterUID:case I.TagAttachmentUID:this.currentTagTargetIsMovie=!1;break;case I.SimpleTag:{if(!this.currentTagTargetIsMovie)break;this.currentSimpleTagName=null,this.readContiguousElements(e.slice(c,l))}break;case I.TagName:this.currentSimpleTagName=no(e,l);break;case I.TagString:{if(!this.currentSimpleTagName)break;const u=no(e,l);this.processTagValue(this.currentSimpleTagName,u)}break;case I.TagBinary:{if(!this.currentSimpleTagName)break;const u=ve(e,l);this.processTagValue(this.currentSimpleTagName,u)}break;case I.AttachedFile:{if(!this.currentSegment)break;this.currentAttachedFile={fileUid:null,fileName:null,fileMediaType:null,fileData:null,fileDescription:null},this.readContiguousElements(e.slice(c,l));const u=this.currentSegment.metadataTags;if(this.currentAttachedFile.fileUid&&this.currentAttachedFile.fileData&&(u.raw??={},u.raw[this.currentAttachedFile.fileUid.toString()]=new Wd(this.currentAttachedFile.fileData,this.currentAttachedFile.fileMediaType??void 0,this.currentAttachedFile.fileName??void 0,this.currentAttachedFile.fileDescription??void 0)),this.currentAttachedFile.fileMediaType?.startsWith("image/")&&this.currentAttachedFile.fileData){const f=this.currentAttachedFile.fileName;let m="unknown";if(f){const g=f.toLowerCase();g.startsWith("cover.")?m="coverFront":g.startsWith("back.")&&(m="coverBack")}u.images??=[],u.images.push({data:this.currentAttachedFile.fileData,mimeType:this.currentAttachedFile.fileMediaType,kind:m,name:this.currentAttachedFile.fileName??void 0,description:this.currentAttachedFile.fileDescription??void 0})}this.currentAttachedFile=null}break;case I.FileUID:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileUid=ak(e,l)}break;case I.FileName:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileName=no(e,l)}break;case I.FileMediaType:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileMediaType=Us(e,l)}break;case I.FileData:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileData=ve(e,l)}break;case I.FileDescription:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileDescription=no(e,l)}break;case I.ContentEncodings:{if(!this.currentTrack)break;this.readContiguousElements(e.slice(c,l)),this.currentTrack.decodingInstructions.sort((u,f)=>f.order-u.order)}break;case I.ContentEncoding:this.currentDecodingInstruction={order:0,scope:jl.Block,data:null},this.readContiguousElements(e.slice(c,l)),this.currentDecodingInstruction.data&&this.currentTrack.decodingInstructions.push(this.currentDecodingInstruction),this.currentDecodingInstruction=null;break;case I.ContentEncodingOrder:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.order=Ie(e,l)}break;case I.ContentEncodingScope:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.scope=Ie(e,l)}break;case I.ContentCompression:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decompress",algorithm:co.Zlib,settings:null},this.readContiguousElements(e.slice(c,l))}break;case I.ContentCompAlgo:{if(this.currentDecodingInstruction?.data?.type!=="decompress")break;this.currentDecodingInstruction.data.algorithm=Ie(e,l)}break;case I.ContentCompSettings:{if(this.currentDecodingInstruction?.data?.type!=="decompress")break;this.currentDecodingInstruction.data.settings=ve(e,l)}break;case I.ContentEncryption:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decrypt"}}break}return e.filePos=c+l,!0}decodeBlockData(e,r){b(e.decodingInstructions.length>0);let s=r;for(const a of e.decodingInstructions)switch(b(a.data),a.data.type){case"decompress":switch(a.data.algorithm){case co.HeaderStripping:if(a.data.settings&&a.data.settings.length>0){const l=a.data.settings,c=new Uint8Array(l.length+s.length);c.set(l,0),c.set(s,l.length),s=c}break}break}return s}processTagValue(e,r){if(!this.currentSegment?.metadataTags)return;const s=this.currentSegment.metadataTags;if(s.raw??={},s.raw[e]??=r,typeof r=="string")switch(e.toLowerCase()){case"title":s.title??=r;break;case"description":s.description??=r;break;case"artist":s.artist??=r;break;case"album":s.album??=r;break;case"album_artist":s.albumArtist??=r;break;case"genre":s.genre??=r;break;case"comment":s.comment??=r;break;case"lyrics":s.lyrics??=r;break;case"date":{const a=new Date(r);Number.isNaN(a.getTime())||(s.date??=a)}break;case"track_number":case"part_number":{const a=r.split("/"),l=Number.parseInt(a[0],10),c=a[1]&&Number.parseInt(a[1],10);Number.isInteger(l)&&l>0&&(s.trackNumber??=l),c&&Number.isInteger(c)&&c>0&&(s.tracksTotal??=c)}break;case"disc_number":case"disc":{const a=r.split("/"),l=Number.parseInt(a[0],10),c=a[1]&&Number.parseInt(a[1],10);Number.isInteger(l)&&l>0&&(s.discNumber??=l),c&&Number.isInteger(c)&&c>0&&(s.discsTotal??=c)}break}}}class Sg{constructor(e){this.internalTrack=e,this.packetToClusterLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.codecId}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}getTimeResolution(){return this.internalTrack.segment.timestampFactor}getDisposition(){return this.internalTrack.disposition}async getFirstPacket(e){return this.performClusterLookup(null,r=>r.trackData.get(this.internalTrack.id)?{blockIndex:0,correctBlockFound:!0}:{blockIndex:-1,correctBlockFound:!1},-1/0,1/0,e)}intoTimescale(e){return Ul(e*this.internalTrack.segment.timestampFactor)}async getPacket(e,r){const s=this.intoTimescale(e);return this.performClusterLookup(null,a=>{const l=a.trackData.get(this.internalTrack.id);if(!l)return{blockIndex:-1,correctBlockFound:!1};const c=Ve(l.presentationTimestamps,s,m=>m.timestamp),u=c!==-1?l.presentationTimestamps[c].blockIndex:-1,f=c!==-1&&s<l.endTimestamp;return{blockIndex:u,correctBlockFound:f}},s,s,r)}async getNextPacket(e,r){const s=this.packetToClusterLocation.get(e);if(s===void 0)throw new Error("Packet was not created from this track.");return this.performClusterLookup(s.cluster,a=>{if(a===s.cluster){const l=a.trackData.get(this.internalTrack.id);if(s.blockIndex+1<l.blocks.length)return{blockIndex:s.blockIndex+1,correctBlockFound:!0}}else if(a.trackData.get(this.internalTrack.id))return{blockIndex:0,correctBlockFound:!0};return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,r)}async getKeyPacket(e,r){const s=this.intoTimescale(e);return this.performClusterLookup(null,a=>{const l=a.trackData.get(this.internalTrack.id);if(!l)return{blockIndex:-1,correctBlockFound:!1};const c=Op(l.presentationTimestamps,m=>l.blocks[m.blockIndex].isKeyFrame&&m.timestamp<=s),u=c!==-1?l.presentationTimestamps[c].blockIndex:-1,f=c!==-1&&s<l.endTimestamp;return{blockIndex:u,correctBlockFound:f}},s,s,r)}async getNextKeyPacket(e,r){const s=this.packetToClusterLocation.get(e);if(s===void 0)throw new Error("Packet was not created from this track.");return this.performClusterLookup(s.cluster,a=>{if(a===s.cluster){const c=a.trackData.get(this.internalTrack.id).blocks.findIndex((u,f)=>u.isKeyFrame&&f>s.blockIndex);if(c!==-1)return{blockIndex:c,correctBlockFound:!0}}else{const l=a.trackData.get(this.internalTrack.id);if(l&&l.firstKeyFrameTimestamp!==null){const c=l.blocks.findIndex(u=>u.isKeyFrame);return b(c!==-1),{blockIndex:c,correctBlockFound:!0}}}return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,r)}async fetchPacketInCluster(e,r,s){if(r===-1)return null;const l=e.trackData.get(this.internalTrack.id).blocks[r];b(l),l.decoded||(l.data=this.internalTrack.demuxer.decodeBlockData(this.internalTrack,l.data),l.decoded=!0);const c=s.metadataOnly?gn:l.data,u=l.timestamp/this.internalTrack.segment.timestampFactor,f=l.duration/this.internalTrack.segment.timestampFactor,m={};l.mainAdditional&&this.internalTrack.info?.type==="video"&&this.internalTrack.info.alphaMode&&(m.alpha=s.metadataOnly?gn:l.mainAdditional,m.alphaByteLength=l.mainAdditional.byteLength);const g=new qe(c,l.isKeyFrame?"key":"delta",u,f,e.dataStartPos+r,l.data.byteLength,m);return this.packetToClusterLocation.set(g,{cluster:e,blockIndex:r}),g}async performClusterLookup(e,r,s,a,l){const{demuxer:c,segment:u}=this.internalTrack;let f=null,m=null,g=-1;if(e){const{blockIndex:_,correctBlockFound:A}=r(e);if(A)return this.fetchPacketInCluster(e,_,l);_!==-1&&(m=e,g=_)}const y=Ve(this.internalTrack.cuePoints,s,_=>_.time),w=y!==-1?this.internalTrack.cuePoints[y]:null,T=Ve(this.internalTrack.clusterPositionCache,s,_=>_.startTimestamp),S=T!==-1?this.internalTrack.clusterPositionCache[T]:null,v=Math.max(w?.clusterPosition??0,S?.elementStartPos??0)||null;let x;for(e?v===null||e.elementStartPos>=v?(x=e.elementEndPos,f=e):x=v:x=v??u.clusterSeekStartPos;u.elementEndPos===null||x<=u.elementEndPos-An;){if(f){const G=f.trackData.get(this.internalTrack.id);if(G&&G.startTimestamp>a)break}let _=c.reader.requestSliceRange(x,An,yr);if(_ instanceof Promise&&(_=await _),!_)break;const A=x,O=mr(_);if(!O||!go.includes(O.id)&&O.id!==I.Void){const G=await wg(c.reader,A,go,Math.min(u.elementEndPos??1/0,A+Tg));if(G){x=G;continue}else break}const B=O.id;let j=O.size;const L=_.filePos;if(B===I.Cluster){f=await c.readCluster(A,u),j=f.elementEndPos-L;const{blockIndex:G,correctBlockFound:se}=r(f);if(se)return this.fetchPacketInCluster(f,G,l);G!==-1&&(m=f,g=G)}j===null&&(b(B!==I.Cluster),j=(await xd(c.reader,L,zl,u.elementEndPos)).pos-L);const q=L+j;if(u.elementEndPos===null){let G=c.reader.requestSliceRange(q,An,yr);if(G instanceof Promise&&(G=await G),!G)break;if(Yd(G)===I.Segment){u.elementEndPos=q;break}}x=q}if(w&&(!m||m.elementStartPos<w.clusterPosition)){const _=this.internalTrack.cuePoints[y-1];b(!_||_.time<w.time);const A=_?.time??-1/0;return this.performClusterLookup(null,r,A,a,l)}return m?this.fetchPacketInCluster(m,g,l):null}}class lk extends Sg{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.info.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return this.internalTrack.info.alphaMode}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{let e=null;return(this.internalTrack.info.codec==="vp9"||this.internalTrack.info.codec==="av1"||this.internalTrack.info.codec==="avc"&&!this.internalTrack.info.codecDescription||this.internalTrack.info.codec==="hevc"&&!this.internalTrack.info.codecDescription)&&(e=await this.getFirstPacket({})),{codec:Vp({width:this.internalTrack.info.width,height:this.internalTrack.info.height,codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,colorSpace:this.internalTrack.info.colorSpace,avcType:1,avcCodecInfo:this.internalTrack.info.codec==="avc"&&e?Jp(e.data):null,hevcCodecInfo:this.internalTrack.info.codec==="hevc"&&e?ng(e.data):null,vp9CodecInfo:this.internalTrack.info.codec==="vp9"&&e?rg(e.data):null,av1CodecInfo:this.internalTrack.info.codec==="av1"&&e?sg(e.data):null}),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class ck extends Sg{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:Wp({codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,aacCodecInfo:this.internalTrack.info.aacCodecInfo}),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const vg=4,uk=[44100,48e3,32e3],dk=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1,-1,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1,-1,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],fk=1483304551,hk=1231971951,mk=(n,e,r,s,a)=>e===0?0:e===1?Math.floor(144*r/(s<<n))+a:e===2?Math.floor(144*r/s)+a:(Math.floor(12*r/s)+a)*4,pk=(n,e)=>n===3?e===3?21:36:e===3?13:21,gk=(n,e)=>{const r=n>>>24,s=n>>>16&255,a=n>>>8&255,l=n&255;if(r!==255&&s!==255&&a!==255&&l!==255)return{header:null,bytesAdvanced:4};if(r!==255)return{header:null,bytesAdvanced:1};if((s&224)!==224)return{header:null,bytesAdvanced:1};let c=0,u=0;s&16?c=s&8?0:1:(c=1,u=1);const f=s>>3&3,m=s>>1&3,g=a>>4&15,y=(a>>2&3)%3,w=a>>1&1,T=l>>6&3,S=l>>4&3,v=l>>3&1,x=l>>2&1,_=l&3,A=dk[c*16*4+m*16+g];if(A===-1)return{header:null,bytesAdvanced:1};const O=A*1e3,B=uk[y]>>c+u,j=mk(c,m,O,B,w);if(e!==null&&e<j)return{header:null,bytesAdvanced:1};let L;return f===3?L=m===3?384:1152:m===3?L=384:m===2?L=1152:L=576,{header:{totalSize:j,mpegVersionId:f,layer:m,bitrate:O,frequencyIndex:y,sampleRate:B,channel:T,modeExtension:S,copyright:v,original:x,emphasis:_,audioSamplesInFrame:L},bytesAdvanced:1}},Cd=n=>{let e=2130706432,r=0;for(;e!==0;)r>>=1,r|=n&e,e>>=8;return r};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var Vs;(function(n){n[n.Unsynchronisation=128]="Unsynchronisation",n[n.ExtendedHeader=64]="ExtendedHeader",n[n.ExperimentalIndicator=32]="ExperimentalIndicator",n[n.Footer=16]="Footer"})(Vs||(Vs={}));var Ws;(function(n){n[n.ISO_8859_1=0]="ISO_8859_1",n[n.UTF_16_WITH_BOM=1]="UTF_16_WITH_BOM",n[n.UTF_16_BE_NO_BOM=2]="UTF_16_BE_NO_BOM",n[n.UTF_8=3]="UTF_8"})(Ws||(Ws={}));const Bl=128,Vl=10,Hs=["Blues","Classic rock","Country","Dance","Disco","Funk","Grunge","Hip-hop","Jazz","Metal","New age","Oldies","Other","Pop","Rhythm and blues","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death metal","Pranks","Soundtrack","Euro-techno","Ambient","Trip-hop","Vocal","Jazz & funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound clip","Gospel","Noise","Alternative rock","Bass","Soul","Punk","Space","Meditative","Instrumental pop","Instrumental rock","Ethnic","Gothic","Darkwave","Techno-industrial","Electronic","Pop-folk","Eurodance","Dream","Southern rock","Comedy","Cult","Gangsta","Top 40","Christian rap","Pop/funk","Jungle music","Native US","Cabaret","New wave","Psychedelic","Rave","Showtunes","Trailer","Lo-fi","Tribal","Acid punk","Acid jazz","Polka","Retro","Musical","Rock 'n' roll","Hard rock","Folk","Folk rock","National folk","Swing","Fast fusion","Bebop","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic rock","Progressive rock","Psychedelic rock","Symphonic rock","Slow rock","Big band","Chorus","Easy listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber music","Sonata","Symphony","Booty bass","Primus","Porn groove","Satire","Slow jam","Club","Tango","Samba","Folklore","Ballad","Power ballad","Rhythmic Soul","Freestyle","Duet","Punk rock","Drum solo","A cappella","Euro-house","Dance hall","Goa music","Drum & bass","Club-house","Hardcore techno","Terror","Indie","Britpop","Negerpunk","Polsk punk","Beat","Christian gangsta rap","Heavy metal","Black metal","Crossover","Contemporary Christian","Christian rock","Merengue","Salsa","Thrash metal","Anime","Jpop","Synthpop","Christmas","Art rock","Baroque","Bhangra","Big beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math rock","New romantic","Nu-breakz","Post-punk","Post-rock","Psytrance","Shoegaze","Space rock","Trop rock","World music","Neoclassical","Audiobook","Audio theatre","Neue Deutsche Welle","Podcast","Indie rock","G-Funk","Dubstep","Garage rock","Psybient"],yk=(n,e)=>{const r=n.filePos;e.raw??={},e.raw.TAG??=ve(n,Bl-3),n.filePos=r;const s=Bs(n,30);s&&(e.title??=s);const a=Bs(n,30);a&&(e.artist??=a);const l=Bs(n,30);l&&(e.album??=l);const c=Bs(n,4),u=Number.parseInt(c,10);Number.isInteger(u)&&u>0&&(e.date??=new Date(u,0,1));const f=ve(n,30);let m;if(f[28]===0&&f[29]!==0){const y=f[29];y>0&&(e.trackNumber??=y),n.skip(-30),m=Bs(n,28),n.skip(2)}else n.skip(-30),m=Bs(n,30);m&&(e.comment??=m);const g=me(n);g<Hs.length&&(e.genre??=Hs[g])},Bs=(n,e)=>{const r=ve(n,e),s=Os(r.indexOf(0),r.length),a=r.subarray(0,s);let l="";for(let c=0;c<a.length;c++)l+=String.fromCharCode(a[c]);return l.trimEnd()},Wl=n=>{const e=n.filePos,r=kt(n,3),s=me(n),a=me(n),l=me(n),c=te(n);if(r!=="ID3"||s===255||a===255||(c&2155905152)!==0)return n.filePos=e,null;const u=Cd(c);return{majorVersion:s,revision:a,flags:l,size:u}},bg=(n,e,r)=>{if(![2,3,4].includes(e.majorVersion)){console.warn(`Unsupported ID3v2 major version: ${e.majorVersion}`);return}const s=ve(n,e.size),a=new wk(e,s);if(e.flags&Vs.Footer&&a.removeFooter(),e.flags&Vs.Unsynchronisation&&e.majorVersion===3&&a.ununsynchronizeAll(),e.flags&Vs.ExtendedHeader){const l=a.readU32();e.majorVersion===3?a.pos+=l:a.pos+=l-4}for(;a.pos<=a.bytes.length-a.frameHeaderSize();){const l=a.readId3V2Frame();if(!l)break;const c=a.pos,u=a.pos+l.size;let f=!1,m=!1,g=!1;if(e.majorVersion===3?(f=!!(l.flags&64),m=!!(l.flags&128)):e.majorVersion===4&&(f=!!(l.flags&4),m=!!(l.flags&8),g=!!(l.flags&2)||!!(e.flags&Vs.Unsynchronisation)),f){console.warn(`Skipping encrypted ID3v2 frame ${l.id}`),a.pos=u;continue}if(m){console.warn(`Skipping compressed ID3v2 frame ${l.id}`),a.pos=u;continue}switch(g&&a.ununsynchronizeRegion(a.pos,u),r.raw??={},l.id[0]==="T"?r.raw[l.id]??=a.readId3V2EncodingAndText(u):r.raw[l.id]??=a.readBytes(l.size),a.pos=c,l.id){case"TIT2":case"TT2":r.title??=a.readId3V2EncodingAndText(u);break;case"TIT3":case"TT3":r.description??=a.readId3V2EncodingAndText(u);break;case"TPE1":case"TP1":r.artist??=a.readId3V2EncodingAndText(u);break;case"TALB":case"TAL":r.album??=a.readId3V2EncodingAndText(u);break;case"TPE2":case"TP2":r.albumArtist??=a.readId3V2EncodingAndText(u);break;case"TRCK":case"TRK":{const w=a.readId3V2EncodingAndText(u).split("/"),T=Number.parseInt(w[0],10),S=w[1]&&Number.parseInt(w[1],10);Number.isInteger(T)&&T>0&&(r.trackNumber??=T),S&&Number.isInteger(S)&&S>0&&(r.tracksTotal??=S)}break;case"TPOS":case"TPA":{const w=a.readId3V2EncodingAndText(u).split("/"),T=Number.parseInt(w[0],10),S=w[1]&&Number.parseInt(w[1],10);Number.isInteger(T)&&T>0&&(r.discNumber??=T),S&&Number.isInteger(S)&&S>0&&(r.discsTotal??=S)}break;case"TCON":case"TCO":{const y=a.readId3V2EncodingAndText(u);let w=/^\((\d+)\)/.exec(y);if(w){const T=Number.parseInt(w[1]);if(Hs[T]!==void 0){r.genre??=Hs[T];break}}if(w=/^\d+$/.exec(y),w){const T=Number.parseInt(w[0]);if(Hs[T]!==void 0){r.genre??=Hs[T];break}}r.genre??=y}break;case"TDRC":case"TDAT":{const y=a.readId3V2EncodingAndText(u),w=new Date(y);Number.isNaN(w.getTime())||(r.date??=w)}break;case"TYER":case"TYE":{const y=a.readId3V2EncodingAndText(u),w=Number.parseInt(y,10);Number.isInteger(w)&&(r.date??=new Date(w,0,1))}break;case"USLT":case"ULT":{const y=a.readU8();a.pos+=3,a.readId3V2Text(y,u),r.lyrics??=a.readId3V2Text(y,u)}break;case"COMM":case"COM":{const y=a.readU8();a.pos+=3,a.readId3V2Text(y,u),r.comment??=a.readId3V2Text(y,u)}break;case"APIC":case"PIC":{const y=a.readId3V2TextEncoding();let w;if(e.majorVersion===2){const x=a.readAscii(3);w=x==="PNG"?"image/png":x==="JPG"?"image/jpeg":"image/*"}else w=a.readId3V2Text(y,u);const T=a.readU8(),S=a.readId3V2Text(y,u).trimEnd(),v=u-a.pos;if(v>=0){const x=a.readBytes(v);r.images||(r.images=[]),r.images.push({data:x,mimeType:w,kind:T===3?"coverFront":T===4?"coverBack":"unknown",description:S})}}break;default:a.pos+=l.size;break}a.pos=u}};class wk{constructor(e,r){this.header=e,this.bytes=r,this.pos=0,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength)}frameHeaderSize(){return this.header.majorVersion===2?6:10}ununsynchronizeAll(){const e=[];for(let r=0;r<this.bytes.length;r++){const s=this.bytes[r];e.push(s),s===255&&r!==this.bytes.length-1&&this.bytes[r]===0&&r++}this.bytes=new Uint8Array(e),this.view=new DataView(this.bytes.buffer)}ununsynchronizeRegion(e,r){const s=[];for(let c=e;c<r;c++){const u=this.bytes[c];s.push(u),u===255&&c!==r-1&&this.bytes[c+1]===0&&c++}const a=this.bytes.subarray(0,e),l=this.bytes.subarray(r);this.bytes=new Uint8Array(a.length+s.length+l.length),this.bytes.set(a,0),this.bytes.set(s,a.length),this.bytes.set(l,a.length+s.length),this.view=new DataView(this.bytes.buffer)}removeFooter(){this.bytes=this.bytes.subarray(0,this.bytes.length-Vl),this.view=new DataView(this.bytes.buffer)}readBytes(e){const r=this.bytes.subarray(this.pos,this.pos+e);return this.pos+=e,r}readU8(){const e=this.view.getUint8(this.pos);return this.pos+=1,e}readU16(){const e=this.view.getUint16(this.pos,!1);return this.pos+=2,e}readU24(){const e=this.view.getUint16(this.pos,!1),r=this.view.getUint8(this.pos+1);return this.pos+=3,e*256+r}readU32(){const e=this.view.getUint32(this.pos,!1);return this.pos+=4,e}readAscii(e){let r="";for(let s=0;s<e;s++)r+=String.fromCharCode(this.view.getUint8(this.pos+s));return this.pos+=e,r}readId3V2Frame(){if(this.header.majorVersion===2){const e=this.readAscii(3);if(e==="\0\0\0")return null;const r=this.readU24();return{id:e,size:r,flags:0}}else{const e=this.readAscii(4);if(e==="\0\0\0\0")return null;const r=this.readU32();let s=this.header.majorVersion===4?Cd(r):r;const a=this.readU16(),l=this.pos,c=u=>{const f=this.pos+u;if(f>this.bytes.length)return!1;if(f<=this.bytes.length-this.frameHeaderSize()){this.pos+=u;const m=this.readAscii(4);if(m!=="\0\0\0\0"&&!/[0-9A-Z]{4}/.test(m))return!1}return!0};if(!c(s)){const u=this.header.majorVersion===4?r:Cd(r);c(u)&&(s=u)}return this.pos=l,{id:e,size:s,flags:a}}}readId3V2TextEncoding(){const e=this.readU8();if(e>3)throw new Error(`Unsupported text encoding: ${e}`);return e}readId3V2Text(e,r){const s=this.pos,a=this.readBytes(r-this.pos);switch(e){case Ws.ISO_8859_1:{let l="";for(let c=0;c<a.length;c++){const u=a[c];if(u===0){this.pos=s+c+1;break}l+=String.fromCharCode(u)}return l}case Ws.UTF_16_WITH_BOM:if(a[0]===255&&a[1]===254){const l=new TextDecoder("utf-16le"),c=Os(a.findIndex((u,f)=>u===0&&a[f+1]===0&&f%2===0),a.length);return this.pos=s+Math.min(c+2,a.length),l.decode(a.subarray(2,c))}else if(a[0]===254&&a[1]===255){const l=new TextDecoder("utf-16be"),c=Os(a.findIndex((u,f)=>u===0&&a[f+1]===0&&f%2===0),a.length);return this.pos=s+Math.min(c+2,a.length),l.decode(a.subarray(2,c))}else{const l=Os(a.findIndex(c=>c===0),a.length);return this.pos=s+Math.min(l+1,a.length),mn.decode(a.subarray(0,l))}case Ws.UTF_16_BE_NO_BOM:{const l=new TextDecoder("utf-16be"),c=Os(a.findIndex((u,f)=>u===0&&a[f+1]===0&&f%2===0),a.length);return this.pos=s+Math.min(c+2,a.length),l.decode(a.subarray(0,c))}case Ws.UTF_8:{const l=Os(a.findIndex(c=>c===0),a.length);return this.pos=s+Math.min(l+1,a.length),mn.decode(a.subarray(0,l))}}}readId3V2EncodingAndText(e){if(this.pos>=e)return"";const r=this.readId3V2TextEncoding();return this.readId3V2Text(r,e)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Pd=async(n,e,r)=>{let s=e;for(;r===null||s<r;){let a=n.requestSlice(s,vg);if(a instanceof Promise&&(a=await a),!a)break;const l=te(a),c=gk(l,n.fileSize!==null?n.fileSize-s:null);if(c.header)return{header:c.header,startPos:s};s+=c.bytesAdvanced}return null};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class kk extends Ki{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.metadataTags=null,this.tracks=[],this.readingMutex=new sa,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();if(!this.firstFrameHeader)throw new Error("No valid MP3 frame found.");this.tracks=[new Tr(this.input,new Tk(this))]})()}async advanceReader(){if(this.lastLoadedPos===0)for(;;){let u=this.reader.requestSlice(this.lastLoadedPos,Vl);if(u instanceof Promise&&(u=await u),!u){this.lastSampleLoaded=!0;return}const f=Wl(u);if(!f)break;this.lastLoadedPos=u.filePos+f.size}const e=await Pd(this.reader,this.lastLoadedPos,this.reader.fileSize);if(!e){this.lastSampleLoaded=!0;return}const r=e.header;this.lastLoadedPos=e.startPos+r.totalSize-1;const s=pk(r.mpegVersionId,r.channel);let a=this.reader.requestSlice(e.startPos+s,4);if(a instanceof Promise&&(a=await a),a){const u=te(a);if(u===fk||u===hk)return}this.firstFrameHeader||(this.firstFrameHeader=r),r.sampleRate!==this.firstFrameHeader.sampleRate&&console.warn(`MP3 changed sample rate mid-file: ${this.firstFrameHeader.sampleRate} Hz to ${r.sampleRate} Hz. Might be a bug, so please report this file.`);const l=r.audioSamplesInFrame/this.firstFrameHeader.sampleRate,c={timestamp:this.nextTimestampInSamples/this.firstFrameHeader.sampleRate,duration:l,dataStart:e.startPos,dataSize:r.totalSize};this.loadedSamples.push(c),this.nextTimestampInSamples+=r.audioSamplesInFrame}async getMimeType(){return"audio/mpeg"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return b(e),e.computeDuration()}async getMetadataTags(){const e=await this.readingMutex.acquire();try{if(await this.readMetadata(),this.metadataTags)return this.metadataTags;this.metadataTags={};let r=0,s=!1;for(;;){let a=this.reader.requestSlice(r,Vl);if(a instanceof Promise&&(a=await a),!a)break;const l=Wl(a);if(!l)break;s=!0;let c=this.reader.requestSlice(a.filePos,l.size);if(c instanceof Promise&&(c=await c),!c)break;bg(c,l,this.metadataTags),r=a.filePos+l.size}if(!s&&this.reader.fileSize!==null&&this.reader.fileSize>=Bl){let a=this.reader.requestSlice(this.reader.fileSize-Bl,Bl);a instanceof Promise&&(a=await a),b(a),kt(a,3)==="TAG"&&yk(a,this.metadataTags)}return this.metadataTags}finally{e()}}}class Tk{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return b(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate/this.demuxer.firstFrameHeader.audioSamplesInFrame}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return Jt}getCodec(){return"mp3"}getInternalCodecId(){return null}getNumberOfChannels(){return b(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.channel===3?1:2}getSampleRate(){return b(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate}getDisposition(){return{...qi}}async getDecoderConfig(){return b(this.demuxer.firstFrameHeader),{codec:"mp3",numberOfChannels:this.demuxer.firstFrameHeader.channel===3?1:2,sampleRate:this.demuxer.firstFrameHeader.sampleRate}}async getPacketAtIndex(e,r){if(e===-1)return null;const s=this.demuxer.loadedSamples[e];if(!s)return null;let a;if(r.metadataOnly)a=gn;else{let l=this.demuxer.reader.requestSlice(s.dataStart,s.dataSize);if(l instanceof Promise&&(l=await l),!l)return null;a=ve(l,s.dataSize)}return new qe(a,"key",s.timestamp,s.duration,e,s.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,r){const s=await this.demuxer.readingMutex.acquire();try{const a=Yl(this.demuxer.loadedSamples,e.timestamp,c=>c.timestamp);if(a===-1)throw new Error("Packet was not created from this track.");const l=a+1;for(;l>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(l,r)}finally{s()}}async getPacket(e,r){const s=await this.demuxer.readingMutex.acquire();try{for(;;){const a=Ve(this.demuxer.loadedSamples,e,l=>l.timestamp);if(a===-1&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(a,r);if(a>=0&&a+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(a,r);await this.demuxer.advanceReader()}}finally{s()}}getKeyPacket(e,r){return this.getPacket(e,r)}getNextKeyPacket(e,r){return this.getNextPacket(e,r)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const xg=1399285583,Sk=79764919,Cg=new Uint32Array(256);for(let n=0;n<256;n++){let e=n<<24;for(let r=0;r<8;r++)e=e&2147483648?e<<1^Sk:e<<1;Cg[n]=e>>>0&4294967295}const vk=n=>{const e=tt(n),r=e.getUint32(22,!0);e.setUint32(22,0,!0);let s=0;for(let a=0;a<n.length;a++){const l=n[a];s=(s<<8^Cg[s>>>24^l])>>>0}return e.setUint32(22,r,!0),s},bk=(n,e,r)=>{let s=0,a=null;if(n.length>0)if(e.codec==="vorbis"){b(e.vorbisInfo);const l=e.vorbisInfo.modeBlockflags.length,u=(1<<nw(l-1))-1<<1,f=(n[0]&u)>>1;if(f>=e.vorbisInfo.modeBlockflags.length)throw new Error("Invalid mode number.");let m=r;const g=e.vorbisInfo.modeBlockflags[f];if(a=e.vorbisInfo.blocksizes[g],g===1){const y=(u|1)+1,w=n[0]&y?1:0;m=e.vorbisInfo.blocksizes[w]}s=m!==null?m+a>>2:0}else e.codec==="opus"&&(s=Rw(n).durationInSamples);return{durationInSamples:s,vorbisBlockSize:a}},xk=n=>{let e="audio/ogg";if(n.codecStrings){const r=[...new Set(n.codecStrings)];e+=`; codecs="${r.join(", ")}"`}return e};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Wi=27,Xs=282,Ck=Xs+65025,uo=n=>{const e=n.filePos;if($s(n)!==xg)return null;n.skip(1);const s=me(n),a=dT(n),l=$s(n),c=$s(n),u=$s(n),f=me(n),m=new Uint8Array(f);for(let T=0;T<f;T++)m[T]=me(n);const g=27+f,y=m.reduce((T,S)=>T+S,0),w=g+y;return{headerStartPos:e,totalSize:w,dataStartPos:e+g,dataSize:y,headerType:s,granulePosition:a,serialNumber:l,sequenceNumber:c,checksum:u,lacingValues:m}},Pk=(n,e)=>{for(;n.filePos<e-3;){const r=$s(n),s=r&255,a=r>>>8&255,l=r>>>16&255,c=r>>>24&255,u=79;if(!(s!==u&&a!==u&&l!==u&&c!==u)){if(n.skip(-4),r===xg)return!0;n.skip(1)}}return!1};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Ek extends Ki{constructor(e){super(e),this.metadataPromise=null,this.bitstreams=[],this.tracks=[],this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let r=this.reader.requestSliceRange(e,Wi,Xs);if(r instanceof Promise&&(r=await r),!r)break;const s=uo(r);if(!s||!!!(s.headerType&2))break;this.bitstreams.push({serialNumber:s.serialNumber,bosPage:s,description:null,numberOfChannels:-1,sampleRate:-1,codecInfo:{codec:null,vorbisInfo:null,opusInfo:null},lastMetadataPacket:null}),e=s.headerStartPos+s.totalSize}for(const r of this.bitstreams){const s=await this.readPacket(r.bosPage,0);s&&(s.data.byteLength>=7&&s.data[0]===1&&s.data[1]===118&&s.data[2]===111&&s.data[3]===114&&s.data[4]===98&&s.data[5]===105&&s.data[6]===115?await this.readVorbisMetadata(s,r):s.data.byteLength>=8&&s.data[0]===79&&s.data[1]===112&&s.data[2]===117&&s.data[3]===115&&s.data[4]===72&&s.data[5]===101&&s.data[6]===97&&s.data[7]===100&&await this.readOpusMetadata(s,r),r.codecInfo.codec!==null&&this.tracks.push(new Tr(this.input,new _k(r,this))))}})()}async readVorbisMetadata(e,r){let s=await this.findNextPacketStart(e);if(!s)return;const a=await this.readPacket(s.startPage,s.startSegmentIndex);if(!a||(s=await this.findNextPacketStart(a),!s))return;const l=await this.readPacket(s.startPage,s.startSegmentIndex);if(!l||a.data[0]!==3||l.data[0]!==5)return;const c=[],u=y=>{for(;c.push(Math.min(255,y)),!(y<255);)y-=255};u(e.data.length),u(a.data.length);const f=new Uint8Array(1+c.length+e.data.length+a.data.length+l.data.length);f[0]=2,f.set(c,1),f.set(e.data,1+c.length),f.set(a.data,1+c.length+e.data.length),f.set(l.data,1+c.length+e.data.length+a.data.length),r.codecInfo.codec="vorbis",r.description=f,r.lastMetadataPacket=l;const m=tt(e.data);r.numberOfChannels=m.getUint8(11),r.sampleRate=m.getUint32(12,!0);const g=m.getUint8(28);r.codecInfo.vorbisInfo={blocksizes:[1<<(g&15),1<<(g>>4)],modeBlockflags:zw(l.data).modeBlockflags},gd(a.data.subarray(7),this.metadataTags)}async readOpusMetadata(e,r){const s=await this.findNextPacketStart(e);if(!s)return;const a=await this.readPacket(s.startPage,s.startSegmentIndex);if(!a)return;r.codecInfo.codec="opus",r.description=e.data,r.lastMetadataPacket=a;const l=Qd(e.data);r.numberOfChannels=l.outputChannelCount,r.sampleRate=wo,r.codecInfo.opusInfo={preSkip:l.preSkip},gd(a.data.subarray(8),this.metadataTags)}async readPacket(e,r){b(r<e.lacingValues.length);let s=0;for(let y=0;y<r;y++)s+=e.lacingValues[y];let a=e,l=s,c=r;const u=[];e:for(;;){let y=this.reader.requestSlice(a.dataStartPos,a.dataSize);y instanceof Promise&&(y=await y),b(y);const w=ve(y,a.dataSize);for(;;){if(c===a.lacingValues.length){u.push(w.subarray(s,l));break}const S=a.lacingValues[c];if(l+=S,S<255){u.push(w.subarray(s,l));break e}c++}let T=a.headerStartPos+a.totalSize;for(;;){let S=this.reader.requestSliceRange(T,Wi,Xs);if(S instanceof Promise&&(S=await S),!S)return null;const v=uo(S);if(!v)return null;if(a=v,a.serialNumber===e.serialNumber)break;T=a.headerStartPos+a.totalSize}s=0,l=0,c=0}const f=u.reduce((y,w)=>y+w.length,0),m=new Uint8Array(f);let g=0;for(let y=0;y<u.length;y++){const w=u[y];m.set(w,g),g+=w.length}return{data:m,endPage:a,endSegmentIndex:c}}async findNextPacketStart(e){if(e.endSegmentIndex<e.endPage.lacingValues.length-1)return{startPage:e.endPage,startSegmentIndex:e.endSegmentIndex+1};if(!!(e.endPage.headerType&4))return null;let s=e.endPage.headerStartPos+e.endPage.totalSize;for(;;){let a=this.reader.requestSliceRange(s,Wi,Xs);if(a instanceof Promise&&(a=await a),!a)return null;const l=uo(a);if(!l)return null;if(l.serialNumber===e.endPage.serialNumber)return{startPage:l,startSegmentIndex:0};s=l.headerStartPos+l.totalSize}}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(r=>r.getCodecParameterString()));return xk({codecStrings:e.filter(Boolean)})}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){const e=await this.getTracks(),r=await Promise.all(e.map(s=>s.computeDuration()));return Math.max(0,...r)}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}class _k{constructor(e,r){this.bitstream=e,this.demuxer=r,this.encodedPacketToMetadata=new WeakMap,this.sequentialScanCache=[],this.sequentialScanMutex=new sa,this.internalSampleRate=e.codecInfo.codec==="opus"?wo:e.sampleRate}getId(){return this.bitstream.serialNumber}getNumberOfChannels(){return this.bitstream.numberOfChannels}getSampleRate(){return this.bitstream.sampleRate}getTimeResolution(){return this.bitstream.sampleRate}getCodec(){return this.bitstream.codecInfo.codec}getInternalCodecId(){return null}async getDecoderConfig(){return b(this.bitstream.codecInfo.codec),{codec:this.bitstream.codecInfo.codec,numberOfChannels:this.bitstream.numberOfChannels,sampleRate:this.bitstream.sampleRate,description:this.bitstream.description??void 0}}getName(){return null}getLanguageCode(){return Jt}getDisposition(){return{...qi}}async getFirstTimestamp(){return 0}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}granulePositionToTimestampInSamples(e){return this.bitstream.codecInfo.codec==="opus"?(b(this.bitstream.codecInfo.opusInfo),e-this.bitstream.codecInfo.opusInfo.preSkip):e}createEncodedPacketFromOggPacket(e,r,s){if(!e)return null;const{durationInSamples:a,vorbisBlockSize:l}=bk(e.data,this.bitstream.codecInfo,r.vorbisLastBlocksize),c=new qe(s.metadataOnly?gn:e.data,"key",Math.max(0,r.timestampInSamples)/this.internalSampleRate,a/this.internalSampleRate,e.endPage.headerStartPos+e.endSegmentIndex,e.data.byteLength);return this.encodedPacketToMetadata.set(c,{packet:e,timestampInSamples:r.timestampInSamples,durationInSamples:a,vorbisLastBlockSize:r.vorbisLastBlocksize,vorbisBlockSize:l}),c}async getFirstPacket(e){b(this.bitstream.lastMetadataPacket);const r=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!r)return null;let s=0;this.bitstream.codecInfo.codec==="opus"&&(b(this.bitstream.codecInfo.opusInfo),s-=this.bitstream.codecInfo.opusInfo.preSkip);const a=await this.demuxer.readPacket(r.startPage,r.startSegmentIndex);return this.createEncodedPacketFromOggPacket(a,{timestampInSamples:s,vorbisLastBlocksize:null},e)}async getNextPacket(e,r){const s=this.encodedPacketToMetadata.get(e);if(!s)throw new Error("Packet was not created from this track.");const a=await this.demuxer.findNextPacketStart(s.packet);if(!a)return null;const l=s.timestampInSamples+s.durationInSamples,c=await this.demuxer.readPacket(a.startPage,a.startSegmentIndex);return this.createEncodedPacketFromOggPacket(c,{timestampInSamples:l,vorbisLastBlocksize:s.vorbisBlockSize},r)}async getPacket(e,r){if(this.demuxer.reader.fileSize===null)return this.getPacketSequential(e,r);const s=Ul(e*this.internalSampleRate);if(s===0)return this.getFirstPacket(r);if(s<0)return null;b(this.bitstream.lastMetadataPacket);const a=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!a)return null;let l=a.startPage,c=this.demuxer.reader.fileSize;const u=[l];e:for(;l.headerStartPos+l.totalSize<c;){const A=l.headerStartPos,O=Math.floor((A+c)/2);let B=O;for(;;){const j=Math.min(B+Ck,c-Wi);let L=this.demuxer.reader.requestSlice(B,j-B);if(L instanceof Promise&&(L=await L),b(L),!Pk(L,j)){c=O+Wi;continue e}let G=this.demuxer.reader.requestSliceRange(L.filePos,Wi,Xs);G instanceof Promise&&(G=await G),b(G);const se=uo(G);b(se);let oe=!1;if(se.serialNumber===this.bitstream.serialNumber)oe=!0;else{let ne=this.demuxer.reader.requestSlice(se.headerStartPos,se.totalSize);ne instanceof Promise&&(ne=await ne),b(ne);const he=ve(ne,se.totalSize);oe=vk(he)===se.checksum}if(!oe){B=se.headerStartPos+4;continue}if(oe&&se.serialNumber!==this.bitstream.serialNumber){B=se.headerStartPos+se.totalSize;continue}if(se.granulePosition===-1){B=se.headerStartPos+se.totalSize;continue}this.granulePositionToTimestampInSamples(se.granulePosition)>s?c=se.headerStartPos:(l=se,u.push(se));continue e}}let f=a.startPage;for(const A of u){if(A.granulePosition===l.granulePosition)break;(!f||A.headerStartPos>f.headerStartPos)&&(f=A)}let m=f;const g=[m];for(;!(m.serialNumber===this.bitstream.serialNumber&&m.granulePosition===l.granulePosition);){const A=m.headerStartPos+m.totalSize;let O=this.demuxer.reader.requestSliceRange(A,Wi,Xs);O instanceof Promise&&(O=await O),b(O);const B=uo(O);b(B),m=B,m.serialNumber===this.bitstream.serialNumber&&g.push(m)}b(m.granulePosition!==-1);let y=null,w,T,S=m,v=0;if(m.headerStartPos===a.startPage.headerStartPos)w=this.granulePositionToTimestampInSamples(0),T=!0,y=0;else{w=0,T=!1;for(let B=m.lacingValues.length-1;B>=0;B--)if(m.lacingValues[B]<255){y=B+1;break}if(y===null)throw new Error("Invalid page with granule position: no packets end on this page.");v=y-1;const A={data:gn,endPage:S,endSegmentIndex:v};if(await this.demuxer.findNextPacketStart(A)){const B=Gm(g,m,y);b(B);const j=Km(g,B.page,B.segmentIndex);j&&(m=j.page,y=j.segmentIndex)}else for(;;){const B=Gm(g,m,y);if(!B)break;const j=Km(g,B.page,B.segmentIndex);if(!j)break;if(m=j.page,y=j.segmentIndex,B.page.headerStartPos!==S.headerStartPos){S=B.page,v=B.segmentIndex;break}}}let x=null,_=null;for(;m!==null;){b(y!==null);const A=await this.demuxer.readPacket(m,y);if(!A)break;if(!(m.headerStartPos===a.startPage.headerStartPos&&y<a.startSegmentIndex)){let j=this.createEncodedPacketFromOggPacket(A,{timestampInSamples:w,vorbisLastBlocksize:_?.vorbisBlockSize??null},r);b(j);let L=this.encodedPacketToMetadata.get(j);if(b(L),!T&&A.endPage.headerStartPos===S.headerStartPos&&A.endSegmentIndex===v?(w=this.granulePositionToTimestampInSamples(m.granulePosition),T=!0,j=this.createEncodedPacketFromOggPacket(A,{timestampInSamples:w-L.durationInSamples,vorbisLastBlocksize:_?.vorbisBlockSize??null},r),b(j),L=this.encodedPacketToMetadata.get(j),b(L)):w+=L.durationInSamples,x=j,_=L,T&&(Math.max(w,0)>s||Math.max(L.timestampInSamples,0)===s))break}const B=await this.demuxer.findNextPacketStart(A);if(!B)break;m=B.startPage,y=B.startSegmentIndex}return x}async getPacketSequential(e,r){const s=await this.sequentialScanMutex.acquire();try{const a=Ul(e*this.internalSampleRate);e=a/this.internalSampleRate;const l=Ve(this.sequentialScanCache,a,f=>f.timestampInSamples);let c;if(l!==-1){const f=this.sequentialScanCache[l];c=this.createEncodedPacketFromOggPacket(f.packet,{timestampInSamples:f.timestampInSamples,vorbisLastBlocksize:f.vorbisLastBlockSize},r)}else c=await this.getFirstPacket(r);let u=0;for(;c&&c.timestamp<e;){const f=await this.getNextPacket(c,r);if(!f||f.timestamp>e)break;if(c=f,u++,u===100){u=0;const m=this.encodedPacketToMetadata.get(c);b(m),this.sequentialScanCache.length>0&&b(ot(this.sequentialScanCache).timestampInSamples<=m.timestampInSamples),this.sequentialScanCache.push(m)}}return c}finally{s()}}getKeyPacket(e,r){return this.getPacket(e,r)}getNextKeyPacket(e,r){return this.getNextPacket(e,r)}}const Km=(n,e,r)=>{let s=e,a=r;e:for(;;){for(a--,a;a>=0;a--)if(s.lacingValues[a]<255){a++;break e}if(b(a===-1),!(s.headerType&1)){a=0;break}const c=Dp(n,u=>u.headerStartPos<s.headerStartPos);if(!c)return null;s=c,a=s.lacingValues.length}if(b(a!==-1),a===s.lacingValues.length){const l=n[n.indexOf(s)+1];b(l),s=l,a=0}return{page:s,segmentIndex:a}},Gm=(n,e,r)=>{if(r>0)return{page:e,segmentIndex:r-1};const s=Dp(n,a=>a.headerStartPos<e.headerStartPos);return s?{page:s,segmentIndex:s.lacingValues.length-1}:null};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var hr;(function(n){n[n.PCM=1]="PCM",n[n.IEEE_FLOAT=3]="IEEE_FLOAT",n[n.ALAW=6]="ALAW",n[n.MULAW=7]="MULAW",n[n.EXTENSIBLE=65534]="EXTENSIBLE"})(hr||(hr={}));class Ik extends Ki{constructor(e){super(e),this.metadataPromise=null,this.dataStart=-1,this.dataSize=-1,this.audioInfo=null,this.tracks=[],this.lastKnownPacketIndex=0,this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=this.reader.requestSlice(0,12);e instanceof Promise&&(e=await e),b(e);const r=kt(e,4),s=r!=="RIFX",a=r==="RF64",l=ai(e,s);let c=a?this.reader.fileSize:Math.min(l+8,this.reader.fileSize??1/0);if(kt(e,4)!=="WAVE")throw new Error("Invalid WAVE file - wrong format");let f=0,m=null,g=e.filePos;for(;c===null||g<c;){let w=this.reader.requestSlice(g,8);if(w instanceof Promise&&(w=await w),!w)break;const T=kt(w,4),S=ai(w,s),v=w.filePos;if(a&&f===0&&T!=="ds64")throw new Error('Invalid RF64 file: First chunk must be "ds64".');if(T==="fmt ")await this.parseFmtChunk(v,S,s);else if(T==="data"){if(m??=S,this.dataStart=w.filePos,this.dataSize=Math.min(m,(c??1/0)-this.dataStart),this.reader.fileSize===null)break}else if(T==="ds64"){let x=this.reader.requestSlice(v,S);if(x instanceof Promise&&(x=await x),!x)break;const _=Xm(x,s);m=Xm(x,s),c=Math.min(_+8,this.reader.fileSize??1/0)}else T==="LIST"?await this.parseListChunk(v,S,s):(T==="ID3 "||T==="id3 ")&&await this.parseId3Chunk(v,S);g=v+S+(S&1),f++}if(!this.audioInfo)throw new Error('Invalid WAVE file - missing "fmt " chunk');if(this.dataStart===-1)throw new Error('Invalid WAVE file - missing "data" chunk');const y=this.audioInfo.blockSizeInBytes;this.dataSize=Math.floor(this.dataSize/y)*y,this.tracks.push(new Tr(this.input,new Ak(this)))})()}async parseFmtChunk(e,r,s){let a=this.reader.requestSlice(e,r);if(a instanceof Promise&&(a=await a),!a)return;let l=ro(a,s);const c=ro(a,s),u=ai(a,s);a.skip(4);const f=ro(a,s);let m;if(r===14?m=8:m=ro(a,s),r>=18&&l!==357){const g=ro(a,s),y=r-18;if(Math.min(y,g)>=22&&l===hr.EXTENSIBLE){a.skip(6);const T=ve(a,16);l=T[0]|T[1]<<8}}(l===hr.MULAW||l===hr.ALAW)&&(m=8),this.audioInfo={format:l,numberOfChannels:c,sampleRate:u,sampleSizeInBytes:Math.ceil(m/8),blockSizeInBytes:f}}async parseListChunk(e,r,s){let a=this.reader.requestSlice(e,r);if(a instanceof Promise&&(a=await a),!a)return;const l=kt(a,4);if(l!=="INFO"&&l!=="INF0")return;let c=a.filePos;for(;c<=e+r-8;){a.filePos=c;const u=kt(a,4),f=ai(a,s),m=ve(a,f);let g=0;for(let w=0;w<m.length&&m[w]!==0;w++)g++;const y=String.fromCharCode(...m.subarray(0,g));switch(this.metadataTags.raw??={},this.metadataTags.raw[u]=y,u){case"INAM":case"TITL":this.metadataTags.title??=y;break;case"TIT3":this.metadataTags.description??=y;break;case"IART":this.metadataTags.artist??=y;break;case"IPRD":this.metadataTags.album??=y;break;case"IPRT":case"ITRK":case"TRCK":{const w=y.split("/"),T=Number.parseInt(w[0],10),S=w[1]&&Number.parseInt(w[1],10);Number.isInteger(T)&&T>0&&(this.metadataTags.trackNumber??=T),S&&Number.isInteger(S)&&S>0&&(this.metadataTags.tracksTotal??=S)}break;case"ICRD":case"IDIT":{const w=new Date(y);Number.isNaN(w.getTime())||(this.metadataTags.date??=w)}break;case"YEAR":{const w=Number.parseInt(y,10);Number.isInteger(w)&&w>0&&(this.metadataTags.date??=new Date(w,0,1))}break;case"IGNR":case"GENR":this.metadataTags.genre??=y;break;case"ICMT":case"CMNT":case"COMM":this.metadataTags.comment??=y;break}c+=8+f+(f&1)}}async parseId3Chunk(e,r){let s=this.reader.requestSlice(e,r);if(s instanceof Promise&&(s=await s),!s)return;const a=Wl(s);if(a){const l=s.slice(e+10,a.size);bg(l,a,this.metadataTags)}}getCodec(){if(b(this.audioInfo),this.audioInfo.format===hr.MULAW)return"ulaw";if(this.audioInfo.format===hr.ALAW)return"alaw";if(this.audioInfo.format===hr.PCM){if(this.audioInfo.sampleSizeInBytes===1)return"pcm-u8";if(this.audioInfo.sampleSizeInBytes===2)return"pcm-s16";if(this.audioInfo.sampleSizeInBytes===3)return"pcm-s24";if(this.audioInfo.sampleSizeInBytes===4)return"pcm-s32"}return this.audioInfo.format===hr.IEEE_FLOAT&&this.audioInfo.sampleSizeInBytes===4?"pcm-f32":null}async getMimeType(){return"audio/wav"}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return b(e),e.computeDuration()}async getTracks(){return await this.readMetadata(),this.tracks}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}const Ds=2048;class Ak{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return this.demuxer.getCodec()}getInternalCodecId(){return b(this.demuxer.audioInfo),this.demuxer.audioInfo.format}async getDecoderConfig(){const e=this.demuxer.getCodec();return e?(b(this.demuxer.audioInfo),{codec:e,numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate}):null}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getNumberOfChannels(){return b(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}getSampleRate(){return b(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getTimeResolution(){return b(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return Jt}getDisposition(){return{...qi}}async getFirstTimestamp(){return 0}async getPacketAtIndex(e,r){b(this.demuxer.audioInfo);const s=e*Ds*this.demuxer.audioInfo.blockSizeInBytes;if(s>=this.demuxer.dataSize)return null;const a=Math.min(Ds*this.demuxer.audioInfo.blockSizeInBytes,this.demuxer.dataSize-s);if(this.demuxer.reader.fileSize===null){let f=this.demuxer.reader.requestSlice(this.demuxer.dataStart+s,a);if(f instanceof Promise&&(f=await f),!f)return null}let l;if(r.metadataOnly)l=gn;else{let f=this.demuxer.reader.requestSlice(this.demuxer.dataStart+s,a);f instanceof Promise&&(f=await f),b(f),l=ve(f,a)}const c=e*Ds/this.demuxer.audioInfo.sampleRate,u=a/this.demuxer.audioInfo.blockSizeInBytes/this.demuxer.audioInfo.sampleRate;return this.demuxer.lastKnownPacketIndex=Math.max(e,c),new qe(l,"key",c,u,e,a)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getPacket(e,r){b(this.demuxer.audioInfo);const s=Math.floor(Math.min(e*this.demuxer.audioInfo.sampleRate/Ds,(this.demuxer.dataSize-1)/(Ds*this.demuxer.audioInfo.blockSizeInBytes))),a=await this.getPacketAtIndex(s,r);if(a)return a;if(s===0)return null;b(this.demuxer.reader.fileSize===null);let l=await this.getPacketAtIndex(this.demuxer.lastKnownPacketIndex,r);for(;l;){const c=await this.getNextPacket(l,r);if(!c)break;l=c}return l}getNextPacket(e,r){b(this.demuxer.audioInfo);const s=Math.round(e.timestamp*this.demuxer.audioInfo.sampleRate/Ds);return this.getPacketAtIndex(s+1,r)}getKeyPacket(e,r){return this.getPacket(e,r)}getNextKeyPacket(e,r){return this.getNextPacket(e,r)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Hl=7,$l=9,Ed=n=>{const e=n.filePos,r=ve(n,9),s=new Ye(r);if(s.readBits(12)!==4095||(s.skipBits(1),s.readBits(2)!==0))return null;const c=s.readBits(1),u=s.readBits(2)+1,f=s.readBits(4);if(f===15)return null;s.skipBits(1);const m=s.readBits(3);if(m===0)throw new Error("ADTS frames with channel configuration 0 are not supported.");s.skipBits(1),s.skipBits(1),s.skipBits(1),s.skipBits(1);const g=s.readBits(13);s.skipBits(11);const y=s.readBits(2)+1;if(y!==1)throw new Error("ADTS frames with more than one AAC frame are not supported.");let w=null;return c===1?n.filePos-=2:w=s.readBits(16),{objectType:u,samplingFrequencyIndex:f,channelConfiguration:m,frameLength:g,numberOfAacFrames:y,crcCheck:w,startPos:e}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const _d=1024;class Mk extends Ki{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.tracks=[],this.readingMutex=new sa,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();b(this.firstFrameHeader),this.tracks=[new Tr(this.input,new Fk(this))]})()}async advanceReader(){let e=this.reader.requestSliceRange(this.lastLoadedPos,Hl,$l);if(e instanceof Promise&&(e=await e),!e){this.lastSampleLoaded=!0;return}const r=Ed(e);if(!r){this.lastSampleLoaded=!0;return}if(this.reader.fileSize!==null&&r.startPos+r.frameLength>this.reader.fileSize){this.lastSampleLoaded=!0;return}this.firstFrameHeader||(this.firstFrameHeader=r);const s=ho[r.samplingFrequencyIndex];b(s!==void 0);const a=_d/s,l=r.crcCheck?$l:Hl,c={timestamp:this.nextTimestampInSamples/s,duration:a,dataStart:r.startPos+l,dataSize:r.frameLength-l};this.loadedSamples.push(c),this.nextTimestampInSamples+=_d,this.lastLoadedPos=r.startPos+r.frameLength}async getMimeType(){return"audio/aac"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return b(e),e.computeDuration()}async getMetadataTags(){return{}}}class Fk{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return this.getSampleRate()/_d}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return Jt}getCodec(){return"aac"}getInternalCodecId(){return b(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.objectType}getNumberOfChannels(){b(this.demuxer.firstFrameHeader);const e=Hd[this.demuxer.firstFrameHeader.channelConfiguration];return b(e!==void 0),e}getSampleRate(){b(this.demuxer.firstFrameHeader);const e=ho[this.demuxer.firstFrameHeader.samplingFrequencyIndex];return b(e!==void 0),e}getDisposition(){return{...qi}}async getDecoderConfig(){b(this.demuxer.firstFrameHeader);const e=new Uint8Array(3),r=new Ye(e),{objectType:s,samplingFrequencyIndex:a,channelConfiguration:l}=this.demuxer.firstFrameHeader;return s>31?(r.writeBits(5,31),r.writeBits(6,s-32)):r.writeBits(5,s),r.writeBits(4,a),r.writeBits(4,l),{codec:`mp4a.40.${this.demuxer.firstFrameHeader.objectType}`,numberOfChannels:this.getNumberOfChannels(),sampleRate:this.getSampleRate(),description:e.subarray(0,Math.ceil((r.pos-1)/8))}}async getPacketAtIndex(e,r){if(e===-1)return null;const s=this.demuxer.loadedSamples[e];if(!s)return null;let a;if(r.metadataOnly)a=gn;else{let l=this.demuxer.reader.requestSlice(s.dataStart,s.dataSize);if(l instanceof Promise&&(l=await l),!l)return null;a=ve(l,s.dataSize)}return new qe(a,"key",s.timestamp,s.duration,e,s.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,r){const s=await this.demuxer.readingMutex.acquire();try{const a=Yl(this.demuxer.loadedSamples,e.timestamp,c=>c.timestamp);if(a===-1)throw new Error("Packet was not created from this track.");const l=a+1;for(;l>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(l,r)}finally{s()}}async getPacket(e,r){const s=await this.demuxer.readingMutex.acquire();try{for(;;){const a=Ve(this.demuxer.loadedSamples,e,l=>l.timestamp);if(a===-1&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(a,r);if(a>=0&&a+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(a,r);await this.demuxer.advanceReader()}}finally{s()}}getKeyPacket(e,r){return this.getPacket(e,r)}getNextKeyPacket(e,r){return this.getNextPacket(e,r)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Nk=n=>n===0?null:n===1?192:n>=2&&n<=5?144*2**n:n===6?"uncommon-u8":n===7?"uncommon-u16":n>=8&&n<=15?2**n:null,Rk=(n,e)=>{switch(n){case 0:return e;case 1:return 88200;case 2:return 176400;case 3:return 192e3;case 4:return 8e3;case 5:return 16e3;case 6:return 22050;case 7:return 24e3;case 8:return 32e3;case 9:return 44100;case 10:return 48e3;case 11:return 96e3;case 12:return"uncommon-u8";case 13:return"uncommon-u16";case 14:return"uncommon-u16-10";default:return null}},zk=n=>{let e=0;const r=new Ye(ve(n,1));for(;r.readBits(1)===1;)e++;if(e===0)return r.readBits(7);const s=[],a=e-1,l=new Ye(ve(n,a)),c=8-e-1;for(let f=0;f<c;f++)s.unshift(r.readBits(1));for(let f=0;f<a;f++)for(let m=0;m<8;m++){const g=l.readBits(1);m<2||s.unshift(g)}return s.reduce((f,m,g)=>f|m<<g,0)},Bk=(n,e)=>{if(e==="uncommon-u16")return Pt(n)+1;if(e==="uncommon-u8")return me(n)+1;if(typeof e=="number")return e;Mn(e),b(!1)},Dk=(n,e)=>e==="uncommon-u16"?Pt(n):e==="uncommon-u16-10"?Pt(n)*10:e==="uncommon-u8"?me(n):typeof e=="number"?e:null,Ok=n=>{let r=0;for(const s of n){r^=s;for(let a=0;a<8;a++)(r&128)!==0?r=r<<1^7:r<<=1,r&=255}return r};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Uk extends Ki{constructor(e){super(e),this.loadedSamples=[],this.metadataPromise=null,this.track=null,this.metadataTags={},this.audioInfo=null,this.lastLoadedPos=null,this.blockingBit=null,this.readingMutex=new sa,this.lastSampleLoaded=!1,this.reader=e._reader}async computeDuration(){return await this.readMetadata(),b(this.track),this.track.computeDuration()}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}async getTracks(){return await this.readMetadata(),b(this.track),[this.track]}async getMimeType(){return"audio/flac"}async readMetadata(){let e=4;return this.metadataPromise??=(async()=>{for(;this.reader.fileSize===null||e<this.reader.fileSize;){let r=this.reader.requestSlice(e,4);if(r instanceof Promise&&(r=await r),e+=4,r===null)throw new Error(`Metadata block at position ${e} is too small! Corrupted file.`);b(r);const s=me(r),a=Ls(r),l=(s&128)!==0;switch(s&127){case Gs.STREAMINFO:{let u=this.reader.requestSlice(e,a);if(u instanceof Promise&&(u=await u),b(u),u===null)throw new Error(`StreamInfo block at position ${e} is too small! Corrupted file.`);const f=ve(u,34),m=new Ye(f),g=m.readBits(16),y=m.readBits(16),w=m.readBits(24),T=m.readBits(24),S=m.readBits(20),v=m.readBits(3)+1;m.readBits(5);const x=m.readBits(36);m.skipBits(128);const _=new Uint8Array(42);_.set(new Uint8Array([102,76,97,67]),0),_.set(new Uint8Array([128,0,0,34]),4),_.set(f,8),this.audioInfo={numberOfChannels:v,sampleRate:S,totalSamples:x,minimumBlockSize:g,maximumBlockSize:y,minimumFrameSize:w,maximumFrameSize:T,description:_},this.track=new Tr(this.input,new Lk(this));break}case Gs.VORBIS_COMMENT:{let u=this.reader.requestSlice(e,a);u instanceof Promise&&(u=await u),b(u),gd(ve(u,a),this.metadataTags);break}case Gs.PICTURE:{let u=this.reader.requestSlice(e,a);u instanceof Promise&&(u=await u),b(u);const f=te(u),m=te(u),g=mn.decode(ve(u,m)),y=te(u),w=mn.decode(ve(u,y));u.skip(16);const T=te(u),S=ve(u,T);this.metadataTags.images??=[],this.metadataTags.images.push({data:S,mimeType:g,kind:f===3?"coverFront":f===4?"coverBack":"unknown",description:w});break}}if(e+=a,l){this.lastLoadedPos=e;break}}})()}async readNextFlacFrame({startPos:e,isFirstPacket:r}){b(this.audioInfo);const s=6,l=this.audioInfo.maximumFrameSize+16,c=await this.reader.requestSliceRange(e,this.audioInfo.minimumFrameSize,l);if(!c)return null;const u=this.readFlacFrameHeader({slice:c,isFirstPacket:r});if(!u)return null;for(c.filePos=e+this.audioInfo.minimumFrameSize;;){if(c.filePos>c.end-s)return{num:u.num,blockSize:u.blockSize,sampleRate:u.sampleRate,size:c.end-e,isLastFrame:!0};if(me(c)===255){const m=c.filePos,g=me(c),y=this.blockingBit===1?249:248;if(g!==y){c.filePos=m;continue}c.skip(-2);const w=c.filePos-e,T=this.readFlacFrameHeader({slice:c,isFirstPacket:!1});if(!T){c.filePos=m;continue}if(this.blockingBit===0){if(T.num-u.num!==1){c.filePos=m;continue}}else if(T.num-u.num!==u.blockSize){c.filePos=m;continue}return{num:u.num,blockSize:u.blockSize,sampleRate:u.sampleRate,size:w,isLastFrame:!1}}}}readFlacFrameHeader({slice:e,isFirstPacket:r}){const s=e.filePos,a=ve(e,4),l=new Ye(a);if(l.readBits(15)!==32764)return null;if(this.blockingBit===null){b(r);const x=l.readBits(1);this.blockingBit=x}else if(this.blockingBit===1){if(b(!r),l.readBits(1)!==1)return null}else if(this.blockingBit===0){if(b(!r),l.readBits(1)!==0)return null}else throw new Error("Invalid blocking bit");const u=Nk(l.readBits(4));if(!u)return null;b(this.audioInfo);const f=Rk(l.readBits(4),this.audioInfo.sampleRate);if(!f||(l.readBits(4),l.readBits(3),l.readBits(1)!==0))return null;const g=zk(e),y=Bk(e,u),w=Dk(e,f);if(w===null||w!==this.audioInfo.sampleRate)return null;const T=e.filePos-s,S=me(e);e.skip(-T),e.skip(-1);const v=Ok(ve(e,T));return S!==v?null:{num:g,blockSize:y,sampleRate:w}}async advanceReader(){await this.readMetadata(),b(this.lastLoadedPos!==null),b(this.audioInfo);const e=this.lastLoadedPos,r=await this.readNextFlacFrame({startPos:e,isFirstPacket:this.loadedSamples.length===0});if(!r){this.lastSampleLoaded=!0;return}const s=this.loadedSamples[this.loadedSamples.length-1],l={blockOffset:s?s.blockOffset+s.blockSize:0,blockSize:r.blockSize,byteOffset:e,byteSize:r.size};if(this.lastLoadedPos=this.lastLoadedPos+r.size,this.loadedSamples.push(l),r.isLastFrame){this.lastSampleLoaded=!0;return}}}class Lk{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return"flac"}getInternalCodecId(){return null}getNumberOfChannels(){return b(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getSampleRate(){return b(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return Jt}getTimeResolution(){return b(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getDisposition(){return{...qi}}async getFirstTimestamp(){return 0}async getDecoderConfig(){return b(this.demuxer.audioInfo),{codec:"flac",numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate,description:this.demuxer.audioInfo.description}}async getPacket(e,r){if(b(this.demuxer.audioInfo),e<0)throw new Error("Timestamp cannot be negative");const s=await this.demuxer.readingMutex.acquire();try{for(;;){const a=Ve(this.demuxer.loadedSamples,e,f=>f.blockOffset/this.demuxer.audioInfo.sampleRate);if(a===-1){await this.demuxer.advanceReader();continue}const l=this.demuxer.loadedSamples[a],c=l.blockOffset/this.demuxer.audioInfo.sampleRate,u=l.blockSize/this.demuxer.audioInfo.sampleRate;if(c+u<=e){if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(this.demuxer.loadedSamples.length-1,r);await this.demuxer.advanceReader();continue}return this.getPacketAtIndex(a,r)}}finally{s()}}async getNextPacket(e,r){const s=await this.demuxer.readingMutex.acquire();try{const a=e.sequenceNumber+1;if(this.demuxer.lastSampleLoaded&&a>=this.demuxer.loadedSamples.length)return null;for(;a>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(a,r)}finally{s()}}getKeyPacket(e,r){return this.getPacket(e,r)}getNextKeyPacket(e,r){return this.getNextPacket(e,r)}async getPacketAtIndex(e,r){const s=this.demuxer.loadedSamples[e];if(!s)return null;let a;if(r.metadataOnly)a=gn;else{let u=this.demuxer.reader.requestSlice(s.byteOffset,s.byteSize);if(u instanceof Promise&&(u=await u),!u)return null;a=ve(u,s.byteSize)}b(this.demuxer.audioInfo);const l=s.blockOffset/this.demuxer.audioInfo.sampleRate,c=s.blockSize/this.demuxer.audioInfo.sampleRate;return new qe(a,"key",l,c,e,s.byteSize)}async getFirstPacket(e){for(;this.demuxer.loadedSamples.length===0&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(0,e)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class li{}class Pg extends li{async _getMajorBrand(e){let r=e._reader.requestSlice(0,12);return r instanceof Promise&&(r=await r),!r||(r.skip(4),kt(r,4)!=="ftyp")?null:kt(r,4)}_createDemuxer(e){return new Xw(e)}}class jk extends Pg{async _canReadInput(e){const r=await this._getMajorBrand(e);return!!r&&r!=="qt  "}get name(){return"MP4"}get mimeType(){return"video/mp4"}}class Vk extends Pg{async _canReadInput(e){return await this._getMajorBrand(e)==="qt  "}get name(){return"QuickTime File Format"}get mimeType(){return"video/quicktime"}}class Eg extends li{async isSupportedEBMLOfDocType(e,r){let s=e._reader.requestSlice(0,yr);if(s instanceof Promise&&(s=await s),!s)return!1;const a=gg(s);if(a===null||a<1||a>8||Ie(s,a)!==I.EBML)return!1;const c=yg(s);if(c===null)return!1;let u=e._reader.requestSlice(s.filePos,c);if(u instanceof Promise&&(u=await u),!u)return!1;const f=s.filePos;for(;u.filePos<=f+c-An;){const m=mr(u);if(!m)break;const{id:g,size:y}=m,w=u.filePos;if(y===null)return!1;switch(g){case I.EBMLVersion:if(Ie(u,y)!==1)return!1;break;case I.EBMLReadVersion:if(Ie(u,y)!==1)return!1;break;case I.DocType:if(Us(u,y)!==r)return!1;break;case I.DocTypeVersion:if(Ie(u,y)>4)return!1;break}u.filePos=w+y}return!0}_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"matroska")}_createDemuxer(e){return new ok(e)}get name(){return"Matroska"}get mimeType(){return"video/x-matroska"}}class Wk extends Eg{_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"webm")}get name(){return"WebM"}get mimeType(){return"video/webm"}}class Hk extends li{async _canReadInput(e){let r=e._reader.requestSlice(0,10);if(r instanceof Promise&&(r=await r),!r)return!1;let s=0,a=!1;for(;;){let m=e._reader.requestSlice(s,Vl);if(m instanceof Promise&&(m=await m),!m)break;const g=Wl(m);if(!g)break;a=!0,s=m.filePos+g.size}const l=await Pd(e._reader,s,s+4096);if(!l)return!1;if(a)return!0;s=l.startPos+l.header.totalSize;const c=await Pd(e._reader,s,s+vg);if(!c)return!1;const u=l.header,f=c.header;return!(u.channel!==f.channel||u.sampleRate!==f.sampleRate)}_createDemuxer(e){return new kk(e)}get name(){return"MP3"}get mimeType(){return"audio/mpeg"}}class $k extends li{async _canReadInput(e){let r=e._reader.requestSlice(0,12);if(r instanceof Promise&&(r=await r),!r)return!1;const s=kt(r,4);return s!=="RIFF"&&s!=="RIFX"&&s!=="RF64"?!1:(r.skip(4),kt(r,4)==="WAVE")}_createDemuxer(e){return new Ik(e)}get name(){return"WAVE"}get mimeType(){return"audio/wav"}}class Qk extends li{async _canReadInput(e){let r=e._reader.requestSlice(0,4);return r instanceof Promise&&(r=await r),r?kt(r,4)==="OggS":!1}_createDemuxer(e){return new Ek(e)}get name(){return"Ogg"}get mimeType(){return"application/ogg"}}class qk extends li{async _canReadInput(e){let r=e._reader.requestSlice(0,4);return r instanceof Promise&&(r=await r),r?kt(r,4)==="fLaC":!1}get name(){return"FLAC"}get mimeType(){return"audio/flac"}_createDemuxer(e){return new Uk(e)}}class Kk extends li{async _canReadInput(e){let r=e._reader.requestSliceRange(0,Hl,$l);if(r instanceof Promise&&(r=await r),!r)return!1;const s=Ed(r);if(!s||(r=e._reader.requestSliceRange(s.frameLength,Hl,$l),r instanceof Promise&&(r=await r),!r))return!1;const a=Ed(r);return a?s.objectType===a.objectType&&s.samplingFrequencyIndex===a.samplingFrequencyIndex&&s.channelConfiguration===a.channelConfiguration:!1}_createDemuxer(e){return new Mk(e)}get name(){return"ADTS"}get mimeType(){return"audio/aac"}}const Gk=new jk,Xk=new Vk,Yk=new Eg,Zk=new Wk,Jk=new Hk,eT=new $k,tT=new Qk,nT=new Kk,rT=new qk,iT=[Gk,Xk,Yk,Zk,eT,tT,rT,Jk,nT];/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class _g{constructor(){this._disposed=!1,this._sizePromise=null,this.onread=null}async getSizeOrNull(){if(this._disposed)throw new Zt;return this._sizePromise??=Promise.resolve(this._retrieveSize())}async getSize(){if(this._disposed)throw new Zt;const e=await this.getSizeOrNull();if(e===null)throw new Error("Cannot determine the size of an unsized source.");return e}}class sT extends _g{constructor(e,r={}){if(!(e instanceof Blob))throw new TypeError("blob must be a Blob.");if(!r||typeof r!="object")throw new TypeError("options must be an object.");if(r.maxCacheSize!==void 0&&(!Lp(r.maxCacheSize)||r.maxCacheSize<0))throw new TypeError("options.maxCacheSize, when provided, must be a non-negative number.");super(),this._readers=new WeakMap,this._blob=e,this._orchestrator=new oT({maxCacheSize:r.maxCacheSize??8*2**20,maxWorkerCount:4,runWorker:this._runWorker.bind(this),prefetchProfile:aT.fileSystem})}_retrieveSize(){const e=this._blob.size;return this._orchestrator.fileSize=e,e}_read(e,r){return this._orchestrator.read(e,r)}async _runWorker(e){let r=this._readers.get(e);for(r===void 0&&("stream"in this._blob&&!lo()?r=this._blob.slice(e.currentPos).stream().getReader():r=null,this._readers.set(e,r));e.currentPos<e.targetPos&&!e.aborted;)if(r){const{done:s,value:a}=await r.read();if(s)throw this._orchestrator.forgetWorker(e),new Error("Blob reader stopped unexpectedly before all requested data was read.");if(e.aborted)break;this.onread?.(e.currentPos,e.currentPos+a.length),this._orchestrator.supplyWorkerData(e,a)}else{const s=await this._blob.slice(e.currentPos,e.targetPos).arrayBuffer();if(e.aborted)break;this.onread?.(e.currentPos,e.currentPos+s.byteLength),this._orchestrator.supplyWorkerData(e,new Uint8Array(s))}e.running=!1,e.aborted&&await r?.cancel()}_dispose(){this._orchestrator.dispose()}}const aT={fileSystem:(n,e)=>(n=Math.floor((n-65536)/65536)*65536,e=Math.ceil((e+65536)/65536)*65536,{start:n,end:e})};class oT{constructor(e){this.options=e,this.fileSize=null,this.nextAge=0,this.workers=[],this.cache=[],this.currentCacheSize=0,this.disposed=!1}read(e,r){b(this.fileSize!==null);const s=this.options.prefetchProfile(e,r,this.workers),a=Math.max(s.start,0),l=Math.min(s.end,this.fileSize);b(a<=e&&r<=l);let c=null;const u=Ve(this.cache,e,A=>A.start),f=u!==-1?this.cache[u]:null;f&&f.start<=e&&r<=f.end&&(f.age=this.nextAge++,c={bytes:f.bytes,view:f.view,offset:f.start});const m=Ve(this.cache,a,A=>A.start),g=c?null:new Uint8Array(r-e);let y=0,w=a;const T=[];if(m!==-1){for(let A=m;A<this.cache.length;A++){const O=this.cache[A];if(O.start>=l)break;if(O.end<=a)continue;const B=Math.max(a,O.start),j=Math.min(l,O.end);if(b(B<=j),w<B&&T.push({start:w,end:B}),w=j,g){const L=Math.max(e,O.start),q=Math.min(r,O.end);if(L<q){const G=L-e;g.set(O.bytes.subarray(L-O.start,q-O.start),G),G===y&&(y=q-e)}}O.age=this.nextAge++}w<l&&T.push({start:w,end:l})}else T.push({start:a,end:l});if(g&&y>=g.length&&(c={bytes:g,view:tt(g),offset:e}),T.length===0)return b(c),c;const{promise:S,resolve:v,reject:x}=wt(),_=[];for(const A of T){const O=Math.max(e,A.start),B=Math.min(r,A.end);O===A.start&&B===A.end?_.push(A):O<B&&_.push({start:O,end:B})}for(const A of T){const O=g&&{start:e,bytes:g,holes:_,resolve:v,reject:x};let B=!1;for(const j of this.workers)if(Fm(A.start-131072,A.start,j.currentPos,j.targetPos)){j.targetPos=Math.max(j.targetPos,A.end),B=!0,O&&!j.pendingSlices.includes(O)&&j.pendingSlices.push(O),j.running||this.runWorker(j);break}if(!B){const j=this.createWorker(A.start,A.end);O&&(j.pendingSlices=[O]),this.runWorker(j)}}return c||(b(g),c=S.then(A=>({bytes:A,view:tt(A),offset:e}))),c}createWorker(e,r){const s={startPos:e,currentPos:e,targetPos:r,running:!1,aborted:this.disposed,pendingSlices:[],age:this.nextAge++};for(this.workers.push(s);this.workers.length>this.options.maxWorkerCount;){let a=0,l=this.workers[0];for(let c=1;c<this.workers.length;c++){const u=this.workers[c];u.age<l.age&&(a=c,l=u)}if(l.running&&l.pendingSlices.length>0)break;l.aborted=!0,this.workers.splice(a,1)}return s}runWorker(e){b(!e.running),b(e.currentPos<e.targetPos),e.running=!0,e.age=this.nextAge++,this.options.runWorker(e).catch(r=>{if(e.running=!1,e.pendingSlices.length>0)e.pendingSlices.forEach(s=>s.reject(r)),e.pendingSlices.length=0;else throw r})}supplyWorkerData(e,r){b(!e.aborted);const s=e.currentPos,a=s+r.length;this.insertIntoCache({start:s,end:a,bytes:r,view:tt(r),age:this.nextAge++}),e.currentPos+=r.length,e.targetPos=Math.max(e.targetPos,e.currentPos);for(let l=0;l<e.pendingSlices.length;l++){const c=e.pendingSlices[l],u=Math.max(s,c.start),f=Math.min(a,c.start+c.bytes.length);u<f&&c.bytes.set(r.subarray(u-s,f-s),u-c.start);for(let m=0;m<c.holes.length;m++){const g=c.holes[m];s<=g.start&&a>g.start&&(g.start=a),g.end<=g.start&&(c.holes.splice(m,1),m--)}c.holes.length===0&&(c.resolve(c.bytes),e.pendingSlices.splice(l,1),l--)}for(let l=0;l<this.workers.length;l++){const c=this.workers[l];e===c||c.running||Fm(s,a,c.currentPos,c.targetPos)&&(this.workers.splice(l,1),l--)}}forgetWorker(e){const r=this.workers.indexOf(e);b(r!==-1),this.workers.splice(r,1)}insertIntoCache(e){if(this.options.maxCacheSize===0)return;let r=Ve(this.cache,e.start,s=>s.start)+1;if(r>0){const s=this.cache[r-1];if(s.end>=e.end)return;if(s.end>e.start){const a=new Uint8Array(e.end-s.start);a.set(s.bytes,0),a.set(e.bytes,e.start-s.start),this.currentCacheSize+=e.end-s.end,s.bytes=a,s.view=tt(a),s.end=e.end,r--,e=s}else this.cache.splice(r,0,e),this.currentCacheSize+=e.bytes.length}else this.cache.splice(r,0,e),this.currentCacheSize+=e.bytes.length;for(let s=r+1;s<this.cache.length;s++){const a=this.cache[s];if(e.end<=a.start)break;if(e.end>=a.end){this.cache.splice(s,1),this.currentCacheSize-=a.bytes.length,s--;continue}const l=new Uint8Array(a.end-e.start);l.set(e.bytes,0),l.set(a.bytes,a.start-e.start),this.currentCacheSize-=e.end-a.start,e.bytes=l,e.view=tt(l),e.end=a.end,this.cache.splice(s,1);break}for(;this.currentCacheSize>this.options.maxCacheSize;){let s=0,a=this.cache[0];for(let l=1;l<this.cache.length;l++){const c=this.cache[l];c.age<a.age&&(s=l,a=c)}if(this.currentCacheSize-a.bytes.length<=this.options.maxCacheSize)break;this.cache.splice(s,1),this.currentCacheSize-=a.bytes.length}}dispose(){for(const e of this.workers)e.aborted=!0;this.workers.length=0,this.cache.length=0,this.disposed=!0}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */Up();class Ig{get disposed(){return this._disposed}constructor(e){if(this._demuxerPromise=null,this._format=null,this._disposed=!1,!e||typeof e!="object")throw new TypeError("options must be an object.");if(!Array.isArray(e.formats)||e.formats.some(r=>!(r instanceof li)))throw new TypeError("options.formats must be an array of InputFormat.");if(!(e.source instanceof _g))throw new TypeError("options.source must be a Source.");if(e.source._disposed)throw new Error("options.source must not be disposed.");this._formats=e.formats,this._source=e.source,this._reader=new lT(e.source)}_getDemuxer(){return this._demuxerPromise??=(async()=>{this._reader.fileSize=await this._source.getSizeOrNull();for(const e of this._formats)if(await e._canReadInput(this))return this._format=e,e._createDemuxer(this);throw new Error("Input has an unsupported or unrecognizable format.")})()}get source(){return this._source}async getFormat(){return await this._getDemuxer(),b(this._format),this._format}async computeDuration(){return(await this._getDemuxer()).computeDuration()}async getTracks(){return(await this._getDemuxer()).getTracks()}async getVideoTracks(){return(await this.getTracks()).filter(r=>r.isVideoTrack())}async getAudioTracks(){return(await this.getTracks()).filter(r=>r.isAudioTrack())}async getPrimaryVideoTrack(){return(await this.getTracks()).find(r=>r.isVideoTrack())??null}async getPrimaryAudioTrack(){return(await this.getTracks()).find(r=>r.isAudioTrack())??null}async getMimeType(){return(await this._getDemuxer()).getMimeType()}async getMetadataTags(){return(await this._getDemuxer()).getMetadataTags()}dispose(){this._disposed||(this._disposed=!0,this._source._disposed=!0,this._source._dispose())}[Symbol.dispose](){this.dispose()}}class Zt extends Error{constructor(e="Input has been disposed."){super(e),this.name="InputDisposedError"}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class lT{constructor(e){this.source=e}requestSlice(e,r){if(this.source._disposed)throw new Zt;if(this.fileSize!==null&&e+r>this.fileSize)return null;const s=e+r,a=this.source._read(e,s);return a instanceof Promise?a.then(l=>l?new ta(l.bytes,l.view,l.offset,e,s):null):a?new ta(a.bytes,a.view,a.offset,e,s):null}requestSliceRange(e,r,s){if(this.source._disposed)throw new Zt;if(this.fileSize!==null)return this.requestSlice(e,yt(this.fileSize-e,r,s));{const a=this.requestSlice(e,s),l=c=>{if(c)return c;const u=m=>(b(m!==null),this.requestSlice(e,yt(m-e,r,s))),f=this.source._retrieveSize();return f instanceof Promise?f.then(u):u(f)};return a instanceof Promise?a.then(l):l(a)}}}class ta{constructor(e,r,s,a,l){this.bytes=e,this.view=r,this.offset=s,this.start=a,this.end=l,this.bufferPos=a-s}static tempFromBytes(e){return new ta(e,tt(e),0,0,e.length)}get length(){return this.end-this.start}get filePos(){return this.offset+this.bufferPos}set filePos(e){this.bufferPos=e-this.offset}get remainingLength(){return Math.max(this.end-this.filePos,0)}skip(e){this.bufferPos+=e}slice(e,r=this.end-e){if(e<this.start||e+r>this.end)throw new RangeError("Slicing outside of original slice.");return new ta(this.bytes,this.view,this.offset,e,e+r)}}const Ht=(n,e)=>{if(n.filePos<n.start||n.filePos+e>n.end)throw new RangeError(`Tried reading [${n.filePos}, ${n.filePos+e}), but slice is [${n.start}, ${n.end}). This is likely an internal error, please report it alongside the file that caused it.`)},ve=(n,e)=>{Ht(n,e);const r=n.bytes.subarray(n.bufferPos,n.bufferPos+e);return n.bufferPos+=e,r},me=n=>(Ht(n,1),n.view.getUint8(n.bufferPos++)),ro=(n,e)=>{Ht(n,2);const r=n.view.getUint16(n.bufferPos,e);return n.bufferPos+=2,r},Pt=n=>{Ht(n,2);const e=n.view.getUint16(n.bufferPos,!1);return n.bufferPos+=2,e},Ls=n=>{Ht(n,3);const e=Zl(n.view,n.bufferPos,!1);return n.bufferPos+=3,e},Id=n=>{Ht(n,2);const e=n.view.getInt16(n.bufferPos,!1);return n.bufferPos+=2,e},ai=(n,e)=>{Ht(n,4);const r=n.view.getUint32(n.bufferPos,e);return n.bufferPos+=4,r},te=n=>{Ht(n,4);const e=n.view.getUint32(n.bufferPos,!1);return n.bufferPos+=4,e},$s=n=>{Ht(n,4);const e=n.view.getUint32(n.bufferPos,!0);return n.bufferPos+=4,e},Hi=n=>{Ht(n,4);const e=n.view.getInt32(n.bufferPos,!1);return n.bufferPos+=4,e},cT=n=>{Ht(n,4);const e=n.view.getInt32(n.bufferPos,!0);return n.bufferPos+=4,e},Xm=(n,e)=>{let r,s;return e?(r=ai(n,!0),s=ai(n,!0)):(s=ai(n,!1),r=ai(n,!1)),s*4294967296+r},_n=n=>{const e=te(n),r=te(n);return e*4294967296+r},uT=n=>{const e=Hi(n),r=te(n);return e*4294967296+r},dT=n=>{const e=$s(n);return cT(n)*4294967296+e},fT=n=>{Ht(n,4);const e=n.view.getFloat32(n.bufferPos,!1);return n.bufferPos+=4,e},Ag=n=>{Ht(n,8);const e=n.view.getFloat64(n.bufferPos,!1);return n.bufferPos+=8,e},kt=(n,e)=>{Ht(n,e);let r="";for(let s=0;s<e;s++)r+=String.fromCharCode(n.bytes[n.bufferPos++]);return r};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Ql=/<(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})>/g,hT=/(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})/,mT=n=>{const e=hT.exec(n);if(!e)throw new Error("Expected match.");return 3600*1e3*Number(e[1]||"0")+60*1e3*Number(e[2])+1e3*Number(e[3])+Number(e[4])},Mg=n=>{const e=Math.floor(n/36e5),r=Math.floor(n%(3600*1e3)/(60*1e3)),s=Math.floor(n%(60*1e3)/1e3),a=n%1e3;return e.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+":"+s.toString().padStart(2,"0")+"."+a.toString().padStart(3,"0")};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Ym{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap}writeU32(e){this.helperView.setUint32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeU64(e){this.helperView.setUint32(0,Math.floor(e/2**32),!1),this.helperView.setUint32(4,e,!1),this.writer.write(this.helper.subarray(0,8))}writeAscii(e){for(let r=0;r<e.length;r++)this.helperView.setUint8(r%8,e.charCodeAt(r)),r%8===7&&this.writer.write(this.helper);e.length%8!==0&&this.writer.write(this.helper.subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.writer.getPos()),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.writer.write(e.contents);else{const r=this.writer.getPos();if(this.writeBoxHeader(e,0),e.contents&&this.writer.write(e.contents),e.children)for(const l of e.children)l&&this.writeBox(l);const s=this.writer.getPos(),a=e.size??s-r;this.writer.seek(r),this.writeBoxHeader(e,a),this.writer.seek(s)}}writeBoxHeader(e,r){this.writeU32(e.largeSize?1:r),this.writeAscii(e.type),e.largeSize&&this.writeU64(r)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){const r=this.offsets.get(e);b(r!==void 0);const s=this.writer.getPos();this.writer.seek(r),this.writeBox(e),this.writer.seek(s)}measureBox(e){if(e.contents&&!e.children)return this.measureBoxHeader(e)+e.contents.byteLength;{let r=this.measureBoxHeader(e);if(e.contents&&(r+=e.contents.byteLength),e.children)for(const s of e.children)s&&(r+=this.measureBox(s));return r}}}const Fe=new Uint8Array(8),Kn=new DataView(Fe.buffer),et=n=>[(n%256+256)%256],pe=n=>(Kn.setUint16(0,n,!1),[Fe[0],Fe[1]]),Fg=n=>(Kn.setInt16(0,n,!1),[Fe[0],Fe[1]]),Ng=n=>(Kn.setUint32(0,n,!1),[Fe[1],Fe[2],Fe[3]]),J=n=>(Kn.setUint32(0,n,!1),[Fe[0],Fe[1],Fe[2],Fe[3]]),ri=n=>(Kn.setInt32(0,n,!1),[Fe[0],Fe[1],Fe[2],Fe[3]]),Qi=n=>(Kn.setUint32(0,Math.floor(n/2**32),!1),Kn.setUint32(4,n,!1),[Fe[0],Fe[1],Fe[2],Fe[3],Fe[4],Fe[5],Fe[6],Fe[7]]),Rg=n=>(Kn.setInt16(0,2**8*n,!1),[Fe[0],Fe[1]]),pr=n=>(Kn.setInt32(0,2**16*n,!1),[Fe[0],Fe[1],Fe[2],Fe[3]]),td=n=>(Kn.setInt32(0,2**30*n,!1),[Fe[0],Fe[1],Fe[2],Fe[3]]),nd=(n,e)=>{const r=[];let s=n;do{let a=s&127;s>>=7,r.length>0&&(a|=128),r.push(a)}while(s>0||e);return r.reverse()},Et=(n,e=!1)=>{const r=Array(n.length).fill(null).map((s,a)=>n.charCodeAt(a));return e&&r.push(0),r},Zd=n=>{let e=null;for(const r of n)(!e||r.timestamp>e.timestamp)&&(e=r);return e},zg=n=>{const e=n*(Math.PI/180),r=Math.round(Math.cos(e)),s=Math.round(Math.sin(e));return[r,s,0,-s,r,0,0,0,1]},Bg=zg(0),Dg=n=>[pr(n[0]),pr(n[1]),td(n[2]),pr(n[3]),pr(n[4]),td(n[5]),pr(n[6]),pr(n[7]),td(n[8])],ke=(n,e,r)=>({type:n,contents:e&&new Uint8Array(e.flat(10)),children:r}),De=(n,e,r,s,a)=>ke(n,[et(e),Ng(r),s??[]],a),pT=n=>n.isQuickTime?ke("ftyp",[Et("qt  "),J(512),Et("qt  ")]):n.fragmented?ke("ftyp",[Et("iso5"),J(512),Et("iso5"),Et("iso6"),Et("mp41")]):ke("ftyp",[Et("isom"),J(512),Et("isom"),n.holdsAvc?Et("avc1"):[],Et("mp41")]),Nl=n=>({type:"mdat",largeSize:n}),gT=n=>({type:"free",size:n}),io=n=>ke("moov",void 0,[yT(n.creationTime,n.trackDatas),...n.trackDatas.map(e=>wT(e,n.creationTime)),n.isFragmented?JT(n.trackDatas):null,fS(n)]),yT=(n,e)=>{const r=mt(Math.max(0,...e.filter(c=>c.samples.length>0).map(c=>{const u=Zd(c.samples);return u.timestamp+u.duration})),Ad),s=Math.max(0,...e.map(c=>c.track.id))+1,a=!Zs(n)||!Zs(r),l=a?Qi:J;return De("mvhd",+a,0,[l(n),l(n),J(Ad),l(r),pr(1),Rg(1),Array(10).fill(0),Dg(Bg),Array(24).fill(0),J(s)])},wT=(n,e)=>{const r=xS(n);return ke("trak",void 0,[kT(n,e),TT(n,e),r.name!==void 0?ke("udta",void 0,[ke("name",[...Wt.encode(r.name)])]):null])},kT=(n,e)=>{const r=Zd(n.samples),s=mt(r?r.timestamp+r.duration:0,Ad),a=!Zs(e)||!Zs(s),l=a?Qi:J;let c;if(n.type==="video"){const f=n.track.metadata.rotation;c=zg(f??0)}else c=Bg;let u=2;return n.track.metadata.disposition?.default!==!1&&(u|=1),De("tkhd",+a,u,[l(e),l(e),J(n.track.id),J(0),l(s),Array(8).fill(0),pe(0),pe(n.track.id),Rg(n.type==="audio"?1:0),pe(0),Dg(c),pr(n.type==="video"?n.info.width:0),pr(n.type==="video"?n.info.height:0)])},TT=(n,e)=>ke("mdia",void 0,[ST(n,e),Jd(!0,vT[n.type],bT[n.type]),xT(n)]),ST=(n,e)=>{const r=Zd(n.samples),s=mt(r?r.timestamp+r.duration:0,n.timescale),a=!Zs(e)||!Zs(s),l=a?Qi:J;return De("mdhd",+a,0,[l(e),l(e),J(n.timescale),l(s),pe(jg(n.track.metadata.languageCode??Jt)),pe(0)])},vT={video:"vide",audio:"soun",subtitle:"text"},bT={video:"MediabunnyVideoHandler",audio:"MediabunnySoundHandler",subtitle:"MediabunnyTextHandler"},Jd=(n,e,r,s="\0\0\0\0")=>De("hdlr",0,0,[n?Et("mhlr"):J(0),Et(e),Et(s),J(0),J(0),Et(r,!0)]),xT=n=>ke("minf",void 0,[_T[n.type](),IT(),FT(n)]),CT=()=>De("vmhd",0,1,[pe(0),pe(0),pe(0),pe(0)]),PT=()=>De("smhd",0,0,[pe(0),pe(0)]),ET=()=>De("nmhd",0,0),_T={video:CT,audio:PT,subtitle:ET},IT=()=>ke("dinf",void 0,[AT()]),AT=()=>De("dref",0,0,[J(1)],[MT()]),MT=()=>De("url ",0,1),FT=n=>{const e=n.compositionTimeOffsetTable.length>1||n.compositionTimeOffsetTable.some(r=>r.sampleCompositionTimeOffset!==0);return ke("stbl",void 0,[NT(n),QT(n),e?YT(n):null,e?ZT(n):null,KT(n),GT(n),XT(n),qT(n)])},NT=n=>{let e;if(n.type==="video")e=RT(gS(n.track.source._codec,n.info.decoderConfig.codec),n);else if(n.type==="audio"){const r=Lg(n.track.source._codec,n.muxer.isQuickTime);b(r),e=UT(r,n)}else n.type==="subtitle"&&(e=HT(kS[n.track.source._codec],n));return b(e),De("stsd",0,0,[J(1)],[e])},RT=(n,e)=>ke(n,[Array(6).fill(0),pe(1),pe(0),pe(0),Array(12).fill(0),pe(e.info.width),pe(e.info.height),J(4718592),J(4718592),J(0),pe(1),Array(32).fill(0),pe(24),Fg(65535)],[yS[e.track.source._codec](e),Bp(e.info.decoderConfig.colorSpace)?zT(e):null]),zT=n=>ke("colr",[Et("nclx"),pe(na[n.info.decoderConfig.colorSpace.primaries]),pe(ra[n.info.decoderConfig.colorSpace.transfer]),pe(ia[n.info.decoderConfig.colorSpace.matrix]),et((n.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),BT=n=>n.info.decoderConfig&&ke("avcC",[...It(n.info.decoderConfig.description)]),DT=n=>n.info.decoderConfig&&ke("hvcC",[...It(n.info.decoderConfig.description)]),Zm=n=>{if(!n.info.decoderConfig)return null;const e=n.info.decoderConfig,r=e.codec.split("."),s=Number(r[1]),a=Number(r[2]),l=Number(r[3]),c=r[4]?Number(r[4]):1,u=r[8]?Number(r[8]):Number(e.colorSpace?.fullRange??0),f=(l<<4)+(c<<1)+u,m=r[5]?Number(r[5]):e.colorSpace?.primaries?na[e.colorSpace.primaries]:2,g=r[6]?Number(r[6]):e.colorSpace?.transfer?ra[e.colorSpace.transfer]:2,y=r[7]?Number(r[7]):e.colorSpace?.matrix?ia[e.colorSpace.matrix]:2;return De("vpcC",1,0,[et(s),et(a),et(f),et(m),et(g),et(y),pe(0)])},OT=n=>ke("av1C",jp(n.info.decoderConfig.codec)),UT=(n,e)=>{let r=0,s,a=16;if(Tt.includes(e.track.source._codec)){const l=e.track.source._codec,{sampleSize:c}=kr(l);a=8*c,a>16&&(r=1)}return r===0?s=[Array(6).fill(0),pe(1),pe(r),pe(0),J(0),pe(e.info.numberOfChannels),pe(a),pe(0),pe(0),pe(e.info.sampleRate<2**16?e.info.sampleRate:0),pe(0)]:s=[Array(6).fill(0),pe(1),pe(r),pe(0),J(0),pe(e.info.numberOfChannels),pe(Math.min(a,16)),pe(0),pe(0),pe(e.info.sampleRate<2**16?e.info.sampleRate:0),pe(0),J(1),J(a/8),J(e.info.numberOfChannels*a/8),J(2)],ke(n,s,[wS(e.track.source._codec,e.muxer.isQuickTime)?.(e)??null])},rd=n=>{let e;switch(n.track.source._codec){case"aac":e=64;break;case"mp3":e=107;break;case"vorbis":e=221;break;default:throw new Error(`Unhandled audio codec: ${n.track.source._codec}`)}let r=[...et(e),...et(21),...Ng(0),...J(0),...J(0)];if(n.info.decoderConfig.description){const s=It(n.info.decoderConfig.description);r=[...r,...et(5),...nd(s.byteLength),...s]}return r=[...pe(1),...et(0),...et(4),...nd(r.length),...r,...et(6),...et(1),...et(2)],r=[...et(3),...nd(r.length),...r],De("esds",0,0,r)},Zr=n=>ke("wave",void 0,[LT(n),jT(n),ke("\0\0\0\0")]),LT=n=>ke("frma",[Et(Lg(n.track.source._codec,n.muxer.isQuickTime))]),jT=n=>{const{littleEndian:e}=kr(n.track.source._codec);return ke("enda",[pe(+e)])},VT=n=>{let e=n.info.numberOfChannels,r=3840,s=n.info.sampleRate,a=0,l=0,c=new Uint8Array(0);const u=n.info.decoderConfig?.description;if(u){b(u.byteLength>=18);const f=It(u),m=Qd(f);e=m.outputChannelCount,r=m.preSkip,s=m.inputSampleRate,a=m.outputGain,l=m.channelMappingFamily,m.channelMappingTable&&(c=m.channelMappingTable)}return ke("dOps",[et(0),et(e),pe(r),J(s),Fg(a),et(l),...c])},WT=n=>{const e=n.info.decoderConfig?.description;b(e);const r=It(e);return De("dfLa",0,0,[...r.subarray(4)])},$n=n=>{const{littleEndian:e,sampleSize:r}=kr(n.track.source._codec),s=+e;return De("pcmC",0,0,[et(s),et(8*r)])},HT=(n,e)=>ke(n,[Array(6).fill(0),pe(1)],[TS[e.track.source._codec](e)]),$T=n=>ke("vttC",[...Wt.encode(n.info.config.description)]),QT=n=>De("stts",0,0,[J(n.timeToSampleTable.length),n.timeToSampleTable.map(e=>[J(e.sampleCount),J(e.sampleDelta)])]),qT=n=>{if(n.samples.every(r=>r.type==="key"))return null;const e=[...n.samples.entries()].filter(([,r])=>r.type==="key");return De("stss",0,0,[J(e.length),e.map(([r])=>J(r+1))])},KT=n=>De("stsc",0,0,[J(n.compactlyCodedChunkTable.length),n.compactlyCodedChunkTable.map(e=>[J(e.firstChunk),J(e.samplesPerChunk),J(1)])]),GT=n=>{if(n.type==="audio"&&n.info.requiresPcmTransformation){const{sampleSize:e}=kr(n.track.source._codec);return De("stsz",0,0,[J(e*n.info.numberOfChannels),J(n.samples.reduce((r,s)=>r+mt(s.duration,n.timescale),0))])}return De("stsz",0,0,[J(0),J(n.samples.length),n.samples.map(e=>J(e.size))])},XT=n=>n.finalizedChunks.length>0&&ot(n.finalizedChunks).offset>=2**32?De("co64",0,0,[J(n.finalizedChunks.length),n.finalizedChunks.map(e=>Qi(e.offset))]):De("stco",0,0,[J(n.finalizedChunks.length),n.finalizedChunks.map(e=>J(e.offset))]),YT=n=>De("ctts",1,0,[J(n.compositionTimeOffsetTable.length),n.compositionTimeOffsetTable.map(e=>[J(e.sampleCount),ri(e.sampleCompositionTimeOffset)])]),ZT=n=>{let e=1/0,r=-1/0,s=1/0,a=-1/0;b(n.compositionTimeOffsetTable.length>0),b(n.samples.length>0);for(let c=0;c<n.compositionTimeOffsetTable.length;c++){const u=n.compositionTimeOffsetTable[c];e=Math.min(e,u.sampleCompositionTimeOffset),r=Math.max(r,u.sampleCompositionTimeOffset)}for(let c=0;c<n.samples.length;c++){const u=n.samples[c];s=Math.min(s,mt(u.timestamp,n.timescale)),a=Math.max(a,mt(u.timestamp+u.duration,n.timescale))}const l=Math.max(-e,0);return a>=2**31?null:De("cslg",0,0,[ri(l),ri(e),ri(r),ri(s),ri(a)])},JT=n=>ke("mvex",void 0,n.map(eS)),eS=n=>De("trex",0,0,[J(n.track.id),J(1),J(0),J(0),J(0)]),Jm=(n,e)=>ke("moof",void 0,[tS(n),...e.map(nS)]),tS=n=>De("mfhd",0,0,[J(n)]),Og=n=>{let e=0,r=0;const s=0,a=0,l=n.type==="delta";return r|=+l,l?e|=1:e|=2,e<<24|r<<16|s<<8|a},nS=n=>ke("traf",void 0,[rS(n),iS(n),sS(n)]),rS=n=>{b(n.currentChunk);let e=0;e|=8,e|=16,e|=32,e|=131072;const r=n.currentChunk.samples[1]??n.currentChunk.samples[0],s={duration:r.timescaleUnitsToNextSample,size:r.size,flags:Og(r)};return De("tfhd",0,e,[J(n.track.id),J(s.duration),J(s.size),J(s.flags)])},iS=n=>(b(n.currentChunk),De("tfdt",1,0,[Qi(mt(n.currentChunk.startTimestamp,n.timescale))])),sS=n=>{b(n.currentChunk);const e=n.currentChunk.samples.map(v=>v.timescaleUnitsToNextSample),r=n.currentChunk.samples.map(v=>v.size),s=n.currentChunk.samples.map(Og),a=n.currentChunk.samples.map(v=>mt(v.timestamp-v.decodeTimestamp,n.timescale)),l=new Set(e),c=new Set(r),u=new Set(s),f=new Set(a),m=u.size===2&&s[0]!==s[1],g=l.size>1,y=c.size>1,w=!m&&u.size>1,T=f.size>1||[...f].some(v=>v!==0);let S=0;return S|=1,S|=4*+m,S|=256*+g,S|=512*+y,S|=1024*+w,S|=2048*+T,De("trun",1,S,[J(n.currentChunk.samples.length),J(n.currentChunk.offset-n.currentChunk.moofOffset||0),m?J(s[0]):[],n.currentChunk.samples.map((v,x)=>[g?J(e[x]):[],y?J(r[x]):[],w?J(s[x]):[],T?ri(a[x]):[]])])},aS=n=>ke("mfra",void 0,[...n.map(oS),lS()]),oS=(n,e)=>De("tfra",1,0,[J(n.track.id),J(63),J(n.finalizedChunks.length),n.finalizedChunks.map(s=>[Qi(mt(s.samples[0].timestamp,n.timescale)),Qi(s.moofOffset),J(e+1),J(1),J(1)])]),lS=()=>De("mfro",0,0,[J(0)]),cS=()=>ke("vtte"),uS=(n,e,r,s,a)=>ke("vttc",void 0,[a!==null?ke("vsid",[ri(a)]):null,r!==null?ke("iden",[...Wt.encode(r)]):null,e!==null?ke("ctim",[...Wt.encode(Mg(e))]):null,s!==null?ke("sttg",[...Wt.encode(s)]):null,ke("payl",[...Wt.encode(n)])]),dS=n=>ke("vtta",[...Wt.encode(n)]),fS=n=>{const e=[],r=n.format._options.metadataFormat??"auto",s=n.output._metadataTags;if(r==="mdir"||r==="auto"&&!n.isQuickTime){const a=mS(s);a&&e.push(a)}else if(r==="mdta"){const a=pS(s);a&&e.push(a)}else(r==="udta"||r==="auto"&&n.isQuickTime)&&hS(e,n.output._metadataTags);return e.length===0?null:ke("udta",void 0,e)},hS=(n,e)=>{for(const{key:r,value:s}of Vd(e))switch(r){case"title":n.push(Qn("nam",s));break;case"description":n.push(Qn("des",s));break;case"artist":n.push(Qn("ART",s));break;case"album":n.push(Qn("alb",s));break;case"albumArtist":n.push(Qn("albr",s));break;case"genre":n.push(Qn("gen",s));break;case"date":n.push(Qn("day",s.toISOString().slice(0,10)));break;case"comment":n.push(Qn("cmt",s));break;case"lyrics":n.push(Qn("lyr",s));break;case"raw":break;case"discNumber":case"discsTotal":case"trackNumber":case"tracksTotal":case"images":break;default:Mn(r)}if(e.raw)for(const r in e.raw){const s=e.raw[r];s==null||r.length!==4||n.some(a=>a.type===r)||(typeof s=="string"?n.push(Qn(r,s)):s instanceof Uint8Array&&n.push(ke(r,Array.from(s))))}},Qn=(n,e)=>{const r=Wt.encode(e);return ke(n,[pe(r.length),pe(jg("und")),Array.from(r)])},ep={"image/jpeg":13,"image/png":14,"image/bmp":27},Ug=(n,e)=>{const r=[];for(const{key:s,value:a}of Vd(n))switch(s){case"title":r.push({key:e?"title":"nam",value:Pn(a)});break;case"description":r.push({key:e?"description":"des",value:Pn(a)});break;case"artist":r.push({key:e?"artist":"ART",value:Pn(a)});break;case"album":r.push({key:e?"album":"alb",value:Pn(a)});break;case"albumArtist":r.push({key:e?"album_artist":"aART",value:Pn(a)});break;case"comment":r.push({key:e?"comment":"cmt",value:Pn(a)});break;case"genre":r.push({key:e?"genre":"gen",value:Pn(a)});break;case"lyrics":r.push({key:e?"lyrics":"lyr",value:Pn(a)});break;case"date":r.push({key:e?"date":"day",value:Pn(a.toISOString().slice(0,10))});break;case"images":for(const l of a)l.kind==="coverFront"&&r.push({key:"covr",value:ke("data",[J(ep[l.mimeType]??0),J(0),Array.from(l.data)])});break;case"trackNumber":if(e){const l=n.tracksTotal!==void 0?`${a}/${n.tracksTotal}`:a.toString();r.push({key:"track",value:Pn(l)})}else r.push({key:"trkn",value:ke("data",[J(0),J(0),pe(0),pe(a),pe(n.tracksTotal??0),pe(0)])});break;case"discNumber":e||r.push({key:"disc",value:ke("data",[J(0),J(0),pe(0),pe(a),pe(n.discsTotal??0),pe(0)])});break;case"tracksTotal":case"discsTotal":break;case"raw":break;default:Mn(s)}if(n.raw)for(const s in n.raw){const a=n.raw[s];a==null||!e&&s.length!==4||r.some(l=>l.key===s)||(typeof a=="string"?r.push({key:s,value:Pn(a)}):a instanceof Uint8Array?r.push({key:s,value:ke("data",[J(0),J(0),Array.from(a)])}):a instanceof Qs&&r.push({key:s,value:ke("data",[J(ep[a.mimeType]??0),J(0),Array.from(a.data)])}))}return r},mS=n=>{const e=Ug(n,!1);return e.length===0?null:De("meta",0,0,void 0,[Jd(!1,"mdir","","appl"),ke("ilst",void 0,e.map(r=>ke(r.key,void 0,[r.value])))])},pS=n=>{const e=Ug(n,!0);return e.length===0?null:ke("meta",void 0,[Jd(!1,"mdta",""),De("keys",0,0,[J(e.length)],e.map(r=>ke("mdta",[...Wt.encode(r.key)]))),ke("ilst",void 0,e.map((r,s)=>{const a=String.fromCharCode(...J(s+1));return ke(a,void 0,[r.value])}))])},Pn=n=>ke("data",[J(1),J(0),...Wt.encode(n)]),gS=(n,e)=>{switch(n){case"avc":return e.startsWith("avc3")?"avc3":"avc1";case"hevc":return"hvc1";case"vp8":return"vp08";case"vp9":return"vp09";case"av1":return"av01"}},yS={avc:BT,hevc:DT,vp8:Zm,vp9:Zm,av1:OT},Lg=(n,e)=>{switch(n){case"aac":return"mp4a";case"mp3":return"mp4a";case"opus":return"Opus";case"vorbis":return"mp4a";case"flac":return"fLaC";case"ulaw":return"ulaw";case"alaw":return"alaw";case"pcm-u8":return"raw ";case"pcm-s8":return"sowt"}if(e)switch(n){case"pcm-s16":return"sowt";case"pcm-s16be":return"twos";case"pcm-s24":return"in24";case"pcm-s24be":return"in24";case"pcm-s32":return"in32";case"pcm-s32be":return"in32";case"pcm-f32":return"fl32";case"pcm-f32be":return"fl32";case"pcm-f64":return"fl64";case"pcm-f64be":return"fl64"}else switch(n){case"pcm-s16":return"ipcm";case"pcm-s16be":return"ipcm";case"pcm-s24":return"ipcm";case"pcm-s24be":return"ipcm";case"pcm-s32":return"ipcm";case"pcm-s32be":return"ipcm";case"pcm-f32":return"fpcm";case"pcm-f32be":return"fpcm";case"pcm-f64":return"fpcm";case"pcm-f64be":return"fpcm"}},wS=(n,e)=>{switch(n){case"aac":return rd;case"mp3":return rd;case"opus":return VT;case"vorbis":return rd;case"flac":return WT}if(e)switch(n){case"pcm-s24":return Zr;case"pcm-s24be":return Zr;case"pcm-s32":return Zr;case"pcm-s32be":return Zr;case"pcm-f32":return Zr;case"pcm-f32be":return Zr;case"pcm-f64":return Zr;case"pcm-f64be":return Zr}else switch(n){case"pcm-s16":return $n;case"pcm-s16be":return $n;case"pcm-s24":return $n;case"pcm-s24be":return $n;case"pcm-s32":return $n;case"pcm-s32be":return $n;case"pcm-f32":return $n;case"pcm-f32be":return $n;case"pcm-f64":return $n;case"pcm-f64be":return $n}return null},kS={webvtt:"wvtt"},TS={webvtt:$T},jg=n=>{b(n.length===3);let e=0;for(let r=0;r<3;r++)e<<=5,e+=n.charCodeAt(r)-96;return e};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Vg{constructor(){this.ensureMonotonicity=!1,this.trackedWrites=null,this.trackedStart=-1,this.trackedEnd=-1}start(){}maybeTrackWrites(e){if(!this.trackedWrites)return;let r=this.getPos();if(r<this.trackedStart){if(r+e.byteLength<=this.trackedStart)return;e=e.subarray(this.trackedStart-r),r=0}const s=r+e.byteLength-this.trackedStart;let a=this.trackedWrites.byteLength;for(;a<s;)a*=2;if(a!==this.trackedWrites.byteLength){const l=new Uint8Array(a);l.set(this.trackedWrites,0),this.trackedWrites=l}this.trackedWrites.set(e,r-this.trackedStart),this.trackedEnd=Math.max(this.trackedEnd,r+e.byteLength)}startTrackingWrites(){this.trackedWrites=new Uint8Array(2**10),this.trackedStart=this.getPos(),this.trackedEnd=this.trackedStart}stopTrackingWrites(){if(!this.trackedWrites)throw new Error("Internal error: Can't get tracked writes since nothing was tracked.");const r={data:this.trackedWrites.subarray(0,this.trackedEnd-this.trackedStart),start:this.trackedStart,end:this.trackedEnd};return this.trackedWrites=null,r}}const id=2**16,sd=2**32;class Wg extends Vg{constructor(e){if(super(),this.pos=0,this.maxPos=0,this.target=e,this.supportsResize="resize"in new ArrayBuffer(0),this.supportsResize)try{this.buffer=new ArrayBuffer(id,{maxByteLength:sd})}catch{this.buffer=new ArrayBuffer(id),this.supportsResize=!1}else this.buffer=new ArrayBuffer(id);this.bytes=new Uint8Array(this.buffer)}ensureSize(e){let r=this.buffer.byteLength;for(;r<e;)r*=2;if(r!==this.buffer.byteLength){if(r>sd)throw new Error(`ArrayBuffer exceeded maximum size of ${sd} bytes. Please consider using another target.`);if(this.supportsResize)this.buffer.resize(r);else{const s=new ArrayBuffer(r),a=new Uint8Array(s);a.set(this.bytes,0),this.buffer=s,this.bytes=a}}}write(e){this.maybeTrackWrites(e),this.ensureSize(this.pos+e.byteLength),this.bytes.set(e,this.pos),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength,this.maxPos=Math.max(this.maxPos,this.pos)}seek(e){this.pos=e}getPos(){return this.pos}async flush(){}async finalize(){this.ensureSize(this.pos),this.target.buffer=this.buffer.slice(0,Math.max(this.maxPos,this.pos))}async close(){}getSlice(e,r){return this.bytes.slice(e,r)}}class SS extends Vg{constructor(e){super(),this.target=e,this.pos=0}write(e){this.maybeTrackWrites(e),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength}getPos(){return this.pos}seek(e){this.pos=e}async flush(){}async finalize(){}async close(){}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class ef{constructor(){this._output=null,this.onwrite=null}}class Hg extends ef{constructor(){super(...arguments),this.buffer=null}_createWriter(){return new Wg(this)}}class vS extends ef{_createWriter(){return new SS(this)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Ad=1e3,bS=2082844800,xS=n=>{const e={},r=n.track;return r.metadata.name!==void 0&&(e.name=r.metadata.name),e},mt=(n,e,r=!0)=>{const s=n*e;return r?Math.round(s):s};class CS extends Gp{constructor(e,r){super(e),this.auxTarget=new Hg,this.auxWriter=this.auxTarget._createWriter(),this.auxBoxWriter=new Ym(this.auxWriter),this.mdat=null,this.ftypSize=null,this.trackDatas=[],this.allTracksKnown=wt(),this.creationTime=Math.floor(Date.now()/1e3)+bS,this.finalizedChunks=[],this.nextFragmentNumber=1,this.maxWrittenTimestamp=-1/0,this.format=r,this.writer=e._writer,this.boxWriter=new Ym(this.writer),this.isQuickTime=r instanceof qg;const s=this.writer instanceof Wg?"in-memory":!1;this.fastStart=r._options.fastStart??s,this.isFragmented=this.fastStart==="fragmented",(this.fastStart==="in-memory"||this.isFragmented)&&(this.writer.ensureMonotonicity=!0),this.minimumFragmentDuration=r._options.minimumFragmentDuration??1}async start(){const e=await this.mutex.acquire(),r=this.output._tracks.some(s=>s.type==="video"&&s.source._codec==="avc");if(this.format._options.onFtyp&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(pT({isQuickTime:this.isQuickTime,holdsAvc:r,fragmented:this.isFragmented})),this.format._options.onFtyp){const{data:s,start:a}=this.writer.stopTrackingWrites();this.format._options.onFtyp(s,a)}if(this.ftypSize=this.writer.getPos(),this.fastStart!=="in-memory")if(this.fastStart==="reserve"){for(const s of this.output._tracks)if(s.metadata.maximumPacketCount===void 0)throw new Error("All tracks must specify maximumPacketCount in their metadata when using fastStart: 'reserve'.")}else this.isFragmented||(this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=Nl(!0),this.boxWriter.writeBox(this.mdat));await this.writer.flush(),e()}allTracksAreKnown(){for(const e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some(r=>r.track===e))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;const e=this.trackDatas.map(r=>r.type==="video"||r.type==="audio"?r.info.decoderConfig.codec:{webvtt:"wvtt"}[r.track.source._codec]);return hg({isQuickTime:this.isQuickTime,hasVideo:this.trackDatas.some(r=>r.type==="video"),hasAudio:this.trackDatas.some(r=>r.type==="audio"),codecStrings:e})}getVideoTrackData(e,r,s){const a=this.trackDatas.find(m=>m.track===e);if(a)return a;Qp(s),b(s),b(s.decoderConfig);const l={...s.decoderConfig};b(l.codedWidth!==void 0),b(l.codedHeight!==void 0);let c=!1;if(e.source._codec==="avc"&&!l.description){const m=Jp(r.data);if(!m)throw new Error("Couldn't extract an AVCDecoderConfigurationRecord from the AVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.264) when not providing a description, or provide a description (must be an AVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in AVCC format.");l.description=xw(m),c=!0}else if(e.source._codec==="hevc"&&!l.description){const m=ng(r.data);if(!m)throw new Error("Couldn't extract an HEVCDecoderConfigurationRecord from the HEVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.265) when not providing a description, or provide a description (must be an HEVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in HEVC format.");l.description=Fw(m),c=!0}const u=iw(1/(e.metadata.frameRate??57600),1e6).denominator,f={muxer:this,track:e,type:"video",info:{width:l.codedWidth,height:l.codedHeight,decoderConfig:l,requiresAnnexBTransformation:c},timescale:u,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(f),this.trackDatas.sort((m,g)=>m.track.id-g.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),f}getAudioTrackData(e,r){const s=this.trackDatas.find(l=>l.track===e);if(s)return s;qp(r),b(r),b(r.decoderConfig);const a={muxer:this,track:e,type:"audio",info:{numberOfChannels:r.decoderConfig.numberOfChannels,sampleRate:r.decoderConfig.sampleRate,decoderConfig:r.decoderConfig,requiresPcmTransformation:!this.isFragmented&&Tt.includes(e.source._codec)},timescale:r.decoderConfig.sampleRate,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(a),this.trackDatas.sort((l,c)=>l.track.id-c.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),a}getSubtitleTrackData(e,r){const s=this.trackDatas.find(l=>l.track===e);if(s)return s;Kp(r),b(r),b(r.config);const a={muxer:this,track:e,type:"subtitle",info:{config:r.config},timescale:1e3,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[],lastCueEndTimestamp:0,cueQueue:[],nextSourceId:0,cueToSourceId:new WeakMap};return this.trackDatas.push(a),this.trackDatas.sort((l,c)=>l.track.id-c.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),a}async addEncodedVideoPacket(e,r,s){const a=await this.mutex.acquire();try{const l=this.getVideoTrackData(e,r,s);let c=r.data;if(l.info.requiresAnnexBTransformation){const m=ko(c);if(m.length===0)throw new Error("Failed to transform packet data. Make sure all packets are provided in Annex B format, as specified in ITU-T-REC-H.264 and ITU-T-REC-H.265.");c=Yp(m,4)}const u=this.validateAndNormalizeTimestamp(l.track,r.timestamp,r.type==="key"),f=this.createSampleForTrack(l,c,u,r.duration,r.type);await this.registerSample(l,f)}finally{a()}}async addEncodedAudioPacket(e,r,s){const a=await this.mutex.acquire();try{const l=this.getAudioTrackData(e,s),c=this.validateAndNormalizeTimestamp(l.track,r.timestamp,r.type==="key"),u=this.createSampleForTrack(l,r.data,c,r.duration,r.type);l.info.requiresPcmTransformation&&await this.maybePadWithSilence(l,c),await this.registerSample(l,u)}finally{a()}}async maybePadWithSilence(e,r){const s=ot(e.samples),a=s?s.timestamp+s.duration:0,l=r-a,c=mt(l,e.timescale);if(c>0){const{sampleSize:u,silentValue:f}=kr(e.info.decoderConfig.codec),m=c*e.info.numberOfChannels,g=new Uint8Array(u*m).fill(f),y=this.createSampleForTrack(e,new Uint8Array(g.buffer),a,l,"key");await this.registerSample(e,y)}}async addSubtitleCue(e,r,s){const a=await this.mutex.acquire();try{const l=this.getSubtitleTrackData(e,s);this.validateAndNormalizeTimestamp(l.track,r.timestamp,!0),e.source._codec==="webvtt"&&(l.cueQueue.push(r),await this.processWebVTTCues(l,r.timestamp))}finally{a()}}async processWebVTTCues(e,r){for(;e.cueQueue.length>0;){const s=new Set([]);for(const m of e.cueQueue)b(m.timestamp<=r),b(e.lastCueEndTimestamp<=m.timestamp+m.duration),s.add(Math.max(m.timestamp,e.lastCueEndTimestamp)),s.add(m.timestamp+m.duration);const a=[...s].sort((m,g)=>m-g),l=a[0],c=a[1]??l;if(r<c)break;if(e.lastCueEndTimestamp<l){this.auxWriter.seek(0);const m=cS();this.auxBoxWriter.writeBox(m);const g=this.auxWriter.getSlice(0,this.auxWriter.getPos()),y=this.createSampleForTrack(e,g,e.lastCueEndTimestamp,l-e.lastCueEndTimestamp,"key");await this.registerSample(e,y),e.lastCueEndTimestamp=l}this.auxWriter.seek(0);for(let m=0;m<e.cueQueue.length;m++){const g=e.cueQueue[m];if(g.timestamp>=c)break;Ql.lastIndex=0;const y=Ql.test(g.text),w=g.timestamp+g.duration;let T=e.cueToSourceId.get(g);if(T===void 0&&c<w&&(T=e.nextSourceId++,e.cueToSourceId.set(g,T)),g.notes){const v=dS(g.notes);this.auxBoxWriter.writeBox(v)}const S=uS(g.text,y?l:null,g.identifier??null,g.settings??null,T??null);this.auxBoxWriter.writeBox(S),w===c&&e.cueQueue.splice(m--,1)}const u=this.auxWriter.getSlice(0,this.auxWriter.getPos()),f=this.createSampleForTrack(e,u,l,c-l,"key");await this.registerSample(e,f),e.lastCueEndTimestamp=c}}createSampleForTrack(e,r,s,a,l){return{timestamp:s,decodeTimestamp:s,duration:a,data:r,size:r.byteLength,type:l,timescaleUnitsToNextSample:mt(a,e.timescale)}}processTimestamps(e,r){if(e.timestampProcessingQueue.length===0)return;if(e.type==="audio"&&e.info.requiresPcmTransformation){let a=0;for(let l=0;l<e.timestampProcessingQueue.length;l++){const c=e.timestampProcessingQueue[l],u=mt(c.duration,e.timescale);a+=u}if(e.timeToSampleTable.length===0)e.timeToSampleTable.push({sampleCount:a,sampleDelta:1});else{const l=ot(e.timeToSampleTable);l.sampleCount+=a}e.timestampProcessingQueue.length=0;return}const s=e.timestampProcessingQueue.map(a=>a.timestamp).sort((a,l)=>a-l);for(let a=0;a<e.timestampProcessingQueue.length;a++){const l=e.timestampProcessingQueue[a];l.decodeTimestamp=s[a],!this.isFragmented&&e.lastTimescaleUnits===null&&(l.decodeTimestamp=0);const c=mt(l.timestamp-l.decodeTimestamp,e.timescale),u=mt(l.duration,e.timescale);if(e.lastTimescaleUnits!==null){b(e.lastSample);const f=mt(l.decodeTimestamp,e.timescale,!1),m=Math.round(f-e.lastTimescaleUnits);if(b(m>=0),e.lastTimescaleUnits+=m,e.lastSample.timescaleUnitsToNextSample=m,!this.isFragmented){let g=ot(e.timeToSampleTable);if(b(g),g.sampleCount===1){g.sampleDelta=m;const w=e.timeToSampleTable[e.timeToSampleTable.length-2];w&&w.sampleDelta===m&&(w.sampleCount++,e.timeToSampleTable.pop(),g=w)}else g.sampleDelta!==m&&(g.sampleCount--,e.timeToSampleTable.push(g={sampleCount:1,sampleDelta:m}));g.sampleDelta===u?g.sampleCount++:e.timeToSampleTable.push({sampleCount:1,sampleDelta:u});const y=ot(e.compositionTimeOffsetTable);b(y),y.sampleCompositionTimeOffset===c?y.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:c})}}else e.lastTimescaleUnits=mt(l.decodeTimestamp,e.timescale,!1),this.isFragmented||(e.timeToSampleTable.push({sampleCount:1,sampleDelta:u}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:c}));e.lastSample=l}if(e.timestampProcessingQueue.length=0,b(e.lastSample),b(e.lastTimescaleUnits!==null),r!==void 0&&e.lastSample.timescaleUnitsToNextSample===0){b(r.type==="key");const a=mt(r.timestamp,e.timescale,!1),l=Math.round(a-e.lastTimescaleUnits);e.lastSample.timescaleUnitsToNextSample=l}}async registerSample(e,r){r.type==="key"&&this.processTimestamps(e,r),e.timestampProcessingQueue.push(r),this.isFragmented?(e.sampleQueue.push(r),await this.interleaveSamples()):this.fastStart==="reserve"?await this.registerSampleFastStartReserve(e,r):await this.addSampleToTrack(e,r)}async addSampleToTrack(e,r){if(!this.isFragmented&&(e.samples.push(r),this.fastStart==="reserve")){const a=e.track.metadata.maximumPacketCount;if(b(a!==void 0),e.samples.length>a)throw new Error(`Track #${e.track.id} has already reached the maximum packet count (${a}). Either add less packets or increase the maximum packet count.`)}let s=!1;if(!e.currentChunk)s=!0;else{e.currentChunk.startTimestamp=Math.min(e.currentChunk.startTimestamp,r.timestamp);const a=r.timestamp-e.currentChunk.startTimestamp;if(this.isFragmented){const l=this.trackDatas.every(c=>{if(e===c)return r.type==="key";const u=c.sampleQueue[0];return u?u.type==="key":c.track.source._closed});a>=this.minimumFragmentDuration&&l&&r.timestamp>this.maxWrittenTimestamp&&(s=!0,await this.finalizeFragment())}else s=a>=.5}s&&(e.currentChunk&&await this.finalizeCurrentChunk(e),e.currentChunk={startTimestamp:r.timestamp,samples:[],offset:null,moofOffset:null}),b(e.currentChunk),e.currentChunk.samples.push(r),this.isFragmented&&(this.maxWrittenTimestamp=Math.max(this.maxWrittenTimestamp,r.timestamp))}async finalizeCurrentChunk(e){if(b(!this.isFragmented),!e.currentChunk)return;e.finalizedChunks.push(e.currentChunk),this.finalizedChunks.push(e.currentChunk);let r=e.currentChunk.samples.length;if(e.type==="audio"&&e.info.requiresPcmTransformation&&(r=e.currentChunk.samples.reduce((s,a)=>s+mt(a.duration,e.timescale),0)),(e.compactlyCodedChunkTable.length===0||ot(e.compactlyCodedChunkTable).samplesPerChunk!==r)&&e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:r}),this.fastStart==="in-memory"){e.currentChunk.offset=0;return}e.currentChunk.offset=this.writer.getPos();for(const s of e.currentChunk.samples)b(s.data),this.writer.write(s.data),s.data=null;await this.writer.flush()}async interleaveSamples(e=!1){if(b(this.isFragmented),!(!e&&!this.allTracksAreKnown()))e:for(;;){let r=null,s=1/0;for(const l of this.trackDatas){if(!e&&l.sampleQueue.length===0&&!l.track.source._closed)break e;l.sampleQueue.length>0&&l.sampleQueue[0].timestamp<s&&(r=l,s=l.sampleQueue[0].timestamp)}if(!r)break;const a=r.sampleQueue.shift();await this.addSampleToTrack(r,a)}}async finalizeFragment(e=!0){b(this.isFragmented);const r=this.nextFragmentNumber++;if(r===1){this.format._options.onMoov&&this.writer.startTrackingWrites();const T=io(this);if(this.boxWriter.writeBox(T),this.format._options.onMoov){const{data:S,start:v}=this.writer.stopTrackingWrites();this.format._options.onMoov(S,v)}}const s=this.trackDatas.filter(T=>T.currentChunk),a=Jm(r,s),l=this.writer.getPos(),c=l+this.boxWriter.measureBox(a);let u=c+gr,f=1/0;for(const T of s){T.currentChunk.offset=u,T.currentChunk.moofOffset=l;for(const S of T.currentChunk.samples)u+=S.size;f=Math.min(f,T.currentChunk.startTimestamp)}const m=u-c,g=m>=2**32;if(g)for(const T of s)T.currentChunk.offset+=Vi-gr;this.format._options.onMoof&&this.writer.startTrackingWrites();const y=Jm(r,s);if(this.boxWriter.writeBox(y),this.format._options.onMoof){const{data:T,start:S}=this.writer.stopTrackingWrites();this.format._options.onMoof(T,S,f)}b(this.writer.getPos()===c),this.format._options.onMdat&&this.writer.startTrackingWrites();const w=Nl(g);w.size=m,this.boxWriter.writeBox(w),this.writer.seek(c+(g?Vi:gr));for(const T of s)for(const S of T.currentChunk.samples)this.writer.write(S.data),S.data=null;if(this.format._options.onMdat){const{data:T,start:S}=this.writer.stopTrackingWrites();this.format._options.onMdat(T,S)}for(const T of s)T.finalizedChunks.push(T.currentChunk),this.finalizedChunks.push(T.currentChunk),T.currentChunk=null;e&&await this.writer.flush()}async registerSampleFastStartReserve(e,r){if(this.allTracksAreKnown()){if(!this.mdat){const s=io(this),l=this.boxWriter.measureBox(s)+this.computeSampleTableSizeUpperBound()+4096;b(this.ftypSize!==null),this.writer.seek(this.ftypSize+l),this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=Nl(!0),this.boxWriter.writeBox(this.mdat);for(const c of this.trackDatas){for(const u of c.sampleQueue)await this.addSampleToTrack(c,u);c.sampleQueue.length=0}}await this.addSampleToTrack(e,r)}else e.sampleQueue.push(r)}computeSampleTableSizeUpperBound(){b(this.fastStart==="reserve");let e=0;for(const r of this.trackDatas){const s=r.track.metadata.maximumPacketCount;b(s!==void 0),e+=8*Math.ceil(2/3*s),e+=4*s,e+=8*Math.ceil(2/3*s),e+=12*Math.ceil(2/3*s),e+=4*s,e+=8*s}return e}async onTrackClose(e){const r=await this.mutex.acquire();if(e.type==="subtitle"&&e.source._codec==="webvtt"){const s=this.trackDatas.find(a=>a.track===e);s&&await this.processWebVTTCues(s,1/0)}this.allTracksAreKnown()&&this.allTracksKnown.resolve(),this.isFragmented&&await this.interleaveSamples(),r()}async finalize(){const e=await this.mutex.acquire();this.allTracksKnown.resolve();for(const r of this.trackDatas)r.type==="subtitle"&&r.track.source._codec==="webvtt"&&await this.processWebVTTCues(r,1/0);if(this.isFragmented){await this.interleaveSamples(!0);for(const r of this.trackDatas)this.processTimestamps(r);await this.finalizeFragment(!1)}else for(const r of this.trackDatas)this.processTimestamps(r),await this.finalizeCurrentChunk(r);if(this.fastStart==="in-memory"){this.mdat=Nl(!1);let r;for(let a=0;a<2;a++){const l=io(this),c=this.boxWriter.measureBox(l);r=this.boxWriter.measureBox(this.mdat);let u=this.writer.getPos()+c+r;for(const f of this.finalizedChunks){f.offset=u;for(const{data:m}of f.samples)b(m),u+=m.byteLength,r+=m.byteLength}if(u<2**32)break;r>=2**32&&(this.mdat.largeSize=!0)}this.format._options.onMoov&&this.writer.startTrackingWrites();const s=io(this);if(this.boxWriter.writeBox(s),this.format._options.onMoov){const{data:a,start:l}=this.writer.stopTrackingWrites();this.format._options.onMoov(a,l)}this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat.size=r,this.boxWriter.writeBox(this.mdat);for(const a of this.finalizedChunks)for(const l of a.samples)b(l.data),this.writer.write(l.data),l.data=null;if(this.format._options.onMdat){const{data:a,start:l}=this.writer.stopTrackingWrites();this.format._options.onMdat(a,l)}}else if(this.isFragmented){const r=this.writer.getPos(),s=aS(this.trackDatas);this.boxWriter.writeBox(s);const a=this.writer.getPos()-r;this.writer.seek(this.writer.getPos()-4),this.boxWriter.writeU32(a)}else{b(this.mdat);const r=this.boxWriter.offsets.get(this.mdat);b(r!==void 0);const s=this.writer.getPos()-r;if(this.mdat.size=s,this.mdat.largeSize=s>=2**32,this.boxWriter.patchBox(this.mdat),this.format._options.onMdat){const{data:l,start:c}=this.writer.stopTrackingWrites();this.format._options.onMdat(l,c)}const a=io(this);if(this.fastStart==="reserve"){b(this.ftypSize!==null),this.writer.seek(this.ftypSize),this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(a);const l=this.boxWriter.offsets.get(this.mdat)-this.writer.getPos();this.boxWriter.writeBox(gT(l))}else this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(a);if(this.format._options.onMoov){const{data:l,start:c}=this.writer.stopTrackingWrites();this.format._options.onMoov(l,c)}}e()}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const PS=-32768,ES=2**15-1,tp="Mediabunny",np=6,rp=5,_S={video:1,audio:2,subtitle:17};class IS extends Gp{constructor(e,r){super(e),this.trackDatas=[],this.allTracksKnown=wt(),this.segment=null,this.segmentInfo=null,this.seekHead=null,this.tracksElement=null,this.tagsElement=null,this.attachmentsElement=null,this.segmentDuration=null,this.cues=null,this.currentCluster=null,this.currentClusterStartMsTimestamp=null,this.currentClusterMaxMsTimestamp=null,this.trackDatasInCurrentCluster=new Map,this.duration=0,this.writer=e._writer,this.format=r,this.ebmlWriter=new sk(this.writer),this.format._options.appendOnly&&(this.writer.ensureMonotonicity=!0)}async start(){const e=await this.mutex.acquire();this.writeEBMLHeader(),this.createSegmentInfo(),this.createCues(),await this.writer.flush(),e()}writeEBMLHeader(){this.format._options.onEbmlHeader&&this.writer.startTrackingWrites();const e={id:I.EBML,data:[{id:I.EBMLVersion,data:1},{id:I.EBMLReadVersion,data:1},{id:I.EBMLMaxIDLength,data:4},{id:I.EBMLMaxSizeLength,data:8},{id:I.DocType,data:this.format instanceof Md?"webm":"matroska"},{id:I.DocTypeVersion,data:2},{id:I.DocTypeReadVersion,data:2}]};if(this.ebmlWriter.writeEBML(e),this.format._options.onEbmlHeader){const{data:r,start:s}=this.writer.stopTrackingWrites();this.format._options.onEbmlHeader(r,s)}}maybeCreateSeekHead(e){if(this.format._options.appendOnly)return;const r=new Uint8Array([28,83,187,107]),s=new Uint8Array([21,73,169,102]),a=new Uint8Array([22,84,174,107]),l=new Uint8Array([25,65,164,105]),c=new Uint8Array([18,84,195,103]),u={id:I.SeekHead,data:[{id:I.Seek,data:[{id:I.SeekID,data:r},{id:I.SeekPosition,size:5,data:e?this.ebmlWriter.offsets.get(this.cues)-this.segmentDataOffset:0}]},{id:I.Seek,data:[{id:I.SeekID,data:s},{id:I.SeekPosition,size:5,data:e?this.ebmlWriter.offsets.get(this.segmentInfo)-this.segmentDataOffset:0}]},{id:I.Seek,data:[{id:I.SeekID,data:a},{id:I.SeekPosition,size:5,data:e?this.ebmlWriter.offsets.get(this.tracksElement)-this.segmentDataOffset:0}]},this.attachmentsElement?{id:I.Seek,data:[{id:I.SeekID,data:l},{id:I.SeekPosition,size:5,data:e?this.ebmlWriter.offsets.get(this.attachmentsElement)-this.segmentDataOffset:0}]}:null,this.tagsElement?{id:I.Seek,data:[{id:I.SeekID,data:c},{id:I.SeekPosition,size:5,data:e?this.ebmlWriter.offsets.get(this.tagsElement)-this.segmentDataOffset:0}]}:null]};this.seekHead=u}createSegmentInfo(){const e={id:I.Duration,data:new vd(0)};this.segmentDuration=e;const r={id:I.Info,data:[{id:I.TimestampScale,data:1e6},{id:I.MuxingApp,data:tp},{id:I.WritingApp,data:tp},this.format._options.appendOnly?null:e]};this.segmentInfo=r}createTracks(){const e={id:I.Tracks,data:[]};this.tracksElement=e;for(const r of this.trackDatas){const s=En[r.track.source._codec];b(s);let a=0;if(r.type==="audio"&&r.track.source._codec==="opus"){a=1e6*80;const l=r.info.decoderConfig.description;if(l){const c=It(l),u=Qd(c);a=Math.round(1e9*(u.preSkip/wo))}}e.data.push({id:I.TrackEntry,data:[{id:I.TrackNumber,data:r.track.id},{id:I.TrackUID,data:r.track.id},{id:I.TrackType,data:_S[r.type]},r.track.metadata.disposition?.default===!1?{id:I.FlagDefault,data:0}:null,r.track.metadata.disposition?.forced?{id:I.FlagForced,data:1}:null,r.track.metadata.disposition?.hearingImpaired?{id:I.FlagHearingImpaired,data:1}:null,r.track.metadata.disposition?.visuallyImpaired?{id:I.FlagVisualImpaired,data:1}:null,r.track.metadata.disposition?.original?{id:I.FlagOriginal,data:1}:null,r.track.metadata.disposition?.commentary?{id:I.FlagCommentary,data:1}:null,{id:I.FlagLacing,data:0},{id:I.Language,data:r.track.metadata.languageCode??Jt},{id:I.CodecID,data:s},{id:I.CodecDelay,data:0},{id:I.SeekPreRoll,data:a},r.track.metadata.name!==void 0?{id:I.Name,data:new Jr(r.track.metadata.name)}:null,r.type==="video"?this.videoSpecificTrackInfo(r):null,r.type==="audio"?this.audioSpecificTrackInfo(r):null,r.type==="subtitle"?this.subtitleSpecificTrackInfo(r):null]})}}videoSpecificTrackInfo(e){const{frameRate:r,rotation:s}=e.track.metadata,a=[e.info.decoderConfig.description?{id:I.CodecPrivate,data:It(e.info.decoderConfig.description)}:null,r?{id:I.DefaultDuration,data:1e9/r}:null],l=s?Gl(-s):0,c=e.info.decoderConfig.colorSpace,u={id:I.Video,data:[{id:I.PixelWidth,data:e.info.width},{id:I.PixelHeight,data:e.info.height},e.info.alphaMode?{id:I.AlphaMode,data:1}:null,Bp(c)?{id:I.Colour,data:[{id:I.MatrixCoefficients,data:ia[c.matrix]},{id:I.TransferCharacteristics,data:ra[c.transfer]},{id:I.Primaries,data:na[c.primaries]},{id:I.Range,data:c.fullRange?2:1}]}:null,l?{id:I.Projection,data:[{id:I.ProjectionType,data:0},{id:I.ProjectionPoseRoll,data:new Sd((l+180)%360-180)}]}:null]};return a.push(u),a}audioSpecificTrackInfo(e){const r=Tt.includes(e.track.source._codec)?kr(e.track.source._codec):null;return[e.info.decoderConfig.description?{id:I.CodecPrivate,data:It(e.info.decoderConfig.description)}:null,{id:I.Audio,data:[{id:I.SamplingFrequency,data:new Sd(e.info.sampleRate)},{id:I.Channels,data:e.info.numberOfChannels},r?{id:I.BitDepth,data:8*r.sampleSize}:null]}]}subtitleSpecificTrackInfo(e){return[{id:I.CodecPrivate,data:Wt.encode(e.info.config.description)}]}maybeCreateTags(){const e=[],r=(l,c)=>{e.push({id:I.SimpleTag,data:[{id:I.TagName,data:new Jr(l)},typeof c=="string"?{id:I.TagString,data:new Jr(c)}:{id:I.TagBinary,data:c}]})},s=this.output._metadataTags,a=new Set;for(const{key:l,value:c}of Vd(s))switch(l){case"title":r("TITLE",c),a.add("TITLE");break;case"description":r("DESCRIPTION",c),a.add("DESCRIPTION");break;case"artist":r("ARTIST",c),a.add("ARTIST");break;case"album":r("ALBUM",c),a.add("ALBUM");break;case"albumArtist":r("ALBUM_ARTIST",c),a.add("ALBUM_ARTIST");break;case"genre":r("GENRE",c),a.add("GENRE");break;case"comment":r("COMMENT",c),a.add("COMMENT");break;case"lyrics":r("LYRICS",c),a.add("LYRICS");break;case"date":r("DATE",c.toISOString().slice(0,10)),a.add("DATE");break;case"trackNumber":{const u=s.tracksTotal!==void 0?`${c}/${s.tracksTotal}`:c.toString();r("PART_NUMBER",u),a.add("PART_NUMBER")}break;case"discNumber":{const u=s.discsTotal!==void 0?`${c}/${s.discsTotal}`:c.toString();r("DISC",u),a.add("DISC")}break;case"tracksTotal":case"discsTotal":break;case"images":case"raw":break;default:Mn(l)}if(s.raw)for(const l in s.raw){const c=s.raw[l];c==null||a.has(l)||(typeof c=="string"||c instanceof Uint8Array)&&r(l,c)}e.length!==0&&(this.tagsElement={id:I.Tags,data:[{id:I.Tag,data:[{id:I.Targets,data:[{id:I.TargetTypeValue,data:50},{id:I.TargetType,data:"MOVIE"}]},...e]}]})}maybeCreateAttachments(){const e=this.output._metadataTags,r=[],s=new Set,a=e.images??[];for(const l of a){let c=l.name;c===void 0&&(c=(l.kind==="coverFront"?"cover":l.kind==="coverBack"?"back":"image")+(aw(l.mimeType)??""));let u;for(;;){u=0n;for(let f=0;f<8;f++)u<<=8n,u|=BigInt(Math.floor(Math.random()*256));if(u!==0n&&!s.has(u))break}s.add(u),r.push({id:I.AttachedFile,data:[l.description!==void 0?{id:I.FileDescription,data:new Jr(l.description)}:null,{id:I.FileName,data:new Jr(c)},{id:I.FileMediaType,data:l.mimeType},{id:I.FileData,data:l.data},{id:I.FileUID,data:u}]})}for(const[l,c]of Object.entries(e.raw??{}))!(c instanceof Wd)||!/^\d+$/.test(l)||a.find(f=>f.mimeType===c.mimeType&&lw(f.data,c.data))||r.push({id:I.AttachedFile,data:[c.description!==void 0?{id:I.FileDescription,data:new Jr(c.description)}:null,{id:I.FileName,data:new Jr(c.name??"")},{id:I.FileMediaType,data:c.mimeType??""},{id:I.FileData,data:c.data},{id:I.FileUID,data:BigInt(l)}]});r.length!==0&&(this.attachmentsElement={id:I.Attachments,data:r})}createSegment(){this.createTracks(),this.maybeCreateTags(),this.maybeCreateAttachments(),this.maybeCreateSeekHead(!1);const e={id:I.Segment,size:this.format._options.appendOnly?-1:np,data:[this.seekHead,this.segmentInfo,this.tracksElement,this.attachmentsElement,this.tagsElement]};if(this.segment=e,this.format._options.onSegmentHeader&&this.writer.startTrackingWrites(),this.ebmlWriter.writeEBML(e),this.format._options.onSegmentHeader){const{data:r,start:s}=this.writer.stopTrackingWrites();this.format._options.onSegmentHeader(r,s)}}createCues(){this.cues={id:I.Cues,data:[]}}get segmentDataOffset(){return b(this.segment),this.ebmlWriter.dataOffsets.get(this.segment)}allTracksAreKnown(){for(const e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some(r=>r.track===e))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;const e=this.trackDatas.map(r=>r.type==="video"||r.type==="audio"?r.info.decoderConfig.codec:{webvtt:"wvtt"}[r.track.source._codec]);return kg({isWebM:this.format instanceof Md,hasVideo:this.trackDatas.some(r=>r.type==="video"),hasAudio:this.trackDatas.some(r=>r.type==="audio"),codecStrings:e})}getVideoTrackData(e,r,s){const a=this.trackDatas.find(c=>c.track===e);if(a)return a;Qp(s),b(s),b(s.decoderConfig),b(s.decoderConfig.codedWidth!==void 0),b(s.decoderConfig.codedHeight!==void 0);const l={track:e,type:"video",info:{width:s.decoderConfig.codedWidth,height:s.decoderConfig.codedHeight,decoderConfig:s.decoderConfig,alphaMode:!!r.sideData.alpha},chunkQueue:[],lastWrittenMsTimestamp:null};return e.source._codec==="vp9"?l.info.decoderConfig={...l.info.decoderConfig,description:new Uint8Array(dw(l.info.decoderConfig.codec))}:e.source._codec==="av1"&&(l.info.decoderConfig={...l.info.decoderConfig,description:new Uint8Array(jp(l.info.decoderConfig.codec))}),this.trackDatas.push(l),this.trackDatas.sort((c,u)=>c.track.id-u.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),l}getAudioTrackData(e,r){const s=this.trackDatas.find(l=>l.track===e);if(s)return s;qp(r),b(r),b(r.decoderConfig);const a={track:e,type:"audio",info:{numberOfChannels:r.decoderConfig.numberOfChannels,sampleRate:r.decoderConfig.sampleRate,decoderConfig:r.decoderConfig},chunkQueue:[],lastWrittenMsTimestamp:null};return this.trackDatas.push(a),this.trackDatas.sort((l,c)=>l.track.id-c.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),a}getSubtitleTrackData(e,r){const s=this.trackDatas.find(l=>l.track===e);if(s)return s;Kp(r),b(r),b(r.config);const a={track:e,type:"subtitle",info:{config:r.config},chunkQueue:[],lastWrittenMsTimestamp:null};return this.trackDatas.push(a),this.trackDatas.sort((l,c)=>l.track.id-c.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),a}async addEncodedVideoPacket(e,r,s){const a=await this.mutex.acquire();try{const l=this.getVideoTrackData(e,r,s),c=r.type==="key";let u=this.validateAndNormalizeTimestamp(l.track,r.timestamp,c),f=r.duration;e.metadata.frameRate!==void 0&&(u=hd(u,1/e.metadata.frameRate),f=hd(f,1/e.metadata.frameRate));const m=l.info.alphaMode?r.sideData.alpha??null:null,g=this.createInternalChunk(r.data,u,f,r.type,m);e.source._codec==="vp9"&&this.fixVP9ColorSpace(l,g),l.chunkQueue.push(g),await this.interleaveChunks()}finally{a()}}async addEncodedAudioPacket(e,r,s){const a=await this.mutex.acquire();try{const l=this.getAudioTrackData(e,s),c=r.type==="key",u=this.validateAndNormalizeTimestamp(l.track,r.timestamp,c),f=this.createInternalChunk(r.data,u,r.duration,r.type);l.chunkQueue.push(f),await this.interleaveChunks()}finally{a()}}async addSubtitleCue(e,r,s){const a=await this.mutex.acquire();try{const l=this.getSubtitleTrackData(e,s),c=this.validateAndNormalizeTimestamp(l.track,r.timestamp,!0);let u=r.text;const f=Math.round(c*1e3);Ql.lastIndex=0,u=u.replace(Ql,w=>{const S=mT(w.slice(1,-1))-f;return`<${Mg(S)}>`});const m=Wt.encode(u),g=`${r.settings??""}
${r.identifier??""}
${r.notes??""}`,y=this.createInternalChunk(m,c,r.duration,"key",g.trim()?Wt.encode(g):null);l.chunkQueue.push(y),await this.interleaveChunks()}finally{a()}}async interleaveChunks(e=!1){if(!(!e&&!this.allTracksAreKnown())){e:for(;;){let r=null,s=1/0;for(const l of this.trackDatas){if(!e&&l.chunkQueue.length===0&&!l.track.source._closed)break e;l.chunkQueue.length>0&&l.chunkQueue[0].timestamp<s&&(r=l,s=l.chunkQueue[0].timestamp)}if(!r)break;const a=r.chunkQueue.shift();this.writeBlock(r,a)}e||await this.writer.flush()}}fixVP9ColorSpace(e,r){if(r.type!=="key"||!e.info.decoderConfig.colorSpace||!e.info.decoderConfig.colorSpace.matrix)return;const s=new Ye(r.data);s.skipBits(2);const a=s.readBits(1),c=(s.readBits(1)<<1)+a;if(c===3&&s.skipBits(1),s.readBits(1)||s.readBits(1)!==0||(s.skipBits(2),s.readBits(24)!==4817730))return;c>=2&&s.skipBits(1);const g={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[e.info.decoderConfig.colorSpace.matrix];Yy(r.data,s.pos,s.pos+3,g)}createInternalChunk(e,r,s,a,l=null){return{data:e,type:a,timestamp:r,duration:s,additions:l}}writeBlock(e,r){this.segment||this.createSegment();const s=Math.round(1e3*r.timestamp),a=this.trackDatas.every(g=>{if(e===g)return r.type==="key";const y=g.chunkQueue[0];return y?y.type==="key":g.track.source._closed});let l=!1;if(!this.currentCluster)l=!0;else{b(this.currentClusterStartMsTimestamp!==null),b(this.currentClusterMaxMsTimestamp!==null);const g=s-this.currentClusterStartMsTimestamp;l=a&&s>this.currentClusterMaxMsTimestamp&&g>=1e3*(this.format._options.minimumClusterDuration??1)||g>ES}l&&this.createNewCluster(s);const c=s-this.currentClusterStartMsTimestamp;if(c<PS)return;const u=new Uint8Array(4),f=new DataView(u.buffer);f.setUint8(0,128|e.track.id),f.setInt16(1,c,!1);const m=Math.round(1e3*r.duration);if(r.additions){const g={id:I.BlockGroup,data:[{id:I.Block,data:[u,r.data]},r.type==="delta"?{id:I.ReferenceBlock,data:new pg(e.lastWrittenMsTimestamp-s)}:null,r.additions?{id:I.BlockAdditions,data:[{id:I.BlockMore,data:[{id:I.BlockAddID,data:1},{id:I.BlockAdditional,data:r.additions}]}]}:null,m>0?{id:I.BlockDuration,data:m}:null]};this.ebmlWriter.writeEBML(g)}else{f.setUint8(3,+(r.type==="key")<<7);const g={id:I.SimpleBlock,data:[u,r.data]};this.ebmlWriter.writeEBML(g)}this.duration=Math.max(this.duration,s+m),e.lastWrittenMsTimestamp=s,this.trackDatasInCurrentCluster.has(e)||this.trackDatasInCurrentCluster.set(e,{firstMsTimestamp:s}),this.currentClusterMaxMsTimestamp=Math.max(this.currentClusterMaxMsTimestamp,s)}createNewCluster(e){this.currentCluster&&this.finalizeCurrentCluster(),this.format._options.onCluster&&this.writer.startTrackingWrites(),this.currentCluster={id:I.Cluster,size:this.format._options.appendOnly?-1:rp,data:[{id:I.Timestamp,data:e}]},this.ebmlWriter.writeEBML(this.currentCluster),this.currentClusterStartMsTimestamp=e,this.currentClusterMaxMsTimestamp=e,this.trackDatasInCurrentCluster.clear()}finalizeCurrentCluster(){if(b(this.currentCluster),!this.format._options.appendOnly){const a=this.writer.getPos()-this.ebmlWriter.dataOffsets.get(this.currentCluster),l=this.writer.getPos();this.writer.seek(this.ebmlWriter.offsets.get(this.currentCluster)+4),this.ebmlWriter.writeVarInt(a,rp),this.writer.seek(l)}if(this.format._options.onCluster){b(this.currentClusterStartMsTimestamp!==null);const{data:a,start:l}=this.writer.stopTrackingWrites();this.format._options.onCluster(a,l,this.currentClusterStartMsTimestamp/1e3)}const e=this.ebmlWriter.offsets.get(this.currentCluster)-this.segmentDataOffset,r=new Map;for(const[a,{firstMsTimestamp:l}]of this.trackDatasInCurrentCluster)r.has(l)||r.set(l,[]),r.get(l).push(a);const s=[...r.entries()].sort((a,l)=>a[0]-l[0]);for(const[a,l]of s)b(this.cues),this.cues.data.push({id:I.CuePoint,data:[{id:I.CueTime,data:a},...l.map(c=>({id:I.CueTrackPositions,data:[{id:I.CueTrack,data:c.track.id},{id:I.CueClusterPosition,data:e}]}))]})}async onTrackClose(){const e=await this.mutex.acquire();this.allTracksAreKnown()&&this.allTracksKnown.resolve(),await this.interleaveChunks(),e()}async finalize(){const e=await this.mutex.acquire();if(this.allTracksKnown.resolve(),this.segment||this.createSegment(),await this.interleaveChunks(!0),this.currentCluster&&this.finalizeCurrentCluster(),b(this.cues),this.ebmlWriter.writeEBML(this.cues),!this.format._options.appendOnly){const r=this.writer.getPos(),s=this.writer.getPos()-this.segmentDataOffset;this.writer.seek(this.ebmlWriter.offsets.get(this.segment)+4),this.ebmlWriter.writeVarInt(s,np),this.segmentDuration.data=new vd(this.duration),this.writer.seek(this.ebmlWriter.offsets.get(this.segmentDuration)),this.ebmlWriter.writeEBML(this.segmentDuration),b(this.seekHead),this.writer.seek(this.ebmlWriter.offsets.get(this.seekHead)),this.maybeCreateSeekHead(!0),this.ebmlWriter.writeEBML(this.seekHead),this.writer.seek(r)}e()}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class tf{getSupportedVideoCodecs(){return this.getSupportedCodecs().filter(e=>pn.includes(e))}getSupportedAudioCodecs(){return this.getSupportedCodecs().filter(e=>Fn.includes(e))}getSupportedSubtitleCodecs(){return this.getSupportedCodecs().filter(e=>ea.includes(e))}_codecUnsupportedHint(e){return""}}class $g extends tf{constructor(e={}){if(!e||typeof e!="object")throw new TypeError("options must be an object.");if(e.fastStart!==void 0&&![!1,"in-memory","reserve","fragmented"].includes(e.fastStart))throw new TypeError("options.fastStart, when provided, must be false, 'in-memory', 'reserve', or 'fragmented'.");if(e.minimumFragmentDuration!==void 0&&(!Number.isFinite(e.minimumFragmentDuration)||e.minimumFragmentDuration<0))throw new TypeError("options.minimumFragmentDuration, when provided, must be a non-negative number.");if(e.onFtyp!==void 0&&typeof e.onFtyp!="function")throw new TypeError("options.onFtyp, when provided, must be a function.");if(e.onMoov!==void 0&&typeof e.onMoov!="function")throw new TypeError("options.onMoov, when provided, must be a function.");if(e.onMdat!==void 0&&typeof e.onMdat!="function")throw new TypeError("options.onMdat, when provided, must be a function.");if(e.onMoof!==void 0&&typeof e.onMoof!="function")throw new TypeError("options.onMoof, when provided, must be a function.");if(e.metadataFormat!==void 0&&!["mdir","mdta","udta","auto"].includes(e.metadataFormat))throw new TypeError("options.metadataFormat, when provided, must be either 'auto', 'mdir', 'mdta', or 'udta'.");super(),this._options=e}getSupportedTrackCounts(){return{video:{min:0,max:1/0},audio:{min:0,max:1/0},subtitle:{min:0,max:1/0},total:{min:1,max:2**32-1}}}get supportsVideoRotationMetadata(){return!0}_createMuxer(e){return new CS(e,this)}}class Qg extends $g{constructor(e){super(e)}get _name(){return"MP4"}get fileExtension(){return".mp4"}get mimeType(){return"video/mp4"}getSupportedCodecs(){return[...pn,...qs,"pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be",...ea]}_codecUnsupportedHint(e){return new qg().getSupportedCodecs().includes(e)?" Switching to MOV will grant support for this codec.":""}}class qg extends $g{constructor(e){super(e)}get _name(){return"MOV"}get fileExtension(){return".mov"}get mimeType(){return"video/quicktime"}getSupportedCodecs(){return[...pn,...Fn]}_codecUnsupportedHint(e){return new Qg().getSupportedCodecs().includes(e)?" Switching to MP4 will grant support for this codec.":""}}class ip extends tf{constructor(e={}){if(!e||typeof e!="object")throw new TypeError("options must be an object.");if(e.appendOnly!==void 0&&typeof e.appendOnly!="boolean")throw new TypeError("options.appendOnly, when provided, must be a boolean.");if(e.minimumClusterDuration!==void 0&&(!Number.isFinite(e.minimumClusterDuration)||e.minimumClusterDuration<0))throw new TypeError("options.minimumClusterDuration, when provided, must be a non-negative number.");if(e.onEbmlHeader!==void 0&&typeof e.onEbmlHeader!="function")throw new TypeError("options.onEbmlHeader, when provided, must be a function.");if(e.onSegmentHeader!==void 0&&typeof e.onSegmentHeader!="function")throw new TypeError("options.onHeader, when provided, must be a function.");if(e.onCluster!==void 0&&typeof e.onCluster!="function")throw new TypeError("options.onCluster, when provided, must be a function.");super(),this._options=e}_createMuxer(e){return new IS(e,this)}get _name(){return"Matroska"}getSupportedTrackCounts(){return{video:{min:0,max:1/0},audio:{min:0,max:1/0},subtitle:{min:0,max:1/0},total:{min:1,max:127}}}get fileExtension(){return".mkv"}get mimeType(){return"video/x-matroska"}getSupportedCodecs(){return[...pn,...qs,...Tt.filter(e=>!["pcm-s8","pcm-f32be","pcm-f64be","ulaw","alaw"].includes(e)),...ea]}get supportsVideoRotationMetadata(){return!1}}class Md extends ip{constructor(e){super(e)}getSupportedCodecs(){return[...pn.filter(e=>["vp8","vp9","av1"].includes(e)),...Fn.filter(e=>["opus","vorbis"].includes(e)),...ea]}get _name(){return"WebM"}get fileExtension(){return".webm"}get mimeType(){return"video/webm"}_codecUnsupportedHint(e){return new ip().getSupportedCodecs().includes(e)?" Switching to MKV will grant support for this codec.":""}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const AS=n=>{if(!n||typeof n!="object")throw new TypeError("Encoding config must be an object.");if(!pn.includes(n.codec))throw new TypeError(`Invalid video codec '${n.codec}'. Must be one of: ${pn.join(", ")}.`);if(!(n.bitrate instanceof Nn)&&(!Number.isInteger(n.bitrate)||n.bitrate<=0))throw new TypeError("config.bitrate must be a positive integer or a quality.");if(n.keyFrameInterval!==void 0&&(!Number.isFinite(n.keyFrameInterval)||n.keyFrameInterval<0))throw new TypeError("config.keyFrameInterval, when provided, must be a non-negative number.");if(n.sizeChangeBehavior!==void 0&&!["deny","passThrough","fill","contain","cover"].includes(n.sizeChangeBehavior))throw new TypeError("config.sizeChangeBehavior, when provided, must be 'deny', 'passThrough', 'fill', 'contain' or 'cover'.");if(n.onEncodedPacket!==void 0&&typeof n.onEncodedPacket!="function")throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(n.onEncoderConfig!==void 0&&typeof n.onEncoderConfig!="function")throw new TypeError("config.onEncoderConfig, when provided, must be a function.");Kg(n.codec,n)},Kg=(n,e)=>{if(!e||typeof e!="object")throw new TypeError("Encoding options must be an object.");if(e.alpha!==void 0&&!["discard","keep"].includes(e.alpha))throw new TypeError("options.alpha, when provided, must be 'discard' or 'keep'.");if(e.bitrateMode!==void 0&&!["constant","variable"].includes(e.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(e.latencyMode!==void 0&&!["quality","realtime"].includes(e.latencyMode))throw new TypeError("latencyMode, when provided, must be 'quality' or 'realtime'.");if(e.fullCodecString!==void 0&&typeof e.fullCodecString!="string")throw new TypeError("fullCodecString, when provided, must be a string.");if(e.fullCodecString!==void 0&&$p(e.fullCodecString)!==n)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${n}).`);if(e.hardwareAcceleration!==void 0&&!["no-preference","prefer-hardware","prefer-software"].includes(e.hardwareAcceleration))throw new TypeError("hardwareAcceleration, when provided, must be 'no-preference', 'prefer-hardware' or 'prefer-software'.");if(e.scalabilityMode!==void 0&&typeof e.scalabilityMode!="string")throw new TypeError("scalabilityMode, when provided, must be a string.");if(e.contentHint!==void 0&&typeof e.contentHint!="string")throw new TypeError("contentHint, when provided, must be a string.")},Fd=n=>{const e=n.bitrate instanceof Nn?n.bitrate._toVideoBitrate(n.codec,n.width,n.height):n.bitrate;return{codec:n.fullCodecString??uw(n.codec,n.width,n.height,e),width:n.width,height:n.height,bitrate:e,bitrateMode:n.bitrateMode,alpha:n.alpha??"discard",framerate:n.framerate,latencyMode:n.latencyMode,hardwareAcceleration:n.hardwareAcceleration,scalabilityMode:n.scalabilityMode,contentHint:n.contentHint,...mw(n.codec)}},MS=n=>{if(!n||typeof n!="object")throw new TypeError("Encoding config must be an object.");if(!Fn.includes(n.codec))throw new TypeError(`Invalid audio codec '${n.codec}'. Must be one of: ${Fn.join(", ")}.`);if(n.bitrate===void 0&&(!Tt.includes(n.codec)||n.codec==="flac"))throw new TypeError("config.bitrate must be provided for compressed audio codecs.");if(n.bitrate!==void 0&&!(n.bitrate instanceof Nn)&&(!Number.isInteger(n.bitrate)||n.bitrate<=0))throw new TypeError("config.bitrate, when provided, must be a positive integer or a quality.");if(n.onEncodedPacket!==void 0&&typeof n.onEncodedPacket!="function")throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(n.onEncoderConfig!==void 0&&typeof n.onEncoderConfig!="function")throw new TypeError("config.onEncoderConfig, when provided, must be a function.");Gg(n.codec,n)},Gg=(n,e)=>{if(!e||typeof e!="object")throw new TypeError("Encoding options must be an object.");if(e.bitrateMode!==void 0&&!["constant","variable"].includes(e.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(e.fullCodecString!==void 0&&typeof e.fullCodecString!="string")throw new TypeError("fullCodecString, when provided, must be a string.");if(e.fullCodecString!==void 0&&$p(e.fullCodecString)!==n)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${n}).`)},Nd=n=>{const e=n.bitrate instanceof Nn?n.bitrate._toAudioBitrate(n.codec):n.bitrate;return{codec:n.fullCodecString??fw(n.codec,n.numberOfChannels,n.sampleRate),numberOfChannels:n.numberOfChannels,sampleRate:n.sampleRate,bitrate:e,bitrateMode:n.bitrateMode,...pw(n.codec)}};class Nn{constructor(e){this._factor=e}_toVideoBitrate(e,r,s){const a=r*s,l={avc:1,hevc:.6,vp9:.6,av1:.4,vp8:1.2},c=1920*1080,u=3e6,f=Math.pow(a/c,.95),y=u*f*l[e]*this._factor;return Math.ceil(y/1e3)*1e3}_toAudioBitrate(e){if(Tt.includes(e)||e==="flac")return;const s={aac:128e3,opus:64e3,mp3:16e4,vorbis:64e3}[e];if(!s)throw new Error(`Unhandled codec: ${e}`);let a=s*this._factor;return e==="aac"?a=[96e3,128e3,16e4,192e3].reduce((c,u)=>Math.abs(u-a)<Math.abs(c-a)?u:c):e==="opus"||e==="vorbis"?a=Math.max(6e3,a):e==="mp3"&&(a=[8e3,16e3,24e3,32e3,4e4,48e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4].reduce((c,u)=>Math.abs(u-a)<Math.abs(c-a)?u:c)),Math.round(a/1e3)*1e3}}const FS=new Nn(.6),NS=new Nn(1),Rd=new Nn(2),RS=async(n,e={})=>{const{width:r=1280,height:s=720,bitrate:a=1e6,...l}=e;if(!pn.includes(n))return!1;if(!Number.isInteger(r)||r<=0)throw new TypeError("width must be a positive integer.");if(!Number.isInteger(s)||s<=0)throw new TypeError("height must be a positive integer.");if(!(a instanceof Nn)&&(!Number.isInteger(a)||a<=0))throw new TypeError("bitrate must be a positive integer or a quality.");Kg(n,l);let c=null;return yd.length>0&&(c??=Fd({codec:n,width:r,height:s,bitrate:a,framerate:void 0,...l}),yd.some(m=>m.supports(n,c)))?!0:typeof VideoEncoder>"u"||(r%2===1||s%2===1)&&(n==="avc"||n==="hevc")||(c??=Fd({codec:n,width:r,height:s,bitrate:a,framerate:void 0,...l,alpha:"discard"}),!(await VideoEncoder.isConfigSupported(c)).supported)?!1:Js()?new Promise(async m=>{try{const g=new VideoEncoder({output:()=>{},error:()=>m(!1)});g.configure(c);const y=new Uint8Array(r*s*4),w=new VideoFrame(y,{format:"RGBA",codedWidth:r,codedHeight:s,timestamp:0});g.encode(w),w.close(),await g.flush(),m(!0)}catch{m(!1)}}):!0},Xg=async(n,e={})=>{const{numberOfChannels:r=2,sampleRate:s=48e3,bitrate:a=128e3,...l}=e;if(!Fn.includes(n))return!1;if(!Number.isInteger(r)||r<=0)throw new TypeError("numberOfChannels must be a positive integer.");if(!Number.isInteger(s)||s<=0)throw new TypeError("sampleRate must be a positive integer.");if(!(a instanceof Nn)&&(!Number.isInteger(a)||a<=0))throw new TypeError("bitrate must be a positive integer.");Gg(n,l);let c=null;return wd.length>0&&(c??=Nd({codec:n,numberOfChannels:r,sampleRate:s,bitrate:a,...l}),wd.some(f=>f.supports(n,c)))||Tt.includes(n)?!0:typeof AudioEncoder>"u"?!1:(c??=Nd({codec:n,numberOfChannels:r,sampleRate:s,bitrate:a,...l}),(await AudioEncoder.isConfigSupported(c)).supported===!0)},sp=async(n=Fn,e)=>{const r=await Promise.all(n.map(s=>Xg(s,e)));return n.filter((s,a)=>r[a])},Yg=async(n,e)=>{for(const r of n)if(await RS(r,e))return r;return null},zS=async(n,e)=>{for(const r of n)if(await Xg(r,e))return r;return null};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class nf{constructor(){this._connectedTrack=null,this._closingPromise=null,this._closed=!1,this._timestampOffset=0}_ensureValidAdd(){if(!this._connectedTrack)throw new Error("Source is not connected to an output track.");if(this._connectedTrack.output.state==="canceled")throw new Error("Output has been canceled.");if(this._connectedTrack.output.state==="finalizing"||this._connectedTrack.output.state==="finalized")throw new Error("Output has been finalized.");if(this._connectedTrack.output.state==="pending")throw new Error("Output has not started.");if(this._closed)throw new Error("Source is closed.")}async _start(){}async _flushAndClose(e){}close(){if(this._closingPromise)return;const e=this._connectedTrack;if(!e)throw new Error("Cannot call close without connecting the source to an output track.");if(e.output.state==="pending")throw new Error("Cannot call close before output has been started.");this._closingPromise=(async()=>{await this._flushAndClose(!1),this._closed=!0,!(e.output.state==="finalizing"||e.output.state==="finalized")&&e.output._muxer.onTrackClose(e)})()}async _flushOrWaitForOngoingClose(e){return this._closingPromise?this._closingPromise:this._flushAndClose(e)}}class rf extends nf{constructor(e){if(super(),this._connectedTrack=null,!pn.includes(e))throw new TypeError(`Invalid video codec '${e}'. Must be one of: ${pn.join(", ")}.`);this._codec=e}}class BS extends rf{constructor(e){super(e)}add(e,r){if(!(e instanceof qe))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(r!==void 0&&(!r||typeof r!="object"))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedVideoPacket(this._connectedTrack,e,r)}}class DS{constructor(e,r){this.source=e,this.encodingConfig=r,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastMultipleOfKeyFrameInterval=-1,this.codedWidth=null,this.codedHeight=null,this.resizeCanvas=null,this.customEncoder=null,this.customEncoderCallSerializer=new Jl,this.customEncoderQueueSize=0,this.alphaEncoder=null,this.splitter=null,this.splitterCreationFailed=!1,this.alphaFrameQueue=[],this.error=null,this.errorNeedsNewStack=!0}async add(e,r,s){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),this.codedWidth!==null&&this.codedHeight!==null){if(e.codedWidth!==this.codedWidth||e.codedHeight!==this.codedHeight){const u=this.encodingConfig.sizeChangeBehavior??"deny";if(u!=="passThrough"){if(u==="deny")throw new Error(`Video sample size must remain constant. Expected ${this.codedWidth}x${this.codedHeight}, got ${e.codedWidth}x${e.codedHeight}. To allow the sample size to change over time, set \`sizeChangeBehavior\` to a value other than 'strict' in the encoding options.`);{let f=!1;this.resizeCanvas||(typeof document<"u"?(this.resizeCanvas=document.createElement("canvas"),this.resizeCanvas.width=this.codedWidth,this.resizeCanvas.height=this.codedHeight):this.resizeCanvas=new OffscreenCanvas(this.codedWidth,this.codedHeight),f=!0);const m=this.resizeCanvas.getContext("2d",{alpha:Js()});b(m),f||(Js()?(m.fillStyle="black",m.fillRect(0,0,this.codedWidth,this.codedHeight)):m.clearRect(0,0,this.codedWidth,this.codedHeight)),e.drawWithFit(m,{fit:u}),r&&e.close(),e=new _t(this.resizeCanvas,{timestamp:e.timestamp,duration:e.duration,rotation:e.rotation}),r=!0}}}}else this.codedWidth=e.codedWidth,this.codedHeight=e.codedHeight;this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),b(this.encoderInitialized);const a=this.encodingConfig.keyFrameInterval??5,l=Math.floor(e.timestamp/a),c={...s,keyFrame:s?.keyFrame||a===0||l!==this.lastMultipleOfKeyFrameInterval};if(this.lastMultipleOfKeyFrameInterval=l,this.customEncoder){this.customEncoderQueueSize++;const u=e.clone(),f=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(u,c)).then(()=>this.customEncoderQueueSize--).catch(m=>this.error??=m).finally(()=>{u.close()});this.customEncoderQueueSize>=4&&await f}else{b(this.encoder);const u=e.toVideoFrame();if(!this.alphaEncoder)this.encoder.encode(u,c),u.close();else if(!!u.format&&!u.format.includes("A")||this.splitterCreationFailed)this.alphaFrameQueue.push(null),this.encoder.encode(u,c),u.close();else{const m=u.displayWidth,g=u.displayHeight;if(!this.splitter)try{this.splitter=new OS(m,g)}catch(y){console.error("Due to an error, only color data will be encoded.",y),this.splitterCreationFailed=!0,this.alphaFrameQueue.push(null),this.encoder.encode(u,c),u.close()}if(this.splitter){const y=this.splitter.extractColor(u),w=this.splitter.extractAlpha(u);this.alphaFrameQueue.push(w),this.encoder.encode(y,c),y.close(),u.close()}}r&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(f=>this.encoder.addEventListener("dequeue",f,{once:!0}))}await this.muxer.mutex.currentPromise}finally{r&&e.close()}}ensureEncoder(e){const r=new Error;this.ensureEncoderPromise=(async()=>{const s=Fd({width:e.codedWidth,height:e.codedHeight,...this.encodingConfig,framerate:this.source._connectedTrack?.metadata.frameRate});this.encodingConfig.onEncoderConfig?.(s);const a=yd.find(l=>l.supports(this.encodingConfig.codec,s));if(a)this.customEncoder=new a,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=s,this.customEncoder.onPacket=(l,c)=>{if(!(l instanceof qe))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(c!==void 0&&(!c||typeof c!="object"))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(l,c),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,l,c).catch(u=>{this.error??=u,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else{if(typeof VideoEncoder>"u")throw new Error("VideoEncoder is not supported by this browser.");if(s.alpha="discard",this.encodingConfig.alpha==="keep"&&(s.latencyMode="quality"),(s.width%2===1||s.height%2===1)&&(this.encodingConfig.codec==="avc"||this.encodingConfig.codec==="hevc"))throw new Error(`The dimensions ${s.width}x${s.height} are not supported for codec '${this.encodingConfig.codec}'; both width and height must be even numbers. Make sure to round your dimensions to the nearest even number.`);if(!(await VideoEncoder.isConfigSupported(s)).supported)throw new Error(`This specific encoder configuration (${s.codec}, ${s.bitrate} bps, ${s.width}x${s.height}, hardware acceleration: ${s.hardwareAcceleration??"no-preference"}) is not supported by this browser. Consider using another codec or changing your video parameters.`);const u=[],f=[];let m=0,g=0;const y=(w,T,S)=>{const v={};if(T){const _=new Uint8Array(T.byteLength);T.copyTo(_),v.alpha=_}const x=qe.fromEncodedChunk(w,v);this.encodingConfig.onEncodedPacket?.(x,S),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,x,S).catch(_=>{this.error??=_,this.errorNeedsNewStack=!1})};this.encoder=new VideoEncoder({output:(w,T)=>{if(!this.alphaEncoder){y(w,null,T);return}const S=this.alphaFrameQueue.shift();b(S!==void 0),S?(this.alphaEncoder.encode(S,{keyFrame:w.type==="key"}),g++,S.close(),u.push({chunk:w,meta:T})):g===0?y(w,null,T):(f.push(m+g),u.push({chunk:w,meta:T}))},error:w=>{w.stack=r.stack,this.error??=w}}),this.encoder.configure(s),this.encodingConfig.alpha==="keep"&&(this.alphaEncoder=new VideoEncoder({output:(w,T)=>{g--;const S=u.shift();for(b(S!==void 0),y(S.chunk,w,S.meta),m++;f.length>0&&f[0]===m;){f.shift();const v=u.shift();b(v!==void 0),y(v.chunk,null,v.meta)}},error:w=>{w.stack=r.stack,this.error??=w}}),this.alphaEncoder.configure(s))}b(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||(await this.encoder.flush(),await this.alphaEncoder?.flush()),this.encoder.state!=="closed"&&this.encoder.close(),this.alphaEncoder&&this.alphaEncoder.state!=="closed"&&this.alphaEncoder.close(),this.alphaFrameQueue.forEach(r=>r?.close()),this.splitter?.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=new Error().stack),this.error}}class OS{constructor(e,r){this.lastFrame=null,typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(e,r):(this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=r);const s=this.canvas.getContext("webgl2",{alpha:!0});if(!s)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=s,this.colorProgram=this.createColorProgram(),this.alphaProgram=this.createAlphaProgram(),this.vao=this.createVAO(),this.sourceTexture=this.createTexture(),this.alphaResolutionLocation=this.gl.getUniformLocation(this.alphaProgram,"u_resolution"),this.gl.useProgram(this.colorProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.colorProgram,"u_sourceTexture"),0),this.gl.useProgram(this.alphaProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.alphaProgram,"u_sourceTexture"),0)}createVertexShader(){return this.createShader(this.gl.VERTEX_SHADER,`#version 300 es
			in vec2 a_position;
			in vec2 a_texCoord;
			out vec2 v_texCoord;
			
			void main() {
				gl_Position = vec4(a_position, 0.0, 1.0);
				v_texCoord = a_texCoord;
			}
		`)}createColorProgram(){const e=this.createVertexShader(),r=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_sourceTexture;
			in vec2 v_texCoord;
			out vec4 fragColor;
			
			void main() {
				vec4 source = texture(u_sourceTexture, v_texCoord);
				fragColor = vec4(source.rgb, 1.0);
			}
		`),s=this.gl.createProgram();return this.gl.attachShader(s,e),this.gl.attachShader(s,r),this.gl.linkProgram(s),s}createAlphaProgram(){const e=this.createVertexShader(),r=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_sourceTexture;
			uniform vec2 u_resolution; // The width and height of the canvas
			in vec2 v_texCoord;
			out vec4 fragColor;

			// This function determines the value for a single byte in the YUV stream
			float getByteValue(float byteOffset) {
				float width = u_resolution.x;
				float height = u_resolution.y;

				float yPlaneSize = width * height;

				if (byteOffset < yPlaneSize) {
					// This byte is in the luma plane. Find the corresponding pixel coordinates to sample from
					float y = floor(byteOffset / width);
					float x = mod(byteOffset, width);
					
					// Add 0.5 to sample the center of the texel
					vec2 sampleCoord = (vec2(x, y) + 0.5) / u_resolution;
					
					// The luma value is the alpha from the source texture
					return texture(u_sourceTexture, sampleCoord).a;
				} else {
					// Write a fixed value for chroma and beyond
					return 128.0 / 255.0;
				}
			}
			
			void main() {
				// Each fragment writes 4 bytes (R, G, B, A)
				float pixelIndex = floor(gl_FragCoord.y) * u_resolution.x + floor(gl_FragCoord.x);
				float baseByteOffset = pixelIndex * 4.0;

				vec4 result;
				for (int i = 0; i < 4; i++) {
					float currentByteOffset = baseByteOffset + float(i);
					result[i] = getByteValue(currentByteOffset);
				}
				
				fragColor = result;
			}
		`),s=this.gl.createProgram();return this.gl.attachShader(s,e),this.gl.attachShader(s,r),this.gl.linkProgram(s),s}createShader(e,r){const s=this.gl.createShader(e);return this.gl.shaderSource(s,r),this.gl.compileShader(s),this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)||console.error("Shader compile error:",this.gl.getShaderInfoLog(s)),s}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const r=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),s=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.STATIC_DRAW);const a=this.gl.getAttribLocation(this.colorProgram,"a_position"),l=this.gl.getAttribLocation(this.colorProgram,"a_texCoord");return this.gl.enableVertexAttribArray(a),this.gl.vertexAttribPointer(a,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(l),this.gl.vertexAttribPointer(l,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}updateTexture(e){this.lastFrame!==e&&((e.displayWidth!==this.canvas.width||e.displayHeight!==this.canvas.height)&&(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.sourceTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.lastFrame=e)}extractColor(e){return this.updateTexture(e),this.gl.useProgram(this.colorProgram),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),new VideoFrame(this.canvas,{timestamp:e.timestamp,duration:e.duration??void 0,alpha:"discard"})}extractAlpha(e){this.updateTexture(e),this.gl.useProgram(this.alphaProgram),this.gl.uniform2f(this.alphaResolutionLocation,this.canvas.width,this.canvas.height),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);const{width:r,height:s}=this.canvas,a=Math.ceil(r/2)*Math.ceil(s/2),l=r*s+a*2,c=Math.ceil(l/(r*4));let u=new Uint8Array(4*r*c);this.gl.readPixels(0,0,r,c,this.gl.RGBA,this.gl.UNSIGNED_BYTE,u),u=u.subarray(0,l),b(u[r*s]===128),b(u[u.length-1]===128);const f={format:"I420",codedWidth:r,codedHeight:s,timestamp:e.timestamp,duration:e.duration??void 0,transfer:[u.buffer]};return new VideoFrame(u,f)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class ap extends rf{constructor(e){AS(e),super(e.codec),this._encoder=new DS(this,e)}add(e,r){if(!(e instanceof _t))throw new TypeError("videoSample must be a VideoSample.");return this._encoder.add(e,!1,r)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class sf extends nf{constructor(e){if(super(),this._connectedTrack=null,!Fn.includes(e))throw new TypeError(`Invalid audio codec '${e}'. Must be one of: ${Fn.join(", ")}.`);this._codec=e}}class US extends sf{constructor(e){super(e)}add(e,r){if(!(e instanceof qe))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(r!==void 0&&(!r||typeof r!="object"))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedAudioPacket(this._connectedTrack,e,r)}}class LS{constructor(e,r){this.source=e,this.encodingConfig=r,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastNumberOfChannels=null,this.lastSampleRate=null,this.isPcmEncoder=!1,this.outputSampleSize=null,this.writeOutputValue=null,this.customEncoder=null,this.customEncoderCallSerializer=new Jl,this.customEncoderQueueSize=0,this.lastEndSampleIndex=null,this.error=null,this.errorNeedsNewStack=!0}async add(e,r){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),this.lastNumberOfChannels!==null&&this.lastSampleRate!==null){if(e.numberOfChannels!==this.lastNumberOfChannels||e.sampleRate!==this.lastSampleRate)throw new Error(`Audio parameters must remain constant. Expected ${this.lastNumberOfChannels} channels at ${this.lastSampleRate} Hz, got ${e.numberOfChannels} channels at ${e.sampleRate} Hz.`)}else this.lastNumberOfChannels=e.numberOfChannels,this.lastSampleRate=e.sampleRate;this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),b(this.encoderInitialized);{const s=Math.round(e.timestamp*e.sampleRate),a=Math.round((e.timestamp+e.duration)*e.sampleRate);if(this.lastEndSampleIndex===null)this.lastEndSampleIndex=a;else{const l=s-this.lastEndSampleIndex;if(l>=64){const c=new hn({data:new Float32Array(l*e.numberOfChannels),format:"f32-planar",sampleRate:e.sampleRate,numberOfChannels:e.numberOfChannels,numberOfFrames:l,timestamp:this.lastEndSampleIndex/e.sampleRate});await this.add(c,!0)}this.lastEndSampleIndex+=e.numberOfFrames}}if(this.customEncoder){this.customEncoderQueueSize++;const s=e.clone(),a=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(s)).then(()=>this.customEncoderQueueSize--).catch(l=>this.error??=l).finally(()=>{s.close()});this.customEncoderQueueSize>=4&&await a,await this.muxer.mutex.currentPromise}else if(this.isPcmEncoder)await this.doPcmEncoding(e,r);else{b(this.encoder);const s=e.toAudioData();this.encoder.encode(s),s.close(),r&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(a=>this.encoder.addEventListener("dequeue",a,{once:!0})),await this.muxer.mutex.currentPromise}}finally{r&&e.close()}}async doPcmEncoding(e,r){b(this.outputSampleSize),b(this.writeOutputValue);const{numberOfChannels:s,numberOfFrames:a,sampleRate:l,timestamp:c}=e,u=2048,f=[];for(let w=0;w<a;w+=u){const T=Math.min(u,e.numberOfFrames-w),S=T*s*this.outputSampleSize,v=new ArrayBuffer(S),x=new DataView(v);f.push({frameCount:T,view:x})}const m=e.allocationSize({planeIndex:0,format:"f32-planar"}),g=new Float32Array(m/Float32Array.BYTES_PER_ELEMENT);for(let w=0;w<s;w++){e.copyTo(g,{planeIndex:w,format:"f32-planar"});for(let T=0;T<f.length;T++){const{frameCount:S,view:v}=f[T];for(let x=0;x<S;x++)this.writeOutputValue(v,(x*s+w)*this.outputSampleSize,g[T*u+x])}}r&&e.close();const y={decoderConfig:{codec:this.encodingConfig.codec,numberOfChannels:s,sampleRate:l}};for(let w=0;w<f.length;w++){const{frameCount:T,view:S}=f[w],v=S.buffer,x=w*u,_=new qe(new Uint8Array(v),"key",c+x/l,T/l);this.encodingConfig.onEncodedPacket?.(_,y),await this.muxer.addEncodedAudioPacket(this.source._connectedTrack,_,y)}}ensureEncoder(e){const r=new Error;this.ensureEncoderPromise=(async()=>{const{numberOfChannels:s,sampleRate:a}=e,l=Nd({numberOfChannels:s,sampleRate:a,...this.encodingConfig});this.encodingConfig.onEncoderConfig?.(l);const c=wd.find(u=>u.supports(this.encodingConfig.codec,l));if(c)this.customEncoder=new c,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=l,this.customEncoder.onPacket=(u,f)=>{if(!(u instanceof qe))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(f!==void 0&&(!f||typeof f!="object"))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(u,f),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,u,f).catch(m=>{this.error??=m,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else if(Tt.includes(this.encodingConfig.codec))this.initPcmEncoder();else{if(typeof AudioEncoder>"u")throw new Error("AudioEncoder is not supported by this browser.");if(!(await AudioEncoder.isConfigSupported(l)).supported)throw new Error(`This specific encoder configuration (${l.codec}, ${l.bitrate} bps, ${l.numberOfChannels} channels, ${l.sampleRate} Hz) is not supported by this browser. Consider using another codec or changing your audio parameters.`);this.encoder=new AudioEncoder({output:(f,m)=>{if(this.encodingConfig.codec==="aac"&&m?.decoderConfig){let y=!1;if(!m.decoderConfig.description||m.decoderConfig.description.byteLength<2?y=!0:y=$d(It(m.decoderConfig.description)).objectType===0,y){const w=Number(ot(l.codec.split(".")));m.decoderConfig.description=hw({objectType:w,numberOfChannels:m.decoderConfig.numberOfChannels,sampleRate:m.decoderConfig.sampleRate})}}const g=qe.fromEncodedChunk(f);this.encodingConfig.onEncodedPacket?.(g,m),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,g,m).catch(y=>{this.error??=y,this.errorNeedsNewStack=!1})},error:f=>{f.stack=r.stack,this.error??=f}}),this.encoder.configure(l)}b(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}initPcmEncoder(){this.isPcmEncoder=!0;const e=this.encodingConfig.codec,{dataType:r,sampleSize:s,littleEndian:a}=kr(e);switch(this.outputSampleSize=s,s){case 1:r==="unsigned"?this.writeOutputValue=(l,c,u)=>l.setUint8(c,yt((u+1)*127.5,0,255)):r==="signed"?this.writeOutputValue=(l,c,u)=>{l.setInt8(c,yt(Math.round(u*128),-128,127))}:r==="ulaw"?this.writeOutputValue=(l,c,u)=>{const f=yt(Math.floor(u*32767),-32768,32767);l.setUint8(c,Bw(f))}:r==="alaw"?this.writeOutputValue=(l,c,u)=>{const f=yt(Math.floor(u*32767),-32768,32767);l.setUint8(c,Ow(f))}:b(!1);break;case 2:r==="unsigned"?this.writeOutputValue=(l,c,u)=>l.setUint16(c,yt((u+1)*32767.5,0,65535),a):r==="signed"?this.writeOutputValue=(l,c,u)=>l.setInt16(c,yt(Math.round(u*32767),-32768,32767),a):b(!1);break;case 3:r==="unsigned"?this.writeOutputValue=(l,c,u)=>jd(l,c,yt((u+1)*83886075e-1,0,16777215),a):r==="signed"?this.writeOutputValue=(l,c,u)=>tw(l,c,yt(Math.round(u*8388607),-8388608,8388607),a):b(!1);break;case 4:r==="unsigned"?this.writeOutputValue=(l,c,u)=>l.setUint32(c,yt((u+1)*21474836475e-1,0,4294967295),a):r==="signed"?this.writeOutputValue=(l,c,u)=>l.setInt32(c,yt(Math.round(u*2147483647),-2147483648,2147483647),a):r==="float"?this.writeOutputValue=(l,c,u)=>l.setFloat32(c,u,a):b(!1);break;case 8:r==="float"?this.writeOutputValue=(l,c,u)=>l.setFloat64(c,u,a):b(!1);break;default:Mn(s),b(!1)}}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||await this.encoder.flush(),this.encoder.state!=="closed"&&this.encoder.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.isPcmEncoder?0:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=new Error().stack),this.error}}class op extends sf{constructor(e){MS(e),super(e.codec),this._encoder=new LS(this,e)}add(e){if(!(e instanceof hn))throw new TypeError("audioSample must be an AudioSample.");return this._encoder.add(e,!1)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class jS extends nf{constructor(e){if(super(),this._connectedTrack=null,!ea.includes(e))throw new TypeError(`Invalid subtitle codec '${e}'. Must be one of: ${ea.join(", ")}.`);this._codec=e}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const VS=["video","audio","subtitle"],ad=n=>{if(!n||typeof n!="object")throw new TypeError("metadata must be an object.");if(n.languageCode!==void 0&&!fo(n.languageCode))throw new TypeError("metadata.languageCode, when provided, must be a three-letter, ISO 639-2/T language code.");if(n.name!==void 0&&typeof n.name!="string")throw new TypeError("metadata.name, when provided, must be a string.");if(n.disposition!==void 0&&cw(n.disposition),n.maximumPacketCount!==void 0&&(!Number.isInteger(n.maximumPacketCount)||n.maximumPacketCount<0))throw new TypeError("metadata.maximumPacketCount, when provided, must be a non-negative integer.")};class zd{constructor(e){if(this.state="pending",this._tracks=[],this._startPromise=null,this._cancelPromise=null,this._finalizePromise=null,this._mutex=new sa,this._metadataTags={},!e||typeof e!="object")throw new TypeError("options must be an object.");if(!(e.format instanceof tf))throw new TypeError("options.format must be an OutputFormat.");if(!(e.target instanceof ef))throw new TypeError("options.target must be a Target.");if(e.target._output)throw new Error("Target is already used for another output.");e.target._output=this,this.format=e.format,this.target=e.target,this._writer=e.target._createWriter(),this._muxer=e.format._createMuxer(this)}addVideoTrack(e,r={}){if(!(e instanceof rf))throw new TypeError("source must be a VideoSource.");if(ad(r),r.rotation!==void 0&&![0,90,180,270].includes(r.rotation))throw new TypeError(`Invalid video rotation: ${r.rotation}. Has to be 0, 90, 180 or 270.`);if(!this.format.supportsVideoRotationMetadata&&r.rotation)throw new Error(`${this.format._name} does not support video rotation metadata.`);if(r.frameRate!==void 0&&(!Number.isFinite(r.frameRate)||r.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${r.frameRate}. Must be a positive number.`);this._addTrack("video",e,r)}addAudioTrack(e,r={}){if(!(e instanceof sf))throw new TypeError("source must be an AudioSource.");ad(r),this._addTrack("audio",e,r)}addSubtitleTrack(e,r={}){if(!(e instanceof jS))throw new TypeError("source must be a SubtitleSource.");ad(r),this._addTrack("subtitle",e,r)}setMetadataTags(e){if(pd(e),this.state!=="pending")throw new Error("Cannot set metadata tags after output has been started or canceled.");this._metadataTags=e}_addTrack(e,r,s){if(this.state!=="pending")throw new Error("Cannot add track after output has been started or canceled.");if(r._connectedTrack)throw new Error("Source is already used for a track.");const a=this.format.getSupportedTrackCounts(),l=this._tracks.reduce((m,g)=>m+(g.type===e?1:0),0),c=a[e].max;if(l===c)throw new Error(c===0?`${this.format._name} does not support ${e} tracks.`:`${this.format._name} does not support more than ${c} ${e} track${c===1?"":"s"}.`);const u=a.total.max;if(this._tracks.length===u)throw new Error(`${this.format._name} does not support more than ${u} tracks${u===1?"":"s"} in total.`);const f={id:this._tracks.length+1,output:this,type:e,source:r,metadata:s};if(f.type==="video"){const m=this.format.getSupportedVideoCodecs();if(m.length===0)throw new Error(`${this.format._name} does not support video tracks.`+this.format._codecUnsupportedHint(f.source._codec));if(!m.includes(f.source._codec))throw new Error(`Codec '${f.source._codec}' cannot be contained within ${this.format._name}. Supported video codecs are: ${m.map(g=>`'${g}'`).join(", ")}.`+this.format._codecUnsupportedHint(f.source._codec))}else if(f.type==="audio"){const m=this.format.getSupportedAudioCodecs();if(m.length===0)throw new Error(`${this.format._name} does not support audio tracks.`+this.format._codecUnsupportedHint(f.source._codec));if(!m.includes(f.source._codec))throw new Error(`Codec '${f.source._codec}' cannot be contained within ${this.format._name}. Supported audio codecs are: ${m.map(g=>`'${g}'`).join(", ")}.`+this.format._codecUnsupportedHint(f.source._codec))}else if(f.type==="subtitle"){const m=this.format.getSupportedSubtitleCodecs();if(m.length===0)throw new Error(`${this.format._name} does not support subtitle tracks.`+this.format._codecUnsupportedHint(f.source._codec));if(!m.includes(f.source._codec))throw new Error(`Codec '${f.source._codec}' cannot be contained within ${this.format._name}. Supported subtitle codecs are: ${m.map(g=>`'${g}'`).join(", ")}.`+this.format._codecUnsupportedHint(f.source._codec))}this._tracks.push(f),r._connectedTrack=f}async start(){const e=this.format.getSupportedTrackCounts();for(const s of VS){const a=this._tracks.reduce((c,u)=>c+(u.type===s?1:0),0),l=e[s].min;if(a<l)throw new Error(l===e[s].max?`${this.format._name} requires exactly ${l} ${s} track${l===1?"":"s"}.`:`${this.format._name} requires at least ${l} ${s} track${l===1?"":"s"}.`)}const r=e.total.min;if(this._tracks.length<r)throw new Error(r===e.total.max?`${this.format._name} requires exactly ${r} track${r===1?"":"s"}.`:`${this.format._name} requires at least ${r} track${r===1?"":"s"}.`);if(this.state==="canceled")throw new Error("Output has been canceled.");return this._startPromise?(console.warn("Output has already been started."),this._startPromise):this._startPromise=(async()=>{this.state="started",this._writer.start();const s=await this._mutex.acquire();await this._muxer.start();const a=this._tracks.map(l=>l.source._start());await Promise.all(a),s()})()}getMimeType(){return this._muxer.getMimeType()}async cancel(){if(this._cancelPromise)return console.warn("Output has already been canceled."),this._cancelPromise;if(this.state==="finalizing"||this.state==="finalized"){console.warn("Output has already been finalized.");return}return this._cancelPromise=(async()=>{this.state="canceled";const e=await this._mutex.acquire(),r=this._tracks.map(s=>s.source._flushOrWaitForOngoingClose(!0));await Promise.all(r),await this._writer.close(),e()})()}async finalize(){if(this.state==="pending")throw new Error("Cannot finalize before starting.");if(this.state==="canceled")throw new Error("Cannot finalize after canceling.");return this._finalizePromise?(console.warn("Output has already been finalized."),this._finalizePromise):this._finalizePromise=(async()=>{this.state="finalizing";const e=await this._mutex.acquire(),r=this._tracks.map(s=>s.source._flushOrWaitForOngoingClose(!1));await Promise.all(r),await this._muxer.finalize(),await this._writer.flush(),await this._writer.finalize(),this.state="finalized",e()})()}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const lp=n=>{if(n!==void 0&&(!n||typeof n!="object"))throw new TypeError("options.video, when provided, must be an object.");if(n?.discard!==void 0&&typeof n.discard!="boolean")throw new TypeError("options.video.discard, when provided, must be a boolean.");if(n?.forceTranscode!==void 0&&typeof n.forceTranscode!="boolean")throw new TypeError("options.video.forceTranscode, when provided, must be a boolean.");if(n?.codec!==void 0&&!pn.includes(n.codec))throw new TypeError(`options.video.codec, when provided, must be one of: ${pn.join(", ")}.`);if(n?.bitrate!==void 0&&!(n.bitrate instanceof Nn)&&(!Number.isInteger(n.bitrate)||n.bitrate<=0))throw new TypeError("options.video.bitrate, when provided, must be a positive integer or a quality.");if(n?.width!==void 0&&(!Number.isInteger(n.width)||n.width<=0))throw new TypeError("options.video.width, when provided, must be a positive integer.");if(n?.height!==void 0&&(!Number.isInteger(n.height)||n.height<=0))throw new TypeError("options.video.height, when provided, must be a positive integer.");if(n?.fit!==void 0&&!["fill","contain","cover"].includes(n.fit))throw new TypeError("options.video.fit, when provided, must be one of 'fill', 'contain', or 'cover'.");if(n?.width!==void 0&&n.height!==void 0&&n.fit===void 0)throw new TypeError("When both options.video.width and options.video.height are provided, options.video.fit must also be provided.");if(n?.rotate!==void 0&&![0,90,180,270].includes(n.rotate))throw new TypeError("options.video.rotate, when provided, must be 0, 90, 180 or 270.");if(n?.allowRotationMetadata!==void 0&&typeof n.allowRotationMetadata!="boolean")throw new TypeError("options.video.allowRotationMetadata, when provided, must be a boolean.");if(n?.crop!==void 0&&Kd(n.crop,"options.video."),n?.frameRate!==void 0&&(!Number.isFinite(n.frameRate)||n.frameRate<=0))throw new TypeError("options.video.frameRate, when provided, must be a finite positive number.");if(n?.alpha!==void 0&&!["discard","keep"].includes(n.alpha))throw new TypeError("options.video.alpha, when provided, must be either 'discard' or 'keep'.");if(n?.keyFrameInterval!==void 0&&(!Number.isFinite(n.keyFrameInterval)||n.keyFrameInterval<0))throw new TypeError("options.video.keyFrameInterval, when provided, must be a non-negative number.");if(n?.process!==void 0&&typeof n.process!="function")throw new TypeError("options.video.process, when provided, must be a function.");if(n?.processedWidth!==void 0&&(!Number.isInteger(n.processedWidth)||n.processedWidth<=0))throw new TypeError("options.video.processedWidth, when provided, must be a positive integer.");if(n?.processedHeight!==void 0&&(!Number.isInteger(n.processedHeight)||n.processedHeight<=0))throw new TypeError("options.video.processedHeight, when provided, must be a positive integer.");if(n?.hardwareAcceleration!==void 0&&!["no-preference","prefer-hardware","prefer-software"].includes(n.hardwareAcceleration))throw new TypeError("options.video.hardwareAcceleration, when provided, must be 'no-preference', 'prefer-hardware' or 'prefer-software'.")},cp=n=>{if(n!==void 0&&(!n||typeof n!="object"))throw new TypeError("options.audio, when provided, must be an object.");if(n?.discard!==void 0&&typeof n.discard!="boolean")throw new TypeError("options.audio.discard, when provided, must be a boolean.");if(n?.forceTranscode!==void 0&&typeof n.forceTranscode!="boolean")throw new TypeError("options.audio.forceTranscode, when provided, must be a boolean.");if(n?.codec!==void 0&&!Fn.includes(n.codec))throw new TypeError(`options.audio.codec, when provided, must be one of: ${Fn.join(", ")}.`);if(n?.bitrate!==void 0&&!(n.bitrate instanceof Nn)&&(!Number.isInteger(n.bitrate)||n.bitrate<=0))throw new TypeError("options.audio.bitrate, when provided, must be a positive integer or a quality.");if(n?.numberOfChannels!==void 0&&(!Number.isInteger(n.numberOfChannels)||n.numberOfChannels<=0))throw new TypeError("options.audio.numberOfChannels, when provided, must be a positive integer.");if(n?.sampleRate!==void 0&&(!Number.isInteger(n.sampleRate)||n.sampleRate<=0))throw new TypeError("options.audio.sampleRate, when provided, must be a positive integer.");if(n?.process!==void 0&&typeof n.process!="function")throw new TypeError("options.audio.process, when provided, must be a function.");if(n?.processedNumberOfChannels!==void 0&&(!Number.isInteger(n.processedNumberOfChannels)||n.processedNumberOfChannels<=0))throw new TypeError("options.audio.processedNumberOfChannels, when provided, must be a positive integer.");if(n?.processedSampleRate!==void 0&&(!Number.isInteger(n.processedSampleRate)||n.processedSampleRate<=0))throw new TypeError("options.audio.processedSampleRate, when provided, must be a positive integer.")},od=2,ld=48e3;class af{static async init(e){const r=new af(e);return await r._init(),r}constructor(e){if(this._addedCounts={video:0,audio:0,subtitle:0},this._totalTrackCount=0,this._trackPromises=[],this._executed=!1,this._synchronizer=new WS,this._totalDuration=null,this._maxTimestamps=new Map,this._canceled=!1,this.onProgress=void 0,this._computeProgress=!1,this._lastProgress=0,this.isValid=!1,this.utilizedTracks=[],this.discardedTracks=[],!e||typeof e!="object")throw new TypeError("options must be an object.");if(!(e.input instanceof Ig))throw new TypeError("options.input must be an Input.");if(!(e.output instanceof zd))throw new TypeError("options.output must be an Output.");if(e.output._tracks.length>0||Object.keys(e.output._metadataTags).length>0||e.output.state!=="pending")throw new TypeError("options.output must be fresh: no tracks or metadata tags added and not started.");if(typeof e.video!="function"&&lp(e.video),typeof e.audio!="function"&&cp(e.audio),e.trim!==void 0&&(!e.trim||typeof e.trim!="object"))throw new TypeError("options.trim, when provided, must be an object.");if(e.trim?.start!==void 0&&(!Number.isFinite(e.trim.start)||e.trim.start<0))throw new TypeError("options.trim.start, when provided, must be a non-negative number.");if(e.trim?.end!==void 0&&(!Number.isFinite(e.trim.end)||e.trim.end<0))throw new TypeError("options.trim.end, when provided, must be a non-negative number.");if(e.trim?.start!==void 0&&e.trim.end!==void 0&&e.trim.start>=e.trim.end)throw new TypeError("options.trim.start must be less than options.trim.end.");if(e.tags!==void 0&&(typeof e.tags!="object"||!e.tags)&&typeof e.tags!="function")throw new TypeError("options.tags, when provided, must be an object or a function.");if(typeof e.tags=="object"&&pd(e.tags),e.showWarnings!==void 0&&typeof e.showWarnings!="boolean")throw new TypeError("options.showWarnings, when provided, must be a boolean.");this._options=e,this.input=e.input,this.output=e.output,this._startTimestamp=e.trim?.start??0,this._endTimestamp=e.trim?.end??1/0;const{promise:r,resolve:s}=wt();this._started=r,this._start=s}async _init(){const e=await this.input.getTracks(),r=this.output.format.getSupportedTrackCounts();let s=1,a=1;for(const m of e){let g;if(m.isVideoTrack()?this._options.video&&(typeof this._options.video=="function"?(g=await this._options.video(m,s),lp(g),s++):g=this._options.video):m.isAudioTrack()?this._options.audio&&(typeof this._options.audio=="function"?(g=await this._options.audio(m,a),cp(g),a++):g=this._options.audio):b(!1),g?.discard){this.discardedTracks.push({track:m,reason:"discarded_by_user"});continue}if(this._totalTrackCount===r.total.max){this.discardedTracks.push({track:m,reason:"max_track_count_reached"});continue}if(this._addedCounts[m.type]===r[m.type].max){this.discardedTracks.push({track:m,reason:"max_track_count_of_type_reached"});continue}m.isVideoTrack()?await this._processVideoTrack(m,g??{}):m.isAudioTrack()&&await this._processAudioTrack(m,g??{})}const l=await this.input.getMetadataTags();let c;if(this._options.tags){const m=typeof this._options.tags=="function"?await this._options.tags(l):this._options.tags;pd(m),c=m}else c=l;const u=(await this.input.getFormat()).mimeType===this.output.format.mimeType,f=l.raw===c.raw;if(l.raw&&f&&!u&&delete c.raw,this.output.setMetadataTags(c),this.isValid=this._totalTrackCount>=r.total.min&&this._addedCounts.video>=r.video.min&&this._addedCounts.audio>=r.audio.min&&this._addedCounts.subtitle>=r.subtitle.min,this._options.showWarnings??!0){const m=[],g=this.discardedTracks.filter(y=>y.reason!=="discarded_by_user");g.length>0&&m.push("Some tracks had to be discarded from the conversion:",g),this.isValid||m.push(`

`+this._getInvalidityExplanation().join("")),m.length>0&&console.warn(...m)}}_getInvalidityExplanation(){const e=[];if(this.discardedTracks.length===0)e.push("Due to missing tracks, this conversion cannot be executed.");else{const r=this.discardedTracks.every(s=>s.reason==="discarded_by_user"||s.reason==="no_encodable_target_codec");if(e.push("Due to discarded tracks, this conversion cannot be executed."),r){const s=this.discardedTracks.flatMap(a=>a.reason==="discarded_by_user"?[]:a.track.type==="video"?this.output.format.getSupportedVideoCodecs():a.track.type==="audio"?this.output.format.getSupportedAudioCodecs():this.output.format.getSupportedSubtitleCodecs());s.length===1?e.push(`
Tracks were discarded because your environment is not able to encode '${s[0]}'.`):e.push(`
Tracks were discarded because your environment is not able to encode any of the following codecs: ${s.map(a=>`'${a}'`).join(", ")}.`),s.includes("mp3")&&e.push(`
The @mediabunny/mp3-encoder extension package provides support for encoding MP3.`)}else e.push(`
Check the discardedTracks field for more info.`)}return e}async execute(){if(!this.isValid)throw new Error(`Cannot execute this conversion because its output configuration is invalid. Make sure to always check the isValid field before executing a conversion.
`+this._getInvalidityExplanation().join(""));if(this._executed)throw new Error("Conversion cannot be executed twice.");if(this._executed=!0,this.onProgress){this._computeProgress=!0,this._totalDuration=Math.min(await this.input.computeDuration()-this._startTimestamp,this._endTimestamp-this._startTimestamp);for(const e of this.utilizedTracks)this._maxTimestamps.set(e.id,0);this.onProgress?.(0)}await this.output.start(),this._start();try{await Promise.all(this._trackPromises)}catch(e){throw this._canceled||this.cancel(),e}this._canceled&&await new Promise(()=>{}),await this.output.finalize(),this._computeProgress&&this.onProgress?.(1)}async cancel(){if(!(this.output.state==="finalizing"||this.output.state==="finalized")){if(this._canceled){console.warn("Conversion already canceled.");return}this._canceled=!0,await this.output.cancel()}}async _processVideoTrack(e,r){const s=e.codec;if(!s){this.discardedTracks.push({track:e,reason:"unknown_source_codec"});return}let a;const l=Gl(e.rotation+(r.rotate??0)),c=this.output.format.supportsVideoRotationMetadata&&(r.allowRotationMetadata??!0),[u,f]=l%180===0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],m=r.crop;m&&qd(m,u,f);const[g,y]=m?[m.width,m.height]:[u,f];let w=g,T=y;const S=w/T,v=j=>Math.ceil(j/2)*2;r.width!==void 0&&r.height===void 0?(w=v(r.width),T=v(Math.round(w/S))):r.width===void 0&&r.height!==void 0?(T=v(r.height),w=v(Math.round(T*S))):r.width!==void 0&&r.height!==void 0&&(w=v(r.width),T=v(r.height));const x=await e.getFirstTimestamp(),_=!!r.forceTranscode||this._startTimestamp>0||x<0||!!r.frameRate||r.keyFrameInterval!==void 0||r.process!==void 0;let A=w!==g||T!==y||l!==0&&(!c||r.process!==void 0)||!!m;const O=r.alpha??"discard";let B=this.output.format.getSupportedVideoCodecs();if(!_&&!r.bitrate&&!A&&B.includes(s)&&(!r.codec||r.codec===s)){const j=new BS(s);a=j,this._trackPromises.push((async()=>{await this._started;const L=new po(e),G={decoderConfig:await e.getDecoderConfig()??void 0},se=Number.isFinite(this._endTimestamp)?await L.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const oe of L.packets(void 0,se,{verifyKeyPackets:!0})){if(this._canceled)return;O==="discard"&&(delete oe.sideData.alpha,delete oe.sideData.alphaByteLength),this._reportProgress(e.id,oe.timestamp),await j.add(oe,G),this._synchronizer.shouldWait(e.id,oe.timestamp)&&await this._synchronizer.wait(oe.timestamp)}j.close(),this._synchronizer.closeTrack(e.id)})())}else{if(!await e.canDecode()){this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});return}r.codec&&(B=B.filter(oe=>oe===r.codec));const L=r.bitrate??Rd,q=await Yg(B,{width:r.process&&r.processedWidth?r.processedWidth:w,height:r.process&&r.processedHeight?r.processedHeight:T,bitrate:L});if(!q){this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});return}const G={codec:q,bitrate:L,keyFrameInterval:r.keyFrameInterval,sizeChangeBehavior:r.fit??"passThrough",alpha:O,hardwareAcceleration:r.hardwareAcceleration},se=new ap(G);if(a=se,!A){const oe=new zd({format:new Qg,target:new vS}),re=new ap(G);oe.addVideoTrack(re),await oe.start();const he=await new kd(e).getSample(x);if(he)try{await re.add(he),he.close(),await oe.finalize()}catch(ze){console.info("Error when probing encoder support. Falling back to rerender path.",ze),A=!0,oe.cancel()}else await oe.cancel()}A?this._trackPromises.push((async()=>{await this._started;const re=new Qw(e,{width:w,height:T,fit:r.fit??"fill",rotation:l,crop:r.crop,poolSize:1,alpha:O==="keep"}).canvases(this._startTimestamp,this._endTimestamp),ne=r.frameRate;let he=null,ze=null,Ze=null;const Ne=async Ce=>{b(he),b(ne!==void 0);const Q=Math.round((Ce-ze)*ne);for(let fe=1;fe<Q;fe++){const X=new _t(he,{timestamp:ze+fe/ne,duration:1/ne});await this._registerVideoSample(e,r,se,X),X.close()}};for await(const{canvas:Ce,timestamp:Q,duration:fe}of re){if(this._canceled)return;let X=Math.max(Q-this._startTimestamp,0);if(Ze=X+fe,ne!==void 0){const V=Math.floor(X*ne)/ne;if(he!==null)if(V<=ze){he=Ce,ze=V;continue}else await Ne(V);X=V}const N=new _t(Ce,{timestamp:X,duration:ne!==void 0?1/ne:fe});await this._registerVideoSample(e,r,se,N),N.close(),ne!==void 0&&(he=Ce,ze=X)}he&&(b(Ze!==null),b(ne!==void 0),await Ne(Math.floor(Ze*ne)/ne)),se.close(),this._synchronizer.closeTrack(e.id)})()):this._trackPromises.push((async()=>{await this._started;const oe=new kd(e),re=r.frameRate;let ne=null,he=null,ze=null;const Ze=async Ne=>{b(ne),b(re!==void 0);const Ce=Math.round((Ne-he)*re);for(let Q=1;Q<Ce;Q++)ne.setTimestamp(he+Q/re),ne.setDuration(1/re),await this._registerVideoSample(e,r,se,ne);ne.close()};for await(const Ne of oe.samples(this._startTimestamp,this._endTimestamp)){if(this._canceled){ne?.close();return}let Ce=Math.max(Ne.timestamp-this._startTimestamp,0);if(ze=Ce+Ne.duration,re!==void 0){const Q=Math.floor(Ce*re)/re;if(ne!==null)if(Q<=he){ne.close(),ne=Ne,he=Q;continue}else await Ze(Q);Ce=Q,Ne.setDuration(1/re)}Ne.setTimestamp(Ce),await this._registerVideoSample(e,r,se,Ne),re!==void 0?(ne=Ne,he=Ce):Ne.close()}ne&&(b(ze!==null),b(re!==void 0),await Ze(Math.floor(ze*re)/re)),se.close(),this._synchronizer.closeTrack(e.id)})())}this.output.addVideoTrack(a,{frameRate:r.frameRate,languageCode:fo(e.languageCode)?e.languageCode:void 0,name:e.name??void 0,disposition:e.disposition,rotation:A?0:l}),this._addedCounts.video++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _registerVideoSample(e,r,s,a){if(this._canceled)return;this._reportProgress(e.id,a.timestamp);let l;if(!r.process)l=[a];else{let c=r.process(a);c instanceof Promise&&(c=await c),Array.isArray(c)||(c=c===null?[]:[c]),l=c.map(u=>u instanceof _t?u:typeof VideoFrame<"u"&&u instanceof VideoFrame?new _t(u):new _t(u,{timestamp:a.timestamp,duration:a.duration}))}for(const c of l){if(this._canceled)break;await s.add(c),this._synchronizer.shouldWait(e.id,c.timestamp)&&await this._synchronizer.wait(c.timestamp)}for(const c of l)c!==a&&c.close()}async _processAudioTrack(e,r){const s=e.codec;if(!s){this.discardedTracks.push({track:e,reason:"unknown_source_codec"});return}let a;const l=e.numberOfChannels,c=e.sampleRate,u=await e.getFirstTimestamp();let f=r.numberOfChannels??l,m=r.sampleRate??c,g=f!==l||m!==c||this._startTimestamp>0||u<0,y=this.output.format.getSupportedAudioCodecs();if(!r.forceTranscode&&!r.bitrate&&!g&&y.includes(s)&&(!r.codec||r.codec===s)&&!r.process){const w=new US(s);a=w,this._trackPromises.push((async()=>{await this._started;const T=new po(e),v={decoderConfig:await e.getDecoderConfig()??void 0},x=Number.isFinite(this._endTimestamp)?await T.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const _ of T.packets(void 0,x)){if(this._canceled)return;this._reportProgress(e.id,_.timestamp),await w.add(_,v),this._synchronizer.shouldWait(e.id,_.timestamp)&&await this._synchronizer.wait(_.timestamp)}w.close(),this._synchronizer.closeTrack(e.id)})())}else{if(!await e.canDecode()){this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});return}let T=null;r.codec&&(y=y.filter(x=>x===r.codec));const S=r.bitrate??Rd,v=await sp(y,{numberOfChannels:r.process&&r.processedNumberOfChannels?r.processedNumberOfChannels:f,sampleRate:r.process&&r.processedSampleRate?r.processedSampleRate:m,bitrate:S});if(!v.some(x=>qs.includes(x))&&y.some(x=>qs.includes(x))&&(f!==od||m!==ld)){const _=(await sp(y,{numberOfChannels:od,sampleRate:ld,bitrate:S})).find(A=>qs.includes(A));_&&(g=!0,T=_,f=od,m=ld)}else T=v[0]??null;if(T===null){this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});return}if(g)a=this._resampleAudio(e,r,T,f,m,S);else{const x=new op({codec:T,bitrate:S});a=x,this._trackPromises.push((async()=>{await this._started;const _=new Wm(e);for await(const A of _.samples(void 0,this._endTimestamp)){if(this._canceled)return;await this._registerAudioSample(e,r,x,A),A.close()}x.close(),this._synchronizer.closeTrack(e.id)})())}}this.output.addAudioTrack(a,{languageCode:fo(e.languageCode)?e.languageCode:void 0,name:e.name??void 0,disposition:e.disposition}),this._addedCounts.audio++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _registerAudioSample(e,r,s,a){if(this._canceled)return;this._reportProgress(e.id,a.timestamp);let l;if(!r.process)l=[a];else{let c=r.process(a);if(c instanceof Promise&&(c=await c),Array.isArray(c)||(c=c===null?[]:[c]),!c.every(u=>u instanceof hn))throw new TypeError("The audio process function must return an AudioSample, null, or an array of AudioSamples.");l=c}for(const c of l){if(this._canceled)break;await s.add(c),this._synchronizer.shouldWait(e.id,c.timestamp)&&await this._synchronizer.wait(c.timestamp)}for(const c of l)c!==a&&c.close()}_resampleAudio(e,r,s,a,l,c){const u=new op({codec:s,bitrate:c});return this._trackPromises.push((async()=>{await this._started;const f=new HS({targetNumberOfChannels:a,targetSampleRate:l,startTime:this._startTimestamp,endTime:this._endTimestamp,onSample:async y=>{await this._registerAudioSample(e,r,u,y),y.close()}}),g=new Wm(e).samples(this._startTimestamp,this._endTimestamp);for await(const y of g){if(this._canceled)return;await f.add(y),y.close()}await f.finalize(),u.close(),this._synchronizer.closeTrack(e.id)})()),u}_reportProgress(e,r){if(!this._computeProgress)return;b(this._totalDuration!==null),this._maxTimestamps.set(e,Math.max(r,this._maxTimestamps.get(e)));const s=Math.min(...this._maxTimestamps.values()),a=yt(s/this._totalDuration,0,1);a!==this._lastProgress&&(this._lastProgress=a,this.onProgress?.(a))}}const up=5;class WS{constructor(){this.maxTimestamps=new Map,this.resolvers=[]}computeMinAndMaybeResolve(){let e=1/0;for(const[,r]of this.maxTimestamps)e=Math.min(e,r);for(let r=0;r<this.resolvers.length;r++){const s=this.resolvers[r];s.timestamp-e<up&&(s.resolve(),this.resolvers.splice(r,1),r--)}return e}shouldWait(e,r){this.maxTimestamps.set(e,Math.max(r,this.maxTimestamps.get(e)??-1/0));const s=this.computeMinAndMaybeResolve();return r-s>=up}wait(e){const{promise:r,resolve:s}=wt();return this.resolvers.push({timestamp:e,resolve:s}),r}closeTrack(e){this.maxTimestamps.delete(e),this.computeMinAndMaybeResolve()}}class HS{constructor(e){this.sourceSampleRate=null,this.sourceNumberOfChannels=null,this.targetSampleRate=e.targetSampleRate,this.targetNumberOfChannels=e.targetNumberOfChannels,this.startTime=e.startTime,this.endTime=e.endTime,this.onSample=e.onSample,this.bufferSizeInFrames=Math.floor(this.targetSampleRate*5),this.bufferSizeInSamples=this.bufferSizeInFrames*this.targetNumberOfChannels,this.outputBuffer=new Float32Array(this.bufferSizeInSamples),this.bufferStartFrame=0,this.maxWrittenFrame=-1}doChannelMixerSetup(){b(this.sourceNumberOfChannels!==null);const e=this.sourceNumberOfChannels,r=this.targetNumberOfChannels;e===1&&r===2?this.channelMixer=(s,a)=>s[a*e]:e===1&&r===4?this.channelMixer=(s,a,l)=>s[a*e]*+(l<2):e===1&&r===6?this.channelMixer=(s,a,l)=>s[a*e]*+(l===2):e===2&&r===1?this.channelMixer=(s,a)=>{const l=a*e;return .5*(s[l]+s[l+1])}:e===2&&r===4?this.channelMixer=(s,a,l)=>s[a*e+l]*+(l<2):e===2&&r===6?this.channelMixer=(s,a,l)=>s[a*e+l]*+(l<2):e===4&&r===1?this.channelMixer=(s,a)=>{const l=a*e;return .25*(s[l]+s[l+1]+s[l+2]+s[l+3])}:e===4&&r===2?this.channelMixer=(s,a,l)=>{const c=a*e;return .5*(s[c+l]+s[c+l+2])}:e===4&&r===6?this.channelMixer=(s,a,l)=>{const c=a*e;return l<2?s[c+l]:l===2||l===3?0:s[c+l-2]}:e===6&&r===1?this.channelMixer=(s,a)=>{const l=a*e;return Math.SQRT1_2*(s[l]+s[l+1])+s[l+2]+.5*(s[l+4]+s[l+5])}:e===6&&r===2?this.channelMixer=(s,a,l)=>{const c=a*e;return s[c+l]+Math.SQRT1_2*(s[c+2]+s[c+l+4])}:e===6&&r===4?this.channelMixer=(s,a,l)=>{const c=a*e;return l<2?s[c+l]+Math.SQRT1_2*s[c+2]:s[c+l+2]}:this.channelMixer=(s,a,l)=>l<e?s[a*e+l]:0}ensureTempBufferSize(e){let r=this.tempSourceBuffer.length;for(;r<e;)r*=2;if(r!==this.tempSourceBuffer.length){const s=new Float32Array(r);s.set(this.tempSourceBuffer),this.tempSourceBuffer=s}}async add(e){this.sourceSampleRate===null&&(this.sourceSampleRate=e.sampleRate,this.sourceNumberOfChannels=e.numberOfChannels,this.tempSourceBuffer=new Float32Array(this.sourceSampleRate*this.sourceNumberOfChannels),this.doChannelMixerSetup());const r=e.numberOfFrames*e.numberOfChannels;this.ensureTempBufferSize(r);const s=e.allocationSize({planeIndex:0,format:"f32"}),a=new Float32Array(this.tempSourceBuffer.buffer,0,s/4);e.copyTo(a,{planeIndex:0,format:"f32"});const l=e.timestamp-this.startTime,c=e.numberOfFrames/this.sourceSampleRate,u=Math.min(l+c,this.endTime-this.startTime),f=Math.floor(l*this.targetSampleRate),m=Math.ceil(u*this.targetSampleRate);for(let g=f;g<m;g++){if(g<this.bufferStartFrame)continue;for(;g>=this.bufferStartFrame+this.bufferSizeInFrames;)await this.finalizeCurrentBuffer(),this.bufferStartFrame+=this.bufferSizeInFrames;const y=g-this.bufferStartFrame;b(y<this.bufferSizeInFrames);const S=(g/this.targetSampleRate-l)*this.sourceSampleRate,v=Math.floor(S),x=Math.ceil(S),_=S-v;for(let A=0;A<this.targetNumberOfChannels;A++){let O=0,B=0;v>=0&&v<e.numberOfFrames&&(O=this.channelMixer(a,v,A)),x>=0&&x<e.numberOfFrames&&(B=this.channelMixer(a,x,A));const j=O+_*(B-O),L=y*this.targetNumberOfChannels+A;this.outputBuffer[L]+=j}this.maxWrittenFrame=Math.max(this.maxWrittenFrame,y)}}async finalizeCurrentBuffer(){if(this.maxWrittenFrame<0)return;const e=(this.maxWrittenFrame+1)*this.targetNumberOfChannels,r=new Float32Array(e);r.set(this.outputBuffer.subarray(0,e));const s=this.bufferStartFrame/this.targetSampleRate,a=new hn({format:"f32",sampleRate:this.targetSampleRate,numberOfChannels:this.targetNumberOfChannels,timestamp:s,data:r});await this.onSample(a),this.outputBuffer.fill(0),this.maxWrittenFrame=-1}finalize(){return this.finalizeCurrentBuffer()}}const Zg=()=>{const n=globalThis;return typeof n.VideoEncoder<"u"&&typeof n.AudioEncoder<"u"},$S=()=>Zg(),QS=n=>{let e=0;return n.map(r=>{const s=Math.max(0,r.outMs-r.inMs),a={...r,offsetMs:e};return e+=s,a})},dp=(n,e)=>{if(!Number.isFinite(n)||n<0)return null;for(const r of e){if(n<r.inMs)return null;if(n<=r.outMs)return{keptMs:r.offsetMs+(n-r.inMs),rangeOutMs:r.outMs}}return null},qS=n=>{switch(n){case"high":return Rd;case"standard":return NS;default:return FS}},KS=async(n,e,r)=>{if(!Zg())throw new Error("WebCodecs not supported");const s=Ud(n);if(s.length===0)throw new Error("No kept ranges to export");const a=QS(s),l=n.mode==="clip"||n.cuts.length>0,c=qS(r.preset),u=await e.getAsset(n.sourceAssetId),f=new Ig({source:new sT(u),formats:iT}),m=new Hg,g=new zd({format:new Md,target:m}),y=await Yg(["vp9","vp8"],{...r.width!==void 0?{width:r.width}:{},...r.height!==void 0?{height:r.height}:{},bitrate:c});if(!y)throw new Error("No encodable WebM video codec available");const w=r.includeAudio?await zS(["opus","vorbis"],{bitrate:c}):null,T=r.includeAudio&&!!w,S={codec:y,bitrate:c,forceTranscode:!0,...r.width!==void 0?{width:r.width}:{},...r.height!==void 0?{height:r.height}:{},...r.fps!==void 0?{frameRate:r.fps}:{},...l?{process:B=>{const j=B.timestamp*1e3,L=dp(j,a);if(!L)return null;const q=Math.max(0,L.rangeOutMs-j);if(q<=0)return null;const G=Math.min(B.duration*1e3,q),se=B.toVideoFrame();return new _t(se,{timestamp:L.keptMs/1e3,duration:G/1e3})}}:{}},v=T?{codec:w,bitrate:c,forceTranscode:!0,...l?{process:B=>{const j=B.timestamp*1e3,L=dp(j,a);if(!L)return null;const q=B.clone();return q.setTimestamp(L.keptMs/1e3),q}}:{}}:{discard:!0};if(await(await af.init({input:f,output:g,video:S,audio:v})).execute(),!m.buffer)throw new Error("WebM export failed to produce output");let _="video/webm";try{_=await g.getMimeType()}catch{}return{blob:new Blob([m.buffer],{type:_}),mime:_,engine:"webcodecs",audioIncluded:T,...y?{videoCodec:y}:{},...w?{audioCodec:w}:{}}},GS=n=>n.split(";")[0]?.trim()==="video/webm"?"webm":"mp4",XS=n=>n.split(";")[0]?.trim()==="video/webm"?"webm":"mp4",YS=(n,e,r)=>{const s=new Date().toISOString().replace(/[:.]/g,"-"),a=XS(n);if(e==="clip"&&r){const l=Math.round(r.inMs),c=Math.round(r.outMs);return`hammer_clip_${s}_${l}-${c}.${a}`}return`hammer_export_${s}.${a}`},ZS=async(n,e,r,s)=>{if(r.container==="webm"&&$S())try{return await KS(n,e,r)}catch{}try{return await Gy(n,e,r)}catch{return Xy(n,s,r.container)}},JS=async(n,e,r,s)=>{s?.("preparing");const a=Ud(n),l=Uy(a);s?.("encoding");const{blob:c,mime:u,engine:f,audioIncluded:m,videoCodec:g,audioCodec:y}=await ZS(n,e,r,l);s?.("saving");const w=n.mode==="clip"&&a.length>0?a[0]:void 0,T=YS(u,n.mode,w),S=new File([c],T,{type:u}),x={assetId:(await e.putAsset(S)).assetId,container:GS(u),filename:T,durationMs:l,bytes:c.size,mime:u,audioIncluded:m,engine:f};return g&&(x.videoCodec=g),y&&(x.audioCodec=y),x},e1=75e3,t1={fast:{minMs:15e3,maxMs:3e4},default:{minMs:25e3,maxMs:45e3},standard:{minMs:3e4,maxMs:6e4}},n1={teaser_funnel:{hook:.3,completeness:0,curiosity:.25,clarity:.25,humor:0,lengthFit:.2},ctr_hook:{hook:.45,completeness:.25,curiosity:0,clarity:.1,humor:0,lengthFit:.2},value_evergreen:{hook:.15,completeness:.35,curiosity:0,clarity:.35,humor:0,lengthFit:.15},community_personality:{hook:.25,completeness:0,curiosity:0,clarity:.2,humor:.35,lengthFit:.2}},r1=["how to","why","what if","the secret","you won't","you will","the reason","here's why","stop","never","always"],Jg=["but","however","yet","although","instead","on the other hand"],e0=["so","because","therefore","as a result","that means","which means","the point is"],i1=["haha","lol","lmao","funny","joke","hilarious","wild","crazy"],s1=["?","..."," but"," so"," because"," here's why"],ql=n=>n.replace(/\s+/g," ").trim(),t0=(n,e)=>{if(n.length<=e)return n;const r=n.slice(0,e).trim();return r.length<n.length?`${r}...`:r},a1=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`short_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,o1=n=>n.segments.filter(e=>e.endMs>e.startMs).map(e=>({...e,text:ql(e.text)})).filter(e=>e.text.length>0).sort((e,r)=>e.startMs-r.startMs),l1=n=>{const e=n.trim();if(/[.!?]\s*$/.test(e))return!0;const r=e.toLowerCase(),s=r.slice(Math.max(0,Math.floor(r.length*.8)));return Jg.some(a=>s.includes(a))||e0.some(a=>s.includes(a))},c1=n=>{const e=n.toLowerCase();let r=.2;return n.includes("?")&&(r+=.4),r1.some(s=>e.includes(s))&&(r+=.4),/\bwhy\b|\bhow\b|\bwhat\b/.test(e)&&(r+=.1),Math.min(1,r)},u1=n=>{const e=n.toLowerCase(),r=Jg.some(l=>e.includes(l)),s=e0.some(l=>e.includes(l));let a=0;return r&&(a+=.5),s&&(a+=.5),Math.min(1,a)},d1=n=>{const e=n.trim(),r=e.toLowerCase();let s=0;return(e.endsWith("?")||e.endsWith("..."))&&(s+=.6),s1.some(a=>r.endsWith(a.trim()))&&(s+=.4),Math.min(1,s)},f1=n=>{const e=n.toLowerCase(),r=e.match(/[a-z0-9']+/g)??[],s=new Set(["it","this","that","they","he","she","we","you","i","its","it's","we're","you're","that's","those"]),l=r.filter(u=>s.has(u)).length/Math.max(1,r.length);let c=1-Math.min(1,l*1.5);return(e.includes("as we said")||e.includes("as mentioned")||e.includes("as noted"))&&(c-=.2),Math.max(0,Math.min(1,c))},h1=n=>{const e=n.toLowerCase();let r=0;return i1.forEach(s=>{e.includes(s)&&(r+=.25)}),Math.min(1,r)},m1=(n,e)=>{const r=e.minMs,s=e.maxMs,a=(r+s)/2,l=Math.max(1,(s-r)/2),c=Math.abs(n-a);return Math.max(0,1-Math.min(1,c/l))},p1=(n,e,r)=>{const s=ql(n.slice(0,2).map(l=>l.text).join(" ")),a=ql(n.map(l=>l.text).join(" "));return{hook:c1(s),completeness:u1(a),curiosity:d1(a),clarity:f1(s),humor:h1(a),lengthFit:m1(e,r)}},g1=n=>{const e=n.trim();if(!e)return"Short";const r=e.search(/[.!?]/),s=r>0?e.slice(0,r):e;return t0(s,56)},y1=n=>{const e=[];return n.hook>=.6&&e.push("Hook"),n.completeness>=.6&&e.push("Complete thought"),n.curiosity>=.6&&e.push("Curiosity gap"),n.humor>=.5&&e.push("Funny"),n.clarity>=.6&&e.push("Clear/Standalone"),n.lengthFit>=.6&&e.push("Length fit"),e.length===0&&e.push("Good fit"),e},w1=(n,e)=>{const r=n1[e],s=n.hook*r.hook+n.completeness*r.completeness+n.curiosity*r.curiosity+n.clarity*r.clarity+n.humor*r.humor+n.lengthFit*r.lengthFit;return Math.round(Math.max(0,Math.min(1,s))*100)},k1=(n,e)=>{const r=Math.min(n.endMs,e.endMs)-Math.max(n.startMs,e.startMs);if(r<=0)return 0;const s=Math.min(n.endMs-n.startMs,e.endMs-e.startMs);return r/Math.max(1,s)},T1=n=>{const e=[...n].sort((s,a)=>a.score-s.score),r=[];return e.forEach(s=>{r.some(l=>k1(s,l)>.7)||r.push(s)}),r},S1=(n,e,r,s=20)=>{const a=o1(n);if(a.length===0)return[];const l=t1[r],c=Math.min(l.maxMs,e1),u=[];for(let m=0;m<a.length;m+=1){const g=a[m];if(!g)continue;const y=g.startMs;for(let w=m;w<a.length;w+=1){const T=a[w];if(!T)continue;let S=T.endMs;const v=S-y;if(v<l.minMs||(v>c&&(S=y+c),!(l1(T.text)||S>=y+c)))continue;const _=a.slice(m,w+1),A=ql(_.slice(0,2).map(q=>q.text).join(" ")),O=t0(A,120),B=g1(O),j=p1(_,S-y,l),L=w1(j,e);u.push({startMs:y,endMs:S,segments:_,score:L,signals:j,title:B,hook:O});break}}return T1(u).sort((m,g)=>g.score-m.score).slice(0,s).map(m=>({id:a1(),startMs:m.startMs,endMs:m.endMs,score:m.score,title:m.title,hook:m.hook,reasonTags:y1(m.signals),segmentIds:m.segments.map(g=>g.id)}))},v1=5400*1e3,b1=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`proj_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,10)}`,x1=async(n,e,r)=>{const s=await xp(n);if(s.durationMs>v1)throw new Error("Video exceeds 90-minute limit. Please trim before importing.");const a=await e.putAsset(n),l=new Date().toISOString(),c={asset:{providerId:e.providerId,assetId:a.assetId},filename:n.name,durationMs:s.durationMs,width:s.width,height:s.height};typeof s.fps=="number"&&(c.fps=s.fps);const u={schemaVersion:"0.1",projectId:b1(),createdAt:l,updatedAt:l,source:c,splits:[],edl:{cuts:[]},effects:{audio:{preset:"off"},video:{}},shorts:[],assets:[]};return r?.trim()&&(u.title=r.trim()),await e.saveProject(u),e.loadProject(u.projectId)},C1=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`transcript_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,10)}`,of=(n,e)=>`seg_${n}_${Math.max(0,Math.round(e))}`,Kl=n=>{const e=n.trim().replace(",",".");if(!e)return null;const r=e.split(":");if(r.length<2||r.length>3)return null;const s=r.pop();if(!s)return null;const a=r.pop();if(!a)return null;const l=r.pop()??"0",c=Number(l),u=Number(a),f=Number(s);if(![c,u,f].every(g=>Number.isFinite(g)))return null;const m=c*3600+u*60+f;return Math.max(0,Math.round(m*1e3))},lf=n=>{const e=Number.isFinite(n.startMs)?Math.max(0,n.startMs):0,r=Number.isFinite(n.endMs)?Math.max(e,n.endMs):e;return{...n,startMs:e,endMs:r}},fp=n=>{const e=n.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`),r=[];for(let s=0;s<e.length;s+=1){const a=e[s];if(!a)continue;const l=a.trim();if(!l)continue;const c=l.toUpperCase();if(c.startsWith("WEBVTT"))continue;if(c.startsWith("NOTE")||c.startsWith("STYLE")||c.startsWith("REGION")){for(;s<e.length;){const v=e[s];if(!v||v.trim()==="")break;s+=1}continue}if(!l.includes("-->"))continue;const[u,f]=l.split("-->");if(!u||!f)continue;const m=f.trim().split(/\s+/)[0];if(!m)continue;const g=Kl(u),y=Kl(m);if(g===null||y===null)continue;const w=[];for(let v=s+1;v<e.length;v+=1){const x=e[v];if(!x){s=v;break}const _=x.trim();if(!_){s=v;break}w.push(_),s=v}const T=w.join(" ").trim();if(!T)continue;const S={id:of(r.length,g),startMs:g,endMs:y,text:T};r.push(lf(S))}return r},hp=n=>{const e=n.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`),r=[];for(let s=0;s<e.length;s+=1){const a=e[s];if(!a)continue;const l=a.trim();if(!l||!l.includes("-->"))continue;const[c,u]=l.split("-->");if(!c||!u)continue;const f=u.trim().split(/\s+/)[0];if(!f)continue;const m=Kl(c),g=Kl(f);if(m===null||g===null)continue;const y=[];for(let S=s+1;S<e.length;S+=1){const v=e[S];if(!v){s=S;break}const x=v.trim();if(!x){s=S;break}y.push(x),s=S}const w=y.join(" ").trim();if(!w)continue;const T={id:of(r.length,m),startMs:m,endMs:g,text:w};r.push(lf(T))}return r},mp=n=>{const e=n.trim();return e?[{id:of(0,0),startMs:0,endMs:0,text:e}]:[]},pp=(n,e,r)=>{const s={id:C1(),createdAt:Date.now(),segments:n.map(lf)};return e&&(s.sourceAssetId=e),r&&(s.language=r),s},In=n=>{const e=Math.max(0,Math.floor(n/1e3)),r=Math.floor(e/60),s=e%60;return`${r}:${s.toString().padStart(2,"0")}`},so=n=>In(n),gp=500,P1=50,cd=.05,ao=2e3,E1=2,_1=[{id:"teaser_funnel",label:"Teaser / Funnel"},{id:"ctr_hook",label:"CTR / Hook-first"},{id:"value_evergreen",label:"Value / Evergreen"},{id:"community_personality",label:"Community / Personality"}],I1=[{id:"fast",label:"Fast (15-30s)"},{id:"default",label:"Default (25-45s)"},{id:"standard",label:"Standard (30-60s)"}],n0=(n,e,r)=>new Promise((s,a)=>{const l=()=>{u(),s()},c=()=>{u(),a(new Error(r))},u=()=>{n.removeEventListener(e,l),n.removeEventListener("error",c)};n.addEventListener(e,l,{once:!0}),n.addEventListener("error",c,{once:!0})}),A1=async n=>{n.readyState>=1||await n0(n,"loadedmetadata","Thumbnail metadata failed to load")},M1=async(n,e)=>{await A1(n);const r=Math.max(0,e/1e3);if(Math.abs(n.currentTime-r)>.01){const f=n0(n,"seeked","Thumbnail seek failed");n.currentTime=r,await f}const s=160,a=n.videoWidth>0&&n.videoHeight>0?n.videoWidth/n.videoHeight:16/9,l=Math.max(1,Math.round(s/a)),c=document.createElement("canvas");c.width=s,c.height=l;const u=c.getContext("2d");if(!u)throw new Error("Thumbnail canvas not available");return u.drawImage(n,0,0,s,l),c.toDataURL("image/jpeg",.72)},F1=n=>{if(!Number.isFinite(n)||n<=0)return"0 B";const e=["B","KB","MB","GB"];let r=n,s=0;for(;r>=1024&&s<e.length-1;)r/=1024,s+=1;return`${r.toFixed(r>=10||s===0?0:1)} ${e[s]}`},N1=n=>{const e=n.lastIndexOf(".");return e<=0?n:n.slice(0,e)},yp=n=>n==="image"?"Image":n==="audio"?"Audio":"Video",Rl=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`id_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,R1=n=>{const e=n.source.durationMs,r=n.edl?.cuts?.map(a=>({inMs:a.inMs,outMs:a.outMs}))??[],s=Ap(r,e);return{sourceAssetId:n.source.asset.assetId,sourceDurationMs:e,cuts:s,mode:"full"}},z1=(n,e)=>({sourceAssetId:n.source.asset.assetId,sourceDurationMs:n.source.durationMs,cuts:[],mode:"clip",clipRangeMs:{inMs:e.inMs,outMs:e.outMs}}),wp=(n,e)=>{if(n.length===0)return null;for(let r=0;r<n.length;r+=1){const s=n[r];if(!s)continue;const a=n[r+1]?.startMs,l=s.endMs>s.startMs?s.endMs:a??Number.POSITIVE_INFINITY;if(e>=s.startMs&&e<l)return s.id}return null};function B1({project:n,storage:e,onProjectUpdated:r,onBack:s}){const[a,l]=Y.useState(null),[c,u]=Y.useState("idle"),[f,m]=Y.useState(null),[g,y]=Y.useState("idle"),[w,T]=Y.useState(null),[S,v]=Y.useState(null),[x,_]=Y.useState("idle"),[A,O]=Y.useState(null),[B,j]=Y.useState("idle"),[L,q]=Y.useState(null),[G,se]=Y.useState(null),[oe,re]=Y.useState(!1),[ne,he]=Y.useState(null),[ze,Ze]=Y.useState("Xenova/whisper-base.en"),[Ne,Ce]=Y.useState(null),[Q,fe]=Y.useState(null),[X,N]=Y.useState(null),[V,ge]=Y.useState("idle"),[Pe,be]=Y.useState(null),[Ee,Oe]=Y.useState(null),[Ae,Ue]=Y.useState(null),[ut,Rn]=Y.useState(0),[aa,en]=Y.useState(!1),[Gn,ci]=Y.useState(null),[Gi,oa]=Y.useState(0),[Sr,la]=Y.useState(0),[ui,Xn]=Y.useState(0),[Xi,So]=Y.useState("webm"),[ca,vo]=Y.useState(!0),[nt,vr]=Y.useState("idle"),[Yn,ua]=Y.useState(null),[st,br]=Y.useState(null),[ec,bo]=Y.useState(null),[xo,tc]=Y.useState(0),[Yi,di]=Y.useState(null),[xr,da]=Y.useState("all"),[Cr,Pr]=Y.useState("newest"),[$t,Co]=Y.useState("transcript"),[Zn,Zi]=Y.useState("assets"),[fa,Po]=Y.useState("teaser_funnel"),[Ji,Eo]=Y.useState("default"),[tn,Er]=Y.useState([]),[Jn,es]=Y.useState("idle"),[_r,er]=Y.useState(null),fi=Y.useRef(null),ts=Y.useRef(null),_o=Y.useRef(null),nn=Y.useRef(null),Io=Y.useRef(null),zn=Y.useRef(null),hi=Y.useRef(new Map),Ir=Y.useRef([]),mi=Y.useRef(!1),yn=Y.useRef(new Map),Ar=Y.useRef(null),Mr=Y.useRef(null),St=Y.useMemo(()=>n.transcript?.segments??[],[n.transcript]),rn=Y.useMemo(()=>n.edl?.cuts??[],[n.edl]),ha=Y.useMemo(()=>n.splits??[],[n.splits]),je=Y.useMemo(()=>n.assets??[],[n.assets]),nc=30,ma=6e4,pa=St.length>0?St[St.length-1]:void 0,ns=pa?pa.endMs:0,rc=St.some(E=>E.text.trim().length>0),Ao=St.length>=nc&&ns>ma&&rc,pi=Y.useMemo(()=>{const E=xe=>xe.displayName??xe.name,D=(xe,We)=>E(xe).localeCompare(E(We)),W=(xe,We)=>We.createdAt.localeCompare(xe.createdAt),ee=(xe,We)=>xe.kind.localeCompare(We.kind),Le=[...xr==="all"?je:je.filter(xe=>xe.kind===xr)];return Cr==="newest"?Le.sort((xe,We)=>{const Mt=W(xe,We);if(Mt!==0)return Mt;const Kt=D(xe,We);return Kt!==0?Kt:xe.id.localeCompare(We.id)}):Cr==="name"?Le.sort((xe,We)=>{const Mt=D(xe,We);if(Mt!==0)return Mt;const Kt=W(xe,We);return Kt!==0?Kt:xe.id.localeCompare(We.id)}):Le.sort((xe,We)=>{const Mt=ee(xe,We);if(Mt!==0)return Mt;const Kt=D(xe,We);if(Kt!==0)return Kt;const _a=W(xe,We);return _a!==0?_a:xe.id.localeCompare(We.id)}),Le},[je,xr,Cr]),Rt=Ee?rn.find(E=>E.id===Ee)??null:null,gi=n.source.durationMs,Qt=Ap(rn.map(E=>({inMs:E.inMs,outMs:E.outMs})),gi),sn=Mp(gi,Qt),ic=!!f?.includes("IndexedDB open blocked"),ga=!!a&&c==="idle",yi=Q!==null&&X!==null&&X>Q&&X-Q>=gp&&X<=n.source.durationMs,wn=nt==="preparing"||nt==="encoding"||nt==="saving",Fr=nt==="preparing"?"Preparing...":nt==="encoding"?"Encoding...":nt==="saving"?"Saving...":nt==="done"?"Export ready":nt==="error"?"Export failed":"",wi=nt==="idle"?"Export: idle":nt==="preparing"?"Export: preparing":nt==="encoding"?"Export: encoding":nt==="saving"?"Export: saving":nt==="error"?`Export failed${Yn?`: ${Yn}`:""}`:nt==="done"&&st?`Export ready: ${st.filename}`:"Export status",sc=nt==="done"&&st?`Export ready: ${st.filename} (${so(st.durationMs)}, ${st.bytes} bytes, ${st.mime}, ${st.container})`:nt==="error"&&Yn?`Export failed: ${Yn}`:void 0,Mo={container:Xi,preset:"draft",includeAudio:ca},ya=!!Rt&&!wn,rt=Number.isFinite(gi)&&gi>0?gi:0,qt=E=>rt<=0?0:Math.min(Math.max(E,0),rt)/rt*100,an=Q!==null&&X!==null?{startMs:Math.min(Q,X),endMs:Math.max(Q,X)}:null,Fo=an&&an.endMs>an.startMs?{left:`${qt(an.startMs)}%`,width:`${qt(an.endMs)-qt(an.startMs)}%`}:void 0,wa={left:`${qt(ut)}%`},Me=Gn!==null?{left:`${qt(Gn)}%`}:void 0,ka=rt>0?Math.max(Sr,Math.ceil(rt*cd)):Sr,Ta=rt>0?Gi/cd:0,rs=rt>0?(Gi+Sr)/cd:0,is=Y.useMemo(()=>{if(rt<=0||Sr<=0)return[];const E=Math.max(0,Ta-ao),D=Math.min(rt,rs+ao),W=Math.floor(E/ao)*ao,ee=[];for(let Te=W;Te<=D&&(ee.push(Math.round(Te)),!(ee.length>120));Te+=ao);return ee},[rt,Ta,rs,Sr]);st&&(st.audioIncluded||ec?.includeAudio),st?.videoCodec&&(`${st.videoCodec}`,st.audioCodec&&`${st.audioCodec}`);const ss=B==="loading-model"||B==="transcribing",No=B==="idle"?"Idle":B==="loading-model"?"Downloading model":B==="transcribing"?"Transcribing":B==="done"?"Done":"Error",as=L!==null&&B==="loading-model"?`${Math.round(L*100)}%`:"",ki=ne?ne==="webgpu"?"WebGPU":"CPU":"",zt=!Ao,kn=zt?"No usable transcript yet. Generate Offline Transcript first.":"",Bn=St.length>0,Dn=[No];as&&Dn.push(as),ki&&Dn.push(ki),oe&&Dn.push("Cached");const Ti=Dn.filter(Boolean).join("  "),On=Bn?"Regenerate":"Generate transcript";Y.useEffect(()=>{let E=!1,D=null;return u("loading"),m(null),l(null),(async()=>{try{const ee=await e.getAsset(n.source.asset.assetId);if(E)return;D=URL.createObjectURL(ee),l(D),u("idle")}catch(ee){if(E)return;if(u("error"),ee instanceof Error)if(ee.message.includes("IndexedDB open blocked")){const Te=ee.message.match(/IndexedDB open blocked.*$/);m(Te?Te[0]:ee.message)}else ee.message.startsWith("Asset not found")?m("Source media not found on this device."):m("Unable to load source media.");else m("Unable to load source media.")}})(),()=>{E=!0,D&&URL.revokeObjectURL(D)}},[n.source.asset.assetId,xo,e]),Y.useEffect(()=>{const E=yn.current;return()=>{E.forEach(D=>URL.revokeObjectURL(D)),E.clear()}},[n.projectId]),Y.useEffect(()=>{const E=zn.current;if(!E)return;const D=()=>la(E.clientWidth);D();let W=null;return typeof ResizeObserver<"u"?(W=new ResizeObserver(D),W.observe(E)):window.addEventListener("resize",D),()=>{W?W.disconnect():window.removeEventListener("resize",D)}},[]),Y.useEffect(()=>{hi.current.clear(),Ir.current=[],mi.current=!1,Xn(E=>E+1)},[a]),Y.useEffect(()=>{},[n]),Y.useEffect(()=>{Ee&&!rn.some(E=>E.id===Ee)&&Oe(null)},[rn,Ee]),Y.useEffect(()=>{Ne&&!St.some(E=>E.id===Ne)&&Ce(null)},[Ne,St]),Y.useEffect(()=>{Er([]),es("idle"),er(null),j("idle"),q(null),se(null)},[n.projectId,n.transcript?.id]),Y.useEffect(()=>{if(!a)return;is.forEach(D=>{hi.current.has(D)||Ir.current.includes(D)||Ir.current.push(D)});const E=()=>{if(mi.current||Ir.current.length===0)return;mi.current=!0;const D=async()=>{const ee=Io.current;if(!ee){mi.current=!1;return}const Te=Ir.current.splice(0,E1);for(const Le of Te)try{const xe=await M1(ee,Le);hi.current.set(Le,xe),Xn(We=>We+1)}catch{}mi.current=!1,E()},W=globalThis;W.requestIdleCallback?W.requestIdleCallback(()=>{D()}):W.setTimeout(()=>{D()},0)};E()},[is,a]);const Nr=()=>{Ar.current!==null&&(window.clearTimeout(Ar.current),Ar.current=null)};Y.useEffect(()=>()=>{Nr()},[]),Y.useEffect(()=>()=>{Mr.current?.terminate(),Mr.current=null},[]);const Ro=async()=>{const E=nn.current;if(!(!E||!ga)){if(Nr(),!E.paused){E.pause();return}if(Ae===null&&sn.length>0){const D=E.currentTime*1e3;if(!sn.find(ee=>D>=ee.inMs&&D<ee.outMs)){const ee=sn.find(Te=>D<Te.inMs)??sn[0];if(!ee)return;E.currentTime=ee.inMs/1e3,Rn(ee.inMs)}}try{await E.play()}catch{en(!1)}}},Si=()=>{Nr(),en(!1)},ac=()=>{Nr(),en(!1)},zo=()=>{const E=nn.current;if(!E)return;let D=E.currentTime*1e3;if(Ae!==null&&D>=Ae)E.pause(),Ue(null),D=Ae;else if(Ae===null&&sn.length>0&&aa){const ee=sn.find(Te=>D>=Te.inMs&&D<Te.outMs);if(ee){if(D>=ee.outMs){const Te=sn.find(Le=>Le.inMs>=ee.outMs);Te?(D=Te.inMs,E.currentTime=Te.inMs/1e3):(D=ee.outMs,E.pause())}}else{const Te=sn.find(Le=>D<Le.inMs);if(Te)D=Te.inMs,E.currentTime=Te.inMs/1e3;else{const Le=sn[sn.length-1];Le&&(D=Le.outMs),E.pause()}}}Rn(D);const W=wp(St,D);Ce(W)},os=()=>{fi.current?.click()},Bo=async E=>{const D=E.currentTarget.files?.[0];if(D){y("loading"),T(null),v(D.name);try{const W=await e.relinkSource(n.projectId,D);r(W),y("idle")}catch(W){y("error"),T(W instanceof Error?W.message:"Unable to relink source.")}finally{E.currentTarget.value=""}}},oc=()=>{ts.current?.click()},vi=(E,D)=>{const W=E.toLowerCase();let ee=[];if(W.endsWith(".vtt")?ee=fp(D):W.endsWith(".srt")?ee=hp(D):W.endsWith(".txt")?ee=mp(D):(ee=fp(D),ee.length===0&&(ee=hp(D)),ee.length===0&&(ee=mp(D))),ee.length===0)throw new Error("Couldn't parse transcript (VTT/SRT/TXT).");return pp(ee,n.source.asset.assetId)},tr=async E=>{await e.setTranscript(n.projectId,E);const D=await e.loadProject(n.projectId);r(D)},Rr=async E=>{const D=E.currentTarget.files?.[0];if(D){_("loading"),O(null);try{const W=await D.text(),ee=vi(D.name,W);await tr(ee),_("idle")}catch(W){_("error"),O(W instanceof Error?W.message:"Unable to import transcript.")}finally{E.currentTarget.value=""}}},ls=E=>{const D=nn.current;D&&(D.currentTime=E.startMs/1e3,D.play().catch(()=>{en(!1)}))},lc=()=>(Mr.current||(Mr.current=Hy()),Mr.current),cc=E=>{j(E.phase),E.phase==="loading-model"?q(E.progress??null):q(null),typeof E.cached=="boolean"&&re(E.cached),E.device&&he(E.device),E.phase==="error"&&se(E.message??"Offline transcription failed.")},Sa=E=>{const D=E.segments.map((W,ee)=>{const Te=W.text.trim();if(!Te)return null;const Le=Math.max(0,Math.round(W.start*1e3)),xe=Math.max(Le,Math.round(W.end*1e3));return{id:`asr_${ee}_${Le}`,startMs:Le,endMs:xe,text:Te}}).filter(Boolean);return pp(D,n.source.asset.assetId,"en")},cs=async()=>{if(!ss){_("loading"),O(null),j("loading-model"),q(0),se(null);try{await tr();const E=await e.getAsset(n.source.asset.assetId),D=await Vy(E,16e3),ee=await lc().transcribe(D.samples,D.sampleRate,{model:ze},cc),Te=Sa(ee);if(Te.segments.length===0)throw new Error("Offline transcription returned no segments.");await tr(Te),_("idle"),O(null),j("done"),se(null),ee.cached&&re(!0),ee.device&&he(ee.device)}catch(E){_("error"),O(E instanceof Error?E.message:"Offline transcription failed."),j("error"),se(E instanceof Error?E.message:"Offline transcription failed.")}}},va=E=>{const D=E.trim(),W=D?`Short: ${D}`:"Short";return W.length<=60?W:`${W.slice(0,57).trim()}...`},Do=(E,D,W)=>W.some(ee=>Math.abs(ee.inMs-E)<250&&Math.abs(ee.outMs-D)<250),Un=()=>{if(!n.transcript||zt){er(kn||"No usable transcript yet. Generate Offline Transcript first."),Er([]);return}es("loading"),er(null);try{const E=S1(n.transcript,fa,Ji,20);Er(E),es("idle")}catch(E){es("error"),er(E instanceof Error?E.message:"Unable to generate suggestions.")}},ba=async E=>{const D=nn.current;if(!D)return;Nr(),Ue(E.endMs),D.currentTime=E.startMs/1e3,Rn(E.startMs);try{await D.play()}catch{en(!1)}const W=Math.max(0,E.endMs-E.startMs);Ar.current=window.setTimeout(()=>{const ee=nn.current;ee&&ee.pause(),Ue(null),Ar.current=null},W)},us=E=>{Er(D=>D.filter(W=>W.id!==E))},xa=async E=>{if(E.length!==0){ge("loading"),be(null);try{const D=[...rn];if(E.forEach(ee=>{Do(ee.startMs,ee.endMs,D)||D.push({id:Rl(),inMs:ee.startMs,outMs:ee.endMs,label:va(ee.title)})}),D.length===rn.length){ge("idle");return}const W=await e.setCuts(n.projectId,D);r(W),ge("idle")}catch(D){ge("error"),be(D instanceof Error?D.message:"Unable to save cut.")}}},ds=async E=>{await xa([E])},fs=async()=>{const E=tn.slice(0,5);await xa(E)},zr=E=>{const D=nn.current;if(!D)return;const W=rt>0?Math.min(Math.max(E,0),rt):E;D.currentTime=W/1e3,Rn(W),Ce(wp(St,W))},At=E=>{const D=E.currentTarget;if(rt<=0){ci(null);return}const W=D.getBoundingClientRect();if(W.width<=0){ci(null);return}const ee=Math.min(Math.max(E.clientX-W.left,0),W.width);ci(ee/W.width*rt)},Br=()=>{ci(null)},Ca=E=>{const D=E.currentTarget;if(rt<=0)return;const W=D.getBoundingClientRect();if(W.width<=0)return;const ee=Math.min(Math.max(E.clientX-W.left,0),W.width);zr(ee/W.width*rt)},bi=()=>{const E=nn.current,D=E?Math.round(E.currentTime*1e3):ut;fe(D),X!==null&&X<=D&&N(null)},uc=()=>{const E=nn.current,D=E?Math.round(E.currentTime*1e3):ut;N(D)},Pa=async(E,D)=>{if(D<=E){be("Cut range must be at least 0.5s.");return}ge("loading"),be(null);try{const W=[...rn,{id:Rl(),inMs:E,outMs:D}],ee=await e.setCuts(n.projectId,W);r(ee),ge("idle")}catch(W){ge("error"),be(W instanceof Error?W.message:"Unable to save cut.")}},Ea=async E=>{if(rt<=0)return;const D=Math.min(Math.max(E,0),rt);if(!ha.some(W=>Math.abs(W.tMs-D)<=P1)){ge("loading"),be(null);try{const W=[...ha,{id:Rl(),tMs:D,kind:"manual"}];W.sort((Te,Le)=>Te.tMs-Le.tMs);const ee=await e.setSplits(n.projectId,W);r(ee),ge("idle")}catch(W){ge("error"),be(W instanceof Error?W.message:"Unable to save split.")}}},xi=async()=>{if(!yi||Q===null||X===null){be("Mark in/out needs at least 0.5s and must be within duration.");return}await Pa(Q,X),fe(null),N(null)},hs=async E=>{ge("loading"),be(null);try{const D=rn.filter(ee=>ee.id!==E),W=await e.setCuts(n.projectId,D);r(W),ge("idle")}catch(D){ge("error"),be(D instanceof Error?D.message:"Unable to delete cut.")}},Oo=async E=>{const D=nn.current;if(D){Nr(),Ue(E.outMs),D.currentTime=E.inMs/1e3,Rn(E.inMs);try{await D.play()}catch{en(!1)}}},Uo=async E=>{vr("preparing"),ua(null),br(null),bo(Mo);try{const D=await JS(E,e,Mo,W=>{vr(W)});br(D),vr("done")}catch(D){vr("error"),ua(D instanceof Error?D.message:"Export failed.")}},dc=async()=>{if(wn)return;const E=R1(n);await Uo(E)},fc=async()=>{if(!Rt||wn)return;const E=z1(n,Rt);await Uo(E)},Ci=async(E,D)=>{di(null);try{const W=await e.setAssets(n.projectId,E);r(W)}catch(W){throw di(W instanceof Error?W.message:D),W}},hc=()=>{_o.current?.click()},mc=async E=>{const D=Array.from(E.currentTarget.files??[]);if(D.length===0)return;di(null);const W=new Date().toISOString(),ee=D.map(Te=>{const Le=Te.type.startsWith("image/")?"image":Te.type.startsWith("audio/")?"audio":"video",xe=Rl(),We=URL.createObjectURL(Te),Mt=yn.current.get(xe);Mt&&URL.revokeObjectURL(Mt),yn.current.set(xe,We);const Kt=N1(Te.name).trim();return{id:xe,kind:Le,name:Te.name,...Kt?{displayName:Kt}:{},size:Te.size,mime:Te.type,createdAt:W}});try{await Ci([...je,...ee],"Unable to import assets.")}catch{ee.forEach(Te=>{const Le=yn.current.get(Te.id);Le&&(URL.revokeObjectURL(Le),yn.current.delete(Te.id))})}finally{E.currentTarget.value=""}},pc=async E=>{const D=yn.current.get(E);D&&(URL.revokeObjectURL(D),yn.current.delete(E));const W=je.filter(ee=>ee.id!==E);await Ci(W,"Unable to remove asset.")},gc=async E=>{const D=E.displayName??E.name,W=window.prompt("Rename asset",D);if(W===null)return;const ee=W.trim();if(!ee)return;const Te=ee.slice(0,60);if(Te===D)return;const Le=je.map(xe=>{if(xe.id!==E.id)return xe;if(Te===xe.name){const{displayName:We,...Mt}=xe;return Mt}return{...xe,displayName:Te}});await Ci(Le,"Unable to rename asset.")};return C.jsxs("div",{className:"hm-editor",children:[C.jsxs("div",{className:"hm-topbar",children:[C.jsxs("div",{className:"hm-topbar-left",children:[C.jsx("button",{className:"hm-button hm-button--ghost hm-button--compact",onClick:s,children:"Back"}),C.jsxs("div",{className:"hm-title-block",children:[C.jsx("div",{className:"hm-project-title",children:n.title??"Untitled project"}),C.jsx("div",{className:"hm-project-subtitle",children:n.source.filename})]})]}),C.jsxs("div",{className:"hm-topbar-center",children:[C.jsx("button",{className:"hm-button hm-button--ghost hm-button--compact",onClick:Ro,disabled:!ga,children:aa?"Pause":"Play"}),C.jsx("div",{className:"hm-timecode",children:In(ut)})]}),C.jsxs("div",{className:"hm-topbar-right",children:[C.jsxs("div",{className:"hm-export-controls",children:[C.jsxs("label",{className:"export-field",children:[C.jsx("span",{className:"export-field-label",children:"Format"}),C.jsxs("select",{value:Xi,onChange:E=>So(E.target.value),disabled:wn,"aria-label":"Export format",title:"MP4 export is coming soon",children:[C.jsx("option",{value:"webm",children:"WebM (Fast)"}),C.jsx("option",{value:"mp4",disabled:!0,children:"MP4 (Coming soon)"})]})]}),C.jsxs("label",{className:"export-field",children:[C.jsx("span",{className:"export-field-label",children:"Audio"}),C.jsx("input",{type:"checkbox",checked:ca,onChange:E=>vo(E.target.checked),disabled:wn})]}),C.jsx("button",{className:"hm-button hm-button--compact",onClick:dc,disabled:wn,children:"Export Full"}),C.jsx("button",{className:"hm-button hm-button--ghost hm-button--compact",onClick:fc,disabled:!ya,children:"Export Cut"})]}),Fr&&C.jsx("div",{className:"hm-export-status",children:Fr})]}),C.jsx("input",{id:"relink-source-input",ref:fi,type:"file",accept:"video/*",onChange:Bo,hidden:!0,"aria-label":"Re-link source media file",title:"Re-link source media file"}),C.jsx("input",{ref:ts,type:"file",accept:".vtt,.srt,.txt,text/plain",onChange:Rr,hidden:!0,"aria-label":"Import transcript",title:"Import transcript"}),C.jsx("input",{ref:_o,type:"file",accept:"image/*,video/*,audio/*",multiple:!0,onChange:mc,hidden:!0,"aria-label":"Import assets",title:"Import assets"})]}),C.jsxs("aside",{className:"hm-leftrail",children:[C.jsxs("div",{className:"hm-leftrail-tabs",children:[C.jsx("button",{className:`hm-tab${$t==="transcript"?" active":""}`,type:"button",onClick:()=>Co("transcript"),children:"Transcript"}),C.jsx("button",{className:`hm-tab${$t==="retakes"?" active":""}`,type:"button",disabled:!0,children:"Retakes"}),C.jsx("button",{className:`hm-tab${$t==="shorts"?" active":""}`,type:"button",disabled:!0,children:"Shorts"}),C.jsx("button",{className:`hm-tab${$t==="captions"?" active":""}`,type:"button",disabled:!0,children:"Captions"}),C.jsx("button",{className:`hm-tab${$t==="assets"?" active":""}`,type:"button",disabled:!0,children:"Assets"}),C.jsx("button",{className:`hm-tab${$t==="templates"?" active":""}`,type:"button",disabled:!0,children:"Templates"})]}),C.jsx("div",{className:"hm-leftrail-panels",children:C.jsxs("section",{className:"hm-panel hm-panel--cuts",children:[C.jsx("div",{className:"hm-panel-header",children:C.jsx("h2",{className:"hm-panel-title",children:"Cuts"})}),C.jsxs("div",{className:"hm-panel-body",children:[C.jsxs("div",{className:"cuts-marks",children:[C.jsxs("div",{children:["In: ",Q!==null?In(Q):"-"]}),C.jsxs("div",{children:["Out: ",X!==null?In(X):"-"]}),C.jsxs("div",{children:["Min: ",so(gp)]})]}),Pe&&C.jsxs("p",{className:"stacked-gap",children:["Cut error: ",Pe]}),rn.length===0?C.jsx("p",{className:"muted stacked-gap-lg",children:"No cuts yet. Mark in/out and add one."}):C.jsx("div",{className:"cuts-list",children:rn.map(E=>C.jsxs("div",{className:`cut-row${E.id===Ee?" selected":""}`,onClick:()=>Oe(E.id),children:[C.jsxs("div",{className:"cut-info",children:[C.jsxs("div",{className:"cut-times",children:[In(E.inMs)," -"," ",In(E.outMs)]}),C.jsxs("div",{className:"cut-duration",children:["Duration: ",so(E.outMs-E.inMs)]})]}),C.jsxs("div",{className:"cut-actions",children:[C.jsx("button",{className:"hm-button hm-button--ghost",onClick:D=>{D.stopPropagation(),Oo(E)},children:"Play"}),C.jsx("button",{className:"hm-button hm-button--ghost",onClick:D=>{D.stopPropagation(),hs(E.id)},children:"Delete"})]})]},E.id))})]})]})})]}),C.jsx("main",{className:"hm-stage",children:C.jsxs("div",{className:"hm-stage-inner",children:[c==="loading"&&C.jsx("div",{className:"hm-stage-card",children:"Loading video..."}),c==="error"&&C.jsxs("div",{className:"hm-stage-card",children:[C.jsx("p",{children:f??"Source media not found on this device."}),C.jsxs("p",{className:"muted stacked-gap",children:["Stored source: ",n.source.filename]}),S&&C.jsxs("p",{className:"muted stacked-gap",children:["Selected file: ",S]}),C.jsx("button",{className:"hm-button",onClick:os,disabled:g==="loading",children:"Re-link source file"}),g==="error"&&C.jsxs("p",{className:"stacked-gap",children:["Re-link failed: ",w]}),g==="loading"&&C.jsx("p",{className:"stacked-gap",children:"Re-linking..."}),ic&&C.jsx("button",{className:"hm-button hm-button--ghost",onClick:()=>tc(E=>E+1),disabled:g==="loading",children:"Retry load"})]}),a&&C.jsx("video",{ref:nn,controls:!0,src:a,onTimeUpdate:zo,onPlay:()=>en(!0),onPause:Si,onEnded:ac,className:"hm-stage-video"}),C.jsx("video",{ref:Io,className:"hm-thumb-video",src:a??void 0,muted:!0,playsInline:!0,preload:"auto"})]})}),C.jsxs("aside",{className:"hm-assetbin","aria-label":"Assets",children:[C.jsxs("div",{className:"hm-assetbinHeader",children:[C.jsxs("div",{className:"hm-rightTabs",children:[C.jsx("button",{className:`hm-tab${Zn==="assets"?" active":""}`,type:"button",onClick:()=>Zi("assets"),children:"Assets"}),C.jsx("button",{className:`hm-tab${Zn==="transcript"?" active":""}`,type:"button",onClick:()=>Zi("transcript"),children:"Transcript"}),C.jsx("button",{className:`hm-tab${Zn==="shorts"?" active":""}`,type:"button",onClick:()=>Zi("shorts"),children:"Shorts"})]}),C.jsx("div",{className:"hm-assetbinActions",children:Zn==="assets"&&C.jsx("button",{className:"hm-button hm-button--compact",onClick:hc,children:"Import"})})]}),C.jsx("div",{className:"hm-assetbinBody",children:Zn==="assets"?C.jsxs(C.Fragment,{children:[Yi&&C.jsx("div",{className:"hm-asset-error",children:Yi}),C.jsxs("div",{className:"hm-asset-controls",children:[C.jsx("div",{className:"hm-asset-filters",children:["all","video","audio","image"].map(E=>C.jsx("button",{type:"button",className:`hm-asset-filter${xr===E?" active":""}`,onClick:()=>da(E),children:E==="all"?"All":E==="image"?"Images":yp(E)},E))}),C.jsxs("label",{className:"hm-asset-sort",children:[C.jsx("span",{children:"Sort"}),C.jsxs("select",{value:Cr,onChange:E=>Pr(E.target.value),children:[C.jsx("option",{value:"newest",children:"Newest"}),C.jsx("option",{value:"name",children:"Name"}),C.jsx("option",{value:"type",children:"Type"})]})]})]}),pi.length===0?C.jsx("div",{className:"hm-empty",children:"Drop images, B-roll, intro/outro here."}):C.jsx("div",{className:"hm-asset-list",children:pi.map(E=>{const D=yn.current.get(E.id),W=E.displayName??E.name;return C.jsxs("div",{className:"hm-asset-card",children:[C.jsx("div",{className:"hm-asset-thumb",children:D&&E.kind==="image"?C.jsx("img",{src:D,alt:E.name}):C.jsx("div",{className:"hm-asset-thumb-fallback",children:E.kind==="video"?"VIDEO":E.kind==="audio"?"AUDIO":"IMAGE"})}),C.jsxs("div",{className:"hm-asset-info",children:[C.jsx("div",{className:"hm-asset-name",title:W,children:W}),W!==E.name&&C.jsx("div",{className:"hm-asset-filename",title:E.name,children:E.name}),C.jsxs("div",{className:"hm-asset-meta",children:[yp(E.kind)," "," ",F1(E.size)]}),C.jsxs("div",{className:"hm-asset-actions",children:[C.jsx("button",{className:"hm-asset-action",type:"button",onClick:()=>void gc(E),children:"Rename"}),C.jsx("button",{className:"hm-asset-action hm-asset-action--danger",type:"button",onClick:()=>void pc(E.id),children:"Remove"})]})]})]},E.id)})})]}):Zn==="transcript"?C.jsxs("section",{className:"hm-right-panel",children:[C.jsxs("div",{className:"hm-panel-header",children:[C.jsxs("div",{className:"hm-panel-titleRow",children:[C.jsx("h2",{className:"hm-panel-title",children:"Transcript"}),C.jsxs("span",{className:"hm-panel-count",children:[St.length," segments"]})]}),C.jsxs("div",{className:"hm-transcript-controls",children:[C.jsx("div",{className:"hm-transcript-status",children:C.jsx("span",{className:"hm-transcript-pill",children:Ti})}),C.jsxs("label",{className:"hm-transcript-model",children:[C.jsx("span",{children:"Model"}),C.jsx("select",{value:ze,onChange:E=>Ze(E.target.value),disabled:ss,children:C.jsx("option",{value:"Xenova/whisper-base.en",children:"Xenova/whisper-base.en"})})]}),C.jsxs("div",{className:"hm-panel-actions",children:[C.jsx("button",{className:"hm-button hm-button--ghost",onClick:oc,disabled:x==="loading",children:"Import transcript"}),C.jsx("button",{className:"hm-button",onClick:cs,disabled:x==="loading"||ss,children:On})]})]})]}),C.jsxs("div",{className:"hm-panel-body hm-transcript-body",children:[B==="loading-model"&&C.jsx("div",{className:"hm-transcript-progress",children:C.jsx("div",{className:"hm-transcript-progressFill",style:{width:`${Math.round((L??0)*100)}%`}})}),G&&C.jsx("div",{className:"hm-transcript-error",children:G}),x==="error"&&C.jsxs("p",{className:"stacked-gap",children:["Transcript error: ",A]}),x==="loading"&&C.jsx("p",{className:"muted stacked-gap",children:"Importing transcript..."}),St.length===0?C.jsx("div",{className:"hm-transcript-empty",children:C.jsx("p",{className:"muted stacked-gap-lg",children:"No transcript yet. Generate an offline transcript to get started."})}):C.jsx("div",{className:"transcript-list",children:St.map(E=>{const D=E.id===Ne,ee=E.endMs>E.startMs?`${In(E.startMs)} - ${In(E.endMs)}`:In(E.startMs);return C.jsxs("button",{onClick:()=>ls(E),className:`transcript-segment${D?" active":""}`,children:[C.jsx("div",{className:"transcript-timestamp",children:ee}),C.jsx("div",{className:"transcript-text",children:E.text})]},E.id)})})]})]}):C.jsxs("section",{className:"hm-right-panel hm-shorts-panel",children:[C.jsx("div",{className:"hm-panel-header",children:C.jsxs("div",{className:"hm-panel-titleRow",children:[C.jsx("h2",{className:"hm-panel-title",children:"Shorts"}),C.jsxs("span",{className:"hm-panel-count",children:[tn.length," suggestions"]})]})}),C.jsxs("div",{className:"hm-panel-body",children:[C.jsxs("div",{className:"hm-shorts-controls",children:[C.jsx("div",{className:"hm-shorts-intents",children:_1.map(E=>C.jsx("button",{type:"button",className:`hm-short-intent${fa===E.id?" active":""}`,onClick:()=>Po(E.id),children:E.label},E.id))}),C.jsxs("div",{className:"hm-shorts-actions",children:[C.jsxs("label",{className:"hm-shorts-select",children:[C.jsx("span",{children:"Length"}),C.jsx("select",{value:Ji,onChange:E=>Eo(E.target.value),children:I1.map(E=>C.jsx("option",{value:E.id,children:E.label},E.id))})]}),C.jsx("button",{className:"hm-button hm-button--compact",onClick:Un,disabled:Jn==="loading"||zt,children:Jn==="loading"?"Generating...":"Generate"}),tn.length>0&&C.jsx("button",{className:"hm-button hm-button--ghost hm-button--compact",onClick:fs,disabled:V==="loading",children:"Create Top 5 Draft Cuts"})]})]}),zt&&C.jsx("p",{className:"hm-short-warning",children:kn}),_r&&C.jsx("p",{className:"hm-short-warning hm-short-warning--error",children:_r}),!zt&&tn.length===0&&Jn==="idle"&&C.jsx("p",{className:"muted stacked-gap-lg",children:"No suggestions yet. Generate to get started."}),tn.length>0&&C.jsx("div",{className:"hm-short-list",children:tn.map(E=>{const D=E.endMs-E.startMs;return C.jsxs("div",{className:"hm-short-card",children:[C.jsxs("div",{className:"hm-short-header",children:[C.jsx("div",{className:"hm-short-title",title:E.title,children:E.title}),C.jsxs("div",{className:"hm-short-score",children:["Score ",E.score]})]}),C.jsx("div",{className:"hm-short-hook",children:E.hook}),C.jsxs("div",{className:"hm-short-meta",children:[C.jsx("span",{children:so(D)}),C.jsxs("span",{children:[In(E.startMs)," -"," ",In(E.endMs)]})]}),C.jsx("div",{className:"hm-short-reasons",children:E.reasonTags.map(W=>C.jsx("span",{className:"hm-short-reason",children:W},W))}),C.jsxs("div",{className:"hm-short-actions",children:[C.jsx("button",{type:"button",className:"hm-button hm-button--ghost hm-button--compact",onClick:()=>void ba(E),disabled:!ga,children:"Preview"}),C.jsx("button",{type:"button",className:"hm-button hm-button--compact",onClick:()=>void ds(E),disabled:V==="loading",children:"Create Draft Cut"}),C.jsx("button",{type:"button",className:"hm-button hm-button--ghost hm-button--compact",onClick:()=>us(E.id),children:"Dismiss"})]})]},E.id)})})]})]})})]}),C.jsxs("div",{className:"hm-timeline",children:[C.jsx("div",{className:"hm-timelineToolbar",children:C.jsxs("div",{className:"hm-timelineActions",children:[C.jsxs("div",{className:"hm-timelineActionGroup",children:[C.jsx("button",{className:"hm-button hm-button--ghost hm-button--compact",onClick:bi,disabled:V==="loading",children:"Mark In"}),C.jsx("button",{className:"hm-button hm-button--ghost hm-button--compact",onClick:uc,disabled:V==="loading",children:"Mark Out"})]}),C.jsx("button",{className:"hm-button hm-button--compact",onClick:xi,disabled:V==="loading"||!yi,children:"Add Cut"})]})}),C.jsx("div",{className:"hm-placementLane","aria-label":"Placement lane",children:C.jsxs("div",{className:"hm-placementTrack",style:{width:ka,transform:`translateX(${-Gi}px)`},children:[C.jsx("div",{className:"hm-placementRail"}),C.jsx("div",{className:"hm-placementEmpty",children:"Drop assets here"})]})}),C.jsx("div",{className:"hm-timeline-track",children:C.jsx("div",{className:"hm-timelineScroll",ref:zn,onScroll:E=>oa(E.currentTarget.scrollLeft),children:C.jsx("div",{className:"hm-timelineCanvas",style:{width:ka},children:C.jsxs("div",{className:"hm-timeline-rail",onMouseMove:At,onMouseLeave:Br,onClick:Ca,role:"slider","aria-label":"Timeline",children:[C.jsx("div",{className:"hm-timelineThumbLayer","aria-hidden":"true",children:is.map(E=>{const D=hi.current.get(E),W=D?"hm-timelineThumb":"hm-timelineThumb hm-timelineThumb--empty";return C.jsx("div",{className:W,style:{left:`${qt(E)}%`,backgroundImage:D?`url(${D})`:void 0}},`${E}-${ui}`)})}),Fo&&C.jsx("div",{className:"hm-timeline-range",style:Fo}),Me&&C.jsx("div",{className:"hm-timeline-ghost",style:Me}),ha.map(E=>C.jsx("button",{type:"button",className:"hm-split",style:{left:`${qt(E.tMs)}%`},onClick:D=>{D.stopPropagation(),zr(E.tMs)},"aria-label":"Jump to split",title:"Jump to split"},E.id)),Q!==null&&C.jsx("button",{type:"button",className:"hm-marker hm-marker--in",style:{left:`${qt(Q)}%`},onClick:E=>{E.stopPropagation(),zr(Q)},"aria-label":"Jump to In marker",title:"Jump to In marker"}),X!==null&&C.jsx("button",{type:"button",className:"hm-marker hm-marker--out",style:{left:`${qt(X)}%`},onClick:E=>{E.stopPropagation(),zr(X)},"aria-label":"Jump to Out marker",title:"Jump to Out marker"}),C.jsx("div",{className:"hm-timeline-playhead",style:wa}),Me&&C.jsx("button",{type:"button",className:"hm-scissor",style:Me,onClick:E=>{E.stopPropagation(),Gn!==null&&(zr(Gn),Ea(Gn))},disabled:V==="loading","aria-label":"Split at playhead",title:"Split at playhead",children:C.jsxs("svg",{viewBox:"0 0 16 16","aria-hidden":"true",focusable:"false",children:[C.jsx("circle",{cx:"4",cy:"4",r:"2",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),C.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),C.jsx("line",{x1:"6",y1:"6",x2:"14",y2:"2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),C.jsx("line",{x1:"6",y1:"10",x2:"14",y2:"14",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})})]})})})}),C.jsxs("div",{className:"hm-timeline-footer",children:[C.jsxs("div",{className:"hm-timeline-meta",children:["Duration: ",so(n.source.durationMs)," |"," ",n.source.width,"x",n.source.height," | Updated:"," ",new Date(n.updatedAt).toLocaleString()]}),C.jsx("div",{className:"hm-timeline-footer-right",children:nt==="idle"?C.jsx("span",{className:"hm-export-idle",children:wi}):C.jsxs("span",{className:`hm-export-pill${nt==="error"?" hm-export-pill--error":""}`,title:sc,children:[wi,""]})})]})]})]})}function D1({onNewProject:n,onOpenProject:e}){return C.jsxs("header",{className:"hub-header",children:[C.jsxs("div",{className:"hub-header-copy",children:[C.jsx("h1",{children:"Welcome to Hammer"}),C.jsx("p",{children:"Organize and review your media before you edit."})]}),C.jsxs("div",{className:"hub-header-actions",children:[C.jsx("button",{type:"button",onClick:n,children:"New Project"}),C.jsx("button",{type:"button",className:"ghost",onClick:e,children:"Open Project"})]})]})}const O1=[{id:"start",label:"Start"},{id:"templates",label:"Templates"},{id:"tools",label:"Tools"}];function U1({active:n,onSelect:e,header:r}){return C.jsxs("aside",{className:"hub-leftnav",children:[C.jsxs("div",{className:"hub-brand",children:[C.jsx("span",{className:"hub-brand-mark",children:"Hammer"}),C.jsx("span",{className:"hub-brand-subtitle",children:"Project Hub"})]}),r,C.jsx("nav",{className:"hub-nav","aria-label":"Project hub navigation",children:O1.map(s=>C.jsx("button",{type:"button",className:`hub-nav-item${n===s.id?" active":""}`,onClick:()=>e?.(s.id),disabled:s.id!=="start",children:s.label},s.id))})]})}const L1=n=>{if(!n||n<=0)return"--:--";const e=Math.floor(n/1e3),r=Math.floor(e/60),s=e%60;return`${r}:${s.toString().padStart(2,"0")}`},j1=n=>{const e=new Date(n);return Number.isNaN(e.getTime())?"Unknown":e.toLocaleString()};function kp({project:n,onOpen:e,onDelete:r}){const s="/assets/blhammer1.png",a=!n.thumbnailAssetId,l=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),e(n.projectId))};return C.jsxs("div",{className:"project-card",role:"button",tabIndex:0,onClick:()=>e(n.projectId),onKeyDown:l,children:[C.jsx("div",{className:`project-thumb${a?" project-thumb--placeholder":""}`,children:C.jsx("img",{src:s,alt:""})}),C.jsxs("div",{className:"project-card-body",children:[C.jsx("div",{className:"project-title",children:n.title}),C.jsxs("div",{className:"project-meta",children:["Last edited: ",j1(n.updatedAt)]}),C.jsxs("div",{className:"project-meta",children:["Duration: ",L1(n.durationMs),typeof n.cutsCount=="number"?`  Cuts: ${n.cutsCount}`:""]})]}),r&&C.jsx("div",{className:"project-card-actions",children:C.jsx("button",{type:"button",className:"ghost",onClick:c=>{c.stopPropagation(),r(n.projectId,n.title)},children:"Delete"})})]})}function V1({projects:n,onOpen:e,onDelete:r}){return C.jsx("div",{className:"hub-grid",children:n.map(s=>{const a={project:s,onOpen:e};return r?C.jsx(kp,{...a,onDelete:r},s.projectId):C.jsx(kp,{...a},s.projectId)})})}const W1=n=>{const e={projectId:n.projectId,title:n.title??n.filename,updatedAt:n.updatedAt,durationMs:n.durationMs,cutsCount:n.cutsCount,splitsCount:n.splitsCount,assetsCount:n.assetsCount};return n.thumbnailAssetId&&(e.thumbnailAssetId=n.thumbnailAssetId),e},H1=n=>{const e=n.lastIndexOf(".");return e<=0?n:n.slice(0,e)};function $1({storage:n,onOpenProject:e}){const[r,s]=Y.useState([]),[a,l]=Y.useState("idle"),[c,u]=Y.useState(null),[f,m]=Y.useState(!1),[g,y]=Y.useState(""),[w,T]=Y.useState(null),[S,v]=Y.useState("idle"),[x,_]=Y.useState(null),A=Y.useRef(null),O=Y.useRef(null),B=async()=>{l("loading"),u(null);try{const ne=await n.listProjects();ne.sort((he,ze)=>he.updatedAt<ze.updatedAt?1:-1),s(ne),l("idle")}catch(ne){l("error"),u(ne instanceof Error?ne.message:"Unknown error")}};Y.useEffect(()=>{B()},[]);const j=()=>{m(!0),_(null)},L=()=>{O.current?.scrollIntoView({behavior:"smooth",block:"start"})},q=ne=>{const he=ne.currentTarget.files?.[0]??null;T(he),he&&!g.trim()&&y(H1(he.name))},G=async ne=>{if(ne.preventDefault(),!w){_("Choose a media file to import.");return}v("creating"),_(null);try{const he=g.trim(),ze=await x1(w,n,he.length?he:void 0);e(ze.projectId),m(!1),T(null),y(""),A.current&&(A.current.value="")}catch(he){v("error"),_(he instanceof Error?he.message:"Unable to create project")}finally{B()}},se=ne=>{e(ne)},oe=async(ne,he)=>{if(window.confirm(`Delete project "${he}"?`))try{await n.deleteProject(ne),await B()}catch(Ze){l("error"),u(Ze instanceof Error?Ze.message:"Unknown error")}},re=r.map(W1);return C.jsxs("div",{className:"hub-shell",children:[C.jsx(U1,{active:"start"}),C.jsxs("div",{className:"hub-main",children:[C.jsx(D1,{onNewProject:j,onOpenProject:L}),f&&C.jsx("section",{className:"hub-create","aria-label":"Create new project",children:C.jsxs("form",{className:"hub-form",onSubmit:G,children:[C.jsxs("label",{className:"hub-field",children:[C.jsx("span",{children:"Project name"}),C.jsx("input",{type:"text",value:g,onChange:ne=>y(ne.target.value),placeholder:"Untitled project"})]}),C.jsxs("label",{className:"hub-field",children:[C.jsx("span",{children:"Import media file"}),C.jsx("input",{ref:A,type:"file",accept:"video/*",onChange:q})]}),C.jsxs("div",{className:"hub-form-actions",children:[C.jsx("button",{type:"submit",disabled:S==="creating",children:S==="creating"?"Creating...":"Create project"}),C.jsx("button",{type:"button",className:"ghost",onClick:()=>m(!1),disabled:S==="creating",children:"Cancel"})]}),x&&C.jsx("p",{className:"hub-error",children:x})]})}),C.jsxs("section",{className:"hub-library",ref:O,children:[C.jsxs("div",{className:"hub-library-header",children:[C.jsx("h2",{children:"Project Library"}),a==="loading"&&C.jsx("span",{className:"hub-muted",children:"Loading..."}),a==="error"&&C.jsx("span",{className:"hub-error",children:c})]}),re.length===0&&a!=="loading"?C.jsxs("div",{className:"hub-empty",children:[C.jsx("img",{src:"/assets/blhammer1.png",alt:"Hammer icon",className:"hub-empty-image"}),C.jsxs("div",{children:[C.jsx("h3",{children:"Welcome to Hammer"}),C.jsx("p",{children:"Start a new project to begin organizing your media."})]})]}):C.jsx(V1,{projects:re,onOpen:se,onDelete:oe})]})]})]})}const ud=n=>{const e=n.replace(/\/+$/,"");if(e.startsWith("/editor/")){const r=decodeURIComponent(e.slice(8));if(r)return{kind:"editor",projectId:r}}return{kind:"hub"}},Q1=()=>{const[n,e]=Y.useState(()=>ud(window.location.pathname));return Y.useEffect(()=>{const s=()=>e(ud(window.location.pathname));return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[]),{route:n,navigate:s=>{window.history.pushState({},"",s),e(ud(s))}}};function q1(){const n=Y.useMemo(()=>new Oy,[]),{route:e,navigate:r}=Q1(),[s,a]=Y.useState({status:"idle",project:null,error:null});if(Y.useEffect(()=>{if(e.kind!=="editor"){a({status:"idle",project:null,error:null});return}let l=!1;return a({status:"loading",project:null,error:null}),n.loadProject(e.projectId).then(c=>{l||a({status:"ready",project:c,error:null})}).catch(c=>{l||a({status:"error",project:null,error:c instanceof Error?c.message:"Unable to load project"})}),()=>{l=!0}},[e,n]),e.kind==="editor"){if(s.status==="loading")return C.jsx("div",{className:"hm-loading",children:C.jsxs("div",{className:"hm-loading-card",children:[C.jsx("h1",{children:"Loading project..."}),C.jsx("p",{children:"Hang tight while we fetch your project."})]})});if(s.status==="error")return C.jsx("div",{className:"hm-loading",children:C.jsxs("div",{className:"hm-loading-card",children:[C.jsx("h1",{children:"Project unavailable"}),C.jsx("p",{children:s.error}),C.jsx("button",{className:"hm-button",onClick:()=>r("/"),children:"Back to Project Hub"})]})});if(s.status==="ready")return C.jsx(B1,{project:s.project,storage:n,onProjectUpdated:l=>a({status:"ready",project:l,error:null}),onBack:()=>r("/")})}return C.jsx($1,{storage:n,onOpenProject:l=>r(`/editor/${encodeURIComponent(l)}`)})}xy.createRoot(document.getElementById("root")).render(C.jsx(yy.StrictMode,{children:C.jsx(q1,{})}));
//# sourceMappingURL=index-DRh-oVSc.js.map
